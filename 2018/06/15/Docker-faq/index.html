<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->




<!-- keywords -->




<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="Linus Lee">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Linus Lee">
    
    <meta name="keywords" content="Funky's NoteBook,Linus Lee">
    
    <meta name="description" content="It's Funky's NoteBook">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>Docker-FAQ Â· Funky&#39;s NoteBook</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/gun.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- ç™¾åº¦ç»Ÿè®¡  -->
    
    <!-- è°·æ­Œç»Ÿè®¡  --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
</head>

    
        <body class="post-body">
    
    
<!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- posté¡µçš„toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >Funky&#39;s NoteBook</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Docker-FAQ</a>
            </div>
    </div>
    
    <a class="home-link" href=/>Funky's NoteBook</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- ä¸»é¡µ  -->
    
    
    <!-- 404é¡µ  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- æ ‡é¢˜  -->
        <h1 class="intro-title">
            <!-- ä¸»é¡µ  -->
            
            Docker-FAQ
            <!-- 404 -->
            
        </h1>
        <!-- å‰¯æ ‡é¢˜ -->
        <p class="intro-subtitle">
            <!-- ä¸»é¡µå‰¯æ ‡é¢˜  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- æ–‡ç« é¡µmeta -->
        
            <div class="post-intros">
                <!-- æ–‡ç« é¡µæ ‡ç­¾  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "docker">docker</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>å­—æ•°ç»Ÿè®¡: <span class="post-count word-count">39,975</span>é˜…è¯»æ—¶é•¿: <span class="post-count reading-time">158 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2018/06/15</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IEå†…æ ¸
        presto: u.indexOf('Presto') > -1, //operaå†…æ ¸
        webKit: u.indexOf('AppleWebKit') > -1, //è‹¹æœã€è°·æ­Œå†…æ ¸
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //ç«ç‹å†…æ ¸
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //æ˜¯å¦ä¸ºç§»åŠ¨ç»ˆç«¯
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //iosç»ˆç«¯
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //androidç»ˆç«¯æˆ–è€…ucæµè§ˆå™¨
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //æ˜¯å¦ä¸ºiPhoneæˆ–è€…å®‰å“QQæµè§ˆå™¨
        iPad: u.indexOf('iPad') > -1, //æ˜¯å¦ä¸ºiPad
        webApp: u.indexOf('Safari') == -1, //æ˜¯å¦ä¸ºwebåº”ç”¨ç¨‹åºï¼Œæ²¡æœ‰å¤´éƒ¨ä¸åº•éƒ¨
        weixin: u.indexOf('MicroMessenger') == -1, //æ˜¯å¦ä¸ºå¾®ä¿¡æµè§ˆå™¨
        uc: u.indexOf('UCBrowser') > -1 //æ˜¯å¦ä¸ºandroidä¸‹çš„UCæµè§ˆå™¨
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UCä¸æ”¯æŒè·¨åŸŸï¼Œæ‰€ä»¥ç›´æ¥æ˜¾ç¤º
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //æ‰€æœ‰å­—ä½“å¼€å§‹åŠ è½½
          // console.log('loading');
        },
        active: function () {  //æ‰€æœ‰å­—ä½“å·²æ¸²æŸ“
          fontLoaded();
        },
        inactive: function () { //å­—ä½“é¢„åŠ è½½å¤±è´¥ï¼Œæ— æ•ˆå­—ä½“æˆ–æµè§ˆå™¨ä¸æ”¯æŒåŠ è½½
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote>
<p>æœ¬FAQåŸºäº<a href="https://github.com/twang2218" target="_blank" rel="noopener">twang2218</a>å¤§ä½¬Blogçš„100é—®åˆ¶ä½œï¼Œç”¨äºè§£å†³å­¦ä¹ Dockerå‡ºç°çš„å¸¸è§é—®é¢˜ã€‚</p>
</blockquote>
<h1 id="Docker-å¼•æ“ç›¸å…³é—®é¢˜-67"><a href="#Docker-å¼•æ“ç›¸å…³é—®é¢˜-67" class="headerlink" title="Docker å¼•æ“ç›¸å…³é—®é¢˜ (67)"></a>Docker å¼•æ“ç›¸å…³é—®é¢˜ <code>(67)</code></h1><h2 id="æ¦‚å¿µé—®é¢˜-5"><a href="#æ¦‚å¿µé—®é¢˜-5" class="headerlink" title="æ¦‚å¿µé—®é¢˜ (5)"></a>æ¦‚å¿µé—®é¢˜ <code>(5)</code></h2><h3 id="å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ-Docker-å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ"><a href="#å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ-Docker-å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ" class="headerlink" title="å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ Docker å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ"></a>å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ Docker å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</h3><p>è¦æŠŠ Windows å’Œ Linux åˆ†æ¸…æ¥šï¼Œæ›´è¦æŠŠå†…æ ¸(<code>kernel</code>)å’Œç”¨æˆ·ç©ºé—´(<code>userland</code>)åˆ†æ¸…æ¥šã€‚</p>
<p>å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯ç›´æ¥è¿è¡Œäº<code>å®¿ä¸»å†…æ ¸</code>çš„ï¼Œè¿™ç‚¹å’Œå®¿ä¸»è¿›ç¨‹ä¸€è‡´ï¼Œåªæ˜¯å®¹å™¨çš„ <code>userland</code> ä¸åŒï¼Œå®¹å™¨çš„ <code>userland</code> ç”±å®¹å™¨é•œåƒæä¾›ï¼Œä¹Ÿå°±æ˜¯è¯´é•œåƒæä¾›äº† <code>rootfs</code>ã€‚</p>
<p>å‡è®¾å®¿ä¸»æ˜¯ <code>Ubuntu</code>ï¼Œå®¹å™¨æ˜¯ <code>CentOS</code>ã€‚<code>CentOS</code> å®¹å™¨ä¸­çš„è¿›ç¨‹ä¼šç›´æ¥å‘ <code>Ubuntu</code> å®¿ä¸»å†…æ ¸å‘é€ <code>syscall</code>ï¼Œè€Œä¸ä¼šç›´æ¥æˆ–é—´æ¥çš„ä½¿ç”¨ä»»ä½• <code>Ubuntu</code> çš„ <code>userland</code> çš„åº“ã€‚</p>
<p>è¿™ç‚¹å’Œè™šæ‹Ÿæœºæœ‰æœ¬è´¨çš„ä¸åŒï¼Œè™šæ‹Ÿæœºæ˜¯è™šæ‹Ÿç¯å¢ƒï¼Œåœ¨ç°æœ‰ç³»ç»Ÿä¸Šè™šæ‹Ÿä¸€å¥—ç‰©ç†è®¾å¤‡ï¼Œç„¶ååœ¨è™šæ‹Ÿç¯å¢ƒå†…è¿è¡Œä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œåœ¨å†…æ ¸ä¹‹ä¸Šå†è·‘å®Œæ•´ç³»ç»Ÿï¼Œå¹¶åœ¨é‡Œé¢è°ƒç”¨è¿›ç¨‹ã€‚</p>
<p>è¿˜ä»¥ä¸Šé¢çš„ä¾‹å­å»è€ƒè™‘ï¼Œè™šæ‹Ÿæœºä¸­ï¼Œ<code>CentOS</code> çš„è¿›ç¨‹å‘é€ <code>syscall</code> å†…æ ¸è°ƒç”¨ï¼Œè¯¥è¯·æ±‚ä¼šè¢«è™šæ‹Ÿæœºå†…çš„ <code>CentOS</code> çš„å†…æ ¸æ¥åˆ°ï¼Œç„¶å <code>CentOS</code> å†…æ ¸è®¿é—®è™šæ‹Ÿç¡¬ä»¶æ—¶ï¼Œç”±è™šæ‹Ÿæœºçš„æœåŠ¡è½¯ä»¶æˆªè·ï¼Œå¹¶ä½¿ç”¨å®¿ä¸»ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ <code>Ubuntu</code> çš„å†…æ ¸åŠ <code>userland</code> çš„åº“å»æ‰§è¡Œã€‚</p>
<p>è€Œä¸”ï¼ŒLinux å’Œ Windows åœ¨è¿™ç‚¹ä¸Šéå¸¸ä¸åŒã€‚Linux çš„è¿›ç¨‹æ˜¯ç›´æ¥å‘ <code>syscall</code> çš„ï¼Œè€Œ Windows åˆ™æŠŠ <code>syscall</code> éšè—äºä¸€å±‚å±‚çš„ <code>DLL</code> æœåŠ¡ä¹‹åï¼Œå› æ­¤ Windows çš„ä»»ä½•ä¸€ä¸ªè¿›ç¨‹å¦‚æœè¦æ‰§è¡Œï¼Œä¸ä»…ä»…éœ€è¦ Windows å†…æ ¸ï¼Œè¿˜éœ€è¦ä¸€ç¾¤æœåŠ¡æ¥æ”¯æ’‘ï¼Œæ‰€ä»¥å¦‚æœ Windows è¦å®ç°ç±»ä¼¼çš„æœºåˆ¶ï¼Œå®¹å™¨å†…å°†ä¸ä¼šåƒ Linux è¿™æ ·è½»é‡çº§ï¼Œè€Œæ˜¯éå¸¸è‡ƒè‚¿ã€‚çœ‹ä¸€ä¸‹å¾®è½¯ç§»æ¤çš„ Docker å°±éå¸¸æ¸…æ¥šäº†ã€‚</p>
<p>æ‰€ä»¥ä¸è¦æŠŠ Docker å’Œè™šæ‹Ÿæœºå¼„æ··ï¼ŒDocker å®¹å™¨åªæ˜¯ä¸€ä¸ªè¿›ç¨‹è€Œå·²ï¼Œåªä¸è¿‡åˆ©ç”¨é•œåƒæä¾›çš„ <code>rootfs</code> æä¾›äº†è°ƒç”¨æ‰€éœ€çš„ <code>userland</code> åº“æ”¯æŒï¼Œä½¿å¾—è¿›ç¨‹å¯ä»¥åœ¨å—æ§ç¯å¢ƒä¸‹è¿è¡Œè€Œå·²ï¼Œå®ƒå¹¶æ²¡æœ‰è™šæ‹Ÿå‡ºä¸€ä¸ªæœºå™¨å‡ºæ¥ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li>(è‹±æ–‡): <a href="https://www.docker.com/what-docker" target="_blank" rel="noopener">https://www.docker.com/what-docker</a></li>
<li>(ä¸­æ–‡): <a href="https://www.docker-cn.com/what-docker" target="_blank" rel="noopener">https://www.docker-cn.com/what-docker</a></li>
</ul>
<h3 id="Docker-èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ"><a href="#Docker-èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ" class="headerlink" title="Docker èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ"></a>Docker èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ</h3><p>é¦–å…ˆï¼ŒåšæŠ€æœ¯å·¥ä½œï¼Œè¯·çæƒœç”Ÿå‘½ï¼Œè¿œç¦»ç™¾åº¦ï¼›<br>å…¶æ¬¡ï¼Œä¸ç¿»å¢™ã€ä¸ç”¨Googleã€ä¸çœ‹è‹±æ–‡èµ„æ–™ï¼Œé‚£è¯·è½¬è¡Œï¼Œæ²¡æ³•æ··ã€‚</p>
<p>ç„¶åæ˜¯å›ç­”é—®é¢˜ï¼ŒDockerçš„èµ„æ–™å…¶å®å¾ˆä¸°å¯Œï¼Œç‰¹åˆ«æ˜¯å®˜æ–¹æ–‡æ¡£è®²è§£éå¸¸è¯¦ç»†ã€‚</p>
<ul>
<li>(è‹±æ–‡): <a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></li>
<li>(ä¸­æ–‡): <a href="https://docs.docker-cn.com" target="_blank" rel="noopener">https://docs.docker-cn.com</a> (æ–‡æ¡£æœ‰å‘ï¼Œä¸å°‘ä»£ç æ ¼å¼æœ‰é”™)</li>
<li>(è€éº¦çš„ç¿»è¯‘): <a href="https://www.gitbook.com/read/book/octowhale/docker-doc-cn" target="_blank" rel="noopener">https://www.gitbook.com/read/book/octowhale/docker-doc-cn</a></li>
</ul>
<p>å¦å¤–ï¼ŒDockeræœ‰ä¸°å¯Œçš„é•œåƒåº“ï¼ŒDocker Hubï¼Œç‰¹åˆ«æ˜¯å®˜æ–¹(Official)çš„é•œåƒå¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œåˆ¶ä½œæ¯”è¾ƒç²¾è‰¯ã€‚</p>
<p><a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">https://hub.docker.com/explore/</a></p>
<p>æ‰€æœ‰çš„å®˜æ–¹é•œåƒéƒ½æœ‰ <code>Dockerfile</code>ï¼Œä»¥åŠåœ¨githubä¸Šæœ‰å…¨éƒ¨ç”Ÿæˆé•œåƒçš„é…å¥—æ–‡ä»¶ï¼Œéµå¾ªäº†<code>Dockerfile</code>çš„æœ€ä½³å®è·µï¼Œè¿™äº›ä¹Ÿæ˜¯å¾ˆå¥½åœ°å­¦ä¹ èµ„æ–™ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨ YouTube çš„ Docker å®˜æ–¹é¢‘é“ä¸‹æœ‰å‡ ç™¾ä¸ªè§†é¢‘è®²åº§ï¼Œä»åˆçº§åˆ°é«˜çº§ç”¨æˆ·éƒ½èƒ½ä»é‡Œé¢å­¦åˆ°å¾ˆå¤šä¸œè¥¿ã€‚</p>
<p><a href="https://www.youtube.com/user/dockerrun" target="_blank" rel="noopener">https://www.youtube.com/user/dockerrun</a></p>
<h3 id="å¦‚ä½•é€‰æ‹©-Docker-ä¹¦ç±ï¼Ÿ"><a href="#å¦‚ä½•é€‰æ‹©-Docker-ä¹¦ç±ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€‰æ‹© Docker ä¹¦ç±ï¼Ÿ"></a>å¦‚ä½•é€‰æ‹© Docker ä¹¦ç±ï¼Ÿ</h3><p>Docker å±äºæ•æ·å¼€å‘çš„äº§å“ï¼Œå¹¶ä¸”å¤„äºé«˜é€Ÿåˆ›æ–°é˜¶æ®µï¼Œæ¯å¹´éƒ½ä¼šæœ‰å¾ˆå¤šç‰ˆæœ¬å‘å¸ƒã€‚ç”±äºè¿™ç§å¿«é€Ÿå¼€å‘çš„ç‰¹æ€§ï¼ŒDocker ä¸€èˆ¬åªä¿ç•™å‡ ä¸ªç‰ˆæœ¬å†…çš„å‘åå…¼å®¹æ€§ï¼Œå†ä¹‹åå°±ä¼šåºŸå¼ƒã€‚å› æ­¤é€‰æ‹©å›¾ä¹¦çš„æ—¶å€™ï¼Œ<strong>ä¸åº”è¯¥é€‰æ‹©æ¯”å½“å‰ç‰ˆæœ¬ä½è¶…è¿‡2-3ä¸ªç‰ˆæœ¬çš„ä¹¦ç±</strong>ã€‚æ¢å¥è¯è¯´ï¼Œå¸‚é¢ä¸Šå¤§éƒ¨åˆ†ä¹¦ç±ï¼Œç‰¹åˆ«æ˜¯ä¸­æ–‡ä¹¦ç±ã€ç½‘æ–‡ï¼Œå¾ˆå¯èƒ½éƒ½è¿‡æ—¶äº†ã€‚</p>
<p>Docker ç‰ˆæœ¬å·åœ¨ 2017 å¹´ä»¥å‰ï¼Œä½¿ç”¨ <code>&lt;å¤§ç‰ˆæœ¬å·&gt;.&lt;å°ç‰ˆæœ¬å·&gt;.&lt;è¡¥ä¸ç‰ˆæœ¬å·&gt;</code> çš„ç»“æ„ï¼Œé‚£æ—¶ Docker åŸºæœ¬ä¼šä¿æŒ <strong>3 ä¸ªå°ç‰ˆæœ¬å·</strong> ä¹‹å†…çš„å…¼å®¹æ€§ï¼ˆå¦‚æœä¸€ä¸ªç‰¹æ€§å®£å¸ƒåºŸå¼ƒï¼Œä¸€èˆ¬ä¼šåœ¨ 3 ä¸ªç‰ˆæœ¬åæ‰å½»åº•ç§»é™¤ï¼‰ã€‚</p>
<p>è€Œä» 2017 å¹´æ˜¥ä»¥åï¼ŒDocker ä½¿ç”¨äº†æ–°ç‰ˆæœ¬å·ç»“æ„ï¼š<code>&lt;å¹´&gt;.&lt;æœˆ&gt;.&lt;è¡¥ä¸ç‰ˆæœ¬å·&gt;</code>ï¼Œå¹¶ä¸”å°†æ¯æœˆå‘å¸ƒä¸€ä¸ª<strong>å‰æ²¿(Edge)ç‰ˆæœ¬</strong>ï¼Œæ¯å­£åº¦å‘å¸ƒä¸€ä¸ª<strong>ç¨³å®š(Stable)ç‰ˆæœ¬</strong>ã€‚å› æ­¤é€‰æ‹©ä¹¦ç±ä¹Ÿåº”è¯¥ä»¥ä»‹ç» <strong>2-3ä¸ªå­£åº¦ä»¥å†…ç‰ˆæœ¬</strong> çš„ä¹¦ç±ä¸ºå‡†ã€‚é‚£äº›ä»‹ç»ä¸€å¹´ä»¥å‰å‘å¸ƒçš„ Docker ç‰ˆæœ¬çš„ä¹¦ç±ä¸åº”è¯¥å†çœ‹äº†ã€‚</p>
<p>å› æ­¤åœ¨è´­ä¹° Docker å›¾ä¹¦çš„æ—¶å€™ï¼Œåº”è¯¥éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼š<strong>è§‚å¯Ÿä¸€ä¸‹å½“å‰çš„ Docker ç‰ˆæœ¬å·ï¼Œé€‰æ‹©ä¸è¦æ™šäº 3 ä¸ªç‰ˆæœ¬çš„ Docker ä¹¦ç±ã€‚</strong> æ¯”å¦‚å†™è¿™æ®µæ–‡å­—æ—¶ä¸º <code>17.06</code>ï¼Œé‚£ä¹ˆå°±ä¸è¦è´­ä¹°ä»‹ç» Docker <code>1.12</code> åŠå…¶ä»¥å‰ç‰ˆæœ¬çš„ä¹¦ç±äº†ï¼Œå¦åˆ™çœ‹åˆ°çš„å¾ˆå¤šä¸œè¥¿å¯èƒ½å°†ä¼šå› è¿‡æ—¶è€Œæ— æ³•ä½¿ç”¨ï¼Œæˆ–è€…å·²ç»ä¸å¿…å¦‚æ­¤ç¹çæœ‰æ›´ç®€å•çš„æ–¹å¼å»å®ç°äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äº Docker å­¦ä¹ è€Œè¨€ï¼Œ<strong>æœ€å¥½çš„ä¹¦ç±æ˜¯å®˜ç½‘æ–‡æ¡£</strong>ï¼Œå®˜ç½‘çš„æ–‡æ¡£å¾ˆä¸°å¯Œã€‚</p>
<ul>
<li>æ–°æ‰‹æ•™ç¨‹ï¼š<ul>
<li>ï¼ˆè‹±æ–‡ï¼‰ï¼š<a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">https://docs.docker.com/get-started/</a></li>
<li>ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="https://docs.docker-cn.com/get-started/" target="_blank" rel="noopener">https://docs.docker-cn.com/get-started/</a></li>
<li>ï¼ˆè€éº¦çš„ç¿»è¯‘ï¼‰ï¼š<a href="https://docs-cn.docker.octowhale.com/get_started/001.Orientation.html" target="_blank" rel="noopener">https://docs-cn.docker.octowhale.com/get_started/001.Orientation.html</a></li>
</ul>
</li>
<li>Docker è¯¾ç¨‹ï¼š<a href="http://training.play-with-docker.com/" target="_blank" rel="noopener">http://training.play-with-docker.com/</a><ul>
<li>è¿ç»´äººå‘˜è¯¾ç¨‹ï¼š<a href="http://training.play-with-docker.com/ops-landing/" target="_blank" rel="noopener">http://training.play-with-docker.com/ops-landing/</a></li>
<li>å¼€å‘äººå‘˜è¯¾ç¨‹ï¼š<a href="http://training.play-with-docker.com/dev-landing/" target="_blank" rel="noopener">http://training.play-with-docker.com/dev-landing/</a></li>
</ul>
</li>
<li>å¤§é‡çš„ä¾‹å­ï¼š<ul>
<li>ï¼ˆè‹±æ–‡ï¼‰ï¼š<a href="https://docs.docker.com/samples/" target="_blank" rel="noopener">https://docs.docker.com/samples/</a></li>
<li>ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="https://docs.docker-cn.com/samples/" target="_blank" rel="noopener">https://docs.docker-cn.com/samples/</a></li>
</ul>
</li>
<li>ç”¨æˆ·æ–‡æ¡£ï¼š<ul>
<li>ï¼ˆè‹±æ–‡ï¼‰ï¼š<a href="https://docs.docker.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/</a></li>
<li>ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="https://docs.docker-cn.com/engine/userguide/" target="_blank" rel="noopener">https://docs.docker-cn.com/engine/userguide/</a></li>
<li>é•œåƒï¼š<ul>
<li>(è‹±æ–‡ï¼‰ï¼š<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></li>
<li>(è€éº¦çš„ç¿»è¯‘)ï¼š<a href="https://docs-cn.docker.octowhale.com/engine/userguide/eng-image/dockerfile_best-practices.html" target="_blank" rel="noopener">https://docs-cn.docker.octowhale.com/engine/userguide/eng-image/dockerfile_best-practices.html</a></li>
</ul>
</li>
<li>å­˜å‚¨ï¼š<a href="https://docs.docker.com/engine/userguide/storagedriver/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/</a></li>
<li>ç½‘ç»œï¼š<a href="https://docs.docker.com/engine/userguide/networking/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/</a></li>
</ul>
</li>
<li>ç®¡ç†æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/admin/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/</a><ul>
<li>å­˜å‚¨ï¼š<a href="https://docs.docker.com/engine/admin/volumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/volumes/</a></li>
</ul>
</li>
<li>å®‰å…¨ï¼š<a href="https://docs.docker.com/engine/security/security/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/security/</a></li>
<li>é›†ç¾¤ï¼š<a href="https://docs.docker.com/engine/swarm/" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/</a></li>
</ul>
<blockquote>
<p>éƒ¨åˆ†æ–‡æ¡£æœ‰å¯¹åº”å®˜æ–¹çš„ä¸­æ–‡ç¿»è¯‘ï¼Œå¯ä»¥ä» <a href="https://docs.docker-cn.com" target="_blank" rel="noopener">https://docs.docker-cn.com</a> æŸ¥çœ‹ã€‚ä½†æ˜¯ä¸€å®šè¦<strong>æ³¨æ„ä»£ç æ ¼å¼</strong>ï¼Œä¸­æ–‡æ–‡æ¡£ä¸­<strong>è®¸å¤šæ ¼å¼æ˜¯é”™è¯¯çš„</strong>ï¼Œåº”è¯¥å¯¹æ¯”è‹±æ–‡æ–‡æ¡£ä¸­çš„ä»£ç æ¥çœ‹ã€‚</p>
</blockquote>
<p>å¯¹äºæ–°æ‰‹è€Œè¨€ï¼Œåº”è¯¥å…ˆä»æ–°æ‰‹æ•™ç¨‹å¼€å§‹ï¼Œå†…å®¹è¿˜æ˜¯å¾ˆç®€å•æ˜“æ‡‚çš„ï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ã€‚ç„¶åï¼Œå¯ä»¥æŠŠç”¨æˆ·æ–‡æ¡£å¥½å¥½çœ‹ä¸€éï¼Œé‡Œé¢æŠŠå¾ˆå¤š Docker çš„åŸºç¡€æ¦‚å¿µè®²çš„å¾ˆæ¸…æ¥šã€‚æ¦‚å¿µæ¸…æ™°åï¼Œå¯ä»¥å»æŠŠå®˜ç½‘ç»™å‡ºçš„ä¾‹å­å¥½å¥½çš„å­¦ä¹ ä¸€ä¸‹ï¼Œè¿™äº›ä¾‹å­éƒ½æ˜¯å…·ä½“æ€ä¹ˆåº”ç”¨ Docker çš„ï¼Œæœ‰æ–‡å­—è¯´æ˜ä»¥åŠå…·ä½“çš„è€ƒè™‘ï¼Œå¾ˆé€‚åˆå­¦ä¹ ã€‚</p>
<h3 id="æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯-Docker-å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ"><a href="#æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯-Docker-å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯ Docker å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ"></a>æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯ Docker å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ</h3><p>é¦–å…ˆ<em>æ„Ÿè°¢</em>ä¼Ÿå¤§çš„å¢™åŠå…¶å…ˆç¥–ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æœ¬åœ°è¿è¡Œ Docker å®˜æ–¹æ–‡æ¡£çš„ç½‘ç«™ï¼Œä»¥ docker çš„æ–¹å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 80:4000 docs/docker.github.io</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è®¿é—® Docker å®¿ä¸»çš„ <code>80</code> ç«¯å£ï¼Œå¦‚ <a href="http://localhost" target="_blank" rel="noopener">http://localhost</a>ï¼Œå°±ä¼šçœ‹åˆ°å®˜ç½‘æ–‡æ¡£äº†ã€‚</p>
<p>å¯¹äºé‚£äº›è®¿é—®ä¸äº†æˆ‘çš„é—®ç­”å½•çš„ç«¥é‹ï¼ŒåŒæ ·å¯ä»¥ç”¨è¿™æ ·çš„æ–¹å¼æ¥æœ¬åœ°è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d -p 80:80 twang2218/blog.lab99.org</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥è®¿é—®æœ¬åœ° <code>80</code> ç«¯å£çœ‹åˆ°æœ€æ–°çš„é—®ç­”å½•äº†ã€‚</p>
<h3 id="Docker-1-8-ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ"><a href="#Docker-1-8-ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ" class="headerlink" title="Docker 1.8 ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ"></a>Docker 1.8 ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ</h3><p>æ¯ä¸ªç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œå®˜æ–¹åšå®¢ <a href="https://blog.docker.com" target="_blank" rel="noopener">https://blog.docker.com</a> éƒ½ä¼šæœ‰ä¸“é—¨æ–‡ç« æè¿°è¿™ä¸ªç‰ˆæœ¬æœ€ä¸»è¦çš„æ”¹è¿›ã€‚</p>
<ul>
<li><code>1.9</code>: <a href="https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/" target="_blank" rel="noopener">https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/</a></li>
<li><code>1.10</code>: <a href="https://blog.docker.com/2016/02/docker-1-10/" target="_blank" rel="noopener">https://blog.docker.com/2016/02/docker-1-10/</a></li>
<li><code>1.11</code>: <a href="https://blog.docker.com/2016/04/docker-engine-1-11-runc/" target="_blank" rel="noopener">https://blog.docker.com/2016/04/docker-engine-1-11-runc/</a></li>
<li><code>1.12</code>: <a href="https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/" target="_blank" rel="noopener">https://blog.docker.com/2016/06/docker-1-12-built-in-orchestration/</a></li>
</ul>
<p>å¦å¤–ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å­™å®äº®ç»´æŠ¤çš„<a href="https://github.com/allencloud/docker-changelog-chinese" target="_blank" rel="noopener">ã€ŠDocker ä¸­æ–‡ Changelogã€‹</a>ï¼š</p>
<ul>
<li><code>1.10</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.10.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.10.0-changelog.md</a></li>
<li><code>1.11</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.0-changelog.md</a></li>
<li><code>1.11.1</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.1-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.11.1-changelog.md</a></li>
<li><code>1.12</code>: <a href="https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.12.0-changelog.md" target="_blank" rel="noopener">https://github.com/allencloud/docker-changelog-chinese/blob/master/docker-1.12.0-changelog.md</a></li>
</ul>
<p>å…³äº <code>Docker 1.13</code> å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘å†™çš„<a href="/post/docker-2016-11-14-what-is-new-in-docker-1-13.html">ã€ŠDocker 1.13 æ–°å¢åŠŸèƒ½ã€‹</a>ã€‚</p>
<h2 id="å®‰è£…ã€é…ç½®é—®é¢˜-8"><a href="#å®‰è£…ã€é…ç½®é—®é¢˜-8" class="headerlink" title="å®‰è£…ã€é…ç½®é—®é¢˜ (8)"></a>å®‰è£…ã€é…ç½®é—®é¢˜ <code>(8)</code></h2><h3 id="Docker-æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ"><a href="#Docker-æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ" class="headerlink" title="Docker æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ"></a>Docker æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ</h3><p>å¥½å§ï¼Œæˆ‘å†³å®šè¦è£… Docker äº†ï¼Œäºæ˜¯æ¥æ‰“å¼€ <a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">Docker å®‰è£…æ–‡æ¡£</a> (<a href="https://docs.docker-cn.com/engine/installation/" target="_blank" rel="noopener">ä¸­æ–‡</a> çœ‹çœ‹æ€ä¹ˆè£…å§â€¦â€¦å‘ƒï¼Œç„¶åå°±å‚»äº†ï¼Œæ€ä¹ˆè¿™ä¹ˆå¤šç§é€‰æ‹©å•Šï¼Ÿï¼</p>
<p>é¦–å…ˆï¼ŒDocker æœ‰å¥½å‡ ä¸ª<em>ç‰ˆæœ¬</em>ï¼Œç¤¾åŒºç‰ˆï¼ˆCommunity Editionï¼‰ã€ä¼ä¸šåŸºç¡€ç‰ˆï¼ˆEnterprise Edition Basicï¼‰ã€ä¼ä¸šæ ‡å‡†ç‰ˆï¼ˆEnterprise Edition Standardï¼‰ã€ä¼ä¸šé«˜çº§ç‰ˆï¼ˆEnterprise Edition Advancedï¼‰ã€‚å¯¹äºæˆ‘ä»¬ä¸€èˆ¬å­¦ä¹ ä½¿ç”¨è€Œè¨€ï¼Œ<em>ä½¿ç”¨ç¤¾åŒºç‰ˆå°±å·²è¶³å¤Ÿ</em>ï¼Œæ‰€ä»¥è®°ä½<strong>CE</strong>å°±å¯ä»¥äº†ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€å †<em>å¹³å°</em>ç‰¹å®šçš„ç‰ˆæœ¬ï¼ŒDocker for Macã€Docker for Windowsã€Docker Toolboxã€Docker for Azureã€Docker for AWS ç­‰ç­‰ï¼Œè¿˜æœ‰ä¸€å †ä¸åŒ Linux çš„å‘è¡Œç‰ˆã€‚é‚£æˆ‘ä»¬åº”è¯¥ç”¨å“ªä¸ªï¼Ÿå…¶å®ä¸éš¾é€‰æ‹©ï¼Œè¿™éƒ½æ˜¯å¹³å°ç‰¹å®šçš„ä¸œè¥¿å˜›ï¼Œé€‰æ‹©è‡ªå·±å¹³å°å°±å®Œäº†ğŸ˜‚ï¼š</p>
<ul>
<li>macOS å°±é€‰æ‹© <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">Docker for Mac</a>ï¼›<ul>
<li>é˜¿é‡Œäº‘ï¼ˆæœªåŠæ—¶æ›´æ–°ï¼‰ï¼š<a href="https://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/stable/</a></li>
</ul>
</li>
<li>Linux å°±é€‰æ‹©è‡ªå·±å¹³å°çš„ Docker æºï¼š<ul>
<li>Ubuntu: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/</a></li>
<li>Debian: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/debian/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/debian/</a></li>
<li>CentOS: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/centos/</a></li>
<li>Fedora: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/fedora/" target="_blank" rel="noopener">https://docs.docker.com/engine/installation/linux/docker-ce/fedora/</a></li>
</ul>
</li>
<li>Windows è¦éº»çƒ¦äº›ï¼š<ul>
<li>å¦‚æœæ˜¯ <em>Windows 10</em> <em>ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆã€æ•™è‚²ç‰ˆ</em>ï¼Œå¹¶ä¸”ç‰ˆæœ¬åœ¨ <code>10586</code> ä»¥åï¼Œå¹¶ä¸”<em>ä¸æ‰“ç®—</em>åœ¨ Docker è¿è¡Œ<em>åŒæ—¶</em>å†è¿è¡Œå…¶å®ƒè™šæ‹Ÿæœºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è£… <a href="https://docs.docker.com/docker-for-windows/" target="_blank" rel="noopener">Docker for Windows</a>ã€‚<ul>
<li>é˜¿é‡Œäº‘ï¼ˆæœªåŠæ—¶æ›´æ–°ï¼‰ï¼š<a href="https://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/stable/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/stable/</a></li>
</ul>
</li>
<li><strong>å…¶å®ƒæƒ…å†µ</strong>éƒ½è£… <a href="https://docs.docker.com/toolbox/overview/" target="_blank" rel="noopener">Docker Toolbox</a><ul>
<li>é˜¿é‡Œäº‘ï¼š<a href="https://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/" target="_blank" rel="noopener">https://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</a></li>
</ul>
</li>
</ul>
</li>
<li>å¦‚æœæ˜¯ç‰¹å®šäº‘æœåŠ¡å¹³å°ï¼Œå¯ä»¥è€ƒè™‘ç‰¹å®šæœåŠ¡å¹³å°çš„ç‰ˆæœ¬ï¼ˆå½“ç„¶ï¼Œè¿™ä¸æ˜¯å¿…é¡»ï¼‰ï¼š<ul>
<li>AWSï¼š<a href="https://docs.docker.com/docker-for-aws/" target="_blank" rel="noopener">Docker for AWS</a></li>
<li>Azureï¼š<a href="https://docs.docker.com/docker-for-azure/" target="_blank" rel="noopener">Docker for Azure</a></li>
</ul>
</li>
</ul>
<p>æœ€åæ˜¯<em>å‘å¸ƒé€šé“</em>ï¼Œä»ä»Šå¹´åˆå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯ä» <code>1.13</code> ä»¥åï¼ŒDocker ä½¿ç”¨äº†æ–°çš„ç‰ˆæœ¬å·è§„åˆ™ï¼Œå°†é‡‡ç”¨ç±»ä¼¼ Ubuntu é‚£ç§ <code>&lt;å¹´&gt;.&lt;æœˆ&gt;</code> çš„å½¢å¼ï¼Œæ¯”å¦‚ <code>17.03</code>, <code>17.06</code> ç­‰ã€‚å¹¶ä¸”ï¼Œå°†å‘å¸ƒé€šé“åˆ†ä¸º<strong>å‰æ²¿ç‰ˆæœ¬(Edge)</strong>å’Œ<strong>ç¨³å®šç‰ˆæœ¬(Stable)</strong>ã€‚å‰æ²¿é€šé“å°†åŸºæœ¬æ¯ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œè€Œç¨³å®šé€šé“å°†åŸºæœ¬æ¯3ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚è¿™æ · Docker çš„å‘å¸ƒå°†æœ‰è§„å¾‹å¯å¯»ã€‚å¯¹äºå–œæ¬¢å°é²œçš„å¯ä»¥é€‰æ‹©å‰æ²¿ç‰ˆæœ¬ï¼Œå¯¹äºéœ€è¦ç¨³å®šçš„ï¼Œå¯ä»¥é€‰æ‹©ç¨³å®šç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‚è€ƒ<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">å®˜æ–¹å®‰è£…æ–‡æ¡£</a> (<a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">ä¸­æ–‡</a>)é…ç½® Linux æºçš„æ—¶å€™ï¼Œå¦‚æœæ˜¯å›½å†…æœåŠ¡å™¨ï¼Œè¦å°†å…¶ä¸­çš„ <code>https://download.docker.com/linux/</code> æ›¿æ¢ä¸º <code>https://mirrors.aliyun.com/docker-ce/linux/</code>ã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼Œæ–‡æ¡£å¦‚æœè¦æ±‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆå°±<strong>æ›¿æ¢</strong>ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository \</span><br><span class="line">   <span class="string">"deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu \</span></span><br><span class="line"><span class="string">   <span class="variable">$(lsb_release -cs)</span> \</span></span><br><span class="line"><span class="string">   stable"</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å®‰è£… Docker å°±ä¼šä½¿ç”¨é˜¿é‡Œäº‘çš„è½¯ä»¶æºï¼Œè€Œä¸éœ€è¦ç¿»å¢™äº†ã€‚ï¼ˆ<em>æ³¨ï¼šè¿™ä¸æ˜¯åŠ é€Ÿå™¨ï¼Œä¸è¦æé”™äº†ï¼ŒåŠ é€Ÿå™¨ä¾æ—§éœ€è¦é…ï¼</em>ï¼‰</p>
<h3 id="æ˜¯ç›´æ¥ç”¨-yum-apt-get-å®‰è£…-Docker-å—ï¼Ÿ"><a href="#æ˜¯ç›´æ¥ç”¨-yum-apt-get-å®‰è£…-Docker-å—ï¼Ÿ" class="headerlink" title="æ˜¯ç›´æ¥ç”¨ yum / apt-get å®‰è£… Docker å—ï¼Ÿ"></a>æ˜¯ç›´æ¥ç”¨ <code>yum</code> / <code>apt-get</code> å®‰è£… Docker å—ï¼Ÿ</h3><p>å¾ˆå¤šäººé—®åˆ° <code>docker</code>, <code>docker.io</code>, <code>docker-engine</code> ç”šè‡³ <code>lxc-docker</code> éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>å…¶ä¸­ï¼ŒRHEL/CentOS è½¯ä»¶æºä¸­çš„ Docker åŒ…åä¸º <code>docker</code>ï¼›Ubuntu è½¯ä»¶æºä¸­çš„ Docker åŒ…åä¸º <code>docker.io</code>ï¼›è€Œå¾ˆå¤è€çš„ Docker æºä¸­ Docker ä¹Ÿæ›¾å«åš <code>lxc-docker</code>ã€‚è¿™äº›éƒ½æ˜¯<code>éå¸¸è€æ—§</code>çš„ Docker ç‰ˆæœ¬ï¼Œå¹¶ä¸”åŸºæœ¬ä¸ä¼šæ›´æ–°åˆ°æœ€æ–°çš„ç‰ˆæœ¬ï¼Œè€Œå¯¹äºä½¿ç”¨ Docker è€Œè¨€ï¼Œä½¿ç”¨æœ€æ–°ç‰ˆæœ¬éå¸¸é‡è¦ã€‚å¦å¤–ï¼Œ17.04 ä»¥åï¼ŒåŒ…åä» <code>docker-engine</code> æ”¹ä¸º <code>docker-ce</code>ï¼Œå› æ­¤ä»ç°åœ¨å¼€å§‹å®‰è£…ï¼Œåº”è¯¥éƒ½ä½¿ç”¨ <code>docker-ce</code> è¿™ä¸ªåŒ…ã€‚</p>
<blockquote>
<p>ä¸è¦ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„è½¯ä»¶æºä¸­çš„ Docker åŒ…ï¼Œå»ä½¿ç”¨ Docker å®˜æ–¹æºçš„åŒ…ã€‚</p>
</blockquote>
<p>æ­£ç¡®çš„å®‰è£…æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>ä¸€ç§æ˜¯å‚è€ƒå®˜æ–¹å®‰è£…æ–‡æ¡£å»é…ç½® <a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">apt</a> æˆ–è€… <a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/centos/" target="_blank" rel="noopener">yum</a> çš„æºï¼›</li>
<li>å¦ä¸€ç§åˆ™æ˜¯ä½¿ç”¨å®˜æ–¹æä¾›çš„å®‰è£…è„šæœ¬å¿«é€Ÿå®‰è£…ã€‚</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£å¯¹é…ç½®æºçš„æ–¹æ³•å·²ç»æœ‰å¾ˆè¯¦ç»†çš„è®²è§£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œéœ€è¦çš„ç›´æ¥å»çœ‹<a href="https://docs.docker-cn.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ã€‚è¿™é‡Œåªä»‹ç»ä½¿ç”¨å®˜æ–¹çš„è„šæœ¬å¿«é€Ÿå®‰è£…ï¼š</p>
<h4 id="17-04-åŠä»¥åçš„ç‰ˆæœ¬"><a href="#17-04-åŠä»¥åçš„ç‰ˆæœ¬" class="headerlink" title="17.04 åŠä»¥åçš„ç‰ˆæœ¬"></a>17.04 åŠä»¥åçš„ç‰ˆæœ¬</h4><p>ä» <code>17.04</code> ä»¥åï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CHANNEL=stable</span><br><span class="line">curl -fsSL https://get.docker.com/ | sh -s -- --mirror Aliyun</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯å®˜æ–¹è„šæœ¬å®‰è£…ï¼Œé€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šå®‰è£…é€šé“ä¸º <code>stable</code>ï¼Œï¼ˆå¦‚æœå–œæ¬¢å°é²œå¯ä»¥æ”¹ä¸º <code>edge</code>, <code>test</code>ï¼‰ï¼Œå¹¶ä¸”æŒ‡å®šä½¿ç”¨é˜¿é‡Œäº‘çš„æº(apt/yum)æ¥å®‰è£… Docker CE ç‰ˆæœ¬ã€‚</p>
<h4 id="17-03-åŠä»¥å‰çš„ç‰ˆæœ¬"><a href="#17-03-åŠä»¥å‰çš„ç‰ˆæœ¬" class="headerlink" title="17.03 åŠä»¥å‰çš„ç‰ˆæœ¬"></a>17.03 åŠä»¥å‰çš„ç‰ˆæœ¬</h4><p>æ—©æœŸçš„ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æˆ–è€… DaoCloud è€çš„è„šæœ¬å®‰è£…ï¼š</p>
<p>ä½¿ç”¨<code>é˜¿é‡Œäº‘</code>çš„å®‰è£…è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>DaoCloud</code>çš„Dockerå®‰è£…è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure>
<h3 id="ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ-Docker-17-07-äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯-17-05-å‘€ï¼Ÿ"><a href="#ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ-Docker-17-07-äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯-17-05-å‘€ï¼Ÿ" class="headerlink" title="ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ Docker 17.07 äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯ 17.05 å‘€ï¼Ÿ"></a>ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ Docker 17.07 äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯ 17.05 å‘€ï¼Ÿ</h3><p>ä» <strong>17.04</strong> ä»¥åï¼ŒDocker çš„æºçš„ç»“æ„ä»¥åŠåŒ…åéƒ½è¿›è¡Œäº†è°ƒæ•´ï¼Œå› æ­¤å¦‚æœä½ ä½ è¿˜ä½¿ç”¨çš„æ˜¯æ—§çš„æºï¼Œé‚£ä¹ˆéœ€è¦å‚ç…§<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæ›´æ–°æºçš„åœ°å€ä¸ºæ–°çš„æºã€‚å‰é¢çš„é—®ç­”ä¸­å·²ç»ç»™å‡ºäº†é“¾æ¥å’Œæ›¿ä»£ç”¨çš„é˜¿é‡Œäº‘æºé•œåƒåœ°å€ï¼Œå‚ç…§ä¿®æ”¹ï¼ˆapt/yumï¼‰æºã€‚</p>
<p>ä¿®æ”¹å¥½åï¼Œå¸è½½æ—§çš„ <code>docker-engine</code>ï¼Œå®‰è£…æ–°çš„ <code>docker-ce</code> å³å¯ã€‚</p>
<h3 id="docker-pull-å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ"><a href="#docker-pull-å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="docker pull å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ"></a><code>docker pull</code> å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ</h3><p>é¦–å…ˆï¼Œè¦â€œæ„Ÿè°¢â€ä¼Ÿå¤§çš„å¢™åŠå…¶äº²å±ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Docker é•œåƒåŠ é€Ÿå™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒåŠ é€Ÿå™¨å°±æ˜¯é•œåƒã€ä»£ç†çš„æ¦‚å¿µã€‚å›½å†…æœ‰ä¸å°‘æœºæ„æä¾›äº†å…è´¹çš„åŠ é€Ÿå™¨ä»¥æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ï¼Œè¿™é‡Œåˆ—å‡ºä¸€äº›å¸¸ç”¨çš„åŠ é€Ÿå™¨æœåŠ¡ï¼š</p>
<ul>
<li><a href="https://www.docker-cn.com/registry-mirror" target="_blank" rel="noopener">Docker å®˜æ–¹çš„ä¸­å›½é•œåƒåŠ é€Ÿå™¨</a>ï¼šä»2017å¹´6æœˆ9æ—¥èµ·ï¼Œ<strong>Docker å®˜æ–¹æä¾›äº†åœ¨ä¸­å›½çš„åŠ é€Ÿå™¨</strong>ï¼Œä»¥è§£å†³å¢™çš„é—®é¢˜ã€‚ä¸ç”¨æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨åŠ é€Ÿå™¨åœ°å€ï¼š<code>https://registry.docker-cn.com</code> å³å¯ã€‚</li>
<li><a href="http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker" target="_blank" rel="noopener">ä¸­å›½ç§‘æŠ€å¤§å­¦çš„é•œåƒåŠ é€Ÿå™¨</a>ï¼šä¸­ç§‘å¤§çš„åŠ é€Ÿå™¨ä¸ç”¨æ³¨å†Œï¼Œç›´æ¥ä½¿ç”¨åœ°å€ <code>https://docker.mirrors.ustc.edu.cn/</code> é…ç½®åŠ é€Ÿå™¨å³å¯ã€‚è¿›ä¸€æ­¥çš„ä¿¡æ¯å¯ä»¥è®¿é—®ï¼š<a href="http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/help/dockerhub.html?highlight=docker</a></li>
<li><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">é˜¿é‡Œäº‘åŠ é€Ÿå™¨</a>ï¼šæ³¨å†Œé˜¿é‡Œäº‘å¼€å‘è´¦æˆ·(<em>å…è´¹çš„</em>)åï¼Œè®¿é—®è¿™ä¸ªé“¾æ¥å°±å¯ä»¥çœ‹åˆ°åŠ é€Ÿå™¨åœ°å€ï¼š <a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="noopener">https://cr.console.aliyun.com/#/accelerator</a></li>
<li><a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">DaoCloud åŠ é€Ÿå™¨</a>ï¼š<a href="http://account.daocloud.io/signup" target="_blank" rel="noopener">æ³¨å†Œ <code>DaoCloud</code> è´¦æˆ·</a>(<em>æ”¯æŒå¾®ä¿¡ç™»å½•</em>)ï¼Œç„¶åè®¿é—®ï¼š <a href="https://www.daocloud.io/mirror#accelerator-doc" target="_blank" rel="noopener">https://www.daocloud.io/mirror#accelerator-doc</a></li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š<strong>ä¸è¦ä½¿ç”¨</strong>åŠ é€Ÿå™¨ç½‘ç«™æ‰€ç»™çš„é…ç½®è„šæœ¬ï¼Œå®¹æ˜“å¯¼è‡´é”™è¯¯ã€‚æˆ‘ä»¬åªéœ€è·å–å…¶æä¾›çš„<strong>åŠ é€Ÿå™¨åœ°å€</strong>å³å¯ã€‚</p>
</blockquote>
<h4 id="Ubuntu-14-04-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Upstart-çš„ç³»ç»Ÿï¼‰"><a href="#Ubuntu-14-04-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Upstart-çš„ç³»ç»Ÿï¼‰" class="headerlink" title="Ubuntu 14.04 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Upstart çš„ç³»ç»Ÿï¼‰"></a>Ubuntu 14.04 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Upstart çš„ç³»ç»Ÿï¼‰</h4><p><code>Ubuntu 14.04</code> æ˜¯ä½¿ç”¨ <code>upstart</code> è¿›è¡Œç³»ç»Ÿåˆå§‹åŒ–çš„ï¼Œå¯¹äºè¿™ç±»ç³»ç»Ÿï¼Œå¯ä»¥ç”¨é€šè¿‡ç¼–è¾‘é…ç½®æ–‡ä»¶çš„æ–¹æ³•æ¥é…ç½®åŠ é€Ÿå™¨ã€‚</p>
<p>å¦‚æœæ˜¯ <code>Ubuntu 14.04</code>ï¼Œé‚£ä¹ˆç¼–è¾‘ <code>/etc/default/docker</code>ï¼Œåœ¨é‡Œé¢å¯»æ‰¾ <code>DOCKER_OPTS</code> ç¯å¢ƒå˜é‡è®¾ç½®çš„è¿™ä¸€è¡Œï¼Œåœ¨å…¶åæ·»åŠ  <code>-â€“registry-mirror=&lt;åŠ é€Ÿå™¨åœ°å€&gt;</code>ã€‚å¦‚æœå‘ç°è¯¥è¡Œå·²è¢«æ³¨é‡Šï¼Œæˆ–è€…ä¸å­˜åœ¨è¯¥è¡Œï¼Œé‚£ä¹ˆæ–°æ·»ä¸€è¡Œå³å¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨ä½¿ç”¨å®˜æ–¹æºå®‰è£…äº† <code>docker-engine</code> åï¼Œä¼šå»ºç«‹ä¸€ä¸ªé»˜è®¤çš„ <code>/etc/default/docker</code>ï¼Œå…¶ä¸­ç›¸å…³ <code>DOCKER_OPTS</code> çš„è¡Œæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use DOCKER_OPTS to modify the daemon startup options.</span></span><br><span class="line"><span class="comment">#DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"</span></span><br></pre></td></tr></table></figure>
<p>å‡è®¾æˆ‘ä»¬çš„åŠ é€Ÿå™¨åœ°å€ä¸º <code>https://registry.docker-cn.com</code>ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€è¡Œé…ç½®ï¼Œå°†å…¶æ”¹ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use DOCKER_OPTS to modify the daemon startup options.</span></span><br><span class="line"><span class="comment">#DOCKER_OPTS="--dns 8.8.8.8 --dns 8.8.4.4"</span></span><br><span class="line">DOCKER_OPTS=<span class="string">"--registry-mirror=https://registry.docker-cn.com"</span></span><br></pre></td></tr></table></figure>
<p>ä¿å­˜æ–‡ä»¶åï¼Œé‡å¯ Docker å¼•æ“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker restart</span><br><span class="line">docker stop/waiting</span><br><span class="line">docker start/running, process 3620</span><br></pre></td></tr></table></figure>
<p>é‡å¯æˆåŠŸåï¼Œç¡®è®¤ä¸€ä¸‹é…ç½®æ˜¯å¦å·²ç»ç”Ÿæ•ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ps -ef | grep dockerd</span><br><span class="line">root      3620     1  0 04:26 ?        00:00:00 /usr/bin/dockerd --registry-mirror=https://registry.docker-cn.com --raw-logs</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé…ç½®æˆåŠŸï¼Œç”Ÿæ•ˆåè¿™é‡Œå°±ä¼šçœ‹åˆ°è‡ªå·±æ‰€é…ç½®çš„åŠ é€Ÿå™¨çš„å†…å®¹ã€‚</p>
<h4 id="Ubuntu-16-04-æˆ–-CentOS-7-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Systemd-çš„ç³»ç»Ÿï¼‰"><a href="#Ubuntu-16-04-æˆ–-CentOS-7-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Systemd-çš„ç³»ç»Ÿï¼‰" class="headerlink" title="Ubuntu 16.04 æˆ– CentOS 7 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Systemd çš„ç³»ç»Ÿï¼‰"></a>Ubuntu 16.04 æˆ– CentOS 7 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Systemd çš„ç³»ç»Ÿï¼‰</h4><p><code>Ubuntu 16.04</code> å’Œ <code>CentOS 7</code> è¿™ç±»ç³»ç»Ÿéƒ½å·²ç»å¼€å§‹ä½¿ç”¨ <code>systemd</code> è¿›è¡Œç³»ç»Ÿåˆå§‹åŒ–ç®¡ç†äº†ï¼Œå¯¹äºä½¿ç”¨ <code>systemd</code> çš„ç³»ç»Ÿï¼Œåº”è¯¥é€šè¿‡ç¼–è¾‘æœåŠ¡é…ç½®æ–‡ä»¶ <code>docker.service</code> æ¥è¿›è¡ŒåŠ é€Ÿå™¨çš„é…ç½®ã€‚</p>
<p>åœ¨å¯ç”¨æœåŠ¡å</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç›´æ¥ç¼–è¾‘ <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> æ–‡ä»¶æ¥è¿›è¡Œé…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/multi-user.target.wants/docker.service</span><br></pre></td></tr></table></figure>
<p>åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ° <code>ExecStart=</code> è¿™ä¸€è¡Œï¼Œå¹¶ä¸”åœ¨å…¶è¡Œå°¾æ·»åŠ ä¸Šæ‰€éœ€çš„é…ç½®ã€‚å‡è®¾æˆ‘ä»¬çš„åŠ é€Ÿå™¨åœ°å€ä¸º <code>https://registry.docker-cn.com</code>ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·é…ç½®ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ExecStart</span>=/usr/bin/dockerd --registry-mirror=https://registry.docker-cn.com</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨: Docker 1.12 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œ<code>dockerd</code> åº”è¯¥æ¢ä¸º <code>docker daemon</code>ï¼Œæ›´æ—©çš„ç‰ˆæœ¬åˆ™æ˜¯ <code>docker -d</code>ã€‚ä¸è¿‡è¿˜åœ¨ç”¨é‚£äº›ç‰ˆæœ¬çš„ç«¥é‹ï¼Œå‡çº§å§â€¦â€¦ğŸ˜“</p>
</blockquote>
<p>ä¿å­˜é€€å‡ºåï¼Œé‡æ–°åŠ è½½é…ç½®å¹¶å¯åŠ¨æœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>ç¡®è®¤ä¸€ä¸‹é…ç½®æ˜¯å¦å·²ç»ç”Ÿæ•ˆï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ps -ef | grep dockerd</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé…ç½®æˆåŠŸï¼Œç”Ÿæ•ˆåå°±ä¼šåœ¨è¿™é‡Œçœ‹åˆ°è‡ªå·±æ‰€é…ç½®çš„åŠ é€Ÿå™¨ã€‚</p>
<p>åœ¨ <code>1.13</code> ç‰ˆæœ¬ä»¥åï¼Œå¯ä»¥ç›´æ¥ <code>docker info</code> æŸ¥çœ‹ï¼Œå¦‚æœé…ç½®æˆåŠŸï¼ŒåŠ é€Ÿå™¨ <code>Registry Mirror</code> ä¼šåœ¨æœ€ä¸‹é¢åˆ—å‡ºæ¥ã€‚</p>
<p>å¦‚æœé‡å¯åå‘ç°æ— æ³•å¯åŠ¨ <code>docker</code> æœåŠ¡ï¼Œæ£€æŸ¥ä¸€ä¸‹æœåŠ¡æ—¥å¿—ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä¹‹å‰æ‰§è¡Œè¿‡é‚£äº›åŠ é€Ÿå™¨ç½‘ç«™çš„è„šæœ¬ï¼Œå¦‚æœæœ‰åšè¿‡ç±»ä¼¼çš„äº‹æƒ…ï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯è¢«å»ºç«‹äº† <code>/etc/docker/daemon.json</code> ä»¥é…ç½®åŠ é€Ÿå™¨ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œåˆ æ‰è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶ååœ¨é‡å¯æœåŠ¡ã€‚</p>
<p>ä½¿ç”¨é…ç½®æ–‡ä»¶æ˜¯ä»¶å¥½äº‹ï¼Œæ¯”å¦‚ä¿®æ”¹é…ç½®ä¸å¿…é‡å¯æœåŠ¡ï¼Œåªéœ€å‘é€ <code>SIGHUP</code> ä¿¡å·å³å¯ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œç›®å‰åœ¨ <code>dockerd</code> ä¸­ä½¿ç”¨é…ç½®æ–‡ä»¶æ—¶ï¼Œæ— æ³•è¾“å‡ºå½“å‰ç”Ÿæ•ˆé…ç½®ï¼Œå¹¶ä¸”å½“ <code>dockerd</code> çš„å‚æ•°å’Œ <code>daemon.json</code> æ–‡ä»¶ä¸­çš„é…ç½®æœ‰æ‰€é‡å¤æ—¶ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§è¦†ç›–å¦ä¸€ä¸ªï¼Œè€Œæ˜¯ä¼šç›´æ¥å¯¼è‡´å¼•æ“å¯åŠ¨å¤±è´¥ã€‚å¾ˆå¤šäººå‘ç°é…äº†åŠ é€Ÿå™¨å Docker å¯åŠ¨ä¸èµ·æ¥äº†å°±æ˜¯è¿™ä¸ªåŸå› ã€‚è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå»æ‰é‡å¤é¡¹ã€‚ä¸è¿‡åœ¨è¿™äº›é—®é¢˜è§£å†³å‰ï¼Œå»ºè®®ä½¿ç”¨ä¿®æ”¹ <code>docker.service</code> è¿™ç±»åšæ³•æ¥å®ç°é…ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ <code>daemon.json</code>ã€‚æ–¹ä¾¿ <code>ps -ef | grep dockerd</code> ä¸€çœ¼çœ‹åˆ°å®é™…é…ç½®æƒ…å†µã€‚</p>
<h3 id="æ€ä¹ˆä¿®æ”¹äº†-docker-æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ"><a href="#æ€ä¹ˆä¿®æ”¹äº†-docker-æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ" class="headerlink" title="æ€ä¹ˆä¿®æ”¹äº† docker æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ"></a>æ€ä¹ˆä¿®æ”¹äº† docker æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ</h3><p>æ”¹åŠ¨çœŸçš„ç”Ÿæ•ˆäº†ä¹ˆï¼Ÿåœ¨å®¿ä¸»ä¸Šè¿è¡Œä¸€ä¸‹ <code>ps -ef | grep dockerd</code> çœ‹çœ‹ï¼Œè‡ªå·±åšçš„é‚£äº›é…ç½®æœ‰ä¹ˆï¼Ÿæ²¡æœ‰çš„è¯å°±è¯´æ˜æ²¡æœ‰ç”Ÿæ•ˆï¼Œé‚£ä¹ˆå°±è¦æ£€æŸ¥åŸå› äº†ã€‚</p>
<p>é¦–å…ˆï¼Œæ”¹å®Œé…ç½®é‡å¯æœåŠ¡äº†ä¹ˆï¼Ÿè™½ç„¶è¿™ä¸ªé—®é¢˜çœ‹ç€å¾ˆå°ç™½ï¼Œä½†æ˜¯ç¡®å®å¾ˆå¤šäººçŠ¯äº†è¿™ä¸ªå°ç™½çš„é”™è¯¯ã€‚</p>
<ul>
<li><code>Ubuntu 14.04</code>: <code>sudo service docker restart</code></li>
<li><code>Ubuntu 16.04</code>, <code>CentOS 7</code>: <code>sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker</code></li>
</ul>
<p>å¦å¤–ï¼Œä½ æ”¹å¯¹äº†é…ç½®æ–‡ä»¶äº†ä¹ˆï¼Ÿ</p>
<p>ä¸å°‘äººæ‡’å¾—çœ‹è‹±æ–‡æ–‡æ¡£ï¼Œ<em>ç™¾åº¦</em>ä¸ªæ–‡ç« å°±ç…§ç€é…ï¼Œæ—¢ä¸ç®¡ç™¾åº¦å¾—åˆ°çš„æ–‡ç« æ‰€è®²çš„ç³»ç»Ÿï¼Œä¹Ÿæ²¡æ³¨æ„ç‰ˆæœ¬ï¼Œè€Œä¸”ä¸­æ–‡æ–‡ç« å¾€å¾€è‡ªèº«è¡¨è¾¾æè¿°ä¸æ¸…æ¥šï¼Œå¾ˆå¤šæƒ³å½“ç„¶çš„ä¸œè¥¿ï¼Œç»“æœæ— æ•°å‘ã€‚è¿™ä¹ˆç™¾åº¦çš„äººï¼Œå¾ˆæœ‰å¯èƒ½å‹æ ¹å°±æ”¹é”™äº†æ–‡ä»¶ã€‚</p>
<blockquote>
<p>ççˆ±ç”Ÿå‘½ï¼Œè¿œç¦»ç™¾åº¦ã€‚</p>
</blockquote>
<p>æœ€è¿‘ä¸¤å¹´å¤„äº <code>upstart</code> åˆ° <code>systemd</code> çš„è¿‡æ¸¡æœŸï¼Œæ‰€ä»¥é…ç½®æœåŠ¡çš„æ–¹å¼<strong>å¯¹äºä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬æ˜¯ä¸ä¸€æ ·çš„</strong>ï¼Œè¦çœ‹çœ‹è‡ªå·±ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆæ“ä½œç³»ç»Ÿï¼Œä»¥åŠä»€ä¹ˆç‰ˆæœ¬ã€‚</p>
<p>å¯¹äº <code>upstart</code> çš„ç³»ç»Ÿï¼ˆ<code>Ubuntu 14.10</code>æˆ–ä»¥å‰çš„ç‰ˆæœ¬ï¼Œ<code>Debian 7</code>æˆ–ä»¥å‰çš„ç‰ˆæœ¬ï¼‰ï¼Œé…ç½®æ–‡ä»¶å¯èƒ½åœ¨ <code>/etc/default/docker</code>ï¼Œå…¶é…ç½®æ–¹å¼åŸºæœ¬æ˜¯é…ç½® <code>DOCKER_*</code> çš„ç¯å¢ƒå˜é‡ã€‚</p>
<p>è€Œå¯¹äº <code>systemd</code> çš„ç³»ç»Ÿ(<code>Ubuntu 15.04</code>åŠä»¥åçš„ç‰ˆæœ¬ï¼Œ<code>Debian 8</code>åŠä»¥åçš„ç‰ˆæœ¬ï¼Œ<code>CentOS 7</code>/<code>RHEL 7</code>åŠä»¥åçš„ç‰ˆæœ¬)ï¼Œé…ç½®æ–‡ä»¶åˆ™åœ¨ <code>systemd</code> çš„é…ç½®ç›®å½•ä¸‹ã€‚</p>
<p>é¦–å…ˆåº”è¯¥ <code>enable</code> è¯¥æœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> ï¼ˆåªè¦æœåŠ¡ <code>enable</code> äº†ï¼Œé‚£ä¹ˆä¸ç®¡ä»€ä¹ˆç³»ç»Ÿï¼Œåº”è¯¥éƒ½ä¼šåœ¨è¿™ä¸ªä½ç½®çœ‹åˆ°é…ç½®æ–‡ä»¶ï¼‰</p>
<blockquote>
<p>è¦æ³¨æ„ <code>upstart</code> çš„æœåŠ¡é…ç½®æ–‡ä»¶å’Œ <code>systemd</code> çš„é…ç½®æ–‡ä»¶çš„æ ¼å¼æ˜¯<strong>ä¸åŒçš„</strong>ï¼Œä¸è¦æ‹¿ç€ <code>upstart</code> çš„é…ç½®è¡Œç›´æ¥å¤åˆ¶ç²˜è´´åˆ° <code>systemd</code> çš„é…ç½®æ–‡ä»¶é‡Œï¼Œä¸¤ç äº‹å„¿ï¼Œè¯·å…ˆå­¦ä¹ åŸºç¡€çŸ¥è¯†ã€‚</p>
</blockquote>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<br><a href="https://docs.docker.com/engine/admin/configuring/#ubuntu" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/configuring/#ubuntu</a><br><a href="https://docs.docker.com/engine/admin/systemd/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/systemd/</a></p>
<h3 id="å¦‚æœ-Docker-å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ"><a href="#å¦‚æœ-Docker-å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ" class="headerlink" title="å¦‚æœ Docker å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ"></a>å¦‚æœ Docker å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ</h3><p>åœ¨ <code>1.12</code> ä»¥å‰çš„ç‰ˆæœ¬ç¡®å®å¦‚æ­¤ï¼Œä½†æ˜¯ä» <code>1.12</code> å¼€å§‹ï¼ŒDocker å¼•æ“åŠ å…¥äº† <code>--live-restore</code> å‚æ•°ï¼Œä½¿ç”¨è¯¥å‚æ•°å¯ä»¥é¿å…å¼•æ“å‡çº§ã€é‡å¯å¯¼è‡´å®¹å™¨åœæ­¢æœåŠ¡çš„æƒ…å†µã€‚</p>
<p>é»˜è®¤æƒ…å†µè¯¥åŠŸèƒ½ä¸ä¼šè¢«å¯åŠ¨ï¼Œå¦‚éœ€å¯åŠ¨ï¼Œéœ€è¦é…ç½® <code>docker</code> æœåŠ¡é…ç½®æ–‡ä»¶ã€‚æ¯”å¦‚ <code>Ubuntu 16.04</code> è¿™ç±» <code>systemd</code> çš„ç³»ç»Ÿï¼Œå¯ä»¥ä¿®æ”¹ <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> æ–‡ä»¶ï¼Œåœ¨ <code>ExecStart=</code> åé¢é…ç½®ä¸Š <code>--live-restore</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=/usr/bin/dockerd \</span><br><span class="line">    --registry-mirror=https://registry.docker-cn.com \</span><br><span class="line">    --live-restore</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ ¼å¼ä¸­ä½¿ç”¨äº†è¡Œå°¾ <code>\</code> çš„æ¢è¡Œå½¢å¼ï¼Œè¿™ç‚¹å’Œ <code>bash</code> è„šæœ¬ä¸€æ ·ï¼Œ<code>systemd</code> æ”¯æŒè¿™ç§æ¢è¡Œå½¢å¼ï¼Œå¦‚å¯¹æ­¤ä¸äº†è§£å¯ä»¥å…ˆå»å­¦ä¹  <code>bash</code> ç¨‹åºè®¾è®¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>--live-restore</code> å’Œ <code>Swarm Mode</code> ä¸å…¼å®¹ï¼Œæ‰€ä»¥åœ¨é›†ç¾¤ç¯å¢ƒä¸­ä¸è¦ä½¿ç”¨ã€‚å®é™…ä¸Šé›†ç¾¤ç¯å¢ƒä¹Ÿä¸ç”¨æ‹…å¿ƒæŸä¸ªæœåŠ¡å™¨é‡å¯çš„é—®é¢˜ï¼Œå› ä¸ºå…¶ä¸Šçš„æœåŠ¡éƒ½ä¼šè¢«è°ƒåº¦åˆ°åˆ«çš„èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤æœåŠ¡å¹¶ä¸ä¼šè¢«ä¸­æ–­ã€‚</p>
<p>å‚è€ƒæ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://docs.docker.com/engine/admin/live-restore/" target="_blank" rel="noopener">https://docs.docker.com/engine/admin/live-restore/</a></li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆæ‰§è¡Œ-docker-å‘½ä»¤ä¼šæŠ¥-permission-denied-æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ‰§è¡Œ-docker-å‘½ä»¤ä¼šæŠ¥-permission-denied-æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ‰§è¡Œ docker å‘½ä»¤ä¼šæŠ¥ permission denied æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ‰§è¡Œ docker å‘½ä»¤ä¼šæŠ¥ <code>permission denied</code> æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ</h3><p>åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œä¸€äº›æ–°è£…äº† docker çš„ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨äº† <code>sudo</code> å‘½ä»¤å®‰è£…å¥½äº† Docker åï¼Œå‘ç°å½“å‰ç”¨æˆ·ä¸€æ‰§è¡Œ <code>docker</code> å‘½ä»¤ï¼Œå°±ä¼šæŠ¥æ²¡æƒé™çš„é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dial unix /var/run/docker.sock: permission denied</span><br></pre></td></tr></table></figure>
<p>ä¸€äº›æ¥è‡ªäº Windows ä¸–ç•Œçš„äººï¼Œå°±ä¼šè¹¦å‡ºæ¥è¯´ï¼Œç”¨ <code>root</code> å‘€â€¦â€¦ğŸ˜“ã€‚è€Œå¦ä¸€äº›æœ‰åŸºæœ¬å¸¸è¯†ã€çŸ¥é“ä¸åº”è¯¥ä½¿ç”¨ <code>root</code> äººå¯èƒ½ä¼šè¯´ï¼Œé‚£å°±ç”¨ <code>sudo docker</code> å§ã€‚è¿™ä¸¤è€…éƒ½æ˜¯ä¸å¯¹çš„ï¼Œæˆ–è€…è¯´ä¸åˆé€‚çš„ã€‚</p>
<p>è¯´ä½¿ç”¨ <code>root</code> çš„äººï¼Œåº”è¯¥å›å»å¥½å¥½å­¦ä¹ ä¸€ä¸‹ Linux æƒé™å¸¸è¯†ã€‚ä¸€èˆ¬ <strong>ä¸åº”è¯¥ç›´æ¥ä½¿ç”¨ <code>root</code> ç”¨æˆ·</strong>ï¼Œç›´æ¥ä½¿ç”¨ <code>root</code> ç”¨æˆ·ä¸ä»…ä»…æ˜¯ä¸¥é‡çš„è¿åäº†å®‰å…¨è§„èŒƒï¼Œè€Œä¸”ä¹Ÿæå®¹æ˜“é€ æˆæ“ä½œäº‹æ•…ã€‚è¿™ä¸æ˜¯ Windows ä¸–ç•Œï¼ŒLinux/Unix ä¸–ç•Œæ˜¯æœ‰ä¸¥æ ¼çš„æƒé™è¦æ±‚çš„ï¼Œåªåº”è¯¥<strong>ä½¿ç”¨æœ€å°çš„æƒé™åšäº‹æƒ…</strong>ã€‚å¦‚æœè¿˜ä¸ç†Ÿæ‚‰ Linux æƒé™æœºåˆ¶ï¼Œé‚£å°±å»å­¦ä¹ ä¸€ä¸‹ï¼Œä¸è¦æŠŠ Windows çš„åæ¯›ç—…å¸¦è¿‡æ¥ã€‚</p>
<p>è¯´ä½¿ç”¨ <code>sudo docker</code> çš„äººï¼Œæ€è·¯æ˜¯å¯¹çš„ï¼Œå› ä¸ºç†è§£äº†å¹³æ—¶æ“ä½œåº”è¯¥ä½¿ç”¨æ™®é€šç”¨æˆ·ï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™ï¼Œæ‰ <code>sudo</code> æå‡æƒé™è¿›è¡Œæ“ä½œã€‚ä½†æ˜¯é—®é¢˜å°±åœ¨è¿™ä¸ª<strong>éœ€è¦</strong>äºŒå­—ä¸Šï¼Œäº‹å®ä¸Šï¼Œ<strong>ä¸éœ€è¦ <code>root</code> æƒé™å°±å¯ä»¥æ‰§è¡Œ <code>docker</code> å‘½ä»¤</strong>ã€‚</p>
<p>å…¶å®å¦‚æœçœ‹è¿‡<a href="https://docs.docker.com/engine/installation/linux/linux-postinstall/#manage-docker-as-a-non-root-user" target="_blank" rel="noopener">å®˜æ–¹å®‰è£…æ–‡æ¡£</a>çš„è¯éƒ½ä¼šçŸ¥é“ï¼Œåªéœ€è¦å°†æ“ä½œ <code>docker</code> çš„ç”¨æˆ·ï¼ŒåŠ å…¥ <code>docker</code> ç»„ï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·æ—¢æ‹¥æœ‰äº†æ“ä½œ <code>docker</code> çš„æƒé™ã€‚</p>
<p>å› æ­¤ï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥æŠŠå½“å‰ç”¨æˆ·åŠ å…¥ <code>docker</code> ç»„ï¼Œ<strong>é€€å‡ºã€é‡æ–°ç™»å½•ç³»ç»Ÿå</strong>ï¼Œæ‰§è¡Œ <code>docker info</code> çœ‹ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°å¯ä»¥ä¸ç”¨ <code>sudo</code> ç›´æ¥æ‰§è¡Œ <code>docker</code> å‘½ä»¤äº†ã€‚</p>
<p>å¦‚æœéœ€è¦æ·»åŠ åˆ«çš„ç”¨æˆ·ï¼Œå°†å…¶ä¸­çš„ <code>$USER</code> æ¢æˆå¯¹åº”çš„ç”¨æˆ·åå³å¯ã€‚</p>
<p>å°†ç”¨æˆ·æ·»åŠ åˆ° <code>docker</code> ç»„ï¼Œå¯ä»¥é¿å… <code>root</code> æƒé™è¯¯æ“ä½œçš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äº <code>dockerd</code> å¼•æ“æ˜¯è¿è¡Œåœ¨ <code>root</code> ç”¨æˆ·ä¸‹çš„ï¼Œè€Œ <code>docker</code> ç»„æˆå‘˜æœ‰æƒé™æŒ‡æŒ¥ <code>dockerd</code> å¼•æ“æ¥åšå¾ˆå¤šäº‹æƒ…ï¼Œå› æ­¤ï¼Œè¯¥ç”¨æˆ·å®é™…ä¸Šæ˜¯æ‹¥æœ‰äº† <code>root</code> çš„æƒé™çš„ã€‚å› æ­¤ä¸è¦è¯¯è§£äº†å°†å½“å‰ç”¨æˆ·åŠ å…¥ <code>docker</code> ç»„çš„åˆè¡·ï¼Œè¿™å’Œèµ‹äºˆç”¨æˆ· <code>sudo</code> æƒåŠ›æ˜¯ä¸€æ ·çš„ï¼Œå¯ä¸æ˜¯è¯´è¿™ä¸ªç”¨æˆ·å°±æ²¡æœ‰ <code>root</code> æƒé™äº†ã€‚è¿™æ ·åšï¼Œåªæ˜¯ä¸å†éœ€è¦ä½¿ç”¨ <code>sudo</code> äº†ï¼Œä¹Ÿé™ä½äº†ä½¿ç”¨ <code>sudo</code> æ—¶è¯¯æ“ä½œçš„å¯èƒ½ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™é‡Œè¯´çš„æƒé™é—®é¢˜ï¼Œå…¨æ˜¯æŒ‡ä½¿ç”¨ <code>docker</code> å‘½ä»¤æ“ä½œ<strong>æœ¬æœº</strong> <code>dockerd</code> å¼•æ“ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ <code>/var/run/docker.sock</code> æ¥æ“ä½œ <code>dockerd</code> å¼•æ“çš„äº‹æƒ…ï¼Œåªæœ‰è¿™ç§æœ‰ä¹‹å‰è¯´çš„æƒé™ç±»çš„é—®é¢˜ã€‚</p>
<p>è€Œ <code>docker</code> å‘½ä»¤è¿˜å¯ä»¥æ“ä½œ<strong>è¿œç¨‹</strong> <code>dockerd</code> çš„å¼•æ“ï¼Œä¹Ÿå°±æ˜¯ <code>-H</code> å‚æ•°ï¼Œæˆ–è€… <code>DOCKER_HOST</code> ç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„ Docker ä¸»æœºã€‚è¿™ç§æƒ…å†µé€šè®¯èµ°çš„æ˜¯ç½‘ç»œã€HTTPï¼Œä¸ä¼šæœ‰æƒé™é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸æ‰“ç®—æ“ä½œæœ¬æœºçš„ <code>dockerd</code> å¼•æ“ï¼Œåˆ™ä¸éœ€è¦å°†ç”¨æˆ·åŠ å…¥ <code>docker</code> ç»„ï¼Œä¹Ÿæ˜¯å¯ä»¥æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ã€‚</p>
<h3 id="æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª-xmrig-çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"><a href="#æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª-xmrig-çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ" class="headerlink" title="æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª xmrig çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"></a>æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª <code>xmrig</code> çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h3><blockquote>
<p><strong>è­¦å‘Šï¼ï¼</strong>ä½ çš„æœåŠ¡å™¨å·²ç»<strong>è¢«å…¥ä¾µäº†</strong>ï¼ï¼</p>
</blockquote>
<p>æœ‰äº›äººæœåŠ¡å™¨ä¸Šçº¿åï¼Œå‘ç°çªç„¶å¤šäº†ä¸€äº›è«åå¥‡å¦™çš„å®¹å™¨åœ¨è·‘ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">IMAGE           COMMAND                  CREATED      STATUS                      PORTS    NAMES</span><br><span class="line">linuxrun/cpu2   <span class="string">"./xmrig --algo=cr...."</span>  4 hours ago  Exited (137) 7 minutes ago           linuxrun-cpu2</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ˜¯æœ‰äººåœ¨ä½ çš„ Docker å®¿ä¸»ä¸Šè·‘äº†ä¸€ä¸ª <code>xmrig</code> æŒ–çŸ¿çš„è •è™«ï¼Œå› ä¸ºä½ çš„ç³»ç»Ÿ<strong>è¢«å…¥ä¾µäº†</strong>â€¦â€¦ğŸ˜“ã€‚</p>
<p>åœ¨ä½ å¤§å« Docker ä¸å®‰å…¨ä¹‹å‰ï¼Œ<em>å…ˆæ£€è®¨ä¸€ä¸‹è‡ªå·±</em>æ˜¯ä¸æ˜¯åšé”™äº†ã€‚æ£€æŸ¥ä¸€ä¸‹ <code>dockerd</code> å¼•æ“æ˜¯å¦é…ç½®é”™è¯¯ï¼š<code>ps -ef | grep dockerd</code>ï¼Œå¦‚æœä½ çœ‹åˆ°çš„æ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep dockerd</span><br><span class="line">123  root   12:34   /usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨å…¶ä¸­æ²¡æœ‰ <code>--tlsverify</code> ç±»çš„ TLS é…ç½®å‚æ•°ï¼Œé‚£å°±è¯´æ˜ä½ å°†ä½ çš„ç³»ç»Ÿå¤§é—¨å½»åº•æ•å¼€äº†ã€‚è¿™æ˜¯é…ç½®ä¸Š<strong>ä¸¥é‡çš„å®‰å…¨äº‹æ•…</strong>ã€‚</p>
<p><code>-H tcp://0.0.0.0:2375</code> æ˜¯è¯´ä½ å¸Œæœ›é€šè¿‡ <code>2375/tcp</code> æ¥æ“æ§ä½ çš„ Docker å¼•æ“ï¼Œä½†æ˜¯å¦‚æœä½ æ²¡æœ‰åŠ  <code>--tlsverify</code> ç±»çš„é…ç½®ï¼Œå°±è¡¨æ˜ä½ çš„æ„å›¾æ˜¯<strong>å…è®¸ä»»ä½•äºº</strong>æ¥æ“æ§ä½ çš„ Docker å¼•æ“ï¼Œè€Œ Docker å¼•æ“æ˜¯ä»¥ <code>root</code> æƒé™å…è®¸çš„ï¼Œå› æ­¤ï¼Œä½ ç­‰äºç»™äº†<strong>åœ°çƒä¸Šæ‰€æœ‰äºº</strong>ä½ æœåŠ¡å™¨çš„ <code>root</code> æƒé™ï¼Œè€Œä¸”<strong>è¿˜æ²¡å¯†ç </strong>ã€‚</p>
<p>å¦‚æœç»†å¿ƒä¸€äº›ï¼Œå»æŸ¥çœ‹ <code>dockerd</code> çš„æœåŠ¡æ—¥å¿—ï¼Œ<code>journalctl -u docker</code>ï¼Œæ—¥å¿—ä¸­æœ‰æ˜ç¡®çš„è­¦å‘Šï¼Œè­¦å‘Šä½ è¿™ä¹ˆé…ç½®æ˜¯æç«¯å±é™©çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ journalctl -u docker</span><br><span class="line">...</span><br><span class="line">level=warning msg=<span class="string">"[!] DON'T BIND ON ANY IP ADDRESS WITHOUT setting --tlsverify IF YOU DON'T KNOW WHAT YOU'RE DOING [!]"</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™äº›ä½ éƒ½å¿½ç•¥äº†ï¼Œé‚£ä¹ˆè¢«åˆ«äººå…¥ä¾µå°±å¤ªæ­£å¸¸äº†ï¼Œæ˜¯ä½ è‡ªå·±<em>é‚€è¯·</em>åˆ«äººæ¥çš„ã€‚æ‰€ä»¥ï¼ŒDocker æœåŠ¡ç»‘å®šç«¯å£ï¼Œ<em>å¿…é¡»</em>é€šè¿‡ TLS ä¿æŠ¤èµ·æ¥ï¼Œä»¥åè§åˆ° <code>-H tcp://....</code> å°±è¦æ£€æŸ¥ï¼Œæ˜¯å¦åŒæ—¶é…ç½®äº† <code>--tlsverify</code>ï¼Œå¦‚æœæ²¡çœ‹åˆ°ï¼Œé‚£å°±æ˜¯ä¸¥é‡é”™è¯¯äº†ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ <code>docker-machine</code> è¿›è¡Œ Docker å®¿ä¸»ç®¡ç†çš„åŸå› ï¼Œå› ä¸º <code>docker-machine</code> ä¼šå¸®ä½ åˆ›å»ºè¯ä¹¦ã€é…ç½® TLSï¼Œç¡®ä¿æœåŠ¡å™¨çš„å®‰å…¨ã€‚</p>
<p>è¿›ä¸€æ­¥å¦‚ä½•é…ç½® TLS çš„ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/security/https/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/https/</a><br>å…³äº <code>docker-machine</code> çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹å®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">https://docs.docker.com/machine/overview/</a></p>
<h2 id="ç½‘ç»œé—®é¢˜-13"><a href="#ç½‘ç»œé—®é¢˜-13" class="headerlink" title="ç½‘ç»œé—®é¢˜ (13)"></a>ç½‘ç»œé—®é¢˜ <code>(13)</code></h2><h3 id="æ€ä¹ˆå›ºå®šå®¹å™¨-IP-åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ–-IP-åœ°å€æ€ä¹ˆåŠï¼Ÿ"><a href="#æ€ä¹ˆå›ºå®šå®¹å™¨-IP-åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ–-IP-åœ°å€æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ€ä¹ˆå›ºå®šå®¹å™¨ IP åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ– IP åœ°å€æ€ä¹ˆåŠï¼Ÿ"></a>æ€ä¹ˆå›ºå®šå®¹å™¨ IP åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ– IP åœ°å€æ€ä¹ˆåŠï¼Ÿ</h3><p>ä¸€èˆ¬æƒ…å†µæ˜¯ä¸éœ€è¦æŒ‡å®šå®¹å™¨ IP åœ°å€çš„ã€‚è¿™ä¸æ˜¯è™šæ‹Ÿä¸»æœºï¼Œè€Œæ˜¯å®¹å™¨ã€‚å…¶åœ°å€æ˜¯ä¾›å®¹å™¨é—´é€šè®¯çš„ï¼Œå®¹å™¨é—´åˆ™ä¸ç”¨ IP ç›´æ¥é€šè®¯ï¼Œè€Œä½¿ç”¨<code>å®¹å™¨å</code>ã€<code>æœåŠ¡å</code>ã€<code>ç½‘ç»œåˆ«å</code>ã€‚</p>
<p>ä¸ºäº†ä¿æŒå‘åå…¼å®¹ï¼Œ<code>docker run</code> åœ¨ä¸æŒ‡å®š <code>--network</code> æ—¶ï¼Œæ‰€åœ¨çš„ç½‘ç»œæ˜¯ <code>default bridge</code>ï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸‹ï¼Œéœ€è¦ä½¿ç”¨ <code>--link</code> å‚æ•°æ‰å¯ä»¥è®©ä¸¤ä¸ªå®¹å™¨æ‰¾åˆ°å¯¹æ–¹ã€‚</p>
<p>è¿™æ˜¯æœ‰å±€é™æ€§çš„ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„æ˜¯ <code>/etc/hosts</code> é™æ€æ–‡ä»¶æ¥è¿›è¡Œçš„è§£æï¼Œæ¯”å¦‚ä¸€ä¸ªä¸»æœºæŒ‚äº†åï¼Œé‡æ–°å¯åŠ¨IPå¯èƒ½ä¼šæ”¹å˜ã€‚è™½ç„¶è¯´è¿™ç§æ”¹å˜Dockeræ˜¯å¯èƒ½æ›´æ–°<code>/etc/hosts</code>æ–‡ä»¶ï¼Œä½†æ˜¯è¿™æœ‰è¯¸å¤šé—®é¢˜ï¼Œå¯èƒ½ä¼šå› ä¸ºç«äº‰å†’é™©å¯¼è‡´ <code>/etc/hosts</code> æ–‡ä»¶æŸæ¯ï¼Œä¹Ÿå¯èƒ½è¿˜åœ¨è¿è¡Œçš„å®¹å™¨åœ¨å–å¾— <code>/etc/hosts</code> çš„è§£æç»“æœåï¼Œä¸å†å»ç›‘è§†è¯¥æ–‡ä»¶æ˜¯å¦å˜åŠ¨ã€‚ç§ç§åŸå› éƒ½å¯èƒ½ä¼šå¯¼è‡´æ—§çš„ä¸»æœºæ— æ³•é€šè¿‡å®¹å™¨åè®¿é—®åˆ°æ–°çš„ä¸»æœºã€‚</p>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/</a></p>
<p>å¦‚æœå¯èƒ½ä¸è¦ä½¿ç”¨è¿™ç§è¿‡æ—¶çš„æ–¹å¼ï¼Œè€Œæ˜¯ç”¨ä¸‹é¢è¯´çš„è‡ªå®šä¹‰ç½‘ç»œçš„æ–¹å¼ã€‚</p>
<p>è€Œå¯¹äºæ–°çš„ç¯å¢ƒï¼ˆDocker 1.10ä»¥ä¸Šï¼‰ï¼Œåº”è¯¥ç»™å®¹å™¨å»ºç«‹è‡ªå®šä¹‰ç½‘ç»œï¼ŒåŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¯¹æ–¹å®¹å™¨çš„å®¹å™¨åã€æœåŠ¡åã€ç½‘ç»œåˆ«åæ¥æ‰¾åˆ°å¯¹æ–¹ã€‚è¿™ä¸ªæ—¶å€™å¸®åŠ©è¿›è¡ŒæœåŠ¡å‘ç°çš„æ˜¯Docker å†…ç½®çš„DNSã€‚æ‰€ä»¥ï¼Œæ— è®ºå®¹å™¨æ˜¯å¦é‡å¯ã€æ›´æ¢IPï¼Œå†…ç½®çš„DNSéƒ½èƒ½æ­£ç¡®æŒ‡å®šåˆ°å¯¹æ–¹çš„ä½ç½®ã€‚</p>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/work-with-networks/#linking-containers-in-user-defined-networks</a></p>
<p>å»ºè®®å‚è€ƒä¸€ä¸‹æˆ‘å†™çš„ LNMP çš„ä¾‹å­ï¼š<br><a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<h3 id="å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„-etc-hosts-æ–‡ä»¶ï¼Ÿ"><a href="#å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„-etc-hosts-æ–‡ä»¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ï¼Ÿ"></a>å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„ <code>/etc/hosts</code> æ–‡ä»¶ï¼Ÿ</h3><p>å®¹å™¨å†…çš„ <code>/etc/hosts</code> æ–‡ä»¶ä¸åº”è¯¥è¢«éšæ„ä¿®æ”¹ï¼Œå¦‚æœå¿…é¡»æ·»åŠ ä¸»æœºåå’Œ IP åœ°å€æ˜ å°„å…³ç³»ï¼Œåº”è¯¥åœ¨ <code>docker run</code> æ—¶ä½¿ç”¨ <code>--add-host</code> å‚æ•°ï¼Œæˆ–è€…åœ¨ <code>docker-compose.yml</code> ä¸­æ·»åŠ  <code>extra_hosts</code> é¡¹ã€‚</p>
<p>ä¸è¿‡åœ¨ç”¨ä¹‹å‰ï¼Œåº”è¯¥å†è€ƒè™‘ä¸€ä¸‹çœŸçš„éœ€è¦ä¿®æ”¹ <code>/etc/hosts</code> ä¹ˆï¼Ÿå¦‚æœåªæ˜¯ä¸ºäº†å®¹å™¨é—´äº’ç›¸è®¿é—®ï¼Œåº”è¯¥å»ºç«‹è‡ªå®šä¹‰ç½‘ç»œï¼Œå¹¶ä½¿ç”¨ Docker å†…ç½®çš„ DNS æœåŠ¡ã€‚</p>
<p>å¯ä»¥å‚è€ƒä¸€ä¸‹æˆ‘å†™çš„è¿™ä¸ª LNMP å¤šå®¹å™¨äº’è¿çš„ä¾‹å­ï¼š<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<h3 id="æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼ŸDockerfile-ä¸­çš„EXPOSEå’Œ-docker-run-p-æœ‰å•¥åŒºåˆ«ï¼Ÿ"><a href="#æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼ŸDockerfile-ä¸­çš„EXPOSEå’Œ-docker-run-p-æœ‰å•¥åŒºåˆ«ï¼Ÿ" class="headerlink" title="æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼ŸDockerfile ä¸­çš„EXPOSEå’Œ docker run -p æœ‰å•¥åŒºåˆ«ï¼Ÿ"></a>æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼Ÿ<code>Dockerfile</code> ä¸­çš„<code>EXPOSE</code>å’Œ <code>docker run -p</code> æœ‰å•¥åŒºåˆ«ï¼Ÿ</h3><p>Dockerä¸­æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªå«åš <code>EXPOSE</code> ï¼Œä¸€ä¸ªå«åš <code>PUBLISH</code> ã€‚</p>
<ul>
<li><code>EXPOSE</code> æ˜¯é•œåƒ/å®¹å™¨å£°æ˜è¦æš´éœ²è¯¥ç«¯å£ï¼Œå¯ä»¥ä¾›å…¶ä»–å®¹å™¨ä½¿ç”¨ã€‚è¿™ç§å£°æ˜ï¼Œåœ¨æ²¡æœ‰è®¾å®š <code>--icc=false</code>çš„æ—¶å€™ï¼Œå®é™…ä¸Šåªæ˜¯ä¸€ç§æ ‡æ³¨ï¼Œå¹¶ä¸å¼ºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰å£°æ˜ <code>EXPOSE</code> çš„ç«¯å£ï¼Œå…¶å®ƒå®¹å™¨ä¹Ÿå¯ä»¥è®¿é—®ã€‚ä½†æ˜¯å½“å¼ºåˆ¶ <code>--icc=false</code> çš„æ—¶å€™ï¼Œé‚£ä¹ˆåªæœ‰ <code>EXPOSE</code> çš„ç«¯å£ï¼Œå…¶å®ƒå®¹å™¨æ‰å¯ä»¥è®¿é—®ã€‚</li>
<li><code>PUBLISH</code> åˆ™æ˜¯é€šè¿‡æ˜ å°„å®¿ä¸»ç«¯å£ï¼Œå°†å®¹å™¨çš„ç«¯å£å…¬å¼€äºå¤–ç•Œï¼Œä¹Ÿå°±æ˜¯è¯´å®¿ä¸»ä¹‹å¤–çš„æœºå™¨ï¼Œå¯ä»¥é€šè¿‡è®¿é—®å®¿ä¸»IPåŠå¯¹åº”çš„è¯¥æ˜ å°„ç«¯å£ï¼Œè®¿é—®åˆ°å®¹å™¨å¯¹åº”ç«¯å£ï¼Œä»è€Œä½¿ç”¨å®¹å™¨æœåŠ¡ã€‚</li>
</ul>
<p><code>EXPOSE</code> çš„ç«¯å£å¯ä»¥ä¸ <code>PUBLISH</code>ï¼Œè¿™æ ·åªæœ‰å®¹å™¨é—´å¯ä»¥è®¿é—®ï¼Œå®¿ä¸»ä¹‹å¤–æ— æ³•è®¿é—®ã€‚è€Œ <code>PUBLISH</code> çš„ç«¯å£ï¼Œå¯ä»¥ä¸äº‹å…ˆ <code>EXPOSE</code>ï¼Œæ¢å¥è¯è¯´ <code>PUBLISH</code> ç­‰äºåŒæ—¶éšå¼å®šä¹‰äº†è¯¥ç«¯å£è¦ <code>EXPOSE</code>ã€‚</p>
<p><code>docker run</code> å‘½ä»¤ä¸­çš„ <code>-p</code>, <code>-P</code> å‚æ•°ï¼Œä»¥åŠ <code>docker-compose.yml</code> ä¸­çš„  <code>ports</code> éƒ¨åˆ†ï¼Œå®é™…ä¸Šå‡æ˜¯æŒ‡ <code>PUBLISH</code>ã€‚</p>
<p>å°å†™ <code>-p</code> æ˜¯ç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸º <code>[å®¿ä¸»IP:]&lt;å®¿ä¸»ç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt;</code>ï¼Œå…¶ä¸­å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œæ¯”å¦‚ï¼š<code>1000-2000:1000-2000</code>ã€‚å¯¹äºå¤šå®¿ä¸»çš„æœºå™¨ï¼Œå¯ä»¥æŒ‡å®šå®¿ä¸»IPï¼Œä¸æŒ‡å®šå®¿ä¸»IPæ—¶ï¼Œå®ˆæŠ¤æ‰€æœ‰æ¥å£ã€‚</p>
<p>å¤§å†™ <code>-P</code> åˆ™æ˜¯è‡ªåŠ¨æ˜ å°„ï¼Œå°†æ‰€æœ‰å®šä¹‰ <code>EXPOSE</code> çš„ç«¯å£ï¼Œéšæœºæ˜ å°„åˆ°å®¿ä¸»çš„æŸä¸ªç«¯å£ã€‚</p>
<h3 id="æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª-p-ä¹ˆï¼Ÿ"><a href="#æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª-p-ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª -p ä¹ˆï¼Ÿ"></a>æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª <code>-p</code> ä¹ˆï¼Ÿ</h3><p><code>-p</code> æ˜¯å¯ä»¥ç”¨èŒƒå›´çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p 8001-8010:8001-8010</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆ-p-åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-p-åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ -p åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ <code>-p</code> åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ</h3><p>é¦–å…ˆï¼Œå½“ç„¶æ˜¯æ£€æŸ¥è¿™ä¸ª docker çš„å®¹å™¨æ˜¯å¦å¯åŠ¨æ­£å¸¸ï¼š <code>docker ps</code>ã€<code>docker top &lt;å®¹å™¨ID&gt;</code>ã€<code>docker logs &lt;å®¹å™¨ID&gt;</code>ã€<code>docker exec -it &lt;å®¹å™¨ID&gt; bash</code>ç­‰ï¼Œè¿™æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ’éšœçš„å‘½ä»¤ï¼›å¦‚æœæ˜¯ <code>docker-compose</code> ä¹Ÿæœ‰å…¶å¯¹åº”çš„è¿™ä¸€ç»„å‘½ä»¤ï¼Œæ‰€ä»¥æ’éšœå¾ˆå®¹æ˜“ã€‚</p>
<p>å¦‚æœç¡®ä¿æœåŠ¡ä¸€åˆ‡æ­£å¸¸ï¼Œç”šè‡³åœ¨å®¹å™¨é‡Œï¼Œå¯ä»¥è®¿é—®åˆ°è¿™äº›æœåŠ¡ï¼Œ<code>docker ps</code> ä¹Ÿæ˜¾ç¤ºå‡ºäº†ç«¯å£æ˜ å°„æˆåŠŸï¼Œé‚£ä¹ˆå°±éœ€è¦<strong>æ£€æŸ¥é˜²ç«å¢™</strong>äº†ã€‚</p>
<h4 id="æœ¬æœºé˜²ç«å¢™"><a href="#æœ¬æœºé˜²ç«å¢™" class="headerlink" title="æœ¬æœºé˜²ç«å¢™"></a>æœ¬æœºé˜²ç«å¢™</h4><p>åœ¨ Docker è¿è¡Œçš„ç³»ç»Ÿä¸Š<strong>ä¸åº”è¯¥è¿è¡Œä»»ä½•é˜²ç«å¢™</strong>â€¦â€¦æ²¡é”™ï¼Œè¯´ä½ å‘¢ï¼ŒCentOS çš„ <strong>firewalld</strong> å’Œ Ubuntu çš„ <strong>ufw</strong> åŒå­¦ã€‚ç”±äº Docker ä½¿ç”¨ <code>iptables</code> è§„åˆ™æ¥è¿›è¡Œç½‘ç»œæ•°æ®æµçš„æ§åˆ¶ï¼Œè€Œé‚£äº›é˜²ç«å¢™æ€»ä»¥ä¸ºåªæœ‰è‡ªå·±æ’°å†™ <code>iptables</code>ï¼Œä»è€Œç»å¸¸ä¼šå¯¼è‡´ Docker è®¾ç½®äº†ä¸€äº›è§„åˆ™ï¼Œç„¶åè½¬çœ¼å°±è¢« <code>firewalld</code> æˆ– <code>ufw</code> ç»™æ¸…äº†ï¼Œç‰¹åˆ«æ˜¯èµ·ã€åœé˜²ç«å¢™æœåŠ¡çš„æ—¶å€™ã€‚ä»è€Œå¯¼è‡´ Docker çš„ç½‘ç»œä»å¤–ç•Œæ— æ³•è®¿é—®ã€‚</p>
<blockquote>
<p>ä¸ºäº†é¿å… <code>iptables</code> çš„è§„åˆ™å¹²æ‰°ï¼Œä¸è¦åœ¨è¿è¡Œ Docker çš„æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œ<strong>ä»»ä½•é˜²ç«å¢™</strong>æˆ–é…ç½®è‡ªå®šä¹‰çš„ <code>iptables</code> è§„åˆ™ï¼Œ<em>é™¤é</em>ä½ éå¸¸æ¸…æ¥šä½ åœ¨åšä»€ä¹ˆï¼Œå¹¶ä¸”çŸ¥é“ä¼šäº§ç”Ÿä»€ä¹ˆåæœã€‚<br>å¦å¤–ï¼Œ<strong>å…³é—­é˜²ç«å¢™åï¼Œè®°å¾—é‡å¯ç³»ç»Ÿ</strong>ï¼Œè‡³å°‘æ˜¯é‡å¯ Docker æœåŠ¡ã€‚å¦åˆ™é˜²ç«å¢™çš„èµ·ã€åœã€åˆ·æ–°è¿™ç±»è¡Œä¸ºä¼šå¯¼è‡´æ¸…ç©º Docker è®¾ç½®çš„ç½‘ç»œè§„åˆ™ï¼Œè€Œå¯¼è‡´å®¹å™¨å†…çš„ç½‘ç»œæ— æ³•å’Œå¤–éƒ¨äº’è”ã€‚</p>
</blockquote>
<h4 id="è¾¹ç•Œé˜²ç«å¢™"><a href="#è¾¹ç•Œé˜²ç«å¢™" class="headerlink" title="è¾¹ç•Œé˜²ç«å¢™"></a>è¾¹ç•Œé˜²ç«å¢™</h4><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡å™¨ï¼Œé‚£ä¹ˆé™¤äº†æœ¬æœºé˜²ç«å¢™å¤–ï¼Œäº‘æœåŠ¡çš„æœåŠ¡å•†ä¸€èˆ¬ä¼šæä¾›è¾¹ç•Œé˜²ç«å¢™æœåŠ¡ï¼Œæ¯”å¦‚å®‰å…¨ç»„ã€å®‰å…¨ç­–ç•¥ç±»çš„ä¸œè¥¿ã€‚æœ‰äº›æœåŠ¡å™¨ä¸ºäº†å®‰å…¨èµ·è§ï¼Œé»˜è®¤åªå¼€é€šå¿…éœ€çš„ <code>22</code> ç«¯å£ç»™ SSH ä½¿ç”¨ï¼Œè€Œå…¶å®ƒç«¯å£å±è”½ã€‚è¿™ä¹Ÿæ˜¯å¯èƒ½å¯¼è‡´è¿œç¨‹è®¿é—®æœåŠ¡å™¨ <code>-p</code> ç«¯å£å¤±è´¥çš„åŸå› ä¹‹ä¸€ã€‚å¦‚æœä½ å‘ç°ä½ åœ¨æœåŠ¡å™¨æœ¬åœ°è®¿é—®æœåŠ¡ï¼Œæ¯”å¦‚ <code>curl localhost</code> æ²¡æœ‰é˜»ç¢ï¼Œä½†æ˜¯è¿œç¨‹è®¿é—®è¯¥æœåŠ¡å°±è¿æ¥å¤±è´¥çš„è¯ï¼Œé‚£ä¹ˆåº”è¯¥å»æ£€æŸ¥äº‘æœåŠ¡å•†çš„å®‰å…¨è®¾ç½®ï¼Œæ˜¯å¦å¿˜è®°äº†å¼€å¯æ‰€éœ€çš„ç«¯å£ã€‚</p>
<h3 id="vethxxxx-è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ"><a href="#vethxxxx-è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ" class="headerlink" title="vethxxxx è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ"></a><code>vethxxxx</code> è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ</h3><p><code>åŒ—äº¬-ZZ-è™¾ç±³</code>æä¾›äº†ä¸€ä¸ªå¥½åŠæ³•ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                       DRIVER</span><br><span class="line">56f04389b8f0        dockerlnmp_backend         bridge</span><br><span class="line">094fcb269385        dockerlnmp_frontend        bridge</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œçš„ <code>NETWORK ID</code>ï¼Œç„¶åè¿è¡Œ <code>ip a | grep veth</code>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ip a | grep veth</span><br><span class="line">12: veth22996d2@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">14: veth34ace9a@if13: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">16: veth0bb3771@if15: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-56f04389b8f0 state UP group default</span><br><span class="line">22: veth399b874@if21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</span><br><span class="line">24: vethf24a0a9@if23: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-094fcb269385 state UP group default</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œçš„ <code>br-56f04389b8f0</code> ä»¥åŠ <code>br-094fcb269385</code>ï¼Œ<code>br-</code> åé¢çš„æ˜¯ä¸Šé¢çš„<code>ç½‘ç»œid</code>ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡º <code>veth</code> å’Œ Docker ç½‘ç»œçš„å¯¹åº”å…³ç³»ï¼Œè€Œå®¹å™¨éƒ½æ˜¯è¿æ¥åˆ°äº†æŸä¸ªDockerç½‘ç»œä¸Šçš„ï¼Œä»è€Œå°±æœ‰äº†å®¹å™¨å’Œ <code>veth</code> çš„å¯¹åº”å…³ç³»ã€‚</p>
<p>å¯¹äºæŸä¸ªç½‘ç»œå‡ºç°äº†å¤šä¸ª <code>veth</code> çš„æƒ…å†µï¼Œå¯ä»¥è§‚å¯Ÿ <code>veth22996d2@if11</code> åé¢çš„ <code>if11</code> è¿™éƒ¨åˆ†ï¼Œå’Œå®¹å™¨å†…çš„ <code>ip addr</code> çš„ç»“æœï¼Œä¸€èˆ¬ <code>å¥‡-å¶</code>æ˜¯ä¸€å¯¹ã€‚</p>
<h3 id="å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ"><a href="#å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ" class="headerlink" title="å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ"></a>å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ</h3><p>å¦‚æœæ˜¯ä½¿ç”¨ <code>docker run</code>ï¼Œé‚£å¾ˆä¸å¹¸ï¼Œä¸€æ¬¡åªå¯ä»¥è¿æ¥ä¸€ä¸ªç½‘ç»œï¼Œå› ä¸º <code>docker run</code> çš„ <code>--network</code> å‚æ•°åªå¯ä»¥å‡ºç°ä¸€æ¬¡ï¼ˆå¦‚æœå‡ºç°å¤šæ¬¡ï¼Œæœ€åçš„ä¼šè¦†ç›–ä¹‹å‰çš„ï¼‰ã€‚ä¸è¿‡å®¹å™¨è¿è¡Œåï¼Œå¯ä»¥ç”¨å‘½ä»¤ <code>docker network connect</code> è¿æ¥å¤šä¸ªç½‘ç»œã€‚</p>
<p>å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªç½‘ç»œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create mynet1</span><br><span class="line">$ docker network create mynet2</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿æ¥è¿™ä¸¤ä¸ªç½‘ç»œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name web --network mynet1 nginx</span><br><span class="line">$ docker network connect mynet2 web</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¦‚æœä½¿ç”¨ <code>docker-compose</code> é‚£å°±æ²¡è¿™ä¸ªé—®é¢˜äº†ã€‚å› ä¸ºå®é™…ä¸Šï¼Œ<a href="https://docs.docker.com/engine/reference/api/docker_remote_api_v1.24/#/create-a-container" target="_blank" rel="noopener"><code>Docker Remote API</code></a> æ˜¯æ”¯æŒä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªç½‘ç»œçš„ï¼Œä½†æ˜¯ä¼°è®¡æ˜¯å‘½ä»¤è¡Œä¸Šä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥ <code>docker run</code> é™å®šä¸ºåªå¯ä»¥ä¸€æ¬¡è¿ä¸€ä¸ªã€‚<code>docker-compose</code> ç›´æ¥å°±å¯ä»¥å°†æœåŠ¡çš„å®¹å™¨è¿å…¥å¤šä¸ªç½‘ç»œï¼Œæ²¡æœ‰é—®é¢˜ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">mynet1</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">mynet2</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">    mynet1:</span></span><br><span class="line"><span class="attr">    mynet2:</span></span><br></pre></td></tr></table></figure>
<h3 id="Docker-å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ"><a href="#Docker-å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ" class="headerlink" title="Docker å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ"></a>Docker å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ</h3><p>Docker è·¨èŠ‚ç‚¹å®¹å™¨ç½‘ç»œäº’è”ï¼Œæœ€é€šç”¨çš„æ˜¯ä½¿ç”¨ <code>overlay</code> ç½‘ç»œã€‚</p>
<p>ä¸€ä»£ Swarm å·²ç»ä¸å†ä½¿ç”¨ï¼Œå®ƒè¦æ±‚ä½¿ç”¨ <code>overlay</code> ç½‘ç»œå‰å…ˆå‡†å¤‡å¥½åˆ†å¸ƒå¼é”®å€¼åº“ï¼Œæ¯”å¦‚ <code>etcd</code>, <code>consul</code> æˆ– <code>zookeeper</code>ã€‚ç„¶ååœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ Docker å¼•æ“ä¸­ï¼Œé…ç½® <code>--cluster-store</code> å’Œ <code>--cluster-advertise</code> å‚æ•°ã€‚è¿™æ ·æ‰å¯ä»¥äº’è¿ã€‚å¯ä»¥å‚è€ƒæˆ‘å†™çš„ LNMP å®¹å™¨äº’è”ä¾‹å­ä¸­çš„ <a href="https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/run1.sh" target="_blank" rel="noopener"><strong>run1.sh</strong></a> è¿™ä¸ªè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ˜¯åˆ©ç”¨ <code>docker-machine</code>è‡ªåŠ¨å»ºç«‹ Swarm å¹¶ä¸”é…ç½®å¥½ <code>overlay</code> çš„è„šæœ¬ï¼Œå¯ä»¥åˆ†æå…¶æµç¨‹ã€‚</p>
<p>ç°åœ¨éƒ½åœ¨ä½¿ç”¨äºŒä»£ Swarmï¼Œä¹Ÿå°±æ˜¯ <code>Docker Swarm Mode</code>ï¼Œéå¸¸ç®€å•ï¼Œåªè¦ <code>docker swarm init</code> å»ºç«‹é›†ç¾¤ï¼Œå…¶å®ƒèŠ‚ç‚¹ <code>docker swarm join</code> åŠ å…¥é›†ç¾¤åï¼Œé›†ç¾¤å†…çš„æœåŠ¡å°±è‡ªåŠ¨å»ºç«‹äº† <code>overlay</code> ç½‘ç»œäº’è”èƒ½åŠ›ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯<strong>å¤šç½‘å¡ç¯å¢ƒ</strong>ï¼Œæ— è®ºæ˜¯ <code>docker swarm init</code> è¿˜æ˜¯ <code>docker swarm join</code>ï¼Œéƒ½ä¸è¦å¿˜è®°ä½¿ç”¨å‚æ•° <code>--advertise-addr</code> æŒ‡å®šå®£å‘Šåœ°å€ï¼Œå¦åˆ™è‡ªåŠ¨é€‰æ‹©çš„åœ°å€å¾ˆå¯èƒ½ä¸æ˜¯ä½ æœŸæœ›çš„ï¼Œä»è€Œå¯¼è‡´é›†ç¾¤äº’è”å¤±è´¥ã€‚æ ¼å¼ä¸º <code>--advertise-addr &lt;åœ°å€&gt;:&lt;ç«¯å£&gt;</code>ï¼Œåœ°å€å¯ä»¥æ˜¯ IP åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘å¡æ¥å£ï¼Œæ¯”å¦‚ <code>eth0</code>ã€‚ç«¯å£é»˜è®¤ä¸º <code>2377</code>ï¼Œå¦‚æœä¸æ”¹åŠ¨å¯ä»¥å¿½ç•¥ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™æ˜¯ä¾›<strong>æœåŠ¡</strong>ä½¿ç”¨çš„ <code>overlay</code>ï¼Œå› æ­¤æ‰€æœ‰ <code>docker service create</code> çš„æœåŠ¡å®¹å™¨å¯ä»¥ä½¿ç”¨è¯¥ç½‘ç»œï¼Œè€Œ <code>docker run</code> ä¸å¯ä»¥ä½¿ç”¨è¯¥ç½‘ç»œï¼Œé™¤éæ˜ç¡®è¯¥ç½‘ç»œä¸º <code>--attachable</code>ã€‚</p>
<p>å…³äº <code>overlay</code> ç½‘ç»œçš„è¿›ä¸€æ­¥ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/userguide/networking/get-started-overlay/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/get-started-overlay/</a></p>
<p>è™½ç„¶é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>overlay</code> ç½‘ç»œï¼Œä½†è¿™å¹¶ä¸æ˜¯å”¯ä¸€çš„å¤šå®¿ä¸»äº’è”æ–¹æ¡ˆã€‚Docker å†…ç½®äº†ä¸€äº›å…¶å®ƒçš„äº’è”æ–¹æ¡ˆï¼Œæ¯”å¦‚æ•ˆç‡æ¯”è¾ƒé«˜çš„ <code>macvlan</code>ã€‚å¦‚æœåœ¨å±€åŸŸç½‘ç»œç¯å¢ƒä¸‹ï¼Œå¯¹ <code>overlay</code> çš„é¢å¤–å¼€é”€ä¸æ»¡æ„ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ <code>macvlan</code> ä»¥åŠ <code>ipvlan</code>ï¼Œè¿™æ˜¯æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆã€‚<br><a href="https://docs.docker.com/engine/userguide/networking/get-started-macvlan/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/get-started-macvlan/</a></p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„ç½‘ç»œå¯ä»¥ç”¨æ¥è¿›è¡Œè·¨å®¿ä¸»äº’è”ï¼Œå¯ä»¥è®¿é—®å®˜ç½‘å¯¹åº”æ–‡æ¡£è¿›ä¸€æ­¥æŸ¥çœ‹ï¼š<a href="https://docs.docker.com/engine/extend/legacy_plugins/#/network-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/network-plugins</a></p>
<h3 id="æ˜æ˜-docker-network-ls-ä¸­çœ‹åˆ°äº†å»ºç«‹çš„-overlay-ç½‘ç»œï¼Œæ€ä¹ˆ-docker-run-è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ"><a href="#æ˜æ˜-docker-network-ls-ä¸­çœ‹åˆ°äº†å»ºç«‹çš„-overlay-ç½‘ç»œï¼Œæ€ä¹ˆ-docker-run-è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ" class="headerlink" title="æ˜æ˜ docker network ls ä¸­çœ‹åˆ°äº†å»ºç«‹çš„ overlay ç½‘ç»œï¼Œæ€ä¹ˆ docker run è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ"></a>æ˜æ˜ <code>docker network ls</code> ä¸­çœ‹åˆ°äº†å»ºç«‹çš„ <code>overlay</code> ç½‘ç»œï¼Œæ€ä¹ˆ <code>docker run</code> è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ</h3><p>å¦‚æœåœ¨ <code>docker network ls</code> ä¸­çœ‹åˆ°äº†å¦‚ä¸‹çš„ <code>overlay</code> ç½‘ç»œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">...</span><br><span class="line">24pz359114y0        mynet               overlay             swarm</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆè¿™ä¸ªåä¸º <code>mynet</code> çš„ç½‘ç»œæ˜¯ä¸å¯ä»¥è¿æ¥åˆ° <code>docker run</code> çš„å®¹å™¨ã€‚å¦‚æœè¯•å›¾è¿æ¥åˆ™ä¼šå‡ºç°æŠ¥é”™ã€‚</p>
<p>å¦‚æœæ˜¯ 1.12 çš„ç³»ç»Ÿï¼Œä¼šçœ‹åˆ°è¿™æ ·æŠ¥é”™ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm --network mynet busybox</span><br><span class="line">docker: Error response from daemon: network mynet not found.</span><br><span class="line">See <span class="string">'docker run --help'</span>.</span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™è¯´ <code>mynet</code> ç½‘ç»œæ‰¾ä¸åˆ°ã€‚å…¶å®å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œä¼šçœ‹åˆ°è¿™ä¸ªåä¸º <code>mynet</code> çš„ç½‘ç»œï¼Œé©±åŠ¨æ˜¯ <code>overlay</code> æ²¡æœ‰é”™ï¼Œä½†å®ƒçš„ <code>Scope</code> æ˜¯ <code>swarm</code>ã€‚è¿™ä¸ªæ„æ€æ˜¯è¯´è¿™ä¸ªç½‘ç»œæ˜¯åœ¨äºŒä»£ <code>Swarm</code> ç¯å¢ƒä¸­å»ºç«‹çš„ <code>overlay</code> ç½‘ç»œï¼Œå› æ­¤åªå¯ä»¥ç”± <code>Swarm</code> ç¯å¢ƒä¸‹çš„æœåŠ¡å®¹å™¨æ‰å¯ä»¥ä½¿ç”¨ã€‚è€Œ <code>docker run</code> æ‰€è¿è¡Œçš„åªæ˜¯é›¶æ•£çš„å®¹å™¨ï¼Œå¹¶é <code>Service</code>ï¼Œå› æ­¤è‡ªç„¶åœ¨é›¶æ•£å®¹å™¨æ‰€èƒ½ä½¿ç”¨çš„ç½‘ç»œä¸­ï¼Œä¸å­˜åœ¨å« <code>mynet</code> ç½‘ç»œã€‚</p>
<p><code>docker run</code> å¯ä»¥ä½¿ç”¨çš„ <code>overlay</code> ç½‘ç»œæ˜¯ <code>Scope</code> ä¸º <code>global</code> çš„ <code>overlay</code> ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨å¤–ç½®é”®å€¼åº“æ‰€å»ºç«‹çš„ <code>overlay</code> ç½‘ç»œï¼Œæ¯”å¦‚ä¸€ä»£ <code>Swarm</code> çš„ <code>overlay</code> ç½‘ç»œã€‚</p>
<p>è¿™ç‚¹åœ¨ 1.13 åç¨æœ‰å˜åŒ–ã€‚å¦‚æœæ˜¯ 1.13 ä»¥åçš„ç³»ç»Ÿï¼Œä¼šçœ‹åˆ°è¿™æ ·çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm --network mynet busybox</span><br><span class="line">docker: Error response from daemon: Could not attach to network mynet: rpc error: code = 7</span><br><span class="line"> desc = network mynet not manually attachable.</span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™ä¿¡æ¯ä¸å†è¯´ç½‘ç»œæ‰¾ä¸åˆ°ï¼Œè€Œæ˜¯è¯´è¿™ä¸ª <code>mynet</code> ç½‘ç»œæ— æ³•è¿æ¥ã€‚è¿™æ˜¯ç”±äºä» 1.13 å¼€å§‹ï¼Œå…è®¸åœ¨å»ºç«‹ç½‘ç»œçš„æ—¶å€™å£°æ˜è¿™ä¸ªç½‘ç»œæ˜¯å¦å¯ä»¥è¢«é›¶æ•£çš„å®¹å™¨æ‰€è¿æ¥ã€‚å¦‚æœ <code>docker network create</code> åŠ äº† <code>--attachable</code> çš„å‚æ•°ï¼Œé‚£ä¹ˆåœ¨åæœŸï¼Œè¿™ä¸ªç½‘ç»œæ˜¯å¯ä»¥è¢«æ™®é€šå®¹å™¨æ‰€è¿æ¥çš„ã€‚</p>
<p>ä½†æ˜¯è¿™æ˜¯åœ¨å®‰å…¨æ¨¡å‹ä¸Šå¼€äº†ä¸€ä¸ªå£å­ï¼Œå› æ­¤ï¼Œé»˜è®¤ä¸å…è®¸æ™®é€šå®¹å™¨é“¾æ¥ï¼Œå¹¶ä¸”ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<h3 id="ä½¿ç”¨-Swarm-Mode-çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå«-ingress-çš„-overlay-ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#ä½¿ç”¨-Swarm-Mode-çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå«-ingress-çš„-overlay-ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="ä½¿ç”¨ Swarm Mode çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå« ingress çš„ overlay ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>ä½¿ç”¨ <code>Swarm Mode</code> çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå« <code>ingress</code> çš„ <code>overlay</code> ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>åœ¨å¯ç”¨äº†äºŒä»£ Swarm åï¼Œå¯èƒ½ä¼šåœ¨ç½‘ç»œåˆ—è¡¨æ—¶çœ‹åˆ°ä¸€ä¸ªåä¸º <code>ingress</code> çš„ overlay ç½‘ç»œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">6beb824623a4        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">f3f636574c7a        docker_gwbridge     bridge              <span class="built_in">local</span></span><br><span class="line">cfeb2513a4a3        host                host                <span class="built_in">local</span></span><br><span class="line">88smbt683r5p        ingress             overlay             swarm</span><br><span class="line">24pz359114y0        mynet               overlay             swarm</span><br><span class="line">d35d69ece740        none                null                <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ª <code>overlay</code> ç½‘ç»œï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æˆ‘ä»¬åˆ›å»ºçš„ <code>mynet</code>ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ Docker å¼•æ“è‡ªå·±åˆ›å»ºçš„ <code>ingress</code>ï¼Œä»é©±åŠ¨å’Œ <code>Scope</code> å¯ä»¥çœ‹å‡ºä¸¤ä¸ªç½‘ç»œéƒ½æ˜¯ç»™ Swarm Mode ä½¿ç”¨çš„ <code>overlay</code> ç½‘ç»œã€‚</p>
<p><code>ingress</code> æ˜¯ <code>overlay</code> ç½‘ç»œï¼Œä½†å¹¶ä¸æ˜¯æ™®é€šçš„ <code>overlay network</code>ï¼Œå®ƒæ˜¯ä¸ºè¾¹ç•Œè¿›å…¥æµé‡ç‰¹æ®Šå‡†å¤‡çš„ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œå­˜åœ¨äºé›†ç¾¤ä¸­æ¯ä¸€ä¸ªDockerå®¿ä¸»ä¸Šï¼Œä¸éœ€è¦é¢å¤–å»ºç«‹ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>docker service create -p 80:80</code> è¿™ç§å½¢å¼åˆ›å»ºä¸€ä¸ªæœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æ±‚æ˜ å°„é›†ç¾¤ç«¯å£ <code>80</code> åˆ°æœåŠ¡å®¹å™¨çš„ <code>80</code> ç«¯å£ä¸Šã€‚å…¶æ•ˆæœæ˜¯è®¿é—®ä»»ä¸€èŠ‚ç‚¹çš„ <code>80</code> ç«¯å£ï¼Œå³ä½¿è¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰è¿è¡Œæˆ‘ä»¬æ‰€éœ€çš„å®¹å™¨ï¼Œä¾æ—§å¯ä»¥è¿æ¥åˆ°å®¹å™¨æœåŠ¡ï¼Œå¹¶ä¸”å–å¾—ç»“æœã€‚å®ç°è¿™æ ·æ•ˆæœçš„ä¸€ä¸ªåŸå› å°±æ˜¯å› ä¸º <code>ingress</code> ç½‘ç»œçš„å­˜åœ¨ã€‚</p>
<p>Swarm ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª<strong>éšè—çš„æ²™ç®±å®¹å™¨</strong>ç›‘å¬å®¿ä¸»çš„æœåŠ¡ç«¯å£ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªé›†ç¾¤å¤–ç•Œçš„è®¿é—®ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>docker network inspect ingress</code> æ¥çœ‹åˆ°è¿™ä¸ªæ²™ç®±å®¹å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect ingress</span><br><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="string">"Name"</span>: <span class="string">"ingress"</span>,</span><br><span class="line">       <span class="string">"Id"</span>: <span class="string">"88smbt683r5p7c0l7sd0dpniw"</span>,</span><br><span class="line">       <span class="string">"Scope"</span>: <span class="string">"swarm"</span>,</span><br><span class="line">       <span class="string">"Driver"</span>: <span class="string">"overlay"</span>,</span><br><span class="line">       <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">           <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">           <span class="string">"Options"</span>: null,</span><br><span class="line">           <span class="string">"Config"</span>: [</span><br><span class="line">               &#123;</span><br><span class="line">                   <span class="string">"Subnet"</span>: <span class="string">"10.255.0.0/16"</span>,</span><br><span class="line">                   <span class="string">"Gateway"</span>: <span class="string">"10.255.0.1"</span></span><br><span class="line">               &#125;</span><br><span class="line">           ]</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">"Containers"</span>: &#123;</span><br><span class="line">           <span class="string">"faff08692b5f916fcb15aa7ac6bc8633a0fa714a52a1fb75e57525c94581c45a"</span>: &#123;</span><br><span class="line">               <span class="string">"Name"</span>: <span class="string">"web.1.1jyunyva6picwsztzrj6t2cio"</span>,</span><br><span class="line">               <span class="string">"EndpointID"</span>: <span class="string">"58240770eb25565b472384731b1b90e36141a633ce184a5163829cf96e9d1195"</span>,</span><br><span class="line">               <span class="string">"MacAddress"</span>: <span class="string">"02:42:0a:ff:00:05"</span>,</span><br><span class="line">               <span class="string">"IPv4Address"</span>: <span class="string">"10.255.0.5/16"</span>,</span><br><span class="line">               <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="string">"ingress-sbox"</span>: &#123;</span><br><span class="line">               <span class="string">"Name"</span>: <span class="string">"ingress-endpoint"</span>,</span><br><span class="line">               <span class="string">"EndpointID"</span>: <span class="string">"fe8f89d4f99d7bacb14c5cb723682c180278d62e9edd10b523cdd81a45695c5d"</span>,</span><br><span class="line">               <span class="string">"MacAddress"</span>: <span class="string">"02:42:0a:ff:00:03"</span>,</span><br><span class="line">               <span class="string">"IPv4Address"</span>: <span class="string">"10.255.0.3/16"</span>,</span><br><span class="line">               <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"Options"</span>: &#123;</span><br><span class="line">           <span class="string">"com.docker.network.driver.overlay.vxlanid_list"</span>: <span class="string">"256"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„å‘½ä»¤è¿”å›ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º <code>ingress-endpoint</code> çš„å®¹å™¨ï¼Œè¿™å°±æ˜¯è¾¹ç•Œæ²™ç®±å®¹å™¨ã€‚</p>
<p>å½“æˆ‘ä»¬åˆ›å»ºæœåŠ¡æ—¶ï¼Œä½¿ç”¨äº† <code>-p</code> å‚æ•°åï¼ŒæœåŠ¡å®¹å™¨å°±ä¼šè¢«è‡ªåŠ¨çš„åŠ å…¥åˆ° <code>ingress</code> ç½‘ç»œä¸­ï¼ŒåŒæ—¶ä¼šåœ¨æ²™ç®±ä¸­æ³¨å†Œæ˜ å°„ä¿¡æ¯ï¼Œå‘ŠçŸ¥å“ªä¸ªæœåŠ¡è¦æ±‚å®ˆæŠ¤å“ªä¸ªç«¯å£ï¼Œå…·ä½“å¯¹åº”å®¹å™¨æ˜¯å“ªäº›ã€‚</p>
<p>å› æ­¤å½“æ²™ç®±æ”¶åˆ°å¤–éƒ¨è¿æ¥åï¼Œé€šè¿‡è®¿é—®ç«¯å£å°±å¯ä»¥çŸ¥é“å…·ä½“æœåŠ¡åœ¨å®ˆæŠ¤ï¼Œç„¶åä¼šé€šè¿‡è¿™ä¸ª <code>ingress</code> ç½‘ç»œå»å°†è¿æ¥è¯·æ±‚è½¬å‘ç»™å¯¹åº”æœåŠ¡å®¹å™¨ã€‚è€Œç”±äº <code>ingress</code> çš„æœ¬è´¨æ˜¯ <code>overlay network</code>ï¼Œå› æ­¤ï¼Œæ— è®ºæœåŠ¡å®¹å™¨è¿è¡Œäºå“ªä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ²™ç®±éƒ½å¯ä»¥æˆåŠŸçš„å°†è¿æ¥è½¬å‘ç»™æ­£ç¡®çš„æœåŠ¡å®¹å™¨ã€‚</p>
<p>æ‰€ä»¥ï¼Œ<code>ingress</code> æ˜¯ç‰¹æ®Šç”¨é€”çš„ç½‘ç»œï¼Œåªè¦æœåŠ¡æœ‰ <code>-p</code> é€‰é¡¹ï¼Œé‚£ä¹ˆæœåŠ¡å®¹å™¨å°±ä¼šè‡ªåŠ¨è¢«åŠ å…¥è¯¥ç½‘ç»œã€‚å› æ­¤æŠŠ <code>ingress</code> ç½‘ç»œå½“åšæ™®é€šçš„ <code>overlay</code> ç½‘ç»œä½¿ç”¨çš„è¯ï¼Œé™¤äº†ä¼šå¹²æ‰° Swarm æ­£å¸¸çš„è¾¹ç•Œè´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œä¹Ÿä¼šç ´åæœåŠ¡éš”ç¦»çš„å®‰å…¨æœºåˆ¶ã€‚æ‰€ä»¥ä¸è¦æŠŠè¿™ä¸ªç½‘ç»œå½“åšæ™®é€šçš„ <code>overlay</code> ç½‘ç»œæ¥ä½¿ç”¨ï¼Œéœ€è¦æ§åˆ¶æœåŠ¡äº’è”å’Œéš”ç¦»æ—¶ï¼Œè¯·ç”¨è‡ªè¡Œåˆ›å»ºçš„ <code>overlay</code> ç½‘ç»œã€‚</p>
<h3 id="å¬è¯´-link-è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ"><a href="#å¬è¯´-link-è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="å¬è¯´ --link è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ"></a>å¬è¯´ <code>--link</code> è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ</h3><p>åœ¨ 1-2 å¹´å‰ï¼ŒDocker æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥äºé»˜è®¤çš„æ¡¥æ¥ç½‘ç»œä¸Šï¼Œä¹Ÿå°±æ˜¯å¾ˆå¤šè€æ–‡ç« é¼“æ£çš„ <code>docker0</code> æ¡¥æ¥ç½‘å¡ã€‚å› æ­¤å®é™…ä¸Šé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰å®¹å™¨éƒ½æ˜¯å¯ä»¥äº’è”çš„ï¼Œæ²¡æœ‰éš”ç¦»ï¼Œå½“ç„¶è¿™æ ·å®‰å…¨æ€§ä¸å¥½ã€‚è€ŒæœåŠ¡å‘ç°ï¼Œæ˜¯åœ¨è¿™ç§ç¯å¢ƒä¸‹å‘å±•å‡ºæ¥çš„ï¼Œé€šè¿‡ä¿®æ”¹å®¹å™¨å†…çš„ <code>/etc/hosts</code> æ–‡ä»¶æ¥å®Œæˆçš„ã€‚å‡¡æ˜¯ <code>--link</code> çš„ä¸»æœºçš„åˆ«åå°±ä¼šå‡ºç°äº <code>/etc/hosts</code> ä¸­ï¼Œå…¶åœ°å€ç”± Docker å¼•æ“ç»´æŠ¤ã€‚å› æ­¤å®¹å™¨é—´æ‰å¯ä»¥é€šè¿‡<strong>åˆ«å</strong>äº’è®¿ã€‚</p>
<p>ä½†æ˜¯è¿™ç§åŠæ³•å¹¶ä¸æ˜¯å¥½çš„è§£å†³æ–¹æ¡ˆï¼ŒDocker æ—©åœ¨ä¸€å¹´å¤šä»¥å‰å°±å·²ç»ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œäº†ã€‚åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥äº’è”ï¼Œå¹¶ä¸”ï¼ŒDocker å†…ç½®äº† DNSï¼Œå®¹å™¨å†…çš„åº”ç”¨å¯ä»¥ä½¿ç”¨æœåŠ¡åã€å®¹å™¨åã€åˆ«åæ¥è¿›è¡ŒæœåŠ¡å‘ç°ï¼Œåç§°ä¼šç»ç”±å†…ç½®çš„ DNS è¿›è¡Œè§£æï¼Œå…¶ç»“æœæ˜¯åŠ¨æ€çš„ï¼›è€Œä¸åœ¨åŒä¸€ç½‘ç»œä¸­çš„å®¹å™¨ï¼Œä¸å¯ä»¥äº’è”ã€‚</p>
<p>å› æ­¤ï¼Œç°åœ¨æ—©å°±ä¸ç”¨ <code>--link</code> äº†ï¼Œè€Œä¸”éå¸¸ä¸å»ºè®®ä½¿ç”¨ã€‚</p>
<blockquote>
<p>PSï¼šè²Œä¼¼æ™ºéšœzabbixçš„é•œåƒçš„å¼•å¯¼ä¸Šè¿˜å†™ç€â€”link </p>
</blockquote>
<p>é¦–å…ˆæ˜¯å› ä¸ºä½¿ç”¨ <code>--link</code> å°±å¾ˆå¯èƒ½è¿˜åœ¨ç”¨é»˜è®¤æ¡¥æ¥ç½‘ç»œï¼Œè¿™å¾ˆä¸å®‰å…¨ï¼Œæ‰€æœ‰å®¹å™¨éƒ½æ²¡æœ‰é€‚åº¦éš”ç¦»ï¼Œç”¨è‡ªå®šä¹‰ç½‘ç»œæ‰æ¯”è¾ƒæ–¹ä¾¿äº’è”éš”ç¦»ã€‚</p>
<p>å…¶æ¬¡ï¼Œä¿®æ”¹ <code>/etc/hosts</code> æ–‡ä»¶æœ‰å¾ˆå¤šå¼Šç—…ã€‚æ¯”å¦‚ï¼Œé«˜é¢‘ç¹çš„å®¹å™¨å¯åœç¯å¢ƒæ—¶ï¼Œå®¹æ˜“äº§ç”Ÿç«äº‰å†’é™©ï¼Œå¯¼è‡´ <code>/etc/hosts</code> æ–‡ä»¶æŸåï¼Œå‡ºç°è®¿é—®æ•…éšœï¼›æˆ–è€…æœ‰äº›åº”ç”¨å‘ç°æ˜¯æ¥è‡ªäº <code>/etc/hosts</code> æ–‡ä»¶åï¼Œå°±å‡å®šå…¶ä¸ºé™æ€æ–‡ä»¶ï¼Œè€Œç¼“å­˜ç»“æœä¸å†æŸ¥è¯¢ï¼Œä»è€Œå¯¼è‡´å®¹å™¨å¯åœ IP å˜æ›´åï¼Œä½¿ç”¨æ—§çš„æ¡ç›®è€Œæ— æ³•è¿æ¥åˆ°æ­£ç¡®çš„å®¹å™¨ç­‰ç­‰ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨ä¸€ä»£ Swarm ç¯å¢ƒä¸­ï¼Œåœ¨ <code>docker-compose.yml</code> ä¸­ä½¿ç”¨äº† <code>links</code> å°±æ„å‘³ç€æœåŠ¡é—´çš„å¼ºä¾èµ–å…³ç³»ï¼Œå› æ­¤è°ƒåº¦æ—¶ä¸ä¼šå°†æœåŠ¡è¿è¡Œäºä¸åŒèŠ‚ç‚¹ï¼Œè€Œæ˜¯å…¨éƒ¨è¿è¡Œäºä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿å¾—æ¨ªå‘æ‰©å±•å¤±è´¥ã€‚</p>
<p>æ‰€ä»¥ä¸è¦å†ä½¿ç”¨ <code>--link</code> ä»¥åŠ <code>docker-compose.yml</code> ä¸­çš„ <code>links</code> äº†ã€‚åº”è¯¥ä½¿ç”¨ <code>docker network</code>ï¼Œå»ºç«‹ç½‘ç»œï¼Œè€Œ <code>docker run --network</code> æ¥è¿æ¥ç‰¹å®šç½‘ç»œã€‚æˆ–è€…ä½¿ç”¨ <code>version: &#39;3&#39;</code> çš„ <code>docker-compose.yml</code> ç›´æ¥å®šä¹‰è‡ªå®šä¹‰ç½‘ç»œå¹¶ä½¿ç”¨ã€‚</p>
<p>å»ºè®®å»çœ‹ä¸€ä¸‹æˆ‘å†™çš„ <code>docker-copmpose</code> å¤šå®¹å™¨äº’è”çš„ä¾‹å­ï¼š<a href="https://github.com/Mr-Linus/docker-compose" target="_blank" rel="noopener">https://github.com/Mr-Linus/docker-compose</a>ï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œè¯·æŸ¥çœ‹<a href="https://docs.docker-cn.com/get-started/part3/" target="_blank" rel="noopener">https://docs.docker-cn.com/get-started/part3/</a></p>
<h3 id="ä½¿ç”¨-HBase-Hadoop-çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#ä½¿ç”¨-HBase-Hadoop-çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ä½¿ç”¨ HBase/Hadoop çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a>ä½¿ç”¨ HBase/Hadoop çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ</h3><p>Hadoop/HBase è¿™ç±»ä¸œè¥¿æ€»å–œæ¬¢æ ¹æ®è®¾å®šçš„åç§°æ­£å‘çš„è§£æä¸€éï¼Œç„¶ååœ¨æŸä¸ªæ—¶å€™ä¼šåå‘çš„è§£æä¸€éæ£€æŸ¥æ˜¯å¦ä¸€è‡´ã€‚è¿™ç§é»˜è®¤å‡å®šå¾ˆå¤šæ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä½¿ç”¨ <code>/etc/hosts</code> çš„æ—¶å€™ã€‚æ­£å‘è§£æä¼šä» <code>/etc/hosts</code> ä¸­å–å¾—ï¼Œè€Œåå‘è§£æåˆ™æ›´å¯èƒ½èµ° DNSï¼Œäºæ˜¯å‡ºç°äº†ä¸ä¸€è‡´ã€‚</p>
<p>å¯¹äº Docker è€Œè¨€ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œåï¼Œä¸€ä¸ªå®¹å™¨æœ‰å¾ˆå¤šä¸ªåå­—ï¼Œå†…ç½® DNS å¯ä»¥æ ¹æ®<strong>æœåŠ¡å</strong>ã€<strong>å®¹å™¨å</strong>ã€<strong>ç½‘ç»œåˆ«å</strong>ã€<strong>&lt;å®¹å™¨å&gt;.&lt;ç½‘ç»œå&gt;</strong> ç­‰æ¥è¿›è¡Œè§£æã€‚å› æ­¤æ­£å‘è§£æè®¾ç½®ä»»ä½•ä¸€ä¸ªï¼Œå…¶ç»“æœéƒ½ä¼šæŒ‡å‘å®¹å™¨çš„ IPã€‚</p>
<p>è€Œåå‘è§£æåˆ™ä¸ä¼šè¿”å›æ‰€æœ‰ç»“æœï¼Œè€Œåªè¿”å›<code>&lt;å®¹å™¨å&gt;.&lt;ç½‘ç»œå&gt;</code>ã€‚</p>
<p>æ‰€ä»¥å½“æœ‰äººè¿™æ ·è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm \</span><br><span class="line">    --name wombat.example.com \</span><br><span class="line">    --hostname wombat.example.com \</span><br><span class="line">    --network net1 \</span><br><span class="line">    m3adow/nettools</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°åå‘è§£æç»“æœå¹¶éè‡ªå·±æ‰€æœŸæœ›çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">50: eth0@if51: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:acff:fe13:2/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment"># dig +short wombat.example.com</span></span><br><span class="line">172.19.0.2</span><br><span class="line">/ <span class="comment"># host 172.19.0.2</span></span><br><span class="line">2.0.19.172.in-addr.arpa domain name pointer wombat.example.com.net1.</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„è§£æç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œç”± <code>wombat.example.com</code> æ­£å‘è§£æçš„è¯ï¼Œå…¶ç»“æœæ˜¯ <code>172.19.0.2</code>ï¼Œç¡®å®æ˜¯æˆ‘ä»¬çš„ IP åœ°å€ï¼›ä½†æ˜¯ç”±  <code>172.19.0.2</code> åå‘è§£æçš„è¯ï¼Œæ‰€å¾—åˆ°çš„åŸŸåç¡®å® <code>wombat.example.com.net1</code>ã€‚å¤šäº†ä¸€ä¸ª <code>.net1</code> çš„å°¾å·´ã€‚ä»è€Œå¯¼è‡´ HBase/Hadoop è¿™ç±»è½¯ä»¶å‡ºç°æ•…éšœã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“åå‘åŸŸåè§£æçš„æ ¼å¼ä¸º <code>&lt;å®¹å™¨å&gt;.&lt;ç½‘ç»œå&gt;</code>ã€‚é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†ç½‘ç»œåè®¾ä¸ºåŸŸåå°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ docker network create example.com</span><br><span class="line">$ docker run -it --rm \</span><br><span class="line">    --name wombat \</span><br><span class="line">    --hostname wombat.example.com \</span><br><span class="line">    --network example.com \</span><br><span class="line">    m3adow/nettools</span><br><span class="line">/ <span class="comment"># ip a</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">52: eth0@if53: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UP</span><br><span class="line">    link/ether 02:42:ac:15:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.21.0.2/16 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:acff:fe15:2/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">/ <span class="comment"># dig +short wombat.example.com</span></span><br><span class="line">172.21.0.2</span><br><span class="line">/ <span class="comment"># host 172.21.0.2</span></span><br><span class="line">2.0.21.172.in-addr.arpa domain name pointer wombat.example.com.</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçœ‹åˆ°ï¼Œæ­£å‘è§£ææ²¡é—®é¢˜ï¼Œåå‘è§£æä¹Ÿå¾—åˆ°äº† <code>wombat.example.com</code> è¿™ä¸ªæ‰€æœŸæœ›çš„ç»“æœã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡åã€ä¸»æœºåã€å®¹å™¨åè¿™ç±»å¯ç”¨äºæœåŠ¡å‘ç°çš„åç§°ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨ <strong>é FQDN</strong>ï¼Œä¹Ÿå°±æ˜¯ä¸åŒ…å« <code>.</code> çš„å•ä¸€åå­—ï¼Œå¦åˆ™åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå‡ºé”™ã€‚</p>
</blockquote>
<h3 id="å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº-IP-å•Šï¼Ÿ"><a href="#å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº-IP-å•Šï¼Ÿ" class="headerlink" title="å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº IP å•Šï¼Ÿ"></a>å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº IP å•Šï¼Ÿ</h3><h4 id="å•æœºç¯å¢ƒ"><a href="#å•æœºç¯å¢ƒ" class="headerlink" title="å•æœºç¯å¢ƒ"></a>å•æœºç¯å¢ƒ</h4><p>å¦‚æœæ˜¯å•æœºç¯å¢ƒï¼Œå¾ˆç®€å•ï¼Œä¸å¿…ç¢ç£¨æ€ä¹ˆçªç ´å‘½åç©ºé—´é™åˆ¶ï¼Œç›´æ¥ç”¨ç¯å¢ƒå˜é‡é€è¿›å»å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e HOST_IP=&lt;å®¿ä¸»çš„IPåœ°å€&gt; nginx</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®¹å™¨å†…ç›´æ¥è¯»å– <code>HOST_IP</code> ç¯å¢ƒå˜é‡å³å¯ã€‚</p>
<h4 id="é›†ç¾¤ç¯å¢ƒ"><a href="#é›†ç¾¤ç¯å¢ƒ" class="headerlink" title="é›†ç¾¤ç¯å¢ƒ"></a>é›†ç¾¤ç¯å¢ƒ</h4><p>é›†ç¾¤ç¯å¢ƒç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œ<code>docker service create</code> ä¸­çš„ <code>-e</code> ä»¥åŠ <code>--env-file</code>æ˜¯åœ¨æœåŠ¡åˆ›å»ºæ—¶æŒ‡å®šã€è¯»å–ç¯å¢ƒå˜é‡å†…å®¹ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶ï¼Œå› æ­¤å¯¹äºæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚è€Œä¸”ç›®å‰ä¸å­˜åœ¨ <code>dockerd -e</code> é€‰é¡¹ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›é€‰é¡¹è¾¾ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p>
<p>ä¸è¿‡æœ‰å˜é€šçš„åŠæ³•ï¼Œå¯ä»¥åœ¨å®¿ä¸»ä¸Šå»ºç«‹ä¸€ä¸ª <code>/etc/variables</code> æ–‡ä»¶ï¼ˆåå­—éšæ„ï¼Œè¿™é‡Œç”¨è¿™ä¸ªæ–‡ä»¶ä¸¾ä¾‹ï¼‰ã€‚å…¶å†…å®¹ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HOST_IP=1.2.3.4</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>1.2.3.4</code> æ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„å®¿ä¸» IPï¼Œå› æ­¤æ¯ä¸ªèŠ‚ç‚¹çš„ <code>/etc/variables</code> çš„å†…å®¹ä¸åŒã€‚</p>
<p>è€Œåœ¨å¯åŠ¨æœåŠ¡æ—¶ï¼ŒæŒ‡å®šæŒ‚è½½è¿™ä¸ªæœåŠ¡ç«¯æœ¬åœ°æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name app \</span><br><span class="line">    --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/etc/variables,target=/etc/variables:ro \</span><br><span class="line">    myapp</span><br></pre></td></tr></table></figure>
<p>ç”±äº <code>--mount</code> æ˜¯å‘ç”Ÿäºå®¹å™¨è¿è¡Œæ—¶ï¼Œå› æ­¤æ‰€åŠ è½½çš„æ˜¯æ‰€è¿è¡Œçš„æœåŠ¡å™¨çš„ <code>/etc/variables</code>ï¼Œé‡Œé¢æ‰€åŒ…å«çš„ä¹Ÿæ˜¯è¯¥æœåŠ¡å™¨çš„ IP åœ°å€ã€‚</p>
<p>åœ¨ <code>myapp</code> è¿™ä¸ªé•œåƒçš„å…¥å£è„šæœ¬åŠ å…¥åŠ è½½è¯¥ç¯å¢ƒå˜é‡æ–‡ä»¶çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/variables</span><br></pre></td></tr></table></figure>
<p>è¿™æ · <code>app</code> è¿™ä¸ªæœåŠ¡å®¹å™¨å°±ä¼šæ‹¥æœ‰ <code>HOST_IP</code> ç¯å¢ƒå˜é‡ï¼Œå…¶å€¼ä¸ºæ‰€è¿è¡Œçš„å®¿ä¸» IPã€‚</p>
<h2 id="å­˜å‚¨é—®é¢˜-11"><a href="#å­˜å‚¨é—®é¢˜-11" class="headerlink" title="å­˜å‚¨é—®é¢˜ (11)"></a>å­˜å‚¨é—®é¢˜ <code>(11)</code></h2><h3 id="å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ"><a href="#å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ" class="headerlink" title="å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ"></a>å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ</h3><p>å¯¹äº <code>devicemapper</code>, <code>btrfs</code>, <code>zfs</code> æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ <code>--storage-opt size=100G</code> è¿™ç§å½¢å¼é™åˆ¶ <code>rootfs</code> çš„å¤§å°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create -it --storage-opt size=120G fedora /bin/bash</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#/set-storage-driver-options-per-container</a></p>
<h3 id="å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ"><a href="#å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ" class="headerlink" title="å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ"></a>å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ</h3><p>å¦‚æœæ‰€è°“æ•°æ®æ˜¯æŒ‡è¿è¡Œæ—¶åŠ¨æ€çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ•°æ®æ–‡ä»¶ä¸åº”è¯¥ä¿å­˜äºé•œåƒå†…ã€‚åœ¨è¿è¡Œæ—¶è¦ä¿æŒå®¹å™¨åŸºç¡€æ–‡ä»¶ä¸å¯å˜çš„ç‰¹æ€§ï¼Œè€Œå˜åŒ–éƒ¨åˆ†ä½¿ç”¨æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œæˆ–è€…æ•°æ®å·æ¥è§£å†³ã€‚</p>
<p>å»ºè®®çœ‹ä¸€ä¸‹å®˜ç½‘ <code>docker volume</code> çš„æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/tutorials/dockervolumes/</a></p>
<h3 id="çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"><a href="#çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ" class="headerlink" title="çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"></a>çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ</h3><p>è¿™é‡Œè¯´åˆ°çš„æœ‰ä¸¤ä¸ªå±‚é¢çš„æ— çŠ¶æ€ï¼š</p>
<h4 id="å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€"><a href="#å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€" class="headerlink" title="å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€"></a>å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€</h4><p>è¿™é‡Œæåˆ°çš„å­˜å‚¨å±‚æ˜¯æŒ‡ç”¨äºå­˜å‚¨é•œåƒã€å®¹å™¨å„ä¸ªå±‚çš„å­˜å‚¨ï¼Œä¸€èˆ¬æ˜¯ <code>Union FS</code>ï¼Œå¦‚ <code>AUFS</code>ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å—è®¾å¤‡çš„ä¸€äº›æœºåˆ¶ï¼ˆå¦‚ <code>snapshot</code> ï¼‰è¿›è¡Œæ¨¡æ‹Ÿï¼Œå¦‚ <code>devicemapper</code>ã€‚</p>
<p><code>Union FS</code> è¿™ç±»å­˜å‚¨ç³»ç»Ÿï¼Œç›¸å½“äºæ˜¯åœ¨ç°æœ‰å­˜å‚¨ä¸Šï¼Œå†åŠ ä¸€å±‚æˆ–å¤šå±‚å­˜å‚¨ï¼Œè¿™ç±»å­˜å‚¨çš„è¯»å†™æ€§èƒ½å¹¶ä¸å¥½ã€‚å¹¶ä¸”å¯¹äº <code>CentOS</code> è¿™ç±»åªèƒ½ä½¿ç”¨ <code>devicemapper</code> çš„ç³»ç»Ÿè€Œè¨€ï¼Œå­˜å‚¨å±‚çš„è¯»å†™è¿˜ç»å¸¸å‡º bugã€‚å› æ­¤ï¼Œ<strong>åœ¨ Docker ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œè¦é¿å…å­˜å‚¨å±‚çš„è¯»å†™</strong>ã€‚é¢‘ç¹è¯»å†™çš„éƒ¨åˆ†ï¼Œåº”è¯¥ä½¿ç”¨<code>å·</code>ã€‚éœ€è¦æŒä¹…åŒ–çš„éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨<strong>å‘½åå·</strong>è¿›è¡ŒæŒä¹…åŒ–ã€‚ç”±äºå‘½åå·çš„ç”Ÿå­˜å‘¨æœŸå’Œå®¹å™¨ä¸åŒï¼Œå®¹å™¨æ¶ˆäº¡é‡å»ºï¼Œå·ä¸ä¼šè·Ÿéšæ¶ˆäº¡ã€‚æ‰€ä»¥å®¹å™¨å¯ä»¥éšä¾¿åˆ äº†é‡æ–°<code>run</code>ï¼Œè€Œå…¶æŒ‚è½½çš„<code>å·</code>åˆ™ä¼šä¿æŒä¹‹å‰çš„æ•°æ®ã€‚</p>
<h4 id="æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€"><a href="#æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€" class="headerlink" title="æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€"></a>æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€</h4><p>ä½¿ç”¨å·æŒä¹…åŒ–å®¹å™¨çŠ¶æ€ï¼Œè™½ç„¶ä»å­˜å‚¨å±‚çš„è§’åº¦çœ‹ï¼Œæ˜¯æ— çŠ¶æ€çš„ï¼Œä½†æ˜¯ä»æœåŠ¡å±‚é¢çœ‹ï¼Œè¿™ä¸ªæœåŠ¡æ˜¯æœ‰çŠ¶æ€çš„ã€‚</p>
<p>ä»æœåŠ¡å±‚é¢ä¸Šè¯´ï¼Œä¹Ÿå­˜åœ¨æ— çŠ¶æ€æœåŠ¡ã€‚å°±æ˜¯è¯´æœåŠ¡æœ¬èº«ä¸éœ€è¦å†™å…¥ä»»ä½•æ–‡ä»¶ã€‚æ¯”å¦‚å‰ç«¯ <code>nginx</code>ï¼Œå®ƒä¸éœ€è¦å†™å…¥ä»»ä½•æ–‡ä»¶ï¼ˆæ—¥å¿—èµ°Dockeræ—¥å¿—é©±åŠ¨ï¼‰ï¼Œä¸­é—´çš„ <code>php</code>, <code>node.js</code> ç­‰æœåŠ¡ï¼Œå¯èƒ½ä¹Ÿä¸éœ€è¦æœ¬åœ°å­˜å‚¨ï¼Œå®ƒä»¬æ‰€éœ€çš„æ•°æ®éƒ½åœ¨ <code>redis</code>, <code>mysql</code>, <code>mongodb</code> ä¸­äº†ã€‚è¿™ç±»æœåŠ¡ï¼Œç”±äºä¸éœ€è¦å·ï¼Œä¹Ÿä¸å‘ç”Ÿæœ¬åœ°å†™æ“ä½œï¼Œåˆ é™¤ã€é‡å¯ã€ä¸ä¿å­˜è‡ªèº«çŠ¶æ€ï¼Œå¹¶ä¸å½±å“æœåŠ¡è¿è¡Œï¼Œå®ƒä»¬éƒ½æ˜¯<code>æ— çŠ¶æ€æœåŠ¡</code>ã€‚è¿™ç±»æœåŠ¡ç”±äºä¸éœ€è¦çŠ¶æ€è¿ç§»ï¼Œä¸éœ€è¦åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå› æ­¤å®ƒä»¬çš„é›†ç¾¤è°ƒåº¦æ›´æ–¹ä¾¿ã€‚</p>
<p>ä¹‹å‰æ²¡æœ‰ <code>docker volume</code> çš„æ—¶å€™ï¼Œæœ‰äº›äººè¯´ Docker åªå¯ä»¥æ”¯æŒæ— çŠ¶æ€æœåŠ¡ï¼ŒåŸå› å°±æ˜¯åªçœ‹åˆ°äº†å­˜å‚¨å±‚éœ€æ±‚æ— çŠ¶æ€ï¼Œè€Œæ²¡æœ‰ <code>docker volume</code> çš„æŒä¹…åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç°åœ¨è¿™ä¸ªè¯´æ³•å·²ç»ä¸æˆç«‹ï¼ŒæœåŠ¡å¯ä»¥æœ‰çŠ¶æ€ï¼ŒçŠ¶æ€æŒä¹…åŒ–ç”¨ <code>docker volume</code>ã€‚</p>
<p>å½“æœåŠ¡å¯ä»¥æœ‰çŠ¶æ€åï¼Œå¦‚æœä½¿ç”¨é»˜è®¤çš„ <code>local</code> å·é©±åŠ¨ï¼Œå¹¶ä¸”ä½¿ç”¨<code>æœ¬åœ°å­˜å‚¨</code>è¿›è¡ŒçŠ¶æ€æŒä¹…åŒ–çš„æƒ…å†µï¼Œå•æœºæœåŠ¡ã€å®¹å™¨çš„å†è°ƒåº¦è¿è¡Œæ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯é¡¾åæ€ä¹‰ï¼Œä½¿ç”¨<code>æœ¬åœ°å­˜å‚¨</code>çš„å·ï¼Œåªå¯ä»¥ä¸ºå½“å‰ä¸»æœºæä¾›æŒä¹…åŒ–çš„å­˜å‚¨ï¼Œè€Œæ— æ³•è·¨ä¸»æœºã€‚</p>
<p>ä½†è¿™åªæ˜¯ä½¿ç”¨é»˜è®¤çš„ <code>local</code> é©±åŠ¨ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>æœ¬åœ°å­˜å‚¨</code> è€Œå·²ã€‚ä½¿ç”¨åˆ†å¸ƒå¼/å…±äº«å­˜å‚¨å°±å¯ä»¥è§£å†³è·¨ä¸»æœºçš„é—®é¢˜ã€‚<code>docker volume</code> è‡ªç„¶æ”¯æŒå¾ˆå¤šåˆ†å¸ƒå¼å­˜å‚¨çš„é©±åŠ¨ï¼Œæ¯”å¦‚ <code>flocker</code>ã€<code>glusterfs</code>ã€<code>ceph</code>ã€<code>ipfs</code> ç­‰ç­‰ã€‚å¸¸ç”¨çš„æ’ä»¶åˆ—è¡¨å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins</a></p>
<h3 id="æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>é¦–å…ˆï¼ŒæŒ‚è½½åˆ†ä¸º<code>æŒ‚è½½æœ¬åœ°å®¿ä¸»ç›®å½•</code> å’Œ <code>æŒ‚è½½æ•°æ®å·(Volume)</code>ã€‚è€Œ<code>æ•°æ®å·</code>åˆåˆ†ä¸º<code>åŒ¿åæ•°æ®å·</code>å’Œ<code>å‘½åæ•°æ®å·</code>ã€‚</p>
<p><strong>ç»‘å®šå®¿ä¸»ç›®å½•</strong>çš„æ¦‚å¿µå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å°†å®¿ä¸»ç›®å½•ç»‘å®šåˆ°å®¹å™¨ä¸­çš„æŸä¸ªç›®å½•ä½ç½®ã€‚è¿™æ ·å®¹å™¨å¯ä»¥ç›´æ¥è®¿é—®å®¿ä¸»ç›®å½•çš„æ–‡ä»¶ã€‚å…¶å½¢å¼æ˜¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v /var/www:/app nginx</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ³¨æ„åˆ° <code>-v</code> çš„å‚æ•°ä¸­ï¼Œå‰åŠéƒ¨åˆ†æ˜¯ç»å¯¹è·¯å¾„ã€‚åœ¨ <code>docker run</code> ä¸­å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œåœ¨ <code>docker-compose</code> ä¸­ï¼Œå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå› ä¸º <code>docker-compose</code> ä¼šå¸®ä½ è¡¥å…¨è·¯å¾„ã€‚</p>
<p>å¦ä¸€ç§å½¢å¼æ˜¯ä½¿ç”¨ <code>Docker Volume</code>ï¼Œä¹Ÿå°±æ˜¯<strong>æ•°æ®å·</strong>ã€‚è¿™æ˜¯å¾ˆå¤šçœ‹<em>å¤è‘£ä¹¦</em>çš„äººä¸äº†è§£çš„æ¦‚å¿µï¼Œ<strong>ä¸è¦è·Ÿæ•°æ®å®¹å™¨ï¼ˆData Containerï¼‰å¼„æ··</strong>ã€‚æ•°æ®å·æ˜¯ Docker å¼•æ“ç»´æŠ¤çš„å­˜å‚¨æ–¹å¼ï¼Œä½¿ç”¨ <code>docker volume create</code> å‘½ä»¤åˆ›å»ºï¼Œå¯ä»¥åˆ©ç”¨å·é©±åŠ¨æ”¯æŒå¤šç§å­˜å‚¨æ–¹æ¡ˆã€‚å…¶é»˜è®¤çš„é©±åŠ¨ä¸º <code>local</code>ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°å·é©±åŠ¨ã€‚æœ¬åœ°é©±åŠ¨æ”¯æŒ<strong>å‘½åå·</strong>å’Œ<strong>åŒ¿åå·</strong>ã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼Œå‘½åå·å°±æ˜¯æœ‰åå­—çš„å·ï¼Œä½¿ç”¨ <code>docker volume create --name xxx</code> å½¢å¼åˆ›å»ºå¹¶å‘½åçš„å·ï¼›è€ŒåŒ¿åå·å°±æ˜¯æ²¡åå­—çš„å·ï¼Œä¸€èˆ¬æ˜¯ <code>docker run -v /data</code> è¿™ç§ä¸æŒ‡å®šå·åçš„æ—¶å€™æ‰€äº§ç”Ÿï¼Œæˆ–è€… <code>Dockerfile</code> é‡Œé¢çš„å®šä¹‰ç›´æ¥ä½¿ç”¨çš„ã€‚</p>
<p>æœ‰åå­—çš„å·ï¼Œåœ¨ç”¨è¿‡ä¸€æ¬¡åï¼Œä»¥åæŒ‚è½½å®¹å™¨çš„æ—¶å€™è¿˜å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºæœ‰åå­—å¯ä»¥æŒ‡å®šã€‚æ‰€ä»¥ä¸€èˆ¬éœ€è¦ä¿å­˜çš„æ•°æ®ä½¿ç”¨å‘½åå·ä¿å­˜ã€‚</p>
<p>è€ŒåŒ¿åå·åˆ™æ˜¯éšç€å®¹å™¨å»ºç«‹è€Œå»ºç«‹ï¼Œéšç€å®¹å™¨æ¶ˆäº¡è€Œæ·¹æ²¡äºå·åˆ—è¡¨ä¸­ï¼ˆå¯¹äº <code>docker run</code> åŒ¿åå·ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼‰ã€‚<strong>å¯¹äºäºŒä»£ Swarm æœåŠ¡è€Œè¨€ï¼ŒåŒ¿åå·ä¼šéšç€æœåŠ¡åˆ é™¤è€Œè‡ªåŠ¨åˆ é™¤ã€‚</strong> å› æ­¤åŒ¿åå·åªå­˜æ”¾æ— å…³ç´§è¦çš„ä¸´æ—¶æ•°æ®ï¼Œéšç€å®¹å™¨æ¶ˆäº¡ï¼Œè¿™äº›æ•°æ®å°†å¤±å»å­˜åœ¨çš„æ„ä¹‰ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå«æ•°æ®å®¹å™¨ (Data Container) çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ <code>--volumes-from</code> çš„ä¸œè¥¿ã€‚è¿™æ—©å°±ä¸ç”¨äº†ï¼Œå¦‚æœçœ‹äº†ä¹¦è¿˜åœ¨è¯´è¿™ç§æ–¹å¼ï¼Œé‚£è¯´æ˜ä¹¦å·²ç»è¿‡æ—¶äº†ã€‚æŒ‰ç…§ä»Šå¤©çš„ç†è§£ï¼Œè¿™ç±»æ•°æ®å®¹å™¨ï¼Œæ— éå°±æ˜¯æŒ‚äº†ä¸ªåŒ¿åå·çš„å®¹å™¨ç½¢äº†ã€‚</p>
<p>åœ¨ <code>Dockerfile</code> ä¸­å®šä¹‰çš„æŒ‚è½½ï¼Œæ˜¯æŒ‡ <code>åŒ¿åæ•°æ®å·</code>ã€‚<code>Dockerfile</code> ä¸­æŒ‡å®š <code>VOLUME</code> çš„ç›®çš„ï¼Œåªæ˜¯ä¸ºäº†å°†æŸä¸ªè·¯å¾„ç¡®å®šä¸ºå·ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‰ç…§æœ€ä½³å®è·µçš„è¦æ±‚ï¼Œ<strong>ä¸åº”è¯¥åœ¨å®¹å™¨å­˜å‚¨å±‚å†…è¿›è¡Œæ•°æ®å†™å…¥æ“ä½œ</strong>ï¼Œæ‰€æœ‰å†™å…¥åº”è¯¥ä½¿ç”¨å·ã€‚å¦‚æœå®šåˆ¶é•œåƒçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç¡®å®šæŸäº›ç›®å½•ä¼šå‘ç”Ÿé¢‘ç¹å¤§é‡çš„è¯»å†™æ“ä½œï¼Œé‚£ä¹ˆ<strong>ä¸ºäº†é¿å…</strong>åœ¨è¿è¡Œæ—¶ç”±äºç”¨æˆ·ç–å¿½è€Œå¿˜è®°æŒ‡å®šå·ï¼Œå¯¼è‡´å®¹å™¨å‘ç”Ÿå­˜å‚¨å±‚å†™å…¥çš„é—®é¢˜ï¼Œå°±å¯ä»¥åœ¨ <code>Dockerfile</code> ä¸­ä½¿ç”¨ <code>VOLUME</code> æ¥æŒ‡å®šæŸäº›ç›®å½•ä¸ºåŒ¿åå·ã€‚è¿™æ ·å³ä½¿ç”¨æˆ·å¿˜è®°äº†æŒ‡å®šå·ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿä¸è‰¯çš„åæœã€‚</p>
<p>è¿™ä¸ªè®¾ç½®å¯ä»¥åœ¨è¿è¡Œæ—¶è¦†ç›–ã€‚é€šè¿‡ <code>docker run</code> çš„ <code>-v</code> å‚æ•°æˆ–è€… <code>docker-compose.yml</code> çš„ <code>volumes</code> æŒ‡å®šã€‚ä½¿ç”¨<code>å‘½åå·</code>çš„å¥½å¤„æ˜¯å¯ä»¥å¤ç”¨ï¼Œå…¶å®ƒå®¹å™¨å¯ä»¥é€šè¿‡è¿™ä¸ª<code>å‘½åæ•°æ®å·</code>çš„åå­—æ¥æŒ‡å®šæŒ‚è½½ï¼Œå…±äº«å…¶å†…å®¹ï¼ˆä¸è¿‡<strong>è¦æ³¨æ„å¹¶å‘è®¿é—®çš„ç«äº‰é—®é¢˜</strong>ï¼‰ã€‚</p>
<p>æ¯”å¦‚ï¼Œ<code>Dockerfile</code> ä¸­è¯´ <code>VOLUME /data</code>ï¼Œé‚£ä¹ˆå¦‚æœç›´æ¥ <code>docker run</code>ï¼Œå…¶ <code>/data</code> å°±ä¼šè¢«æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œå‘ <code>/data</code> å†™å…¥çš„æ“ä½œä¸ä¼šå†™å…¥åˆ°å®¹å™¨å­˜å‚¨å±‚ï¼Œè€Œæ˜¯å†™å…¥åˆ°äº†åŒ¿åå·ä¸­ã€‚ä½†æ˜¯å¦‚æœè¿è¡Œæ—¶ <code>docker run -v mydata:/data</code>ï¼Œè¿™å°±è¦†ç›–äº† <code>/data</code> çš„æŒ‚è½½è®¾ç½®ï¼Œè¦æ±‚å°† <code>/data</code> æŒ‚è½½åˆ°åä¸º <code>mydata</code> çš„å‘½åå·ä¸­ã€‚æ‰€ä»¥è¯´ <code>Dockerfile</code> ä¸­çš„ <code>VOLUME</code> å®é™…ä¸Šæ˜¯ä¸€å±‚ä¿é™©ï¼Œç¡®ä¿é•œåƒè¿è¡Œå¯ä»¥æ›´å¥½çš„éµå¾ªæœ€ä½³å®è·µï¼Œä¸å‘å®¹å™¨å­˜å‚¨å±‚å†…è¿›è¡Œå†™å…¥æ“ä½œã€‚</p>
<p>æ•°æ®å·é»˜è®¤å¯èƒ½ä¼šä¿å­˜äº <code>/var/lib/docker/volumes</code>ï¼Œä¸è¿‡ä¸€èˆ¬ä¸éœ€è¦ã€ä¹Ÿ<strong>ä¸åº”è¯¥è®¿é—®è¿™ä¸ªä½ç½®</strong>ã€‚</p>
<h3 id="å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>å· (Docker Volume) æ˜¯å—æ§å­˜å‚¨ï¼Œæ˜¯ç”± Docker å¼•æ“è¿›è¡Œç®¡ç†ç»´æŠ¤çš„ã€‚å› æ­¤ä½¿ç”¨å·ï¼Œä½ å¯ä»¥ä¸å¿…å¤„ç† <code>uid</code>ã€<code>SELinux</code> ç­‰å„ç§æƒé™é—®é¢˜ï¼ŒDocker å¼•æ“åœ¨å»ºç«‹å·æ—¶ä¼šè‡ªåŠ¨æ·»åŠ å®‰å…¨è§„åˆ™ï¼Œä»¥åŠæ ¹æ®æŒ‚è½½ç‚¹è°ƒæ•´æƒé™ã€‚å¹¶ä¸”å¯ä»¥ç»Ÿä¸€åˆ—è¡¨ã€æ·»åŠ ã€åˆ é™¤ã€‚å¦å¤–ï¼Œé™¤äº†æœ¬åœ°å·å¤–ï¼Œè¿˜æ”¯æŒç½‘ç»œå·ã€åˆ†å¸ƒå¼å·ã€‚</p>
<p>è€ŒæŒ‚è½½ç›®å½•é‚£å°±æ²¡äººç®¡äº†ï¼Œå±äºç”¨æˆ·è‡ªè¡Œç»´æŠ¤ã€‚ä½ å°±å¿…é¡»æ‰‹åŠ¨å¤„ç†æ‰€æœ‰æƒé™é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯åœ¨ <code>CentOS</code> ä¸Šï¼Œå¾ˆå¤šäººç¢°åˆ° <code>Permission Denied</code>ï¼Œå°±æ˜¯å› ä¸ºæ²¡æœ‰ä½¿ç”¨å·ï¼Œè€Œæ˜¯æŒ‚è½½ç›®å½•ï¼Œè€Œä¸”è¿˜å¯¹ SELinux å®‰å…¨æƒé™ä¸€æ— æ‰€çŸ¥å¯¼è‡´ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ"></a>ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ</h3><p>åœ¨ç»‘å®šå®¿ä¸»å†…å®¹çš„å½¢å¼ä¸­ï¼Œæœ‰ä¸€ç§ç‰¹æ®Šçš„å½¢å¼ï¼Œå°±æ˜¯<strong>ç»‘å®šå®¿ä¸»æ–‡ä»¶</strong>ï¼Œæ—¢ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v <span class="variable">$PWD</span>/myapp.ini:/app/app.ini myapp</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>myapp.ini</code> æ–‡ä»¶<strong>ä¸å‘ç”Ÿæ”¹å˜</strong>çš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„ç»‘å®šæ˜¯å’Œç»‘å®šå®¿ä¸»ç›®å½•æ€§è´¨ä¸€æ ·ï¼ŒåŒæ ·æ˜¯å°†å®¿ä¸»æ–‡ä»¶ç»‘å®šåˆ°å®¹å™¨å†…éƒ¨ï¼Œå®¹å™¨å†…å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œæƒ…å†µåˆ™æœ‰ä¸åŒã€‚</p>
<p>ç®€å•çš„æ–‡ä»¶ä¿®æ”¹ï¼Œæ¯”å¦‚ <code>echo &quot;name = jessie&quot; &gt;&gt; myapp.ini</code>ï¼Œè¿™ç±»ä¿®æ”¹ä¾æ—§è¿˜æ˜¯åŸæ¥çš„æ–‡ä»¶ï¼Œå®¿ä¸»ï¼ˆæˆ–å®¹å™¨ï¼‰å¯¹æ–‡ä»¶è¿›è¡Œçš„æ”¹åŠ¨ï¼Œå¦ä¸€æ–¹æ˜¯å¯ä»¥çœ‹åˆ°çš„ã€‚</p>
<p>è€Œå¤æ‚çš„æ–‡ä»¶æ“ä½œï¼Œæ¯”å¦‚ä½¿ç”¨ <code>vim</code>ï¼Œæˆ–è€…å…¶å®ƒç¼–è¾‘å™¨ç¼–è¾‘æ–‡ä»¶ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½ä¼šå¯¼è‡´ä¸€æ–¹çš„ä¿®æ”¹ï¼Œå¦ä¸€æ–¹çœ‹ä¸åˆ°ã€‚</p>
<p>å…¶åŸå› æ˜¯è¿™ç±»ç¼–è¾‘å™¨åœ¨ä¿å­˜æ–‡ä»¶çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡‡ç”¨ä¸€ç§é¿å…å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿæ•…éšœè€Œå¯¼è‡´æ–‡ä»¶ä¸¢å¤±çš„ç­–ç•¥ï¼Œæ—¢å…ˆæŠŠå†…å®¹å†™åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­å»ï¼Œå†™å¥½äº†åï¼Œå†åˆ é™¤æ—§çš„æ–‡ä»¶ï¼Œç„¶åæŠŠæ–°æ–‡ä»¶æ”¹åä¸ºæ—§çš„æ–‡ä»¶åï¼Œä»è€Œå®Œæˆä¿å­˜çš„æ“ä½œã€‚ä»è¿™ä¸ªæ“ä½œæµç¨‹å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶ä¿®æ”¹åçš„æ–‡ä»¶çš„åå­—å’Œè¿‡å»ä¸€æ ·ï¼Œä½†å¯¹äºæ–‡ä»¶ç³»ç»Ÿè€Œè¨€æ˜¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶äº†ã€‚æ¢å¥è¯è¯´ï¼Œè™½ç„¶æ˜¯åŒåæ–‡ä»¶ï¼Œä½†æ˜¯æ—§çš„æ–‡ä»¶çš„ <code>inode</code> å’Œä¿®æ”¹åçš„æ–‡ä»¶çš„ <code>inode</code> ä¸åŒã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ls -i</span><br><span class="line">268541 hello.txt</span><br><span class="line">$ vi hello.txt</span><br><span class="line">$ ls -i</span><br><span class="line">268716 hello.txt</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡ <code>vim</code> ç¼–è¾‘æ–‡ä»¶åï¼Œ<code>inode</code> ä» <code>268541</code> å˜ä¸ºäº† <code>268716</code>ï¼Œè¿™å°±æ˜¯åˆšæ‰è¯´çš„ï¼Œåå­—è¿˜æ˜¯é‚£ä¸ªåå­—ï¼Œæ–‡ä»¶å·²ä¸æ˜¯åŸæ¥çš„æ–‡ä»¶äº†ã€‚</p>
<p>è€Œ Docker çš„ <strong>ç»‘å®š</strong>å®¿ä¸»æ–‡ä»¶ï¼Œå®é™…ä¸Šåœ¨æ–‡ä»¶ç³»ç»Ÿçœ¼é‡Œï¼Œé’ˆå¯¹çš„æ˜¯ <code>inode</code>ï¼Œè€Œä¸æ˜¯æ–‡ä»¶åã€‚å› æ­¤å®¹å™¨å†…æ‰€çœ‹åˆ°çš„ï¼Œä¾æ—§æ˜¯ä¹‹å‰æ—§çš„ <code>inode</code> å¯¹åº”çš„é‚£ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ—§çš„å†…å®¹ã€‚</p>
<p>è¿™å°±å‡ºç°äº†ä¹‹å‰çš„é‚£ä¸ªé—®é¢˜ï¼Œåœ¨å®¿ä¸»å†…ä¿®æ”¹ç»‘å®šæ–‡ä»¶çš„å†…å®¹ï¼Œç»“æœå‘ç°å®¹å™¨å†…çœ‹ä¸åˆ°æ”¹å˜ï¼Œå…¶åŸå› å°±åœ¨äº<strong>å®¿ä¸»çš„é‚£ä¸ªæ–‡ä»¶å·²ä¸æ˜¯åŸæ¥çš„æ–‡ä»¶äº†</strong>ğŸ˜‚ã€‚</p>
<p>è¿™ç±»é—®é¢˜è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå¦‚æœæ–‡ä»¶å¯èƒ½æ”¹å˜ï¼Œé‚£ä¹ˆå°±<strong>ä¸è¦ç»‘å®šå®¿ä¸»æ–‡ä»¶ï¼Œè€Œæ˜¯ç»‘å®šä¸€ä¸ªå®¿ä¸»ç›®å½•</strong>ï¼Œè¿™æ ·åªè¦ç›®å½•ä¸è·‘ï¼Œé‡Œé¢æ–‡ä»¶çˆ±å’‹æ”¹å°±å’‹æ”¹ğŸ˜ã€‚</p>
<h3 id="å¤šä¸ª-Docker-å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS-ï¼Ÿ"><a href="#å¤šä¸ª-Docker-å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS-ï¼Ÿ" class="headerlink" title="å¤šä¸ª Docker å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS ï¼Ÿ"></a>å¤šä¸ª Docker å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS ï¼Ÿ</h3><p>å¦‚æœæ˜¯åŒä¸€ä¸ªå®¿ä¸»ï¼Œé‚£ä¹ˆå¯ä»¥ç»‘å®šåŒä¸€ä¸ªæ•°æ®å·ï¼Œå½“ç„¶ï¼Œç¨‹åºä¸Šè¦å¤„ç†å¥½å¹¶å‘é—®é¢˜ã€‚</p>
<p>å¦‚æœæ˜¯ä¸åŒå®¿ä¸»ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®å·é©±åŠ¨ï¼Œè®©åˆ†å¸ƒåœ¨ä¸åŒå®¿ä¸»çš„å®¹å™¨éƒ½å¯ä»¥è®¿é—®åˆ°çš„åˆ†å¸ƒå¼å­˜å‚¨çš„ä½ç½®ã€‚å¦‚S3ä¹‹ç±»ï¼š</p>
<p><a href="https://docs.docker.com/engine/extend/plugins/#volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/plugins/#volume-plugins</a></p>
<h3 id="æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡-cron-æ€ä¹ˆåŠï¼Ÿ"><a href="#æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡-cron-æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡ cron æ€ä¹ˆåŠï¼Ÿ"></a>æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡ <code>cron</code> æ€ä¹ˆåŠï¼Ÿ</h3><p><code>cron</code> å…¶å®æ˜¯å¦ä¸€ä¸ªæœåŠ¡äº†ï¼Œæ‰€ä»¥åº”è¯¥å¦èµ·ä¸€ä¸ªå®¹å™¨æ¥è¿›è¡Œï¼Œå¦‚éœ€è®¿é—®è¯¥åº”ç”¨çš„æ•°æ®æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥å…±äº«è¯¥åº”ç”¨çš„æ•°æ®å·å³å¯ã€‚è€Œ <code>cron</code> çš„å®¹å™¨ä¸­ï¼Œ<code>cron</code> ä»¥å‰å°è¿è¡Œå³å¯ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ª <code>python</code> è„šæœ¬å¯ä»¥å®šæ—¶æ‰§è¡Œã€‚é‚£ä¹ˆå¯ä»¥è¿™æ ·æ„å»ºè¿™ä¸ªå®¹å™¨ã€‚</p>
<p>é¦–å…ˆåŸºäº <code>python</code> çš„é•œåƒå®šåˆ¶ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.5</span>.<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install -y cron \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get autoremove -y</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">COPY ./cronpy /etc/cron.d/cronpy</span></span><br><span class="line"><span class="bash">CMD [<span class="string">"cron"</span>, <span class="string">"-f"</span>]</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æ‰€æåŠçš„ <code>cronpy</code> å°±æ˜¯æˆ‘ä»¬éœ€è¦è®¡åˆ’æ‰§è¡Œçš„ <code>cron</code> è„šæœ¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * root /app/task.py &gt;&gt; /var/<span class="built_in">log</span>/task.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªè®¡åˆ’ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å®šæ—¶æ‰§è¡Œ <code>/app/task.py</code> æ–‡ä»¶ï¼Œæ—¥å¿—è®°å½•åœ¨ <code>/var/log/task.log</code> ä¸­ã€‚è¿™ä¸ª <code>task.py</code> æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹åªæ˜¯è¾“å‡ºä¸ªæ—¶é—´è€Œå·²ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line">print(<span class="string">"Cron job has run at &#123;0&#125; with environment variable "</span>.format(str(datetime.now())))</span><br></pre></td></tr></table></figure>
<p>è¿™ <code>task.py</code> å¯ä»¥åœ¨æ„å»ºé•œåƒæ—¶æ”¾è¿›å»ï¼Œä¹Ÿå¯ä»¥æŒ‚è½½å®¿ä¸»ç›®å½•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¥æŒ‚è½½å®¿ä¸»ç›®å½•ä¸¾ä¾‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -t cronjob:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œé•œåƒ</span></span><br><span class="line">docker run \</span><br><span class="line">    --name cronjob \</span><br><span class="line">    -d \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>)/task.py:/app/task.py \</span><br><span class="line">    -v $(<span class="built_in">pwd</span>)/<span class="built_in">log</span>/:/var/<span class="built_in">log</span>/ \</span><br><span class="line">    cronjob:latest</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº”è¯¥åœ¨æ„å»ºä¸»æœºä¸Šèµ‹äºˆ <code>task.py</code> æ–‡ä»¶å¯æ‰§è¡Œæƒé™ã€‚</p>
<h3 id="å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ"><a href="#å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ"></a>å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ</h3><p>å·ï¼ˆ<code>Volume</code>ï¼‰ï¼Œæ˜¯ç”¨äºåŠ¨æ€æ•°æ®æŒä¹…åŒ–çš„ã€‚å› æ­¤å…¶å†…å­˜å‚¨çš„éƒ½æ˜¯åŠ¨æ€æ•°æ®ï¼Œè¿è¡Œæ—¶ä¼šå˜åŒ–ã€‚å¦‚æœè¿™é‡Œé¢éœ€è¦åˆå§‹åŒ–é‡Œé¢çš„æ•°æ®ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œã€‚æˆ–è€…åœ¨é•œåƒé‡ŒåŠ å…¥åˆå§‹åŒ–çš„è„šæœ¬ï¼Œæ¯”å¦‚ <code>mysql</code> é•œåƒä¸­çš„åˆå§‹åŒ–ç›®å½•ä¸­çš„è„šæœ¬ï¼›æˆ–è€…è‡ªå·±å•ç‹¬åˆ¶ä½œçº¯ç²¹ç”¨äºåˆå§‹åŒ–å·ç”¨çš„é•œåƒï¼Œå•ç‹¬ä¸€æ¬¡æ€§è¿è¡Œä»¥å°†åˆå§‹åŒ–æ•°æ®çŒå…¥å·ä¸­ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­æ¥è¯´ï¼Œå‡è®¾ä½ éœ€è¦ä¸ªå· <code>mydata</code>ï¼Œç„¶åé‡Œé¢éœ€è¦æœ‰ä¸ª <code>hello.txt</code> æ–‡ä»¶æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œå¦åˆ™å®¹å™¨è¿è¡Œå°±è¦å‡ºå¤§äº‹å„¿äº†â€¦â€¦ï¼ˆè¿™éœ€æ±‚å¾ˆå‚»æˆ‘çŸ¥é“â€¦â€¦ğŸ˜…å¥½å§ï¼Œå‡è®¾å¦‚æ­¤ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬å¾—å…ˆæœ‰è¿™ä¸ªå·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create --name mydata</span><br></pre></td></tr></table></figure>
<p>é‚£æ€ä¹ˆæŠŠè¿™ä¸ªè¶…é‡è¦çš„ <code>hello.txt</code> æ–‡ä»¶æ”¾å…¥å·ä¸­å‘¢ï¼Ÿæœ‰å‡ ç§åŠæ³•ã€‚</p>
<h4 id="æ­£å¸¸æŒ‚è½½è¯¥-mydata-å·ï¼Œç„¶å-docker-cp-è¿›å»"><a href="#æ­£å¸¸æŒ‚è½½è¯¥-mydata-å·ï¼Œç„¶å-docker-cp-è¿›å»" class="headerlink" title="æ­£å¸¸æŒ‚è½½è¯¥ mydata å·ï¼Œç„¶å docker cp è¿›å»"></a>æ­£å¸¸æŒ‚è½½è¯¥ <code>mydata</code> å·ï¼Œç„¶å <code>docker cp</code> è¿›å»</h4><p>è¿™æ˜¯ä¸ªå¾ˆå‚»çš„åŠæ³•ï¼Œä¸è¿‡å¦‚æœå®¹å™¨è¿è¡Œå¹¶ä¸ä¾èµ–äº <code>hello.txt</code> çš„è¯ï¼Œè¿™æ ·åšæ˜¯å¯ä»¥çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name web -v mydata:/data nginx</span><br><span class="line">$ docker cp ./hello.txt web:/data/</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ˜¯å…ˆè®©å®¹å™¨å¯åŠ¨ï¼Œå¯åŠ¨åï¼Œå†æŠŠæ‰€éœ€æ•°æ®å¯¼å…¥å·é‡Œé¢å»ã€‚ä»¥åå®¹å™¨å°±å¯ä»¥ä½¿ç”¨ <code>/data/hello.txt</code> æ–‡ä»¶äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœå®¹å™¨æ˜¯ä¸¥é‡ä¾èµ–äºè¿™ä¸ª <code>hello.txt</code> æ–‡ä»¶çš„è¯ï¼Œè¿™æ ·åšå°±ä¼šå‡ºé—®é¢˜ã€‚å®¹å™¨ä¼šå› ä¸º <code>hello.txt</code> æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè€ŒæŠ¥é”™é€€å‡ºï¼Œå¯¼è‡´æ ¹æœ¬æ²¡æœ‰ <code>docker cp</code> çš„æœºä¼šã€‚</p>
<p>è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å˜é€šä¸€ä¸‹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm \</span><br><span class="line">    -v <span class="variable">$PWD</span>:/<span class="built_in">source</span> \</span><br><span class="line">    -v mydata:/data \</span><br><span class="line">    busybox \</span><br><span class="line">    cp /<span class="built_in">source</span>/hello.txt /data/</span><br><span class="line">$ docker run -d --name web -v mydata:/data nginx</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆå¯åŠ¨äº†ä¸€ä¸ª <code>busybox</code> å®¹å™¨ï¼Œåˆ†åˆ«æŒ‚è½½è¦å¤åˆ¶çš„æºä»¥åŠç›®æ ‡çš„ <code>mydata</code> å·ï¼Œç„¶åç”¨ <code>cp</code> å‘½ä»¤å°† <code>hello.txt</code> å¤åˆ¶åˆ° <code>mydata</code> ä¸­å»ã€‚æ•°æ®å¯¼å…¥ç»“æŸåï¼Œæˆ‘ä»¬å†æ­£å¼æŒ‚è½½ <code>mydata</code> å·åˆ°æ­£å¼çš„å®¹å™¨ä¸Šå¹¶å¯åŠ¨ã€‚è¿™ä¸ªæ—¶å€™ä¸¥é‡ä¾èµ– <code>/data/hello.txt</code> çš„è¿™ä¸ªå®¹å™¨å°±å¯ä»¥é¡ºåˆ©è¿è¡Œäº†ã€‚</p>
<h4 id="ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ"><a href="#ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ" class="headerlink" title="ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ"></a>ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ</h4><p>æ‰‹åŠ¨çš„å»æ‰§è¡Œ <code>docker cp</code>ï¼Œæˆ–è€… <code>docker run ... cp ...</code> å¹¶ä¸æ˜¯å¾ˆæ­£è§„ã€‚å¯ä»¥å†™ä¸ªè„šæœ¬è®©ä¸€åˆ‡éƒ½æ ‡å‡†åŒ–ï¼Œä½†æ˜¯ï¼Œé™¤äº†æµç¨‹å¤–ï¼Œè¿˜éœ€è¦ç¡®ä¿å½“å‰ç¯å¢ƒä¸­çš„åˆå§‹åŒ–æ•°æ®çš„ç‰ˆæœ¬å¿…é¡»æ˜¯æ‰€æœŸæœ›çš„ï¼Œå¦åˆ™åˆå§‹åŒ–äº†é”™è¯¯çš„æ•°æ®ï¼Œä¹Ÿä¼šè®©è¿è¡Œæ—¶çŠ¶æ€è¾¾ä¸åˆ°é¢„æœŸçš„æ•ˆæœã€‚</p>
<p>å› æ­¤ï¼Œå¦ä¸€ç§åŠæ³•æ˜¯ä¸“é—¨åˆ¶ä½œä¸€ä¸ªåˆå§‹åŒ–å·çš„é•œåƒï¼Œè¿™æ ·çš„åšæ³•ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿åœ¨ CI/CD æµç¨‹ä¸­å¯¹åˆå§‹åŒ–æ•°æ®çš„è¿‡ç¨‹è¿›è¡Œæµ‹è¯•ç¡®è®¤ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> busybox</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> hello.txt /<span class="built_in">source</span>/</span></span><br><span class="line"><span class="bash">VOLUME /data</span></span><br><span class="line"><span class="bash">CMD [<span class="string">"cp"</span>, <span class="string">"/source/hello.txt"</span>, <span class="string">"/data/"</span>]</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„é•œåƒåªæœ‰ä¸€ä¸ªç”Ÿå­˜ç›®çš„ï¼Œå°±æ˜¯æŒ‚è½½ <code>mydata</code> å·ï¼Œå¹¶ä¸”æŠŠæ•°æ®å¯¼å…¥è¿›å»ã€‚å‡è®¾æ„å»ºå¥½çš„é•œåƒåä¸º <code>volume-prepare</code>ï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å®Œæˆå¯¼å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --rm -v mydata:/data volume-prepare</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨é•œåƒçš„-Dockerfile-åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†"><a href="#åœ¨é•œåƒçš„-Dockerfile-åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†" class="headerlink" title="åœ¨é•œåƒçš„ Dockerfile åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†"></a>åœ¨é•œåƒçš„ <code>Dockerfile</code> åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†</h4><p>åœ¨ä¹‹å‰çš„é—®ç­”ä¸­æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œå®˜æ–¹é•œåƒ <code>mysql</code> ä¸­å¯ä»¥ä½¿ç”¨ <code>Dockerfile</code> æ¥æ·»åŠ åˆå§‹åŒ–è„šæœ¬ï¼Œå¹¶ä¸”ä¼šåœ¨è¿è¡Œæ—¶åˆ¤æ–­æ˜¯å¦ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œï¼Œå¦‚æœç¡®å®éœ€è¦åˆå§‹åŒ–ï¼Œåˆ™æ‰§è¡Œå®šåˆ¶çš„åˆå§‹åŒ–è„šæœ¬ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•å°† <code>hello.txt</code> åœ¨åˆå§‹åŒ–çš„æ—¶å€™åŠ å…¥åˆ° <code>mydata</code> å·ä¸­å»ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªè¿›å…¥ç‚¹çš„è„šæœ¬ï¼Œç”¨ä»¥ç¡®ä¿åœ¨å®¹å™¨æ‰§è¡Œçš„æ—¶å€™éƒ½ä¼šè¿è¡Œï¼Œè€Œè¿™ä¸ªè„šæœ¬å°†åˆ¤æ–­æ˜¯å¦éœ€è¦æ•°æ®åˆå§‹åŒ–ï¼Œå¹¶ä¸”è¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">"/data/hello.txt"</span> ]; <span class="keyword">then</span></span><br><span class="line">    cp /<span class="built_in">source</span>/hello.txt /data/</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>
<p>åä¸º <code>entrypoint.sh</code> çš„è¿™ä¸ªè„šæœ¬å¾ˆç®€å•ï¼Œåˆ¤æ–­ä¸€ä¸‹ <code>/data/hello.txt</code> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±éœ€è¦åˆå§‹åŒ–ã€‚åˆå§‹åŒ–è¡Œä¸ºä¹Ÿå¾ˆç®€å•ï¼Œå°†å®ç°å‡†å¤‡å¥½çš„ <code>/source/hello.txt</code> å¤åˆ¶åˆ° <code>/data/</code> ç›®å½•ä¸­å»ï¼Œä»¥å®Œæˆåˆå§‹åŒ–ã€‚ç¨‹åºçš„æœ€åï¼Œå°†æ‰§è¡Œé€å…¥çš„å‘½ä»¤ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ <code>Dockerfile</code>ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> hello.txt /<span class="built_in">source</span>/</span></span><br><span class="line"><span class="bash">COPY entrypoint.sh /</span></span><br><span class="line"><span class="bash">VOLUME /data</span></span><br><span class="line"><span class="bash">ENTRYPOINT [<span class="string">"/entrypoint.sh"</span>]</span></span><br><span class="line"><span class="bash">CMD [<span class="string">"nginx"</span>, <span class="string">"-g"</span>, <span class="string">"daemon off;"</span>]</span></span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æ„å»ºé•œåƒã€å¯åŠ¨å®¹å™¨åï¼Œå°±ä¼šå‘ç° <code>/data</code> ç›®å½•ä¸‹å·²ç»å­˜åœ¨äº† <code>hello.txt</code> æ–‡ä»¶äº†ï¼Œåˆå§‹åŒ–æˆåŠŸäº†ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨-Docker-å®¹å™¨é‡Œè¿è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨-Docker-å®¹å™¨é‡Œè¿è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨ Docker å®¹å™¨é‡Œè¿è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨ Docker å®¹å™¨é‡Œè¿è¡Œï¼Ÿ</h3><p>ä¸ä¸ºä»€ä¹ˆï¼Œ<strong>å› ä¸ºè¿™ä¸ªè¯´æ³•ä¸å¯¹</strong>ï¼Œå¤§éƒ¨åˆ†è®¤ä¸ºæ•°æ®åº“å¿…é¡»æ”¾åˆ°å®¹å™¨å¤–è¿è¡Œçš„äººæ ¹æœ¬ä¸çŸ¥é“ <code>Docker Volume</code> ä¸ºä½•ç‰©ã€‚</p>
<p>åœ¨æ—©å¹´ Docker æ²¡æœ‰ <code>Docker Volume</code> çš„æ—¶å€™ï¼Œå…¶æ•°æ®æŒä¹…åŒ–æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™å·²ç»å¾ˆå¤šå¹´è¿‡å»äº†ã€‚ç°åœ¨æœ‰ <code>Docker Volume</code> è§£å†³æŒä¹…åŒ–é—®é¢˜ï¼Œä»æœ¬åœ°ç›®å½•ç»‘å®šã€å—æ§å­˜å‚¨ç©ºé—´ã€å—è®¾å¤‡ã€ç½‘ç»œå­˜å‚¨åˆ°åˆ†å¸ƒå¼å­˜å‚¨ï¼Œ<code>Docker Volume</code> éƒ½æ”¯æŒï¼Œä¸å­˜åœ¨æ•°æ®è¯»å†™ç±»çš„æœåŠ¡ä¸é€‚äºè¿è¡Œäºå®¹å™¨å†…çš„è¯´æ³•ã€‚</p>
<p>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œä½¿ç”¨æ•°æ®å·æ˜¯ç›´æ¥å‘å®¿ä¸»å†™å…¥æ–‡ä»¶ï¼Œä¸å­˜åœ¨æ€§èƒ½æŸè€—ã€‚è€Œä¸”å·çš„ç”Ÿå­˜å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œå®¹å™¨æ¶ˆäº¡å·ä¸æ¶ˆäº¡ï¼Œé‡æ–°è¿è¡Œå®¹å™¨å¯ä»¥æŒ‚è½½æŒ‡å®šå‘½åå·ï¼Œæ•°æ®ä¾ç„¶å­˜åœ¨ï¼Œä¹Ÿä¸å­˜åœ¨æ— æ³•æŒä¹…åŒ–çš„é—®é¢˜ã€‚</p>
<p>å»ºè®®å»é˜…è¯»ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="noopener">https://docs.docker.com/engine/tutorials/dockervolumes/</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_create/</a></li>
<li><a href="https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins" target="_blank" rel="noopener">https://docs.docker.com/engine/extend/legacy_plugins/#/volume-plugins</a></li>
</ul>
<h3 id="å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ"><a href="#å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ"></a>å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ</h3><p>è¦æ„Ÿè°¢å¼ºå¤§çš„ <code>Go Template</code>ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ˜¾ç¤ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format <span class="string">'&#123;&#123;.Name&#125;&#125; =&gt; &#123;&#123;with .Mounts&#125;&#125;&#123;&#123;range .&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;.Name&#125;&#125;,&#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;'</span> $(docker ps -aq)</span><br></pre></td></tr></table></figure>
<p><em>æ³¨æ„è¿™é‡Œçš„æ¢è¡Œå’Œç©ºæ ¼æ˜¯æœ‰æ„å¦‚æ­¤çš„</em>ï¼Œè¿™æ ·å°±å¯ä»¥å†è¿”å›ç»“æœæ§åˆ¶ç¼©è¿›æ ¼å¼ã€‚å…¶ç»“æœå°†æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ docker inspect --format <span class="string">'&#123;&#123;.Name&#125;&#125; =&gt; &#123;&#123;with .Mounts&#125;&#125;&#123;&#123;range .&#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;.Name&#125;&#125;&#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;'</span> $(docker ps -aq)</span><br><span class="line">/device_api_1 =&gt;</span><br><span class="line">/device_dashboard-debug_1 =&gt;</span><br><span class="line">/device_redis_1 =&gt;</span><br><span class="line">    device_redis-data</span><br><span class="line">/device_mongo_1 =&gt;</span><br><span class="line">    device_mongo-data</span><br><span class="line">    61453e46c3409f42e938324d7feffc6aeb6b7ce16d2080566e3b128c910c9570</span><br><span class="line">/prometheus_prometheus_1 =&gt;</span><br><span class="line">    fc0185ed3fc637295de810efaff7333e8ff2f6050d7f9368a22e19fb2c1e3c3f</span><br></pre></td></tr></table></figure>
<h2 id="é•œåƒé—®é¢˜-17"><a href="#é•œåƒé—®é¢˜-17" class="headerlink" title="é•œåƒé—®é¢˜ (17)"></a>é•œåƒé—®é¢˜ <code>(17)</code></h2><h3 id="docker-pull-ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ"><a href="#docker-pull-ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ" class="headerlink" title="docker pull ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ"></a><code>docker pull</code> ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ</h3><blockquote>
<p>åˆå­¦ Docker è¦åå¤å‘Šè¯«è‡ªå·±ï¼Œ<strong>Docker ä¸æ˜¯è™šæ‹Ÿæœº</strong>ã€‚</p>
</blockquote>
<p>Dockerä¸æ˜¯è™šæ‹Ÿæœºï¼ŒDocker é•œåƒä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºçš„ ISO æ–‡ä»¶ã€‚Docker çš„é•œåƒæ˜¯åˆ†å±‚å­˜å‚¨ï¼Œæ¯ä¸€ä¸ªé•œåƒéƒ½æ˜¯ç”±å¾ˆå¤šå±‚ï¼Œå¾ˆå¤šä¸ªæ–‡ä»¶ç»„æˆã€‚è€Œä¸åŒçš„é•œåƒæ˜¯å…±äº«ç›¸åŒçš„å±‚çš„ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œä¸å­˜åœ¨å…·ä½“å“ªä¸ªæ–‡ä»¶æ˜¯ <code>pull</code> ä¸‹æ¥çš„é•œåƒçš„é—®é¢˜ã€‚</p>
<p>å…·ä½“é•œåƒä¿å­˜ä½ç½®å–å†³äºç³»ç»Ÿï¼Œä¸€èˆ¬<code>Linux</code>ç³»ç»Ÿä¸‹ï¼Œåœ¨ <code>/var/lib/docker</code> é‡Œã€‚å¯¹äºä½¿ç”¨ <code>Union FS</code> çš„ç³»ç»Ÿ(<code>Ubuntu</code>)ï¼Œå¦‚ <code>aufs</code>, <code>overlay2</code> ç­‰ï¼Œå¯ä»¥ç›´æ¥åœ¨ <code>/var/lib/docker/{aufs,overlay2}</code> ä¸‹çœ‹åˆ°æ‰¾åˆ°å„ä¸ªé•œåƒçš„å±‚ã€å®¹å™¨çš„å±‚ï¼Œä»¥åŠå…¶ä¸­çš„å†…å®¹ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¯¹äº<code>CentOS</code>è¿™ç±»æ²¡æœ‰<code>Union FS</code>çš„ç³»ç»Ÿï¼Œä¼šä½¿ç”¨å¦‚<code>devicemapper</code>è¿™ç±»ä¸œè¥¿çš„ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½(å¦‚<code>snapshot</code>)æ¨¡æ‹Ÿï¼Œé•œåƒä¼šå­˜å‚¨äºå—è®¾å¤‡é‡Œï¼Œå› æ­¤æ— æ³•çœ‹åˆ°å…·ä½“æ¯å±‚ä¿¡æ¯ä»¥åŠæ¯å±‚é‡Œé¢çš„å†…å®¹ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>CentOS/RHEL</code> ä½¿ç”¨ <code>lvm-loop</code>ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¨€ç–æ–‡ä»¶æ¨¡æ‹Ÿå—è®¾å¤‡ï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šä½äº <code>/var/lib/docker/devicemapper/devicemapper/data</code> çš„ä½ç½®ã€‚è¿™æ˜¯éå¸¸ä¸æ¨èçš„ï¼Œå¦‚æœå‘ç°è¿™ä¸ªæ–‡ä»¶å¾ˆå¤§ï¼Œé‚£å°±è¯´æ˜ä½ åœ¨ç”¨ <code>devicemapper + loop</code> çš„æ–¹å¼ï¼Œä¸è¦è¿™ä¹ˆåšï¼Œå»å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæ¢ <code>direct-lvm</code>ï¼Œä¹Ÿå°±æ˜¯åˆ†é…çœŸæ­£çš„å—è®¾å¤‡ç»™ <code>devicemapper</code> å»ç”¨ã€‚</p>
<h3 id="docker-images-å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ"><a href="#docker-images-å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ" class="headerlink" title="docker images å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ"></a><code>docker images</code> å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ</h3><p>è¿™ä¸ªæ˜¾ç¤ºçš„å¤§å°æ˜¯è®¡ç®—åçš„å¤§å°ï¼Œè¦çŸ¥é“ docker image æ˜¯åˆ†å±‚å­˜å‚¨çš„ï¼Œåœ¨<code>1.10</code>ä¹‹å‰ï¼Œä¸åŒé•œåƒæ— æ³•å…±äº«åŒä¸€å±‚ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šç¡®å®æ˜¯ä¸‹è½½å¤§å°ã€‚ä½†æ˜¯ä»<code>1.10</code>ä¹‹åï¼Œå·²æœ‰çš„å±‚ï¼ˆé€šè¿‡<code>SHA256</code>æ¥åˆ¤æ–­ï¼‰ï¼Œä¸éœ€è¦å†ä¸‹è½½ã€‚åªéœ€è¦ä¸‹è½½å˜åŒ–çš„å±‚ã€‚æ‰€ä»¥å®é™…ä¸‹è½½å¤§å°æ¯”è¿™ä¸ªæ•°å€¼è¦å°ã€‚è€Œä¸”æœ¬åœ°ç¡¬ç›˜ç©ºé—´å ç”¨ï¼Œä¹Ÿæ¯”<code>docker images</code>åˆ—å‡ºæ¥çš„ä¸œè¥¿åŠ èµ·æ¥å°å¾ˆå¤šï¼Œå¾ˆå¤šé‡å¤çš„éƒ¨åˆ†å…±äº«äº†ã€‚</p>
<h3 id="docker-images-a-åæ˜¾ç¤ºäº†å¥½å¤š-lt-none-gt-çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ"><a href="#docker-images-a-åæ˜¾ç¤ºäº†å¥½å¤š-lt-none-gt-çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ" class="headerlink" title="docker images -a åæ˜¾ç¤ºäº†å¥½å¤š &lt;none&gt; çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ"></a><code>docker images -a</code> åæ˜¾ç¤ºäº†å¥½å¤š <code>&lt;none&gt;</code> çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ</h3><p>ç®€å•æ¥è¯´ï¼Œ<code>&lt;none&gt;</code> å°±æ˜¯è¯´è¯¥é•œåƒæ²¡æœ‰æ‰“æ ‡ç­¾ã€‚è€Œæ²¡æœ‰æ‰“æ ‡ç­¾é•œåƒä¸€èˆ¬åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯<strong>ä¾èµ–é•œåƒ</strong>ï¼Œä¸€ç±»æ˜¯<strong>ä¸¢äº†æ ‡ç­¾çš„é•œåƒ</strong>ã€‚</p>
<h4 id="ä¾èµ–é•œåƒ"><a href="#ä¾èµ–é•œåƒ" class="headerlink" title="ä¾èµ–é•œåƒ"></a>ä¾èµ–é•œåƒ</h4><p>Dockerçš„é•œåƒã€å®¹å™¨çš„å­˜å‚¨å±‚æ˜¯Union FSï¼Œåˆ†å±‚å­˜å‚¨ç»“æ„ã€‚æ‰€ä»¥ä»»ä½•é•œåƒé™¤äº†æœ€ä¸Šé¢ä¸€å±‚æ‰“ä¸Šæ ‡ç­¾(tag)å¤–ï¼Œå…¶å®ƒä¸‹é¢ä¾èµ–çš„ä¸€å±‚å±‚å­˜å‚¨ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚è¿™äº›é•œåƒæ²¡æœ‰æ‰“ä¸Šä»»ä½•æ ‡ç­¾ï¼Œæ‰€ä»¥åœ¨ <code>docker images -a</code> çš„æ—¶å€™ä¼šä»¥ <code>&lt;none&gt;</code> çš„å½¢å¼æ˜¾ç¤ºã€‚æ³¨æ„è§‚å¯Ÿä¸€ä¸‹ <code>docker pull</code> çš„æ¯ä¸€å±‚çš„<code>sha256</code>çš„æ ¡éªŒå€¼ï¼Œç„¶åå¯¹æ¯”ä¸€ä¸‹ <code>&lt;none&gt;</code> ä¸­çš„ç›¸åŒæ ¡éªŒå€¼çš„é•œåƒï¼Œå®ƒä»¬å°±æ˜¯ä¾èµ–é•œåƒã€‚è¿™äº›é•œåƒ<strong>ä¸åº”å½“è¢«åˆ é™¤</strong>ï¼Œå› ä¸ºæœ‰æ ‡ç­¾é•œåƒåœ¨ä¾èµ–å®ƒä»¬ã€‚</p>
<h4 id="ä¸¢äº†æ ‡ç­¾çš„é•œåƒ"><a href="#ä¸¢äº†æ ‡ç­¾çš„é•œåƒ" class="headerlink" title="ä¸¢äº†æ ‡ç­¾çš„é•œåƒ"></a>ä¸¢äº†æ ‡ç­¾çš„é•œåƒ</h4><p>è¿™ç±»é•œåƒå¯èƒ½æœ¬æ¥æœ‰æ ‡ç­¾ï¼Œåæ¥ä¸¢äº†ã€‚åŸå› å¯èƒ½å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>docker pull</code> äº†ä¸€ä¸ªåŒæ ·æ ‡ç­¾ä½†æ˜¯æ–°ç‰ˆæœ¬çš„é•œåƒï¼Œäºæ˜¯è¯¥æ ‡ç­¾ä»æ—§ç‰ˆæœ¬çš„é•œåƒè½¬ç§»åˆ°äº†æ–°ç‰ˆæœ¬é•œåƒä¸Šï¼Œé‚£ä¹ˆæ—§ç‰ˆæœ¬çš„é•œåƒä¸Šçš„æ ‡ç­¾å°±ä¸¢äº†ï¼›</li>
<li><code>docker build</code> æ—¶æŒ‡å®šçš„æ ‡ç­¾éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆæ–°æ„å»ºçš„é•œåƒæ‹¥æœ‰è¯¥æ ‡ç­¾ï¼Œè€Œä¹‹å‰æ„å»ºçš„é•œåƒå°±ä¸¢å¤±äº†æ ‡ç­¾ã€‚</li>
</ul>
<p>è¿™ç±»é•œåƒè¢«ç§°ä¸º <code>dangling</code> - è™šæ‚¬é•œåƒã€‚è¿™äº›é•œåƒå¯ä»¥åˆ é™¤ï¼Œæ‰‹åŠ¨åˆ é™¤ dangling é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune</span><br></pre></td></tr></table></figure>
<p>å¯¹äº 1.13 ä»¥å‰çš„è€ç‰ˆæœ¬ï¼Œä½¿ç”¨ <code>dangling=true</code> è¿‡æ»¤æ¡ä»¶å³å¯ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š<code>docker rmi $(docker images -aq -f &quot;dangling=true&quot;)</code></p>
<p>å¯¹äºé¢‘ç¹æ„å»ºçš„æœºå™¨ï¼Œæ¯”å¦‚ Jenkins ä¹‹ç±»çš„ç¯å¢ƒã€‚æ‰‹åŠ¨æ¸…ç†æ˜¾ç„¶ä¸æ˜¯å¥½çš„åŠæ³•ï¼Œåº”è¯¥å®šæœŸæ‰§è¡Œå›ºå®šè„šæœ¬æ¥æ¸…ç†è¿™äº›æ— ç”¨çš„é•œåƒã€‚å¾ˆå¹¸è¿ï¼ŒSpotify ä¹Ÿé¢ä¸´äº†åŒæ ·çš„é—®é¢˜ï¼Œä»–ä»¬å·²ç»å†™äº†ä¸€ä¸ªå¼€æºå·¥å…·æ¥åšè¿™ä»¶äº‹æƒ…ï¼š<a href="https://github.com/spotify/docker-gc" target="_blank" rel="noopener">https://github.com/spotify/docker-gc</a></p>
<h3 id="ä¸ºä»€ä¹ˆ-Docker-Hub-çš„é•œåƒå°ºå¯¸å’Œ-docker-images-ä¸ä¸€è‡´ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Docker-Hub-çš„é•œåƒå°ºå¯¸å’Œ-docker-images-ä¸ä¸€è‡´ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Docker Hub çš„é•œåƒå°ºå¯¸å’Œ docker images ä¸ä¸€è‡´ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Docker Hub çš„é•œåƒå°ºå¯¸å’Œ <code>docker images</code> ä¸ä¸€è‡´ï¼Ÿ</h3><p>Docker Hubä¸Šæ˜¾ç¤ºçš„æ˜¯ç»è¿‡ <code>gzip</code> å‹ç¼©åçš„é•œåƒå¤§å°ï¼Œè¿™ä¸ªå¤§å°ä¹Ÿæ˜¯ä½ å°†ä¸‹è½½çš„é•œåƒå¤§å°ï¼Œä¸€èˆ¬æ¥è¯´ä¹Ÿæ˜¯ Docker Hub ç”¨æˆ·æœ€å…³å¿ƒçš„å¤§å°ã€‚</p>
<p>è€Œ <code>docker images</code> æ˜¾ç¤ºçš„æ˜¯<code>pull</code>ä¸‹æ¥å¹¶è§£å‹ç¼©åçš„å¤§å°ï¼Œå› ä¸ºä½¿ç”¨<code>docker images</code>çš„æ—¶å€™æ›´å…³å¿ƒçš„æ˜¯æœ¬åœ°ç£ç›˜ç©ºé—´å ç”¨çš„å¤§å°ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯æœªå‹ç¼©é•œåƒçš„å¤§å°ã€‚</p>
<h3 id="docker-commit-æ€ä¹ˆç”¨å•Šï¼Ÿ"><a href="#docker-commit-æ€ä¹ˆç”¨å•Šï¼Ÿ" class="headerlink" title="docker commit æ€ä¹ˆç”¨å•Šï¼Ÿ"></a><code>docker commit</code> æ€ä¹ˆç”¨å•Šï¼Ÿ</h3><p>ç®€å•çš„å›ç­”å°±æ˜¯ï¼Œä¸è¦ç”¨ <code>commit</code>ï¼Œå»å†™ <code>Dockerfile</code>ã€‚</p>
<blockquote>
<p>Docker ä¸æ˜¯è™šæ‹Ÿæœºã€‚è¿™å¥è¯è¦åœ¨å­¦ä¹  Docker çš„è¿‡ç¨‹ä¸­åå¤æé†’è‡ªå·±ã€‚æ‰€ä»¥ä¸è¦æŠŠè™šæ‹Ÿæœºä¸­çš„ä¸€äº›æ¦‚å¿µå¸¦è¿‡æ¥ã€‚</p>
</blockquote>
<p>Docker æä¾›äº†å¾ˆå¥½çš„ <code>Dockerfile</code> çš„æœºåˆ¶æ¥å¸®åŠ©å®šåˆ¶é•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Shell å‘½ä»¤ï¼Œéå¸¸æ–¹ä¾¿ã€‚è€Œä¸”ï¼Œè¿™æ ·åˆ¶ä½œçš„é•œåƒæ›´åŠ é€æ˜ï¼Œä¹Ÿå®¹æ˜“ç»´æŠ¤ï¼Œåœ¨åŸºç¡€é•œåƒå‡çº§åï¼Œå¯ä»¥ç®€å•åœ°é‡æ–°æ„å»ºä¸€ä¸‹ï¼Œå°±å¯ä»¥ç»§æ‰¿åŸºç¡€é•œåƒçš„å®‰å…¨ç»´æŠ¤æ“ä½œã€‚</p>
<p>ä½¿ç”¨ <code>docker commit</code> åˆ¶ä½œçš„é•œåƒè¢«ç§°ä¸º<code>é»‘ç®±é•œåƒ</code>ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯é‡Œé¢è¿›è¡Œçš„æ˜¯é»‘ç®±æ“ä½œï¼Œé™¤æœ¬äººå¤–æ— äººçŸ¥æ™“ã€‚å³ä½¿è¿™ä¸ªåˆ¶ä½œé•œåƒçš„äººï¼Œè¿‡ä¸€æ®µæ—¶é—´åä¹Ÿä¸ä¼šå®Œæ•´çš„è®°èµ·é‡Œé¢çš„æ“ä½œã€‚é‚£ä¹ˆå½“æœ‰äº›ä¸œè¥¿éœ€è¦æ”¹å˜æ—¶ï¼Œæˆ–è€…å› åŸºç¡€é•œåƒæ›´æ–°è€Œéœ€è¦é‡æ–°åˆ¶ä½œé•œåƒæ—¶ï¼Œä¼šè®©ä¸€åˆ‡å˜å¾—å¼‚å¸¸å›°éš¾ï¼Œå°±å¦‚åŒé‡æ–°å®‰è£…è°ƒè¯•é…ç½®æœåŠ¡å™¨ä¸€æ ·ï¼Œå¤±å»äº† Docker çš„ä¼˜åŠ¿äº†ã€‚</p>
<p>å¦å¤–ï¼ŒDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå…¶æ–‡ä»¶ç³»ç»Ÿæ˜¯ Union FSï¼Œåˆ†å±‚å¼å­˜å‚¨ï¼Œæ¯ä¸€æ¬¡ <code>commit</code> éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œä¸Šä¸€å±‚çš„æ–‡ä»¶å¹¶ä¸ä¼šå› ä¸º <code>rm</code> è€Œåˆ é™¤ï¼Œåªæ˜¯åœ¨å½“å‰å±‚æ ‡è®°ä¸ºåˆ é™¤è€Œçœ‹ä¸åˆ°äº†è€Œå·²ï¼Œæ¯æ¬¡ <code>docker pull</code> çš„æ—¶å€™ï¼Œé‚£äº›ä¸å¿…è¦çš„æ–‡ä»¶éƒ½ä¼šå¦‚å½±éšå½¢ï¼Œæ‰€å¾—åˆ°çš„é•œåƒä¹Ÿå¿…ç„¶è‡ƒè‚¿ä¸å ªã€‚è€Œä¸”ï¼Œéšç€æ–‡ä»¶å±‚æ•°çš„å¢åŠ ï¼Œä¸ä»…ä»…é•œåƒæ›´è‡ƒè‚¿ï¼Œå…¶è¿è¡Œæ—¶æ€§èƒ½ä¹Ÿå¿…ç„¶ä¼šå—åˆ°å½±å“ã€‚è¿™ä¸€åˆ‡éƒ½è¿èƒŒäº† Docker çš„æœ€ä½³å®è·µã€‚</p>
<p>ä½¿ç”¨ <code>commit</code> çš„åœºåˆæ˜¯ä¸€äº›ç‰¹æ®Šç¯å¢ƒï¼Œæ¯”å¦‚å…¥ä¾µåä¿å­˜ç°åœºç­‰ç­‰ï¼Œè¿™ä¸ªå‘½ä»¤ä¸åº”è¯¥æˆä¸ºå®šåˆ¶é•œåƒçš„æ ‡å‡†åšæ³•ã€‚æ‰€ä»¥ï¼Œè¯·ç”¨ <code>Dockerfile</code> å®šåˆ¶é•œåƒã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨-import-export-save-load-commit-æ¥æ„å»ºé•œåƒï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨-import-export-save-load-commit-æ¥æ„å»ºé•œåƒï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨ import, export, save, load, commit æ¥æ„å»ºé•œåƒï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨ <code>import</code>, <code>export</code>, <code>save</code>, <code>load</code>, <code>commit</code> æ¥æ„å»ºé•œåƒï¼Ÿ</h3><p><code>commit</code> å‘½ä»¤åœ¨å‰ä¸€ä¸ªé—®ç­”å·²ç»è¯´è¿‡ï¼Œè¿™æ˜¯åˆ¶ä½œ<strong>é»‘ç®±é•œåƒ</strong>ï¼Œæ— æ³•ç»´æŠ¤ï¼Œä¸åº”è¯¥è¢«ä½¿ç”¨ã€‚</p>
<p><code>import</code> å’Œ <code>export</code> çš„åšæ³•ï¼Œå®é™…ä¸Šæ˜¯å°†ä¸€ä¸ª<em>å®¹å™¨</em>æ¥ä¿å­˜ä¸º <code>tar</code> æ–‡ä»¶ï¼Œç„¶ååœ¨å¯¼å…¥ä¸º<em>é•œåƒ</em>ã€‚è¿™æ ·åˆ¶ä½œçš„é•œåƒåŒæ ·æ˜¯<strong>é»‘ç®±é•œåƒ</strong>ï¼Œä¸åº”è¯¥ä½¿ç”¨ã€‚è€Œä¸”è¿™ç±»å¯¼å…¥å¯¼å‡ºä¼šå¯¼è‡´åŸæœ‰åˆ†å±‚ä¸¢å¤±ï¼Œåˆå¹¶ä¸ºä¸€å±‚ï¼Œè€Œä¸”ä¼šä¸¢å¤±å¾ˆå¤šç›¸å…³é•œåƒå…ƒæ•°æ®æˆ–è€…é…ç½®ï¼Œæ¯”å¦‚ <code>CMD</code> å‘½ä»¤å°±å¯èƒ½ä¸¢å¤±ï¼Œå¯¼è‡´é•œåƒæ— æ³•ç›´æ¥å¯åŠ¨ã€‚</p>
<p><code>save</code> å’Œ <code>load</code> ç¡®å®æ˜¯é•œåƒä¿å­˜å’ŒåŠ è½½ï¼Œä½†æ˜¯è¿™æ˜¯åœ¨æ²¡æœ‰ <code>registry</code> çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨æŠŠé•œåƒè€ƒæ¥è€ƒå»ï¼Œè¿™æ˜¯å›åˆ°äº†åå¤šå¹´çš„ U ç›˜æ—¶ä»£ğŸ˜­ã€‚è¿™åŒæ ·æ˜¯ä¸æ¨èçš„ï¼Œé•œåƒçš„å‘å¸ƒã€æ›´æ–°ç»´æŠ¤åº”è¯¥ä½¿ç”¨ <code>registry</code>ã€‚æ— è®ºæ˜¯è‡ªå·±æ¶è®¾ç§æœ‰ <code>registry</code> æœåŠ¡ï¼Œè¿˜æ˜¯ä½¿ç”¨å…¬æœ‰ <code>registry</code> æœåŠ¡ï¼Œå¦‚ <a href="https://hub.docker.com/" target="_blank" rel="noopener">Docker Hub</a>ã€‚</p>
<h3 id="Dockerfile-æ€ä¹ˆå†™ï¼Ÿ"><a href="#Dockerfile-æ€ä¹ˆå†™ï¼Ÿ" class="headerlink" title="Dockerfile æ€ä¹ˆå†™ï¼Ÿ"></a><code>Dockerfile</code> æ€ä¹ˆå†™ï¼Ÿ</h3><p>æœ€ç›´æ¥ä¹Ÿæ˜¯æœ€ç®€å•çš„åŠæ³•æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è®²è¿°å…·ä½“ <code>Dockerfile</code> çš„å‘½ä»¤è¯­æ³•ï¼š<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p>
<p>ç„¶åï¼Œå­¦ä¹ ä¸€ä¸‹å®˜æ–¹çš„ <code>Dockerfile</code> æœ€ä½³å®è·µï¼š<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/</a></p>
<p>æœ€åï¼Œå» Docker Hub å­¦ä¹ é‚£äº›<strong><a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">å®˜æ–¹(Official)é•œåƒ</a></strong> <code>Dockerfile</code> å’‹å†™çš„ã€‚</p>
<h3 id="Dockerfile-å°±æ˜¯-shell-è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚"><a href="#Dockerfile-å°±æ˜¯-shell-è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚" class="headerlink" title="Dockerfile å°±æ˜¯ shell è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚"></a><code>Dockerfile</code> å°±æ˜¯ <code>shell</code> è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚</h3><p>ä¸æ˜¯è¿™æ ·çš„ã€‚</p>
<blockquote>
<p><code>Dockerfile</code> ä¸ç­‰äº <code>.sh</code> è„šæœ¬</p>
</blockquote>
<p><code>Dockerfile</code> ç¡®å®æ˜¯æè¿°å¦‚ä½•æ„å»ºé•œåƒçš„ï¼Œå…¶ä¸­ä¹Ÿæä¾›äº† <code>RUN</code> è¿™æ ·çš„å‘½ä»¤ï¼Œå¯ä»¥è¿è¡Œ shell å‘½ä»¤ã€‚ä½†æ˜¯å’Œæ™®é€š shell è„šæœ¬è¿˜æœ‰å¾ˆå¤§çš„ä¸åŒã€‚</p>
<p><code>Dockerfile</code> æè¿°çš„å®é™…ä¸Šæ˜¯é•œåƒçš„æ¯ä¸€å±‚è¦å¦‚ä½•æ„å»ºï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª<code>RUN</code>æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä¸€å±‚ã€‚æ‰€ä»¥ä¸€å®šè¦ç†è§£â€œåˆ†å±‚å­˜å‚¨â€çš„æ¦‚å¿µã€‚ä¸Šä¸€å±‚çš„ä¸œè¥¿ä¸ä¼šè¢«ç‰©ç†åˆ é™¤ï¼Œè€Œæ˜¯ä¼šä¿ç•™ç»™ä¸‹ä¸€å±‚ï¼Œä¸‹ä¸€å±‚ä¸­å¯ä»¥æŒ‡å®šåˆ é™¤è¿™éƒ¨åˆ†å†…å®¹ï¼Œä½†å®é™…ä¸Šåªæ˜¯è¿™ä¸€å±‚åšçš„æŸä¸ªæ ‡è®°ï¼Œè¯´è¿™ä¸ªè·¯å¾„çš„ä¸œè¥¿åˆ äº†ã€‚ä½†å®é™…ä¸Šå¹¶ä¸ä¼šå»ä¿®æ”¹ä¸Šä¸€å±‚çš„ä¸œè¥¿ã€‚æ¯ä¸€å±‚éƒ½æ˜¯é™æ€çš„ï¼Œè¿™ä¹Ÿæ˜¯å®¹å™¨æœ¬èº«çš„ <code>immutable</code> ç‰¹æ€§ï¼Œè¦ä¿æŒè‡ªèº«çš„é™æ€ç‰¹æ€§ã€‚</p>
<p>æ‰€ä»¥å¾ˆå¤šæ–°æ‰‹ä¼šå¸¸çŠ¯ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼ŒæŠŠ <code>Dockerfile</code> å½“åš shell è„šæœ¬æ¥å†™äº†ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é”™è¯¯æ¡ˆä¾‹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum update</span></span><br><span class="line"><span class="bash">RUN yum -y install gcc</span></span><br><span class="line"><span class="bash">RUN yum -y install python </span></span><br><span class="line"><span class="bash">ADD jdk-xxxx.tar.gz /tmp</span></span><br><span class="line"><span class="bash">RUN <span class="built_in">cd</span> xxxx &amp;&amp; install</span></span><br><span class="line"><span class="bash">RUN xxx &amp;&amp; configure &amp;&amp; make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ç›¸å½“é”™è¯¯çš„ã€‚é™¤äº†æ— ç•çš„å¢åŠ äº†å¾ˆå¤šå±‚ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚</p>
<p>æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯æŠŠ<strong>åŒä¸€ä¸ªä»»åŠ¡çš„å‘½ä»¤</strong>æ”¾åˆ°ä¸€ä¸ª <code>RUN</code> ä¸‹ï¼Œå¤šæ¡å‘½ä»¤åº”è¯¥ç”¨ <code>&amp;&amp;</code> è¿æ¥ï¼Œå¹¶ä¸”åœ¨æœ€åè¦æ‰“æ‰«å¹²å‡€æ‰€ä½¿ç”¨çš„ç¯å¢ƒï¼Œå› ä¸ºæ¯æ‰§è¡Œä¸€æ¬¡<code>RUN</code>jå°±å¤šåŠ äº†ä¸€å±‚é•œåƒã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µæ‘˜è‡ªå®˜æ–¹ <code>redis</code> é•œåƒ <code>Dockerfile</code> çš„éƒ¨åˆ†ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> buildDeps=<span class="string">'gcc libc6-dev make'</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">set</span> -x \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update &amp;&amp; apt-get install -y <span class="variable">$buildDeps</span> --no-install-recommends \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -O redis.tar.gz <span class="string">"<span class="variable">$REDIS_DOWNLOAD_URL</span>"</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$REDIS_DOWNLOAD_SHA1</span> *redis.tar.gz"</span> | sha1sum -c - \</span></span><br><span class="line"><span class="bash">    &amp;&amp; mkdir -p /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm redis.tar.gz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; make -C /usr/src/redis install \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -r /usr/src/redis \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove <span class="variable">$buildDeps</span></span></span><br></pre></td></tr></table></figure>
<h3 id="é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª-RUN-å°±å¯¹äº†å§ï¼Ÿ"><a href="#é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª-RUN-å°±å¯¹äº†å§ï¼Ÿ" class="headerlink" title="é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª RUN å°±å¯¹äº†å§ï¼Ÿ"></a>é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª <code>RUN</code> å°±å¯¹äº†å§ï¼Ÿ</h3><p>ä¸æ˜¯æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆä¸ºä¸€ä¸ª <code>RUN</code>ï¼Œè¦åˆç†åˆ†å±‚ï¼Œä»¥åŠ å¿«æ„å»ºå’Œéƒ¨ç½²ã€‚</p>
<blockquote>
<p>åˆç†åˆ†å±‚å°±æ˜¯å°†å…·æœ‰<strong>ä¸åŒå˜æ›´é¢‘ç¹ç¨‹åº¦</strong>çš„å±‚ï¼Œè¿›è¡Œæ‹†åˆ†ï¼Œè®©ç¨³å®šçš„éƒ¨åˆ†åœ¨åŸºç¡€ï¼Œæ›´å®¹æ˜“å˜æ›´çš„éƒ¨åˆ†åœ¨è¡¨å±‚ï¼Œä½¿å¾—èµ„æºå¯ä»¥é‡å¤åˆ©ç”¨ï¼Œä»¥å¢åŠ æ„å»ºå’Œéƒ¨ç½²çš„é€Ÿåº¦ã€‚</p>
</blockquote>
<p>ä»¥ <a href="https://coding.net/u/twang2218/p/docker-example/git/blob/master/node/Dockerfile" target="_blank" rel="noopener"><code>node.js</code> çš„åº”ç”¨ç¤ºä¾‹é•œåƒ</a>ä¸ºä¾‹ï¼Œå…¶ä¸­çš„å¤åˆ¶åº”ç”¨å’Œå®‰è£…ä¾èµ–çš„éƒ¨åˆ†ï¼Œå¦‚æœéƒ½åˆå¹¶ä¸€èµ·ï¼Œä¼šå†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> . /usr/src/app</span></span><br><span class="line"><span class="bash">RUN npm install</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œåœ¨ <code>node.js</code> åº”ç”¨é•œåƒç¤ºä¾‹ä¸­ï¼Œåˆ™æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></span><br><span class="line"><span class="bash">RUN npm install</span></span><br><span class="line"><span class="bash">COPY . /usr/src/app</span></span><br></pre></td></tr></table></figure>
<p>ä»å±‚æ•°ä¸Šçœ‹ï¼Œç¡®å®å¤šäº†ä¸€å±‚ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸‰è¡Œåˆ†å¼€æ˜¯æ•…æ„è¿™æ ·åšçš„ï¼Œå…¶ç›®çš„å°±æ˜¯åˆç†åˆ†å±‚ï¼Œå……åˆ†åˆ©ç”¨ Docker åˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µï¼Œä»¥å¢åŠ æ„å»ºã€éƒ¨ç½²çš„æ•ˆç‡ã€‚</p>
<p>åœ¨ <code>docker build</code> çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸå±‚ä¹‹å‰æ„å»ºè¿‡ï¼Œè€Œä¸”è¯¥å±‚æœªå‘ç”Ÿæ”¹å˜çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆ <code>docker</code> å°±ä¼š<strong>ç›´æ¥ä½¿ç”¨ç¼“å­˜</strong>ï¼Œä¸ä¼šé‡å¤æ„å»ºã€‚å› æ­¤ï¼Œåˆç†åˆ†å±‚ï¼Œå……åˆ†åˆ©ç”¨ç¼“å­˜ï¼Œä¼šæ˜¾è‘—åŠ é€Ÿæ„å»ºé€Ÿåº¦ã€‚</p>
<p>ç¬¬ä¸€è¡Œçš„ç›®çš„æ˜¯å°† <code>package.json</code> å¤åˆ¶åˆ°åº”ç”¨ç›®å½•ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº”ç”¨ä»£ç ç›®å½•ã€‚è¿™æ ·åªæœ‰ <code>pakcage.json</code> å‘ç”Ÿæ”¹å˜åï¼Œæ‰ä¼šè§¦å‘ç¬¬äºŒè¡Œ <code>RUN npm install</code>ã€‚è€Œåªè¦ <code>package.json</code> æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆåº”ç”¨çš„ä»£ç æ”¹å˜å°±ä¸ä¼šå¼•å‘ <code>npm install</code>ï¼Œåªä¼šå¼•å‘ç¬¬ä¸‰è¡Œçš„ <code>COPY . /usr/src/app</code>ï¼Œä»è€ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</p>
<p>è€Œå¦‚æœæŒ‰ç…§å‰é¢æ‰€æåˆ°çš„ï¼Œåˆå¹¶ä¸ºä¸¤å±‚ï¼Œé‚£ä¹ˆä»»ä½•ä»£ç æ”¹å˜ï¼Œéƒ½ä¼šè§¦å‘ <code>RUN npm install</code>ï¼Œä»è€Œæµªè´¹å¤§é‡çš„å¸¦å®½å’Œæ—¶é—´ã€‚</p>
<p>åˆç†åˆ†å±‚é™¤äº†å¯ä»¥åŠ å¿«æ„å»ºå¤–ï¼Œè¿˜å¯ä»¥åŠ å¿«éƒ¨ç½²ï¼Œè¦çŸ¥é“ï¼Œ<code>docker pull</code> çš„æ—¶å€™ï¼Œæ˜¯åˆ†å±‚ä¸‹è½½çš„ï¼Œå¹¶ä¸”å·²å­˜åœ¨çš„å±‚å°±<strong>ä¸ä¼šé‡å¤ä¸‹è½½</strong>ã€‚</p>
<p>æ¯”å¦‚ï¼Œè¿™é‡Œçš„ <code>RUN npm install</code> è¿™ä¸€å±‚ï¼Œå¾€å¾€ä¼šå‡ ç™¾ MB ç”šè‡³ä¸Š GBã€‚è€Œåœ¨ <code>package.json</code> æœªå‘ç”Ÿå˜æ›´çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆåªæœ‰ <code>COPY . /usr/src/app</code> è¿™ä¸€å±‚ä¼šè¢«é‡æ–°æ„å»ºï¼Œå¹¶ä¸”ä¹Ÿåªæœ‰è¿™ä¸€å±‚ä¼šåœ¨å„ä¸ªèŠ‚ç‚¹ <code>docker pull</code> çš„è¿‡ç¨‹ä¸­é‡æ–°ä¸‹è½½ï¼Œå¾€å¾€è¿™ä¸€å±‚çš„ä»£ç é‡åªæœ‰å‡ å MBï¼Œç”šè‡³æ›´å°ã€‚è¿™å¯¹äºå¤§è§„æ¨¡çš„å¹¶è¡Œéƒ¨ç½²ä¸­ï¼Œæ‰€èŠ‚çº¦çš„ä¸œè¥¿å‘æµé‡æ˜¯éå¸¸æ˜¾è‘—çš„ã€‚ç‰¹åˆ«æ˜¯æ•æ·å¼€å‘ç¯å¢ƒä¸­ï¼Œä»£ç å˜æ›´çš„é¢‘ç¹åº¦è¦æ¯”ä¾èµ–å˜æ›´çš„é¢‘ç¹åº¦é«˜å¾ˆå¤šï¼Œæ¯æ¬¡é‡å¤ä¸‹è½½ä¾èµ–ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„æµé‡å’Œæ—¶é—´ä¸Šçš„æµªè´¹ã€‚</p>
<h3 id="context-åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ"><a href="#context-åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ" class="headerlink" title="context åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ"></a><code>context</code> åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ</h3><p><code>context</code>ï¼Œ<strong>ä¸Šä¸‹æ–‡</strong>ï¼Œæ˜¯ <code>docker build</code> ä¸­å¾ˆé‡è¦çš„ä¸€ä¸ªæ¦‚å¿µã€‚æ„å»ºé•œåƒå¿…é¡»æŒ‡å®š <code>context</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t xxx &lt;contextè·¯å¾„&gt;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€… <code>docker-compose.yml</code> ä¸­çš„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app:</span></span><br><span class="line"><span class="attr">    build:</span></span><br><span class="line"><span class="attr">        context:</span> <span class="string">&lt;contextè·¯å¾„&gt;</span></span><br><span class="line"><span class="attr">        dockerfile:</span> <span class="string">dockerfile</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œéƒ½éœ€è¦æŒ‡å®š <code>context</code>ã€‚</p>
<p><code>context</code> æ˜¯å·¥ä½œç›®å½•ï¼Œä½†ä¸è¦å’Œæ„å»ºé•œåƒçš„<code>Dockerfile</code> ä¸­çš„ <code>WORKDIR</code> å¼„æ··ï¼Œ<code>context</code> æ˜¯ <code>docker build</code> å‘½ä»¤çš„å·¥ä½œç›®å½•ã€‚</p>
<p><code>docker build</code> å‘½ä»¤å®é™…ä¸Šæ˜¯å®¢æˆ·ç«¯ï¼ŒçœŸæ­£æ„å»ºé•œåƒå¹¶éç”±è¯¥å‘½ä»¤ç›´æ¥å®Œæˆã€‚<code>docker build</code> å‘½ä»¤å°† <code>context</code> çš„ç›®å½•ä¸Šä¼ ç»™ <code>Docker</code> å¼•æ“ï¼Œç”±å®ƒè´Ÿè´£åˆ¶ä½œé•œåƒã€‚</p>
<p>åœ¨ Dockerfile ä¸­å¦‚æœå†™ <code>COPY ./package.json /app/</code> è¿™ç§å‘½ä»¤ï¼Œå®é™…çš„æ„æ€å¹¶ä¸æ˜¯æŒ‡æ‰§è¡Œ <code>docker build</code> æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œä¹Ÿä¸æ˜¯æŒ‡ <code>Dockerfile</code> æ‰€åœ¨ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œè€Œæ˜¯æŒ‡ <code>context</code> ç›®å½•ä¸‹çš„ <code>package.json</code>ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰äººå‘ç° <code>COPY ../package.json /app</code> æˆ–è€… <code>COPY /opt/xxxx /app</code> æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºå®ƒä»¬éƒ½åœ¨ <code>context</code> ä¹‹å¤–ï¼Œå¦‚æœçœŸæ­£éœ€è¦ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ° <code>context</code> ç›®å½•ä¸‹å†æ“ä½œã€‚</p>
<p>è¯è¯´ï¼Œæœ‰ä¸€äº›ç½‘æ–‡ç”šè‡³æç¬‘çš„è¯´è¦æŠŠ <code>Dockerfile</code> æ”¾åˆ°ç£ç›˜æ ¹ç›®å½•ï¼Œæ‰èƒ½æ„å»ºå¦‚ä½•å¦‚ä½•ã€‚è¿™éƒ½æ˜¯å¯¹ <code>context</code> å®Œå…¨ä¸äº†è§£çš„è¡¨ç°ã€‚æƒ³è±¡ä¸€ä¸‹æŠŠæ•´ä¸ªç£ç›˜<strong>å‡ åä¸ª GB</strong>å½“åšä¸Šä¸‹æ–‡å‘é€ç»™ <code>dockerd</code> å¼•æ“çš„æƒ…å†µï¼ŒğŸ˜±â€¦â€¦</p>
<p><code>docker build -t xxx .</code> ä¸­çš„è¿™ä¸ª<code>.</code>ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æŒ‡å®š <code>Context</code> çš„ç›®å½•ï¼Œè€Œå¹¶éæ˜¯æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨ç›®å½•ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š <code>Dockerfile</code> çš„è¯ï¼Œä¼šå°† <code>Context</code> ä¸‹çš„åä¸º <code>Dockerfile</code> çš„æ–‡ä»¶ä½œä¸º <code>Dockerfile</code>ã€‚æ‰€ä»¥å¾ˆå¤šäººä¼šæ··æ·†ï¼Œè®¤ä¸ºè¿™ä¸ª <code>.</code> æ˜¯åœ¨è¯´ <code>Dockerfile</code> çš„ä½ç½®ï¼Œå…¶å®ä¸ç„¶ã€‚</p>
<p>ä¸€èˆ¬é¡¹ç›®ä¸­ï¼Œ<code>Dockerfile</code> å¯èƒ½è¢«æ”¾ç½®äºä¸¤ä¸ªä½ç½®ã€‚</p>
<ul>
<li>ä¸€ä¸ªå¯èƒ½æ˜¯æ”¾ç½®äºé¡¹ç›®é¡¶çº§ç›®å½•ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯åœ¨é¡¶çº§ç›®å½•æ„å»ºæ—¶ï¼Œé¡¹ç›®æ‰€æœ‰å†…å®¹éƒ½åœ¨ä¸Šä¸‹æ–‡å†…ï¼Œæ–¹ä¾¿æ„å»ºï¼›</li>
<li>å¦ä¸€ä¸ªåšæ³•æ˜¯ï¼Œå°†æ‰€æœ‰ Docker ç›¸å…³çš„å†…å®¹é›†ä¸­äºæŸä¸ªç›®å½•ï¼Œæ¯”å¦‚ <code>docker</code> ç›®å½•ï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰ä¸åŒåˆ†æ”¯çš„ <code>Dockerfile</code>ï¼Œä»¥åŠ <code>docker-compose.yml</code> ç±»çš„æ–‡ä»¶ã€entrypoint çš„è„šæœ¬ç­‰ç­‰ã€‚è¿™ç§æƒ…å†µçš„ä¸Šä¸‹æ–‡æ‰€åœ¨ç›®å½•ä¸å†æ˜¯ <code>Dockerfile</code> æ‰€åœ¨ç›®å½•äº†ï¼Œå› æ­¤éœ€è¦æ³¨æ„æŒ‡å®šä¸Šä¸‹æ–‡çš„ä½ç½®ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œé¡¹ç›®ä¸­å¯èƒ½ä¼šåŒ…å«ä¸€äº›æ„å»ºä¸éœ€è¦çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸åº”è¯¥è¢«å‘é€ç»™ <code>dockerd</code> å¼•æ“ï¼Œä½†æ˜¯å®ƒä»¬å¤„äºä¸Šä¸‹æ–‡ç›®å½•ä¸‹ï¼Œè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>.dockerignore</code> æ–‡ä»¶æ¥è¿‡æ»¤ä¸å¿…è¦çš„å†…å®¹ã€‚<code>.dockerignore</code> æ–‡ä»¶åº”è¯¥æ”¾ç½®äºä¸Šä¸‹æ–‡é¡¶çº§ç›®å½•ä¸‹ï¼Œå†…å®¹æ ¼å¼å’Œ <code>.gitignore</code> ä¸€æ ·ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp</span><br><span class="line">db</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±è¿‡æ»¤äº† <code>tmp</code> å’Œ <code>db</code> ç›®å½•ï¼Œå®ƒä»¬ä¸ä¼šè¢«ä½œä¸ºä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†å‘ç»™ <code>dockerd</code> å¼•æ“ã€‚</p>
<blockquote>
<p>å¦‚æœä½ å‘ç°ä½ çš„ <code>docker build</code> éœ€è¦å‘é€åºå¤§çš„ Context çš„æ—¶å€™ï¼Œå°±éœ€è¦æ¥æ£€æŸ¥æ˜¯ä¸æ˜¯ <code>.dockerignore</code> å¿˜äº†æ’°å†™ï¼Œæˆ–è€…å¿˜äº†è¿‡æ»¤æŸäº›ä¸œè¥¿äº†ã€‚</p>
</blockquote>
<h3 id="ENTRYPOINT-å’Œ-CMD-åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#ENTRYPOINT-å’Œ-CMD-åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="ENTRYPOINT å’Œ CMD åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a><code>ENTRYPOINT</code> å’Œ <code>CMD</code> åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3><p><code>Dockerfile</code> çš„ç›®çš„æ˜¯åˆ¶ä½œé•œåƒï¼Œæ¢å¥è¯è¯´ï¼Œå®é™…ä¸Šæ˜¯å‡†å¤‡çš„æ˜¯ä¸»è¿›ç¨‹è¿è¡Œç¯å¢ƒã€‚é‚£ä¹ˆå‡†å¤‡å¥½åï¼Œéœ€è¦æ‰§è¡Œä¸€ä¸ªç¨‹åºæ‰å¯ä»¥å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œè€Œå¯åŠ¨çš„åŠæ³•å°±æ˜¯è°ƒç”¨ <code>ENTRYPOINT</code>ï¼Œå¹¶ä¸”æŠŠ <code>CMD</code> ä½œä¸ºå‚æ•°ä¼ è¿›å»è¿è¡Œã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢çš„æ¦‚å¿µï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT <span class="string">"CMD"</span></span><br></pre></td></tr></table></figure>
<p>å‡è®¾æœ‰ä¸ª <code>myubuntu</code> é•œåƒ <code>ENTRYPOINT</code> æ˜¯ <code>sh -c</code>ï¼Œè€Œæˆ‘ä»¬ <code>docker run -it myubuntu uname -a</code>ã€‚é‚£ä¹ˆ <code>uname -a</code> å°±æ˜¯è¿è¡Œæ—¶æŒ‡å®šçš„ <code>CMD</code>ï¼Œé‚£ä¹ˆ Docker å®é™…è¿è¡Œçš„å°±æ˜¯ç»“åˆèµ·æ¥çš„ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c <span class="string">"uname -a"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœæ²¡æœ‰æŒ‡å®š <code>ENTRYPOINT</code>ï¼Œé‚£ä¹ˆå°±åªæ‰§è¡Œ <code>CMD</code>ï¼›</li>
<li>å¦‚æœæŒ‡å®šäº† <code>ENTRYPOINT</code> è€Œæ²¡æœ‰æŒ‡å®š <code>CMD</code>ï¼Œè‡ªç„¶æ‰§è¡Œ <code>ENTRYPOINT</code>;</li>
<li>å¦‚æœ <code>ENTRYPOINT</code> å’Œ <code>CMD</code> éƒ½æŒ‡å®šäº†ï¼Œé‚£ä¹ˆå°±å¦‚åŒä¸Šé¢æ‰€è¿°ï¼Œæ‰§è¡Œ <code>ENTRYPOINT &quot;CMD&quot;</code>ï¼›</li>
<li>å¦‚æœæ²¡æœ‰æŒ‡å®š <code>ENTRYPOINT</code>ï¼Œè€Œ <code>CMD</code> ç”¨çš„æ˜¯ä¸Šè¿°é‚£ç§ shell å‘½ä»¤çš„å½¢å¼ï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨ <code>sh -c</code> ä½œä¸º <code>ENTRYPOINT</code>ã€‚</li>
</ul>
<p>æ³¨æ„æœ€åä¸€ç‚¹çš„åŒºåˆ«ï¼Œè¿™ä¸ªåŒºåˆ«å¯¼è‡´äº†åŒæ ·çš„å‘½ä»¤æ”¾åˆ° <code>CMD</code> å’Œ <code>ENTRYPOINT</code> ä¸‹æ•ˆæœä¸åŒï¼Œå› æ­¤æœ‰å¯èƒ½æ”¾åœ¨ <code>ENTRYPOINT</code> ä¸‹çš„åŒæ ·çš„å‘½ä»¤ï¼Œç”±äºéœ€è¦ <code>tty</code> è€Œè¿è¡Œæ—¶å¿˜è®°äº†ç»™ï¼ˆæ¯”å¦‚å¿˜è®°äº†<code>docker-compose.yml</code> çš„ <code>tty:true</code>ï¼‰å¯¼è‡´è¿è¡Œå¤±è´¥ã€‚</p>
<p>è¿™ç§ç”¨æ³•å¯ä»¥å¾ˆçµæ´»ï¼Œæ¯”å¦‚æˆ‘ä»¬åšä¸ª <code>git</code> é•œåƒï¼Œå¯ä»¥æŠŠ <code>git</code> å‘½ä»¤æŒ‡å®šä¸º <code>ENTRYPOINT</code>ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ <code>docker run</code> çš„æ—¶å€™ï¼Œç›´æ¥è·Ÿå­å‘½ä»¤å³å¯ã€‚æ¯”å¦‚ <code>docker run git log</code> å°±æ˜¯æ˜¾ç¤ºæ—¥å¿—ã€‚</p>
<h3 id="æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„-Dockerfile-ï¼Ÿ"><a href="#æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„-Dockerfile-ï¼Ÿ" class="headerlink" title="æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„ Dockerfile ï¼Ÿ"></a>æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„ <code>Dockerfile</code> ï¼Ÿ</h3><ul>
<li>ç›´æ¥å» Docker Hub ä¸Šçœ‹ï¼šå¤§å¤šæ•° Docker Hub ä¸Šçš„é•œåƒéƒ½ä¼šæœ‰ <code>Dockerfile</code>ï¼Œç›´æ¥åœ¨ Docker Hub çš„é•œåƒé¡µé¢å°±å¯ä»¥çœ‹åˆ° <code>Dockerfile</code> çš„é“¾æ¥ï¼›</li>
<li>å¦‚æœæ˜¯è‡ªå·±å…¬å¸åšçš„ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯æ‰“ä¸ªç”µè¯ã€å‘ä¸ªæ¶ˆæ¯é—®ä¸€ä¸‹ã€‚åˆ«çœ‹è¿™ä¸ªè¯´æ³•çœ‹èµ·æ¥å¾ˆå‚»ï¼Œä¸å°‘äººéƒ½å®å¯è‡ªå·±ç¢ç£¨ä¹Ÿä¸å»é—®ï¼›</li>
<li>å¦‚æœæ²¡æœ‰ <code>Dockerfile</code>ï¼Œä¸€èˆ¬è¿™ç±»é•œåƒå°±ä¸åº”è¯¥è€ƒè™‘ä½¿ç”¨äº†ï¼Œè¿™ç±»é»‘ç®±ä¼¼çš„é•œåƒå¾ˆå®¹æœ‰æœ‰é—®é¢˜ã€‚å¦‚æœæ˜¯ä»€ä¹ˆç‰¹æ®ŠåŸå› ï¼Œé‚£ç»§ç»­å¾€ä¸‹çœ‹ï¼›</li>
<li><code>docker history</code> å¯ä»¥çœ‹åˆ°é•œåƒæ¯ä¸€å±‚çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‘½ä»¤ï¼Œå½“ç„¶é»‘ç®±é•œåƒçš„ <code>commit</code> çœ‹ä¸è§æ“ä½œï¼›</li>
<li><code>docker inspect</code> å¯ä»¥åˆ†æé•œåƒå¾ˆå¤šç»†èŠ‚ã€‚</li>
<li>ç›´æ¥è¿è¡Œé•œåƒï¼Œè¿›å…¥<code>shell</code>ï¼Œç„¶åæ ¹æ®ä¸Šé¢çš„åˆ†æç»“æœå»è¿›ä¸€æ­¥åˆ†ææ—¥å¿—ã€æ–‡ä»¶å†…å®¹åŠå˜åŒ–ã€‚</li>
<li>ç»è¿‡åˆ†æåï¼Œè‡ªå·±å†™ <code>Dockerfile</code> è¿˜åŸæ“ä½œã€‚</li>
</ul>
<h3 id="åœ¨ä½ çš„-LNMP-çš„ä¾‹å­ä¸­ï¼ŒPHP-çš„-Dockerfile-é‡Œé¢çš„-â€œæ„å»ºä¾èµ–â€-å’Œ-â€œè¿è¡Œä¾èµ–â€-éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#åœ¨ä½ çš„-LNMP-çš„ä¾‹å­ä¸­ï¼ŒPHP-çš„-Dockerfile-é‡Œé¢çš„-â€œæ„å»ºä¾èµ–â€-å’Œ-â€œè¿è¡Œä¾èµ–â€-éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="åœ¨ä½ çš„ LNMP çš„ä¾‹å­ä¸­ï¼ŒPHP çš„ Dockerfile é‡Œé¢çš„ â€œæ„å»ºä¾èµ–â€ å’Œ â€œè¿è¡Œä¾èµ–â€ éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>åœ¨ä½ çš„ LNMP çš„ä¾‹å­ä¸­ï¼ŒPHP çš„ <code>Dockerfile</code> é‡Œé¢çš„ â€œæ„å»ºä¾èµ–â€ å’Œ â€œè¿è¡Œä¾èµ–â€ éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h3><p>è¿™é‡Œæ‰€æåˆ°çš„æ˜¯æˆ‘çš„é‚£ä¸ª LNMP ä¾‹å­çš„ <code>php</code> æœåŠ¡çš„ <code>Dockerfile</code>ï¼š<a href="https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git/blob/master/php/Dockerfile</a></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7</span>-fpm</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash"><span class="comment"># "æ„å»ºä¾èµ–"</span></span></span><br><span class="line"><span class="bash">    &amp;&amp; buildDeps=<span class="string">" \</span></span></span><br><span class="line"><span class="bash">        build-essential \</span></span><br><span class="line"><span class="bash">        php5-dev \</span></span><br><span class="line"><span class="bash">        libfreetype6-dev \</span></span><br><span class="line"><span class="bash">        libjpeg62-turbo-dev \</span></span><br><span class="line"><span class="bash">        libmcrypt-dev \</span></span><br><span class="line"><span class="bash">        libpng12-dev \</span></span><br><span class="line"><span class="bash">    <span class="string">" \</span></span></span><br><span class="line"><span class="bash"><span class="comment"># "è¿è¡Œä¾èµ–"</span></span></span><br><span class="line"><span class="bash">    &amp;&amp; runtimeDeps=<span class="string">" \</span></span></span><br><span class="line"><span class="bash">        libfreetype6 \</span></span><br><span class="line"><span class="bash">        libjpeg62-turbo \</span></span><br><span class="line"><span class="bash">        libmcrypt4 \</span></span><br><span class="line"><span class="bash">        libpng12-0 \</span></span><br><span class="line"><span class="bash">    <span class="string">" \</span></span></span><br><span class="line"><span class="bash"><span class="comment"># "å®‰è£… php ä»¥åŠç¼–è¯‘æ„å»ºç»„ä»¶æ‰€éœ€åŒ…"</span></span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install -y <span class="variable">$&#123;runtimeDeps&#125;</span> <span class="variable">$&#123;buildDeps&#125;</span> --no-install-recommends \</span></span><br><span class="line"><span class="bash"><span class="comment"># "ç¼–è¯‘å®‰è£… php ç»„ä»¶"</span></span></span><br><span class="line"><span class="bash">    &amp;&amp; docker-php-ext-install iconv mcrypt mysqli pdo pdo_mysql zip \</span></span><br><span class="line"><span class="bash">    &amp;&amp; docker-php-ext-configure gd \</span></span><br><span class="line"><span class="bash">        --with-freetype-dir=/usr/include/ \</span></span><br><span class="line"><span class="bash">        --with-jpeg-dir=/usr/include/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; docker-php-ext-install gd \</span></span><br><span class="line"><span class="bash"><span class="comment"># "æ¸…ç†"</span></span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove \</span></span><br><span class="line"><span class="bash">        -o APT::AutoRemove::RecommendsImportant=<span class="literal">false</span> \</span></span><br><span class="line"><span class="bash">        -o APT::AutoRemove::SuggestsImportant=<span class="literal">false</span> \</span></span><br><span class="line"><span class="bash">        <span class="variable">$buildDeps</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/cache/apt/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯é’ˆå¯¹ <code>php</code> é•œåƒè¿›è¡Œå®šåˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>php:7-fpm</code> ä¸­æ²¡æœ‰å®‰è£…æ‰€éœ€çš„ <code>mysqli</code>, <code>pdo_mysql</code>, <code>gd</code> ç­‰ç»„ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å®‰è£…ï¼Œè€Œä¸”ï¼Œéƒ¨åˆ†ç»„ä»¶è¿˜éœ€è¦ç¼–è¯‘ã€‚</p>
<p>å› æ­¤ï¼Œè¿™é‡Œæ¶‰åŠäº†ä¸¤ç±»ä¾èµ–åº“/å·¥å…·ï¼Œä¸€ç±»æ˜¯å®‰è£…ã€ç¼–è¯‘é˜¶æ®µæ‰€éœ€è¦çš„ä¾èµ–ï¼›å¦ä¸€ç±»æ˜¯è¿è¡Œæ—¶æ‰€éœ€çš„ä¾èµ–ã€‚è¦è®°ä½ <code>Dockerfile</code> çš„æœ€ä½³å®è·µä¸­è¦æ±‚æœ€ç»ˆé•œåƒåªåº”è¯¥ä¿ç•™æœ€å°çš„æ‰€éœ€ä¾èµ–ï¼Œå› æ­¤å®‰è£…æ„å»ºçš„ä¾èµ–åº”è¯¥åœ¨å®‰è£…ç»“æŸåæ¸…é™¤ï¼Œè¿™ä¸€å±‚åªä¿ç•™çœŸæ­£éœ€è¦çš„è¿è¡Œæ—¶ä¾èµ–ã€‚</p>
<p>å› æ­¤ï¼Œéµå¾ªæœ€ä½³å®è·µçš„è¦æ±‚ï¼Œè¿™é‡ŒåŒºåˆ†äº† <code>buildDeps</code> å’Œ <code>runtimeDeps</code> åï¼Œå¯ä»¥åœ¨å®‰è£…ç»“æŸåï¼Œå¸è½½ã€æ¸…ç† <code>buildDeps</code> çš„ä¾èµ–ã€‚è¿™æ ·ç¡®ä¿æ²¡æœ‰æ— å…³çš„ä¸œè¥¿è¿˜åœ¨è¯¥å±‚ä¸­ã€‚</p>
<h3 id="åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ"><a href="#åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ" class="headerlink" title="åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ"></a>åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ</h3><p>ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ã€‚</p>
<p>å¦‚æœä»£ç å˜åŠ¨éå¸¸é¢‘ç¹ï¼Œæ¯”å¦‚å¼€å‘é˜¶æ®µï¼Œä»£ç å‡ ä¹æ¯å‡ åˆ†é’Ÿå°±éœ€è¦å˜åŠ¨è°ƒè¯•ï¼Œè¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ <code>--volume</code> æŒ‚è½½å®¿ä¸»ç›®å½•çš„åŠæ³•ã€‚è¿™æ ·ä¸ç”¨æ¯æ¬¡æ„å»ºæ–°é•œåƒï¼Œç›´æ¥å†æ¬¡è¿è¡Œå°±å¯ä»¥åŠ è½½æœ€æ–°ä»£ç ï¼Œç”šè‡³æœ‰äº›å·¥å…·å¯ä»¥è§‚å¯Ÿæ–‡ä»¶å˜åŒ–ä»è€ŒåŠ¨æ€åŠ è½½ï¼Œè¿™æ ·å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<p>å¦‚æœä»£ç æ²¡æœ‰é‚£ä¹ˆé¢‘ç¹å˜åŠ¨ï¼Œæ¯”å¦‚å‘å¸ƒé˜¶æ®µï¼Œè¿™ç§æƒ…å†µï¼Œåº”è¯¥å°†æ„å»ºå¥½çš„åº”ç”¨æ”¾å…¥é•œåƒã€‚ä¸€èˆ¬æ¥è¯´æ˜¯ä½¿ç”¨ CI/CD å·¥å…·ï¼Œå¦‚ <code>Jenkins</code>, <code>Drone.io</code>, <code>Gitlab CI</code> ç­‰ï¼Œè¿›è¡Œæ„å»ºã€æµ‹è¯•ã€åˆ¶ä½œé•œåƒã€å‘å¸ƒé•œåƒã€ä»¥åŠåˆ†æ­¥å‘å¸ƒä¸Šçº¿ã€‚</p>
<p>å¯¹äºé…ç½®æ–‡ä»¶ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå¦‚æœæ˜¯é¢‘ç¹å˜æ›´çš„é…ç½®ï¼Œå¯ä»¥æŒ‚è½½å®¿ä¸»ï¼Œæˆ–è€…åŠ¨æ€é…ç½®æ–‡ä»¶å¯ä»¥ä½¿ç”¨å·ã€‚ä½†æ˜¯å¯¹äºå¹¶éé¢‘ç¹å˜æ›´çš„é…ç½®æ–‡ä»¶ï¼Œåº”è¯¥å°†å…¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œèµ° CI/CD æµç¨‹è¿›è¡Œéƒ¨ç½²ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç»‘å®šå®¿ä¸»ç›®å½•è™½ç„¶æ–¹ä¾¿ï¼Œä½†æ˜¯ä¸åˆ©äºé›†ç¾¤éƒ¨ç½²ï¼Œå› ä¸ºé›†ç¾¤éƒ¨ç½²å‰è¿˜éœ€è¦ç¡®ä¿é›†ç¾¤å„ä¸ªèŠ‚ç‚¹åŒæ­¥å­˜åœ¨æ‰€æŒ‚è½½çš„ç›®å½•åŠå…¶å†…å®¹ã€‚å› æ­¤é›†ç¾¤éƒ¨ç½²æ›´å€¾å‘äºå°†åº”ç”¨æ‰“å…¥é•œåƒï¼Œæ–¹ä¾¿éƒ¨ç½²ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆåœ¨-Dockerfile-ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥-sqlã€service-xxx-startï¼‰ä¸ç®¡ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåœ¨-Dockerfile-ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥-sqlã€service-xxx-startï¼‰ä¸ç®¡ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨ Dockerfile ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥ .sqlã€service xxx startï¼‰ä¸ç®¡ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåœ¨ <code>Dockerfile</code> ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥ <code>.sql</code>ã€<code>service xxx start</code>ï¼‰ä¸ç®¡ç”¨ï¼Ÿ</h3><p>è¿™æ˜¯å…¸å‹çš„å¯¹ <code>Dockerfile</code> ä»¥åŠé•œåƒã€å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µä¸äº†è§£ã€‚</p>
<blockquote>
<p><code>Dockerfile</code> ä¸æ˜¯ <code>shell</code> è„šæœ¬ï¼Œè€Œæ˜¯å®šåˆ¶ <code>rootfs</code> çš„è„šæœ¬ã€‚å®ƒå¹¶ä¸æ˜¯åœ¨è¿è¡Œæ—¶è¿è¡Œçš„ï¼Œè€Œæ˜¯åœ¨æ„å»ºæ—¶è¿è¡Œçš„ã€‚</p>
</blockquote>
<p>å¯¼å…¥ <code>.sql</code> æ–‡ä»¶åˆ°æ•°æ®åº“ï¼Œå®é™…ä¸Šä¿®æ”¹çš„æ˜¯æ•°æ®åº“æ•°æ®æ–‡ä»¶ï¼Œè€Œæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å­˜å‚¨äºå·ï¼Œé»˜è®¤ä¸ºåŒ¿åå·ï¼Œå› æ­¤å½“å¯¼å…¥è¡Œä¸ºç»“æŸåï¼Œæ„å»ºè¯¥å±‚çš„å®¹å™¨åœæ­¢è¿è¡Œï¼ŒåŒ¿åå·è¢«æŠ›å¼ƒï¼Œæ‰€æœ‰å¯¼å…¥è¡Œä¸ºéƒ½ä¼šä¸¢å¤±ï¼Œå› æ­¤æ‰€è°“çš„å¯¼å…¥ <code>.sql</code> çš„è¡Œä¸ºåœ¨ <code>Dockerfile</code> é‡Œå®é™…ä¸Šå®Œå…¨æ²¡æœ‰æ„ä¹‰ã€‚</p>
<p>è€Œ <code>service xxxx start</code> ä¹Ÿå®Œå…¨æ²¡æœ‰æ„ä¹‰ï¼Œè¿™æ˜¯å¯åŠ¨åå°æœåŠ¡åœ¨ä¼ ç»Ÿè™šæ‹Ÿæœºä½¿ç”¨çš„å‘½ä»¤ï¼Œè€ŒDockeré•œåƒä¸ºäº†è¾¾åˆ°ç²¾ç®€åœ¨åå°åšäº†å¾ˆå¤šåˆ å‡ï¼Œä¸”ä¸è¯´ Docker ä¸­ä¸ç”¨åå°æœåŠ¡ï¼Œè¿™ç§å¯åŠ¨è¡Œä¸ºå¯¹æ–‡ä»¶ç³»ç»Ÿæ ¹æœ¬æ²¡å½±å“ï¼Œè¿™ä»…ä»…æ˜¯è®©åå°åœ¨æ„å»ºæ‰€ç”¨çš„å®¹å™¨ä¸­è¿è¡Œä¸€ä¸‹ï¼Œå®Œå…¨æ²¡æœ‰æ„ä¹‰ã€‚æœ€åè¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œæ˜¯å¦ä¸€ä¸ªè¿›ç¨‹äº†ï¼Œè¯¥æ²¡å¯åŠ¨çš„ä¸œè¥¿è¿˜æ˜¯ä¸ä¼šå¯åŠ¨ã€‚</p>
<p>ä½†æ˜¯ä¸è¦å› æ­¤å°±ç›²ç›®çš„å¾—å‡º <code>Dockerfile</code> æ— æ³•åˆå§‹åŒ–æ•°æ®åº“çš„ç»“è®ºã€‚æ‰€æœ‰å®˜æ–¹é•œåƒéƒ½è€ƒè™‘åˆ°äº†å®šåˆ¶çš„é—®é¢˜ï¼Œå»çœ‹ç‰¹å®šå®˜æ–¹é•œåƒçš„æ–‡æ¡£ï¼ŒåŸºæœ¬éƒ½ä¼šçœ‹åˆ°å®šåˆ¶ã€åˆå§‹åŒ–çš„æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚å®˜æ–¹ <code>mysql</code> é•œåƒä¸­ï¼Œå¯ä»¥æŠŠåˆå§‹åŒ–çš„ <code>.sql</code> è„šæœ¬æ–‡ä»¶åœ¨ <code>Dockerfile</code> ä¸­ <code>COPY</code> è‡³ <code>/docker-entrypoint-initdb.d/</code> ç›®å½•ä¸­ï¼Œåœ¨å®¹å™¨ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œå¦‚æœæ‰€æŒ‚è½½çš„å·æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå°±ä¼šä¾æ¬¡<a href="https://github.com/docker-library/mysql/blob/4dd33136c4739667a223d39b6f829beb27b235cf/5.7/docker-entrypoint.sh#L151" target="_blank" rel="noopener">æ‰§è¡Œè¯¥ç›®å½•ä¸­çš„æ–‡ä»¶</a>ï¼Œä»è€Œå®Œæˆæ•°æ®åº“åˆå§‹åŒ–ã€å¯¼å…¥ç­‰åŠŸèƒ½ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> mysql:<span class="number">5.7</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> mysql-data-backup.sql /docker-entrypoint-initdb.d/</span></span><br></pre></td></tr></table></figure>
<h3 id="ä¸ºä»€ä¹ˆåŸºäº-Alpine-çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº-Alpine-çš„é•œåƒä¹ˆï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåŸºäº-Alpine-çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº-Alpine-çš„é•œåƒä¹ˆï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåŸºäº Alpine çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº Alpine çš„é•œåƒä¹ˆï¼Ÿ"></a>ä¸ºä»€ä¹ˆåŸºäº Alpine çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº Alpine çš„é•œåƒä¹ˆï¼Ÿ</h3><p><code>Alpine Linux</code> ä½“ç§¯å°æ˜¯å› ä¸ºå®ƒæ‰€ä½¿ç”¨çš„åŸºç¡€å‘½ä»¤æ¥è‡ªç²¾ç®€çš„ <code>busybox</code>ï¼Œå¹¶ä¸”å®ƒä½¿ç”¨çš„æ˜¯ç®€åŒ–å®ç°çš„ <code>musl</code> ä½œä¸ºåº“æ”¯æŒï¼Œè€Œå¹¶éå®Œæ•´çš„ <code>glibc</code>ã€‚<code>musl</code> ä½“ç§¯å°ï¼Œä½†æ˜¯æœ‰å¯èƒ½æœ‰ä¸å…¼å®¹çš„æƒ…å†µï¼Œå› æ­¤ä¸€èˆ¬ä¸ç”¨ <code>Alpine</code> çš„é•œåƒï¼Œé™¤éç©ºé—´å—é™ï¼Œä½“ç§¯å¤§å°å¾ˆå…³é”®æ—¶æ‰ä¼šä½¿ç”¨ã€‚</p>
<p>è¿‡å»å‡ºç°è¿‡å…¼å®¹é—®é¢˜ï¼Œä½†æ˜¯éšç€ <code>Docker</code> çš„ä½¿ç”¨ï¼Œå¯¹ <code>Alpine</code> çš„éœ€æ±‚ä¼šè¶Šæ¥è¶Šå¤šï¼Œæ›´å¤šçš„å…¼å®¹é—®é¢˜ä¼šè¢«å‘ç°ã€ä¿®å¤ï¼Œæ‰€ä»¥ç›¸ä¿¡åœ¨æœªæ¥è¿™åº”è¯¥æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†æ˜¯å¦‚æœç°åœ¨å°±è¦ä½¿ç”¨ï¼Œä¸€å®šè¦è¿›è¡Œé‡å¤çš„æµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰ä¼šå½±å“åˆ°è‡ªå·±çš„ <code>bug</code>ã€‚</p>
<h3 id="å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ"><a href="#å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ" class="headerlink" title="å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ"></a>å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ</h3><p>é•œåƒæ˜¯åˆ†å±‚å­˜å‚¨çš„ï¼Œé•œåƒä¹‹é—´ä¹Ÿå¯ä»¥ä¾èµ–ï¼Œå› æ­¤åˆ©ç”¨ Docker é•œåƒå¾ˆå®¹æ˜“å®ç°é‡å¤çš„éƒ¨åˆ†å¤ç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰æ²¡æœ‰åŠæ³•å¯ä»¥å¯è§†åŒ–çš„çœ‹åˆ°é•œåƒçš„ä¾èµ–å…³ç³»å‘¢ï¼Ÿ</p>
<p>å¾ˆæ—©ä»¥å‰ï¼ŒDocker æœ‰ä¸ª <code>docker images --tree</code> çš„å‘½ä»¤çš„ï¼Œåæ¥éšç€é•œåƒåˆ†å±‚å¹³é¢åŒ–åï¼Œè¿™ä¸ªå‘½ä»¤å°±å–æ¶ˆäº†ã€‚å¹¸è¿çš„æ˜¯ï¼ŒNate Jones å†™äº†ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºå¯è§†åŒ–é•œåƒåˆ†å±‚ä¾èµ–ï¼Œå«åš <strong>dockviz</strong>ï¼š<a href="https://github.com/justone/dockviz" target="_blank" rel="noopener">https://github.com/justone/dockviz</a></p>
<p>å¯¹äº Mac å¹³å°çš„ç”¨æˆ·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨ <code>brew</code> æ¥è¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install dockviz</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå…¶å®ƒå¹³å°çš„ç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥å»<a href="https://github.com/justone/dockviz/releases" target="_blank" rel="noopener">å‘å¸ƒé¡µé¢</a>ä¸‹è½½ã€‚</p>
<p>å®‰è£…å¥½åï¼Œç›´æ¥æ‰§è¡Œ <code>dockviz images --tree</code> å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ dockviz images --tree</span><br><span class="line">â”œâ”€&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">â”‚ â””â”€&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">â”‚   â””â”€&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">â”‚     â””â”€&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">â”‚       â””â”€&lt;missing&gt; Virtual Size: 55.3 MB</span><br><span class="line">â”‚         â””â”€&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">â”‚           â””â”€&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">â”‚             â””â”€&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">â”‚               â””â”€&lt;missing&gt; Virtual Size: 108.3 MB</span><br><span class="line">â”‚                 â””â”€0b5dec81616c Virtual Size: 108.3 MB Tags: nginx:latest</span><br><span class="line">â””â”€&lt;missing&gt; Virtual Size: 100.1 MB</span><br><span class="line">  â””â”€&lt;missing&gt; Virtual Size: 100.1 MB</span><br><span class="line">    â””â”€&lt;missing&gt; Virtual Size: 123.9 MB</span><br><span class="line">      â””â”€&lt;missing&gt; Virtual Size: 131.2 MB</span><br><span class="line">        â”œâ”€&lt;missing&gt; Virtual Size: 272.8 MB</span><br><span class="line">        â”‚ â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚   â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚     â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚       â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚         â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚           â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚             â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚               â””â”€&lt;missing&gt; Virtual Size: 274.2 MB</span><br><span class="line">        â”‚                 â””â”€&lt;missing&gt; Virtual Size: 737.9 MB</span><br><span class="line">        â”‚                   â””â”€4551430cfe80 Virtual Size: 738.3 MB Tags: openjdk:latest</span><br><span class="line">        â””â”€&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">          â””â”€&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">            â””â”€&lt;missing&gt; Virtual Size: 132.4 MB</span><br><span class="line">...</span><br><span class="line">                            â””â”€&lt;missing&gt; Virtual Size: 276.0 MB</span><br><span class="line">                                â””â”€&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                â””â”€&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                    â””â”€&lt;missing&gt; Virtual Size: 292.4 MB</span><br><span class="line">                                    â””â”€72d2be374029 Virtual Size: 292.4 MB Tags: tomcat:latest</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè§‰å¾—æ–‡æœ¬æ ¼å¼å¤ªç¹æ‚ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆ <a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language" target="_blank" rel="noopener">DOT å›¾</a>)ï¼Œä½¿ç”¨å‘½ä»¤ <code>dockviz images -d | dot -Tpng -o image_tree.png</code> å°±å¯ä»¥å°†ä½ çš„é•œåƒä¾èµ–å…³ç³»ç»˜åˆ¶æˆå›¾ï¼ˆ<a href="https://imagebin.ca/v/3ZhFvSPeqAi0" target="_blank" rel="noopener">https://imagebin.ca/v/3ZhFvSPeqAi0</a>ï¼‰ã€‚</p>
<h2 id="æ—¥å¿—é—®é¢˜-2"><a href="#æ—¥å¿—é—®é¢˜-2" class="headerlink" title="æ—¥å¿—é—®é¢˜ (2)"></a>æ—¥å¿—é—®é¢˜ <code>(2)</code></h2><h3 id="Docker-æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ"><a href="#Docker-æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ" class="headerlink" title="Docker æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ"></a>Docker æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ</h3><p>æ—¥å¿—åˆ†ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ <code>Docker å¼•æ“æ—¥å¿—</code>ï¼›å¦ä¸€ç±»æ˜¯ <code>å®¹å™¨æ—¥å¿—</code>ã€‚</p>
<h4 id="Docker-å¼•æ“æ—¥å¿—"><a href="#Docker-å¼•æ“æ—¥å¿—" class="headerlink" title="Docker å¼•æ“æ—¥å¿—"></a>Docker å¼•æ“æ—¥å¿—</h4><p><code>Docker å¼•æ“æ—¥å¿—</code> ä¸€èˆ¬æ˜¯äº¤ç»™äº† <code>Upstart</code>(Ubuntu 14.04) æˆ–è€… <code>systemd</code> (CentOS 7, Ubuntu 16.04)ã€‚å‰è€…ä¸€èˆ¬ä½äº <code>/var/log/upstart/docker.log</code> ä¸‹ï¼Œåè€…ä¸€èˆ¬é€šè¿‡ <code>jounarlctl -u docker</code> æ¥è¯»å–ã€‚ä¸åŒç³»ç»Ÿçš„ä½ç½®éƒ½ä¸ä¸€æ ·ï¼ŒSOä¸Šæœ‰äººæ€»ç»“äº†ä¸€ä»½åˆ—è¡¨ï¼Œæˆ‘ä¿®æ­£äº†ä¸€ä¸‹ï¼Œå¯ä»¥å‚è€ƒï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç³»ç»Ÿ</th>
<th>æ—¥å¿—ä½ç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td> Ubuntu(14.04)</td>
<td><code>/var/log/upstart/docker.log</code></td>
</tr>
<tr>
<td> Ubuntu(16.04)</td>
<td><code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td> CentOS 7/RHEL 7/Fedora</td>
<td><code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td> CoreOS</td>
<td><code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td> OpenSuSE</td>
<td><code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td> OSX</td>
<td><code>~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/log/dâ€Œâ€‹ocker.log</code></td>
</tr>
<tr>
<td> Debian GNU/Linux 7</td>
<td><code>/var/log/daemon.log</code></td>
</tr>
<tr>
<td> Debian GNU/Linux 8</td>
<td><code>journalctl -u docker.service</code></td>
</tr>
<tr>
<td> Boot2Docker</td>
<td><code>/var/log/docker.log</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="å®¹å™¨æ—¥å¿—"><a href="#å®¹å™¨æ—¥å¿—" class="headerlink" title="å®¹å™¨æ—¥å¿—"></a>å®¹å™¨æ—¥å¿—</h4><p><code>å®¹å™¨çš„æ—¥å¿—</code> åˆ™å¯ä»¥é€šè¿‡ <code>docker logs</code> å‘½ä»¤æ¥è®¿é—®ï¼Œè€Œä¸”å¯ä»¥åƒ <code>tail -f</code> ä¸€æ ·ï¼Œä½¿ç”¨ <code>docker logs -f</code> æ¥å®æ—¶æŸ¥çœ‹ã€‚å¦‚æœä½¿ç”¨ Docker Composeï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>docker-compose logs &lt;æœåŠ¡å&gt;</code> æ¥æŸ¥çœ‹ã€‚</p>
<p>å¦‚æœæ·±ç©¶å…¶æ—¥å¿—ä½ç½®ï¼Œæ¯ä¸ªå®¹å™¨çš„æ—¥å¿—é»˜è®¤éƒ½ä¼šä»¥ <code>json-file</code> çš„æ ¼å¼å­˜å‚¨äº <code>/var/lib/docker/containers/&lt;å®¹å™¨id&gt;/&lt;å®¹å™¨id&gt;-json.log</code> ä¸‹ï¼Œä¸è¿‡å¹¶ä¸å»ºè®®å»è¿™é‡Œç›´æ¥è¯»å–å†…å®¹ï¼Œå› ä¸º Docker æä¾›äº†æ›´å®Œå–„åœ°æ—¥å¿—æ”¶é›†æ–¹å¼ - <code>Docker æ—¥å¿—æ”¶é›†é©±åŠ¨</code>ã€‚</p>
<p>å…³äºæ—¥å¿—æ”¶é›†ï¼Œ<code>Docker</code> å†…ç½®äº†å¾ˆå¤šæ—¥å¿—é©±åŠ¨ï¼Œå¯ä»¥é€šè¿‡ç±»ä¼¼äº <code>fluentd</code>, <code>syslog</code> è¿™ç±»æœåŠ¡æ”¶é›†æ—¥å¿—ã€‚æ— è®ºæ˜¯ <code>Docker</code> å¼•æ“ï¼Œè¿˜æ˜¯å®¹å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ—¥å¿—é©±åŠ¨ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ‰“ç®—ç”¨ <code>fluentd</code> æ”¶é›†æŸä¸ªå®¹å™¨æ—¥å¿—ï¼Œå¯ä»¥è¿™æ ·å¯åŠ¨å®¹å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d \</span><br><span class="line">    --<span class="built_in">log</span>-driver=fluentd \</span><br><span class="line">    --<span class="built_in">log</span>-opt fluentd-address=10.2.3.4:24224 \</span><br><span class="line">    --<span class="built_in">log</span>-opt tag=<span class="string">"docker.&#123;&#123;.Name&#125;&#125;"</span> \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>10.2.3.4:24224</code> æ˜¯ <code>fluentd</code> æœåŠ¡åœ°å€ï¼Œå®é™…ç¯å¢ƒä¸­åº”è¯¥æ¢æˆçœŸå®çš„åœ°å€ã€‚</p>
<p>å…·ä½“ä½¿ç”¨ <code>fluentd</code> çš„æ–¹æ³•ï¼Œè¯·å‚è€ƒæˆ‘å†™çš„ä¸€ç»„ <code>fluentd</code> æ—¥å¿—æ”¶é›†çš„ä¾‹å­ï¼š</p>
<p><a href="https://coding.net/u/twang2218/p/docker-example/git/tree/master/fluentd" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-example/git/tree/master/fluentd</a></p>
<h3 id="ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ°-fluentd-åå¦‚ä½•åŒºåˆ†ï¼Ÿ"><a href="#ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ°-fluentd-åå¦‚ä½•åŒºåˆ†ï¼Ÿ" class="headerlink" title="ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ° fluentd åå¦‚ä½•åŒºåˆ†ï¼Ÿ"></a>ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ° <code>fluentd</code> åå¦‚ä½•åŒºåˆ†ï¼Ÿ</h3><p>æœ‰ä¸¤ç§æ¦‚å¿µçš„åŒºåˆ†ï¼Œä¸€ç§æ˜¯åŒºåˆ†å¼€<code>ä¸åŒå®¹å™¨</code>çš„æ—¥å¿—ï¼Œå¦ä¸€ç§æ˜¯åŒºåˆ†å¼€æ¥<code>ä¸åŒæœåŠ¡</code>çš„æ—¥å¿—ã€‚</p>
<p>åŒºåˆ†ä¸åŒå®¹å™¨çš„æ—¥å¿—æ˜¯å¾ˆç›´è§‚çš„æƒ³æ³•ã€‚è¿è¡Œäº†å‡ ä¸ªä¸åŒçš„å®¹å™¨ï¼Œæ—¥å¿—éƒ½é€å‘æ—¥å¿—æ”¶é›†ï¼Œé‚£ä¹ˆæ˜¾ç„¶ä¸å¸Œæœ› <code>nginx</code> å®¹å™¨çš„æ—¥å¿—å’Œ <code>MySQL</code> å®¹å™¨çš„æ—¥å¿—æ··æ‚åœ¨ä¸€èµ·çœ‹ã€‚</p>
<p>ä½†æ˜¯åœ¨ Swarm é›†ç¾¤ç¯å¢ƒä¸­ï¼ŒåŒºåˆ†å®¹å™¨å°±å·²ç»ä¸å†æ˜¯åˆç†çš„åšæ³•äº†ã€‚å› ä¸ºåŒä¸€ä¸ªæœåŠ¡å¯èƒ½æœ‰è®¸å¤šå‰¯æœ¬ï¼Œè€Œåˆæœ‰å¾ˆå¤šä¸ªæœåŠ¡ï¼Œå¦‚æœä¸€ä¸ªä¸ªçš„å®¹å™¨åŒºåˆ†å»åˆ†æï¼Œå¾ˆéš¾çœ‹åˆ°ä¸€ä¸ªæ•´ä½“ä¸ŠæŸä¸ªæœåŠ¡çš„æœåŠ¡çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚è€Œä¸”ï¼Œå®¹å™¨æ˜¯çŸ­ç”Ÿå­˜å‘¨æœŸçš„ï¼Œåœ¨ç»´æŠ¤æœŸé—´å®¹å™¨ç”Ÿå­˜æ­»äº¡æ˜¯å¾ˆå¸¸è§çš„äº‹æƒ…ã€‚å¦‚æœæ˜¯åƒä¼ ç»Ÿè™šæ‹Ÿæœºé‚£æ ·å­ä»¥å®¹å™¨ä¸ºå•å…ƒå»åˆ†ææ—¥å¿—ï¼Œå…¶ç»“æœå¾ˆéš¾å…·æœ‰ä»·å€¼ã€‚å› æ­¤æ›´å¤šçš„æ—¶å€™æ˜¯å¯¹æŸä¸€ä¸ªæœåŠ¡çš„æ—¥å¿—æ•´ä½“åˆ†æï¼Œæ— éœ€åŒºåˆ«æ—¥å¿—å…·ä½“æ¥è‡ªäºå“ªä¸ªå®¹å™¨ï¼Œä¸éœ€è¦å…³å¿ƒå®¹å™¨æ˜¯ä»€ä¹ˆæ—¶é—´äº§ç”Ÿä»¥åŠæ˜¯å¦æ¶ˆäº¡ï¼Œåªéœ€è¦ä»¥æœåŠ¡ä¸ºå•å…ƒå»åŒºåˆ†æ—¥å¿—å³å¯ã€‚</p>
<p>è¿™ä¸¤ç±»çš„åŒºåˆ†æ—¥å¿—çš„åŠæ³•ï¼ŒDocker éƒ½å¯ä»¥åšåˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ <code>fluentd</code> ä¸ºä¾‹è¯´æ˜ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    web:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.11-alpine</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">"3000:80"</span></span><br><span class="line"><span class="attr">        labels:</span></span><br><span class="line"><span class="attr">            section:</span> <span class="string">frontend</span></span><br><span class="line"><span class="attr">            group:</span> <span class="string">alpha</span></span><br><span class="line"><span class="attr">            service:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">            image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">            base_os:</span> <span class="string">alpine</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">fluentd</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                fluentd-address:</span> <span class="string">"localhost:24224"</span></span><br><span class="line"><span class="attr">                tag:</span> <span class="string">"frontend.web.nginx.<span class="template-variable">&#123;&#123;.Name&#125;&#125;</span>"</span></span><br><span class="line"><span class="attr">                labels:</span> <span class="string">"section,group,service,image,base_os"</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬è¿è¡Œäº†ä¸€ä¸ª <code>nginx:alpine</code> çš„å®¹å™¨ï¼ŒæœåŠ¡åä¸º <code>web</code>ã€‚å®¹å™¨çš„æ—¥å¿—ä½¿ç”¨ <code>fluentd</code> è¿›è¡Œæ”¶é›†ï¼Œå¹¶ä¸”é™„ä¸Šæ ‡ç­¾ <code>frontend.web.nginx.&lt;å®¹å™¨å&gt;</code>ã€‚é™¤æ­¤ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ç»„ <code>labels</code>ï¼Œå¹¶ä¸”åœ¨ <code>logging</code> çš„ <code>options</code> ä¸­çš„ <code>labels</code> ä¸­æŒ‡æ˜å¸Œæœ›å“ªäº›æ ‡ç­¾éšæ—¥å¿—è®°å½•ã€‚è¿™äº›ä¿¡æ¯ä¸­å¾ˆå¤šä¸€éƒ¨åˆ†éƒ½ä¼šå‡ºç°åœ¨æ‰€æ”¶é›†çš„æ—¥å¿—é‡Œã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>fluentd</code> æ”¶åˆ°çš„ä¿¡æ¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"frontend.web.nginx.service_web_1"</span>: &#123;</span><br><span class="line">    <span class="attr">"image"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">    <span class="attr">"base_os"</span>: <span class="string">"alpine"</span>,</span><br><span class="line">    <span class="attr">"container_id"</span>: <span class="string">"f7212f7108de033045ddc22858569d0ac50921b043b97a2c8bf83b1b1ee50e34"</span>,</span><br><span class="line">    <span class="attr">"section"</span>: <span class="string">"frontend"</span>,</span><br><span class="line">    <span class="attr">"service"</span>: <span class="string">"web"</span>,</span><br><span class="line">    <span class="attr">"log"</span>: <span class="string">"172.20.0.1 - - [09/Dec/2016:15:02:45 +0000] \"GET / HTTP/1.1\" 200 612 \"-\" \"curl/7.49.1\" \"-\""</span>,</span><br><span class="line">    <span class="attr">"group"</span>: <span class="string">"alpha"</span>,</span><br><span class="line">    <span class="attr">"container_name"</span>: <span class="string">"/service_web_1"</span>,</span><br><span class="line">    <span class="attr">"source"</span>: <span class="string">"stdout"</span>,</span><br><span class="line">    <span class="attr">"remote"</span>: <span class="string">"172.20.0.1"</span>,</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"-"</span>,</span><br><span class="line">    <span class="attr">"user"</span>: <span class="string">"-"</span>,</span><br><span class="line">    <span class="attr">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line">    <span class="attr">"path"</span>: <span class="string">"/"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"200"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="string">"612"</span>,</span><br><span class="line">    <span class="attr">"referer"</span>: <span class="string">"-"</span>,</span><br><span class="line">    <span class="attr">"agent"</span>: <span class="string">"curl/7.49.1"</span>,</span><br><span class="line">    <span class="attr">"forward"</span>: <span class="string">"-"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå»é™¤ <code>nginx</code> æ­£å¸¸çš„è®¿é—®æ—¥å¿—é¡¹ç›®å¤–ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°æœ‰å“ªäº›å…ƒæ•°æ®ä¿¡æ¯å¯ä»¥åˆ©ç”¨äº†ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"frontend.web.nginx.service_web_1"</span>: &#123;</span><br><span class="line">    <span class="attr">"image"</span>: <span class="string">"nginx"</span>,</span><br><span class="line">    <span class="attr">"base_os"</span>: <span class="string">"alpine"</span>,</span><br><span class="line">    <span class="attr">"container_id"</span>: <span class="string">"f7212f7108de033045ddc22858569d0ac50921b043b97a2c8bf83b1b1ee50e34"</span>,</span><br><span class="line">    <span class="attr">"section"</span>: <span class="string">"frontend"</span>,</span><br><span class="line">    <span class="attr">"service"</span>: <span class="string">"web"</span>,</span><br><span class="line">    <span class="attr">"group"</span>: <span class="string">"alpha"</span>,</span><br><span class="line">    <span class="attr">"container_name"</span>: <span class="string">"/service_web_1"</span>,</span><br><span class="line">    <span class="attr">"source"</span>: <span class="string">"stdout"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ <code>logging</code> ä¸‹æ‰€æœ‰æŒ‡å®šçš„ <code>labels</code> éƒ½åœ¨ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥å¯¹æ¯ä¸ªæœåŠ¡è®¾å®šä¸åŒçš„æ ‡ç­¾ï¼Œé€šè¿‡æ ‡ç­¾æ¥åŒºåˆ†æœåŠ¡ã€‚æ¯”å¦‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ <code>web</code> æœåŠ¡æŒ‡å®šäº† <code>service=web</code> çš„æ ‡ç­¾ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥å¯¹æ•°æ®åº“çš„æœåŠ¡è®¾å®šæ ‡ç­¾ä¸º <code>service=mysql</code>ï¼Œè¿™æ ·åœ¨æ±‡æ€»åï¼Œåªéœ€è¦å¯¹ <code>service</code> æ ‡ç­¾åˆ†ç»„è¿‡æ»¤å³å¯ï¼Œåˆ†ç¦»èšåˆä¸åŒæœåŠ¡çš„æ—¥å¿—ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸æ­¢ä¸€ä¸ªæ ‡ç­¾ï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬è®¾ç½®äº†å¤šç»„ä¸åŒé¢—ç²’åº¦çš„æ ‡ç­¾ï¼Œåœ¨åæœŸåˆ†ç»„çš„æ—¶å€™ï¼Œå¯ä»¥å¾ˆçµæ´»çš„è¿›è¡Œç»„åˆï¼Œä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ã€‚</p>
<p>æ­¤å¤–ï¼Œæ³¨æ„ <code>frontend.web.nginx.service_web_1</code>ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¹‹å‰åˆ©ç”¨ <code>--log-opt tag=frontend.web.nginx.&lt;å®¹å™¨å&gt;</code> è¿›è¡Œè®¾å®šçš„ï¼Œå…¶ä¸­ <code>&lt;å®¹å™¨å&gt;</code> æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Go æ¨¡æ¿è¡¨è¾¾å¼ <em>&lbrace;&lbrace;.Name}}</em>ã€‚Go æ¨¡æ¿å¾ˆå¼ºå¤§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå®ç°éå¸¸å¤æ‚çš„æ ‡ç­¾ã€‚åœ¨ <code>fluentd</code> ä¸­ï¼Œ<code>&lt;match&gt;</code> é¡¹å¯ä»¥æ ¹æ®æ ‡ç­¾æ¥è¿›è¡Œç­›é€‰ã€‚</p>
<p>è¿™é‡Œå¯ä»¥å”¯ä¸€è¡¨ç¤ºå®¹å™¨çš„ï¼Œæœ‰å®¹å™¨ ID <code>container_id</code>ï¼Œè€Œå®¹å™¨å <code>container_name</code> ä¹Ÿä»æŸç§ç¨‹åº¦ä¸Šå¯ä»¥ç”¨æ¥åŒºåˆ†ä¸åŒå®¹å™¨ã€‚å› æ­¤è¿›è¡Œå®¹å™¨åŒºåˆ†æ—¥å¿—çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸¤é¡¹ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ª <code>source</code>ï¼Œè¿™è¡¨ç¤ºäº†æ—¥å¿—æ˜¯ä»<code>æ ‡å‡†è¾“å‡º</code>è¿˜æ˜¯<code>æ ‡å‡†é”™è¯¯è¾“å‡º</code>å¾—åˆ°çš„ï¼Œç”±æ­¤å¯ä»¥åŒºåˆ†<code>æ­£å¸¸æ—¥å¿—</code>å’Œ<code>é”™è¯¯æ—¥å¿—</code>ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œé™¤äº†å®¹å™¨è‡ªèº«è¾“å‡ºçš„ä¿¡æ¯å¤–ï¼ŒDocker è¿˜å¯ä»¥ä¸ºæ¯ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—æ·»åŠ å¾ˆå¤šå…ƒæ•°æ®ï¼Œä»¥å¸®åŠ©åæœŸçš„æ—¥å¿—å¤„ç†ä¸­åº”å¯¹ä¸åŒéœ€æ±‚çš„æœç´¢å’Œè¿‡æ»¤ã€‚</p>
<p>åœ¨åæœŸå¤„ç†ä¸­ï¼Œ<code>fluentd</code> ä¸­å¯ä»¥åˆ©ç”¨ <code>&lt;match&gt;</code> æˆ–è€… <code>&lt;filter&gt;</code> æ’ä»¶æ ¹æ® <code>tag</code> æˆ–è€…å…¶å®ƒå…ƒæ•°æ®è¿›è¡Œåˆ†åˆ«å¤„ç†ã€‚è€Œæ—¥å¿—åˆ°äº† ElasticSearch è¿™ç±»ç³»ç»Ÿåï¼Œåˆ™å¯ä»¥ç”¨æ›´ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€è¿›è¡Œè¿‡æ»¤ã€èšåˆã€‚</p>
<h2 id="ä½¿ç”¨é—®é¢˜-11"><a href="#ä½¿ç”¨é—®é¢˜-11" class="headerlink" title="ä½¿ç”¨é—®é¢˜ (11)"></a>ä½¿ç”¨é—®é¢˜ <code>(11)</code></h2><h3 id="ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ"></a>ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ</h3><p>è¿™æ˜¯åˆå­¦ Docker å¸¸å¸¸ç¢°åˆ°çš„é—®é¢˜ï¼Œæ­¤æ—¶è¿˜ä»¥è™šæ‹Ÿæœºæ¥ç†è§£ Dockerï¼Œè®¤ä¸ºå¯åŠ¨ Docker å°±æ˜¯å¯åŠ¨è™šæ‹Ÿæœºï¼Œä¹Ÿæ²¡æœ‰ææ˜ç™½å‰å°å’Œåå°çš„åŒºåˆ«ã€‚</p>
<p>é¦–å…ˆï¼Œç¢°åˆ°è¿™ç±»é—®é¢˜åº”è¯¥æŸ¥æ—¥å¿—å’Œå®¹å™¨ä¸»è¿›ç¨‹é€€å‡ºç ã€‚</p>
<p>æ£€æŸ¥å®¹å™¨æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;å®¹å™¨ID&gt;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å®¹å™¨é€€å‡ºç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                           COMMAND             CREATED             STATUS                      PORTS                                                                  NAMES</span><br><span class="line">cc2aa3f4745f        ubuntu                          <span class="string">"/bin/bash"</span>         23 hours ago        Exited (0) 22 hours ago                                                                            clever_lewin</span><br><span class="line">25510a2cb171        twang2218/gitlab-ce-zh:8.15.3   <span class="string">"/assets/wrapper"</span>   2 days ago          Exited (127) 2 days ago                                                                            determined_mirzakhani</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>STATUS</code> ä¸€æ ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é€€å‡ºç æ˜¯å¤šå°‘ã€‚</p>
<ul>
<li>å¦‚æœçœ‹åˆ°äº† <code>Exited (127)</code> é‚£å¾ˆå¯èƒ½æ˜¯ç”±äºå†…å­˜è¶…æ ‡å¯¼è‡´è§¦å‘ <code>Out Of Memory</code> ç„¶åè¢«å¼ºåˆ¶ç»ˆæ­¢äº†ã€‚</li>
<li>å¦‚æœçœ‹åˆ°äº† <code>Exited (0)</code>ï¼Œè¿™è¯´æ˜å®¹å™¨ä¸»è¿›ç¨‹æ­£å¸¸é€€å‡ºäº†ã€‚</li>
<li>å¦‚æœæ˜¯å…¶ä»–æƒ…å†µï¼Œåº”è¯¥æ£€æŸ¥å®¹å™¨æ—¥å¿—ã€‚</li>
</ul>
<p>åˆå­¦ Docker çš„äººå¸¸å¸¸ä¼šä¸ç†è§£æ—¢ç„¶æ­£å¸¸æ€ä¹ˆä¼šé€€å‡ºçš„æ„æ€ã€‚ä¸å¾—ä¸åœ¨å¼ºè°ƒä¸€éï¼ŒDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨åªæ˜¯è¿›ç¨‹ã€‚å› æ­¤å½“æ‰§è¡Œ <code>docker run</code> çš„æ—¶å€™ï¼Œå®é™…æ‰€åšçš„åªæ˜¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œå¦‚æœè¿›ç¨‹é€€å‡ºäº†ï¼Œé‚£ä¹ˆå®¹å™¨è‡ªç„¶å°±ç»ˆæ­¢äº†ã€‚</p>
<p>é‚£ä¹ˆè¿›ç¨‹ä¸ºä»€ä¹ˆä¼šé€€å‡ºï¼Ÿ</p>
<ul>
<li>å¦‚æœæ˜¯æ‰§è¡Œ <code>service nginx start</code> è¿™ç±»å¯åŠ¨åå°æœåŠ¡ç¨‹åºçš„å‘½ä»¤ï¼Œé‚£è¯´æ˜è¿˜æ˜¯æŠŠ Docker å½“åšè™šæ‹Ÿæœºäº†ã€‚Docker å¯åŠ¨çš„æ˜¯è¿›ç¨‹ï¼Œå› æ­¤æ‰€è°“çš„åå°æœåŠ¡åº”è¯¥æ”¾åˆ°å‰å°ï¼Œæ¯”å¦‚åº”è¯¥ <code>nginx -g &#39;daemon off;&#39;</code> è¿™æ ·ç›´æ¥å‰å°å¯åŠ¨åº”ç”¨æ‰å¯¹ã€‚</li>
<li>å¦‚æœå‘ç° <code>COMMAND</code> ä¸€æ æ˜¯ <code>/bin/bash</code>ï¼Œé‚£è¿˜æ˜¯è¯´æ˜æŠŠ Docker å½“è™šæ‹Ÿæœºäº†ã€‚<code>COMMAND</code> åº”è¯¥æ˜¯åº”ç”¨ç¨‹åºï¼Œè€Œä¸äº¤äº’å¼æ“ä½œç•Œé¢ï¼Œå®¹å™¨ä¸éœ€è¦äº¤äº’å¼æ“ä½œç•Œé¢ã€‚æ­¤å¤–ï¼Œå¦‚æœä½¿ç”¨ <code>/bin/bash</code> å¸Œæœ›èµ·ä¸€ä¸ªäº¤äº’å¼çš„ç•Œé¢ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»æä¾›ç»™å…¶è¾“å…¥å’Œç»ˆç«¯ï¼Œå› æ­¤å¿…é¡»åŠ  <code>-it</code> é€‰é¡¹ï¼Œæ¯”å¦‚ <code>docker run -it ubuntu /bin/bash</code></li>
</ul>
<h3 id="å¦‚ä½•åœ¨-Docker-å®¹å™¨å†…ä½¿ç”¨-docker-å‘½ä»¤-æ¯”å¦‚åœ¨-Jenkins-å®¹å™¨ä¸­-ï¼Ÿ"><a href="#å¦‚ä½•åœ¨-Docker-å®¹å™¨å†…ä½¿ç”¨-docker-å‘½ä»¤-æ¯”å¦‚åœ¨-Jenkins-å®¹å™¨ä¸­-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ Docker  å®¹å™¨å†…ä½¿ç”¨ docker å‘½ä»¤(æ¯”å¦‚åœ¨ Jenkins å®¹å™¨ä¸­)ï¼Ÿ"></a>å¦‚ä½•åœ¨ Docker  å®¹å™¨å†…ä½¿ç”¨ <code>docker</code> å‘½ä»¤(æ¯”å¦‚åœ¨ Jenkins å®¹å™¨ä¸­)ï¼Ÿ</h3><p>é¦–å…ˆï¼Œä¸è¦åœ¨ Docker å®¹å™¨ä¸­å®‰è£…ã€è¿è¡Œ Docker å¼•æ“ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ Docker In Docker (DIND)ï¼Œå‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/" target="_blank" rel="noopener">https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/</a></p>
<p>ä¸ºäº†è®©å®¹å™¨å†…å¯ä»¥æ„å»ºé•œåƒï¼Œåº”è¯¥ä½¿ç”¨ <code>Docker Remote API</code> çš„å®¢æˆ·ç«¯æ¥ç›´æ¥è°ƒç”¨å®¿ä¸»çš„ Docker Engineã€‚å¯ä»¥æ˜¯åŸç”Ÿçš„ Docker CLI ï¼ˆ<code>docker</code> å‘½ä»¤ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯<a href="https://docs.docker.com/engine/reference/api/remote_api_client_libraries/" target="_blank" rel="noopener">å…¶å®ƒè¯­è¨€çš„åº“</a>ã€‚</p>
<h4 id="ä¸º-Jenkins-æ·»åŠ -Docker-å‘½ä»¤è¡Œ"><a href="#ä¸º-Jenkins-æ·»åŠ -Docker-å‘½ä»¤è¡Œ" class="headerlink" title="ä¸º Jenkins æ·»åŠ  Docker å‘½ä»¤è¡Œ"></a>ä¸º Jenkins æ·»åŠ  Docker å‘½ä»¤è¡Œ</h4><p>ä¸‹é¢ä»¥å®šåˆ¶ <code>jenkins</code> é•œåƒä¸ºä¾‹ï¼Œä½¿ç”¨ <code>Dockerfile</code> æ·»åŠ  <code>docker</code> å‘½ä»¤è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶è°ƒæ•´æƒé™ã€‚</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> jenkins:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½å®‰è£…Docker CLI</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -O https://get.docker.com/builds/Linux/x86_64/docker-latest.tgz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; tar zxvf docker-latest.tgz \</span></span><br><span class="line"><span class="bash">    &amp;&amp; cp docker/docker /usr/<span class="built_in">local</span>/bin/ \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf docker docker-latest.tgz</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># å°† `jenkins` ç”¨æˆ·çš„ç»„ ID æ”¹ä¸ºå®¿ä¸» `docker` ç»„çš„ç»„IDï¼Œä»è€Œå…·æœ‰æ‰§è¡Œ `docker` å‘½ä»¤çš„æƒé™ã€‚</span></span></span><br><span class="line"><span class="bash">ARG DOCKER_GID=999</span></span><br><span class="line"><span class="bash">USER jenkins:<span class="variable">$&#123;DOCKER_GID&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä¸‹è½½äº†é™æ€ç¼–è¯‘çš„ <code>docker</code> å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æå–å‘½ä»¤è¡Œå®‰è£…åˆ°ç³»ç»Ÿç›®å½•ä¸‹ã€‚ç„¶åè°ƒæ•´äº† <code>jenkins</code> ç”¨æˆ·çš„ç»„ IDï¼Œè°ƒæ•´ä¸ºå®¿ä¸» <code>docker</code> ç»„IDï¼Œä»è€Œä½¿å…¶å…·æœ‰æ‰§è¡Œ <code>docker</code> å‘½ä»¤çš„æƒé™ã€‚</p>
<p>ç»„ ID ä½¿ç”¨äº† <code>DOCKER_GID</code> å‚æ•°æ¥å®šä¹‰ï¼Œä»¥æ–¹ä¾¿è¿›ä¸€æ­¥å®šåˆ¶ã€‚æ„å»ºæ—¶å¯ä»¥é€šè¿‡ <code>--build-arg</code> æ¥æ”¹å˜ <code>DOCKER_GID</code> çš„é»˜è®¤å€¼ï¼Œè¿è¡Œæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ <code>--user jenkins:1234</code> æ¥æ”¹å˜è¿è¡Œç”¨æˆ·çš„èº«ä»½ã€‚</p>
<p><em>è¿™é‡Œçš„åŸºç¡€é•œåƒä½¿ç”¨çš„æ˜¯ <code>jenkins:alpine</code>ï¼Œæ¢ä¸ºé <code>alpine</code> çš„é•œåƒ <code>jenkins:latest</code> ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</em></p>
<p>ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ„å»ºé•œåƒï¼ˆå‡è®¾é•œåƒåä¸º <code>jenkins-docker</code>ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t jenkins-docker .</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦æ„å»ºæ—¶è°ƒæ•´ <code>docker</code> ç»„ IDï¼Œå¯ä»¥ä½¿ç”¨ <code>--build-arg</code> æ¥è¦†ç›–å‚æ•°é»˜è®¤å€¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t jenkins-docker --build-arg DOCKER_GID=1234 .</span><br></pre></td></tr></table></figure>
<p>åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œå°†å®¿ä¸»çš„ <code>/var/run/docker.sock</code> æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨å†…çš„åŒæ ·ä½ç½®ï¼Œä»è€Œè®©å®¹å™¨å†…å¯ä»¥é€šè¿‡ <a href="https://en.wikipedia.org/wiki/Unix_domain_socket" target="_blank" rel="noopener">unix socket</a> è°ƒç”¨å®¿ä¸»çš„ Docker å¼•æ“ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ <code>jenkins</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker run --name jenkins \</span><br><span class="line">    -d \</span><br><span class="line">    -p 8080:8080 \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    jenkins-docker</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>jenkins</code> å®¹å™¨ä¸­ï¼Œå°±å·²ç»å¯ä»¥æ‰§è¡Œ <code>docker</code> å‘½ä»¤äº†ï¼Œå¯ä»¥é€šè¿‡ <code>docker exec</code> æ¥éªŒè¯è¿™ä¸ªç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it jenkins sh</span><br><span class="line">/ $ id</span><br><span class="line">uid=1000(jenkins) gid=999(ping) groups=999(ping)</span><br><span class="line">/ $ docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:      1.12.3</span><br><span class="line"> API version:  1.24</span><br><span class="line"> Go version:   go1.6.3</span><br><span class="line"> Git commit:   6b644ec</span><br><span class="line"> Built:        Wed Oct 26 23:26:11 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Version:      1.13.0-rc2</span><br><span class="line"> API version:  1.25</span><br><span class="line"> Go version:   go1.7.3</span><br><span class="line"> Git commit:   1f9b3ef</span><br><span class="line"> Built:        Wed Nov 23 06:32:39 2016</span><br><span class="line"> OS/Arch:      linux/amd64</span><br><span class="line">/ $</span><br></pre></td></tr></table></figure>
<h3 id="Docker-å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ"><a href="#Docker-å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ" class="headerlink" title="Docker å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ"></a>Docker å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--restart=always</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#restart-policies-restart</a></p>
<h3 id="docker-stats-æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ"><a href="#docker-stats-æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ" class="headerlink" title="docker stats æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ"></a><code>docker stats</code> æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ</h3><p>å¯¹äºä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé»˜è®¤çš„ <code>docker stats</code> é‡Œåªæ˜¾ç¤ºå®¹å™¨ IDï¼Œåæ¥å³ä½¿æ”¯æŒäº† <code>--format</code>ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œè€Œæ²¡æœ‰å°†å…¶å˜ä¸ºé»˜è®¤é…ç½®ã€‚<code>17.10</code> ä»¥åçš„ç‰ˆæœ¬ï¼Œ<code>docker container stats</code> é»˜è®¤å°†æ˜¾ç¤ºå®¹å™¨åç§°ã€‚</p>
<p>å¯¹äºä»¥å‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä¿®æ”¹å®¢æˆ·ç«¯æœ¬åœ°çš„ <code>~/.docker/config.json</code> æ–‡ä»¶ï¼ŒåŠ å…¥ä¸€è¡Œé…ç½®ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"statsFormat"</span>: <span class="string">"table &#123;&#123;.Name&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;\t&#123;&#123;.MemPerc&#125;&#125;\t&#123;&#123;.NetIO&#125;&#125;\t&#123;&#123;.BlockIO&#125;&#125;\t&#123;&#123;.PIDs&#125;&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·é»˜è®¤æ ¼å¼å°±ä¼šæ”¹ä¸ºè¿™é‡ŒæŒ‡å®šçš„æ ¼å¼ã€‚</p>
<p>å¯¹äºä¸æ”¯æŒè¿™ä¸ªé…ç½®æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>--format</code> æ¥æŒ‡å®šæ˜¾ç¤ºæ ¼å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats --format <span class="string">"table &#123;&#123;.Name&#125;&#125;\t&#123;&#123;.CPUPerc&#125;&#125;\t&#123;&#123;.MemUsage&#125;&#125;\t&#123;&#123;.MemPerc&#125;&#125;\t&#123;&#123;.NetIO&#125;&#125;\t&#123;&#123;.BlockIO&#125;&#125;\t&#123;&#123;.PIDs&#125;&#125;"</span></span><br></pre></td></tr></table></figure>
<p>è¿™ç§æƒ…å†µï¼Œå»ºè®®å°†å…¶æ·»åŠ ä¸ºä¸€ä¸ª <code>alias</code>ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚</p>
<p>å¯¹äºä¸æ”¯æŒ <code>--format</code> çš„è€ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats $(docker ps --format=<span class="string">'&#123;&#123;.Names&#125;&#125;'</span>)</span><br></pre></td></tr></table></figure>
<p>å…¶ç¼ºç‚¹æ˜¯ä¸æ”¯æŒåŠ¨æ€æ·»åŠ ã€åˆ é™¤çš„å®¹å™¨ï¼Œæ‰€ä»¥ä¸èƒ½ä½œä¸ºæŒç»­è§‚å¯Ÿã€‚</p>
<h3 id="æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘-Ubuntu-14-04-ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯3-13ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘-Ubuntu-14-04-ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯3-13ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ Ubuntu 14.04 ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯3.13ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a>æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ <code>Ubuntu 14.04</code> ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯<code>3.13</code>ï¼Œæ€ä¹ˆåŠï¼Ÿ</h3><p>å…¶å® <code>Ubuntu 14.04</code> å®˜æ–¹ç»´æŠ¤çš„å†…æ ¸å·²ç»åˆ° <code>4.4</code> äº†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å‡çº§å†…æ ¸ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y --install-recommends linux-generic-lts-xenial</span><br></pre></td></tr></table></figure>
<h3 id="å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ"><a href="#å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ" class="headerlink" title="å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ"></a>å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ</h3><p><code>Docker 1.10</code> ä¹‹åæ”¯æŒåŠ¨æ€ä¿®æ”¹ï¼Œä½¿ç”¨ <code>docker update</code> å‘½ä»¤ï¼Œå¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update -m 300m</span><br></pre></td></tr></table></figure>
<h3 id="ç»å¸¸åœ¨å„ç§-Docker-å‘½ä»¤é‡Œçœ‹åˆ°-labelï¼Œlabel-æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#ç»å¸¸åœ¨å„ç§-Docker-å‘½ä»¤é‡Œçœ‹åˆ°-labelï¼Œlabel-æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="ç»å¸¸åœ¨å„ç§ Docker å‘½ä»¤é‡Œçœ‹åˆ° --labelï¼Œlabel æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ"></a>ç»å¸¸åœ¨å„ç§ <code>Docker</code> å‘½ä»¤é‡Œçœ‹åˆ° <code>--label</code>ï¼Œ<code>label</code> æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ</h3><p><code>Label</code> æ˜¯<code>é”®å€¼å¯¹</code>ï¼Œæ˜¯ <code>metadata</code>ï¼Œæ˜¯è´¯ç©¿äº <code>Docker</code> å„ä¸ªèµ„æºçš„ï¼ŒåŒ…æ‹¬å¼•æ“ã€é•œåƒã€å®¹å™¨ã€å·ã€ç½‘ç»œã€Swarm èŠ‚ç‚¹ã€æœåŠ¡ç­‰ã€‚</p>
<ul>
<li>é”® <code>key</code>ï¼šæ ¼å¼è¦æ±‚åªå¯ä»¥åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œä»¥åŠ<code>.</code>ï¼Œ<code>-</code>ã€‚æ¨èä½¿ç”¨ç±»ä¼¼äº <code>Java</code> é‚£ç§åå‘åŸŸåæ ¼å¼ï¼Œå¦‚ <code>com.example.mytag</code>ã€‚</li>
<li>å€¼ <code>value</code>ï¼šæ ¼å¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œé™¤äº†æ™®é€šå­—ç¬¦ä¸²å¤–ï¼Œè¿˜å¯ä»¥æ˜¯ <code>JSON</code>, <code>XML</code>, <code>CSV</code> æˆ–è€… <code>YAML</code>ï¼Œå½“ç„¶ï¼Œéœ€è¦å…ˆè¿›è¡Œåºåˆ—åŒ–ã€‚</li>
</ul>
<p>å½“èµ„æºå¾ˆå°‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹ä¸€ä¸ªä¸ªèµ„æºè¿›è¡Œæ“ä½œï¼Œä½†æ˜¯ï¼Œåœ¨ç®¡ç†å¾ˆå¤šèµ„æºçš„æ—¶å€™ï¼Œè¿™ä¹ˆåšå°±å˜å¾—ä¸å¤§ç°å®ã€‚ç»å¸¸çš„éœ€æ±‚æ˜¯é’ˆå¯¹æŸä¸€ç±»çš„èµ„æºè¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸ªçš„æ“ä½œã€‚è¿™ç§æƒ…å†µï¼Œç»å¸¸ä¼šä½¿ç”¨ <code>label</code> æ¥å¸®åŠ©å®ç°ã€‚</p>
<p>å½“åˆ›å»ºä¸€ä¸ªèµ„æºçš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šè¿™ä¸ªèµ„æºçš„ <code>label</code>ï¼ˆä¸€ä¸ªèµ„æºå¯ä»¥æœ‰å¾ˆå¤šä¸ª <code>label</code>ï¼‰ï¼Œè€Œå½“åˆ›å»ºäº†å¾ˆå¤šä¸ªèµ„æºçš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è¿‡æ»¤ <code>label</code> çš„é”®ã€å€¼æ¥å¾—åˆ°æ‰€éœ€çš„èµ„æºåˆ—è¡¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker run</code> è¿è¡Œä¸€å †å®¹å™¨ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡ <code>label</code> æŒ‡å®šå®¹å™¨æ˜¯æ¶æ„ä¸­çš„å“ªä¸€éƒ¨åˆ†ã€‚</p>
<ul>
<li>å‰ç«¯ï¼š<code>--label type=frontend</code></li>
<li>ä¸­é—´ä»¶ï¼š<code>--label type=middleware</code></li>
<li>å­˜å‚¨ï¼š<code>--label type=storage</code></li>
</ul>
<p>åœ¨åæœŸç»´æŠ¤æ—¶ï¼Œå¯ä»¥ç›´æ¥è¿‡æ»¤æ˜¾ç¤ºæƒ³è¦çš„å®¹å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åªæƒ³çœ‹å‰ç«¯å®¹å™¨è¿è¡Œæƒ…å†µï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps --filter label=<span class="built_in">type</span>=frontend</span><br></pre></td></tr></table></figure>
<p>è€Œä¸”ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥çš„å’Œå…¶å®ƒå‘½ä»¤é…åˆæ“ä½œè¿™ç»„å®¹å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦åœæ­¢æ‰€æœ‰å‰ç«¯å®¹å™¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -f label=<span class="built_in">type</span>=frontend)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>label</code> åœ¨é›†ç¾¤è°ƒåº¦ä¸­ä¹Ÿéå¸¸æœ‰ç”¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒçš„ Docker ä¸»æœºçš„å¼•æ“ <code>dockerd</code> å‚æ•°ä¸­ï¼Œé€šè¿‡ <code>label</code> æ¥åŠ å…¥å­˜å‚¨ç±»å‹çš„ä¿¡æ¯ï¼Œå¦‚ï¼š</p>
<ul>
<li>å­˜å‚¨ç±»å‹ä¸º <code>SSD</code>ï¼š<code>--label storage=ssd</code></li>
<li>å­˜å‚¨ç±»å‹ä¸º <code>HDD</code>ï¼š<code>--label storage=hdd</code></li>
</ul>
<p>å¯¹äºæ•°æ®åº“çš„æœåŠ¡ï¼Œæˆ‘ä»¬è‡ªç„¶å¸Œæœ›è·‘åœ¨ <code>SSD</code> ä¸Šä»¥è·å¾—æ›´å¤§çš„æ€§èƒ½ï¼Œè€Œæ—¥å¿—ã€å¤‡ä»½æœåŠ¡åˆ™å¸Œæœ›è·‘åœ¨ <code>HDD</code> ä¸Šè·å¾—æ›´é«˜çš„å®¹é‡ã€‚é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆåšï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --name mysql \</span><br><span class="line">    --constraint <span class="string">'engine.labels.storage == ssd'</span> \</span><br><span class="line">    mysql</span><br></pre></td></tr></table></figure>
<h4 id="æ·»åŠ labelä»¥åŠè¿‡æ»¤"><a href="#æ·»åŠ labelä»¥åŠè¿‡æ»¤" class="headerlink" title="æ·»åŠ labelä»¥åŠè¿‡æ»¤"></a>æ·»åŠ <code>label</code>ä»¥åŠè¿‡æ»¤</h4><p>æ·»åŠ  <code>label</code> å¤§å¤šæ ¼å¼éƒ½æ˜¯åœ¨åˆ›å»ºã€ä¿®æ”¹èµ„æºæ—¶ï¼Œä½¿ç”¨ <code>--label &lt;key&gt;=&lt;value&gt;</code> å‚æ•°ï¼ˆéƒ¨åˆ†å‘½ä»¤æä¾›äº† <code>-l</code> ç¼©å†™å½¢å¼ï¼‰ã€‚<code>value</code> å¯ä»¥çœç•¥ï¼Œæ ¼å¼ä¸º <code>--label &lt;key&gt;</code>ã€‚å¦‚æœéœ€è¦å®šä¹‰å¤šç»„ <code>label</code>ï¼Œåªéœ€å¤šç»„ <code>--label</code> å³å¯ã€‚</p>
<p>è¿‡æ»¤ <code>label</code> åˆ™å¤§å¤šå‘ç”Ÿåœ¨åˆ—è¡¨å‘½ä»¤ä¸­ï¼Œä½¿ç”¨ <code>--filter label=&lt;key&gt;=&lt;value&gt;</code>ï¼Œæˆ–è€…å¯¹äºä¸å…³å¿ƒ <code>value</code> çš„æƒ…å†µï¼Œ<code>--filter label=&lt;key&gt;</code>ï¼ˆéƒ¨åˆ†å‘½ä»¤æä¾›äº† <code>-f</code> çš„ç¼©å†™å½¢å¼ï¼‰ã€‚</p>
<p>ä¸‹é¢çš„åˆ—è¡¨ï¼Œåˆ—å‡ºäº†æ”¯æŒ <code>label</code> çš„å‘½ä»¤ï¼ˆé™¤éç‰¹æ®Šå£°æ˜ï¼Œâ€æ·»åŠ â€å‘½ä»¤ä½¿ç”¨ <code>--label</code> é€‰é¡¹æ·»åŠ  <code>label</code>ï¼›â€è¿‡æ»¤â€å‘½ä»¤ä½¿ç”¨ <code>--filter</code> è¿‡æ»¤<code>label</code>ï¼‰ï¼š</p>
<ul>
<li>Docker å¼•æ“<ul>
<li>æ·»åŠ ï¼š<code>dockerd</code>ï¼š <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a></li>
</ul>
</li>
<li>é•œåƒ<ul>
<li>æ·»åŠ ï¼š<ul>
<li><code>docker build</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/build/</a></li>
<li><code>Dockerfile</code> ä¸­çš„ <code>LABEL</code>ï¼ˆä¼šç»§æ‰¿<code>FROM</code>é•œåƒçš„<code>LABEL</code>ï¼‰ï¼š<a href="https://docs.docker.com/engine/reference/builder/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/#/label</a></li>
</ul>
</li>
<li>è¿‡æ»¤ï¼š<code>docker images</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/images/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/images/#/filtering</a></li>
</ul>
</li>
<li>å®¹å™¨<ul>
<li>æ·»åŠ ï¼š<code>docker create</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/create/</a><ul>
<li>é™¤äº† <code>--label</code> å¤–ï¼Œ<code>docker create</code> è¿˜æ”¯æŒä½¿ç”¨é€‰é¡¹ <code>--label-file</code> ä»æ–‡ä»¶ä¸­åŠ è½½ <code>label</code></li>
</ul>
</li>
<li>æ·»åŠ ï¼š<code>docker run</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/run/#/set-metadata-on-container--l---label---label-file</a><ul>
<li>é™¤äº† <code>--label</code> å¤–ï¼Œ<code>docker run</code> è¿˜æ”¯æŒä½¿ç”¨é€‰é¡¹ <code>--label-file</code> ä»æ–‡ä»¶ä¸­åŠ è½½ <code>label</code></li>
</ul>
</li>
<li>è¿‡æ»¤ï¼š<code>docker ps</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/ps/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/ps/#/label</a></li>
</ul>
</li>
<li>å·<ul>
<li>æ·»åŠ ï¼š<code>docker volume create</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/volume_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_create/</a></li>
<li>è¿‡æ»¤ï¼š<code>docker volume ls</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/volume_ls/#/filtering</a></li>
</ul>
</li>
<li>ç½‘ç»œ<ul>
<li>æ·»åŠ ï¼š<code>docker network create</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/network_create/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/network_create/</a></li>
<li>è¿‡æ»¤ï¼š<code>docker network ls</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/network_ls/#/filtering</a></li>
</ul>
</li>
<li>Swarm èŠ‚ç‚¹<ul>
<li><code>docker node update</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_update/#/add-label-metadata-to-a-node</a><ul>
<li>æ·»åŠ ï¼š<code>--label-add</code></li>
<li>åˆ é™¤ï¼š<code>--label-rm</code></li>
</ul>
</li>
<li>è¿‡æ»¤ï¼š<code>docker node ls</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_ls/#/filtering</a></li>
<li>è¿‡æ»¤ï¼š<code>docker node ps</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/node_ps/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/node_ps/#/label</a></li>
</ul>
</li>
<li>æœåŠ¡<ul>
<li>æ·»åŠ ï¼š<code>docker service create</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/set-metadata-on-a-service--l---label</a><ul>
<li>é™¤äº† <code>--label</code> å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>--container-label</code> æ¥æ·»åŠ å®¹å™¨ <code>label</code></li>
</ul>
</li>
<li><code>docker service update</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/service_update/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_update/</a><ul>
<li>æ·»åŠ å®¹å™¨ <code>label</code>ï¼š<code>--container-label-add</code></li>
<li>åˆ é™¤å®¹å™¨ <code>label</code>ï¼š<code>--container-label-rm</code></li>
<li>æ·»åŠ æœåŠ¡ <code>label</code>ï¼š<code>--label-add</code></li>
<li>åˆ é™¤æœåŠ¡ <code>label</code>ï¼š<code>--label-rm</code></li>
</ul>
</li>
<li>è¿‡æ»¤ï¼š<code>docker service ls</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/service_ls/#/label" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_ls/#/label</a></li>
</ul>
</li>
</ul>
<p>é™¤äº†ä¸Šè¿°èµ„æºå¤–ï¼Œ<code>docker events</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>label</code> è¿‡æ»¤ç»“æœï¼š<a href="https://docs.docker.com/engine/reference/commandline/events/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/events/</a></p>
<h4 id="é›†ç¾¤è°ƒåº¦çº¦æŸ"><a href="#é›†ç¾¤è°ƒåº¦çº¦æŸ" class="headerlink" title="é›†ç¾¤è°ƒåº¦çº¦æŸ"></a>é›†ç¾¤è°ƒåº¦çº¦æŸ</h4><ul>
<li>ä¸€ä»£ Swarmï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æ·»åŠ çº¦æŸ<ul>
<li><code>docker run</code>ï¼š<code>-e constraint:storage==sdd</code>ï¼š<a href="https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions" target="_blank" rel="noopener">https://docs.docker.com/swarm/scheduler/filter/#/how-to-write-filter-expressions</a></li>
<li><code>docker-compose.yml</code>ï¼šä½¿ç”¨ <code>environment</code> æ¥è¿›è¡Œçº¦æŸï¼š<a href="https://docs.docker.com/compose/swarm/#/manual-scheduling" target="_blank" rel="noopener">https://docs.docker.com/compose/swarm/#/manual-scheduling</a></li>
</ul>
</li>
</ul>
<p>å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"2"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    redis:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">"constraint:storage==ssd"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>äºŒä»£ Swarm<ul>
<li><code>docker service create</code>ï¼š<code>--constraint value</code>ï¼š<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/specify-service-constraints---constraint</a></li>
</ul>
</li>
</ul>
<p>å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>Swarm èŠ‚ç‚¹</code> çš„ <code>label</code> è¿›è¡Œçº¦æŸï¼ˆæ³¨æ„ï¼Œè¿™æ¬¡ç”¨çš„ä¸æ˜¯<code>å¼•æ“</code>çš„<code>label</code>ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">    --name web \</span><br><span class="line">    --constraint <span class="string">'node.labels.type == frontend'</span> \</span><br><span class="line">    nginx</span><br></pre></td></tr></table></figure>
<h3 id="éƒ½è¯´ä¸è¦ç”¨-root-å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„-Dockerfile-éƒ½æ˜¯ç”¨-root-å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ"><a href="#éƒ½è¯´ä¸è¦ç”¨-root-å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„-Dockerfile-éƒ½æ˜¯ç”¨-root-å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ" class="headerlink" title="éƒ½è¯´ä¸è¦ç”¨ root å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„ Dockerfile éƒ½æ˜¯ç”¨ root å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ"></a>éƒ½è¯´ä¸è¦ç”¨ <code>root</code> å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„ <code>Dockerfile</code> éƒ½æ˜¯ç”¨ <code>root</code> å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ</h3><p>å¹¶éæ‰€æœ‰å®˜æ–¹é•œåƒçš„ <code>Dockerfile</code> éƒ½æ˜¯ç”¨ <code>root</code> ç”¨æˆ·å»æ‰§è¡Œçš„ã€‚æ¯”å¦‚ <code>mysql</code> é•œåƒçš„æ‰§è¡Œèº«ä»½å°±æ˜¯ <code>mysql</code> ç”¨æˆ·ï¼›<code>redis</code> é•œåƒçš„æœåŠ¡è¿è¡Œç”¨æˆ·å°±æ˜¯ <code>redis</code>ï¼›<code>mongo</code> é•œåƒå†…çš„æœåŠ¡æ‰§è¡Œèº«ä»½æ˜¯ <code>mongo</code> ç”¨æˆ·ï¼›<code>jenkins</code> é•œåƒå†…æ˜¯ <code>jenkins</code> ç”¨æˆ·å¯åŠ¨æœåŠ¡ç­‰ç­‰ã€‚æ‰€ä»¥è¯´ â€œéƒ½æ˜¯ç”¨ <code>root</code> å»è¿è¡Œâ€ æ˜¯ä¸å®¢è§‚çš„ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯è¯´åœ¨<strong>å®¹å™¨å†…</strong>ä½¿ç”¨ <code>root</code> å°±éå¸¸å±é™©ã€‚å®¹å™¨å†…çš„ <code>root</code> å’Œå®¿ä¸»ä¸Šçš„ <code>root</code> ä¸åŒï¼Œå®¹å™¨å†…çš„ <code>root</code> è™½ç„¶ <code>uid</code> ä¹Ÿé»˜è®¤ä¸º <code>0</code>ï¼Œä½†æ˜¯å´å¤„äºä¸€ä¸ªéš”ç¦»çš„å‘½åç©ºé—´ï¼Œè€Œä¸”è¢«å»æ‰äº†å¤§é‡çš„ç‰¹æƒã€‚å®¹å™¨å†…çš„ <code>root</code> æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»€ä¹ˆç‰¹æƒçš„ç”¨æˆ·ï¼Œå±é™©çš„æ“ä½œåŸºæœ¬éƒ½æ— æ³•æ‰§è¡Œã€‚</p>
<p>ä¸è¿‡ï¼Œå¦‚æœç”¨æˆ·å¯ä»¥æ‰“ç ´è¿™ä¸ªå®‰å…¨ä¿æŠ¤ï¼Œé‚£å°±æ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚æ¯”å¦‚ï¼Œå¦‚æœç”¨æˆ·æŒ‚è½½äº†å®¿ä¸»ç›®å½•ç»™å®¹å™¨ï¼Œè¿™å°±æ˜¯æ‰“é€šäº†ä¸€ä¸ªå®¹å™¨å†…çš„ <code>root</code> æ“æ§å®¿ä¸»çš„ä¸€ä¸ªé€šé“ï¼Œä½¿å¾—å®¹å™¨å†…çš„ <code>root</code> å¯ä»¥ä¿®æ”¹æ‰€æŒ‚è½½çš„ç›®å½•ä¸‹çš„ä»»ä½•æ–‡ä»¶ã€‚</p>
<p>å› ä¸ºå½“å‰ç‰ˆæœ¬çš„ Docker ä¸­ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹</strong>å®¹å™¨çš„ <code>user namespace</code> å¹¶æœªå¼€å¯ï¼Œæ‰€ä»¥å®¹å™¨å†…çš„ç”¨æˆ·å’Œå®¿ä¸»ç”¨æˆ·å…±äº« <code>uid</code> ç©ºé—´ã€‚å®¹å™¨å†…çš„ <code>uid</code> ä¸º <code>0</code> çš„ <code>root</code>ï¼Œå°±è¢«ç³»ç»Ÿè§†ä¸º <code>uid=0</code> çš„å®¿ä¸» <code>root</code>ï¼Œå› æ­¤ç£ç›˜è¯»å†™æ—¶ï¼Œå…·æœ‰å®¿ä¸» <code>root</code> åŒç­‰è¯»å†™æƒé™ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸€èˆ¬ä¸æ¨èæŒ‚è½½å®¿ä¸»ç›®å½•ã€ç‰¹åˆ«æ˜¯æŒ‚è½½å®¿ä¸»ç³»ç»Ÿç›®å½•çš„åŸå› ä¹‹ä¸€ã€‚è¿™ä¸€åˆ‡åªè¦å®šåˆ¶é•œåƒçš„æ—¶å€™ï¼Œå®¹å™¨å†…ä¸ä½¿ç”¨ <code>root</code> å¯åŠ¨æœåŠ¡å°±æ²¡è¿™ä¸ªé—®é¢˜äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¸Šé¢è¯´çš„é—®é¢˜åªæ˜¯é»˜è®¤æƒ…å†µä¸‹ <code>user namespace</code> ä¸ä¼šå¯ç”¨çš„é—®é¢˜ã€‚<code>dockerd</code> æœ‰ä¸€ä¸ª <code>--userns-remap</code> å‚æ•°ï¼Œåªè¦é…ç½®äº†è¿™ä¸ªå‚æ•°ï¼Œå°±å¯ä»¥ç¡®ä¿å®¹å™¨å†…çš„ <code>uid</code> æ˜¯ç‹¬ç«‹å‘½åç©ºé—´ï¼Œå®¹å™¨å†…çš„ <code>uid</code> å˜åˆ°å®¿ä¸»çš„æ—¶å€™ï¼Œä¼šè¢« <code>remap</code> åˆ°å¦ä¸€ä¸ªèŒƒå›´ã€‚å› æ­¤ï¼Œå®¹å™¨å†…çš„ <code>uid=0</code> çš„ <code>root</code> å°†å®Œå…¨è·Ÿ <code>root</code> æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œä»…ä»…æ˜¯ä¸ªæ™®é€šç”¨æˆ·è€Œå·²ã€‚</p>
<p>ç›¸å…³ä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><code>--userns-remap</code> çš„ä»‹ç»ï¼š<a href="https://docs.docker.com/engine/reference/commandline/dockerd/#/daemon-user-namespace-options" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/#/daemon-user-namespace-options</a></li>
<li>Docker å®‰å…¨ï¼š<a href="https://docs.docker.com/engine/security/security/" target="_blank" rel="noopener">https://docs.docker.com/engine/security/security/</a></li>
</ul>
<h3 id="æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ-systemctl-start-xxx-æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ"><a href="#æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ-systemctl-start-xxx-æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ" class="headerlink" title="æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ systemctl start xxx æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ"></a>æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ <code>systemctl start xxx</code> æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ</h3><p>å¦‚æœåœ¨å®¹å™¨å†…ä½¿ç”¨ <code>systemctl</code> å‘½ä»¤ï¼Œç»å¸¸ä¼šå‘ç°ç¢°åˆ°è¿™æ ·çš„é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to get D-Bus connection: Operation not permitted</span><br></pre></td></tr></table></figure>
<p>è¿™å¾ˆæ­£å¸¸ï¼Œå› ä¸º <code>systemd</code> æ˜¯å®Œæ•´ç³»ç»Ÿçš„æœåŠ¡å¯åŠ¨ã€ç»´æŠ¤çš„ç³»ç»ŸæœåŠ¡ç¨‹åºï¼Œè€Œä¸”éœ€è¦ç‰¹æƒå»æ‰§è¡Œã€‚ä½†æ˜¯å®¹å™¨ä¸æ˜¯å®Œæ•´ç³»ç»Ÿï¼Œæ—¢æ²¡æœ‰é…åˆçš„æœåŠ¡ï¼Œä¹Ÿæ²¡æœ‰ç‰¹æƒï¼Œæ‰€ä»¥è‡ªç„¶ç”¨ä¸äº†ã€‚</p>
<p>å¦‚æœä½ ç¢°åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œåªèƒ½å†æ¬¡æé†’ä½ ï¼Œ<strong>Docker ä¸æ˜¯è™šæ‹Ÿæœº</strong>ã€‚è¯•å›¾åœ¨å®¹å™¨é‡Œæ‰§è¡Œ <code>systemctl</code> å‘½ä»¤çš„ï¼Œå¤§å¤šéƒ½æ˜¯è¿˜æ²¡æœ‰ææ˜ç™½å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«ï¼Œå› ä¸ºçœ‹åˆ°äº†å¯ä»¥æœ‰ Shellï¼Œå°±ä»¥ä¸ºè¿™æ˜¯ä¸ªè™šæ‹Ÿæœºï¼Œè¯•å›¾é‡å¤è‡ªå·±åœ¨å®Œæ•´ç³»ç»Ÿä¸Šçš„ä½“éªŒã€‚è¿™æ˜¯ç”¨æ³•é”™è¯¯ï¼Œ<strong>ä¸è¦æŠŠ Docker å½“åšè™šæ‹Ÿæœºå»ç”¨ï¼Œå®¹å™¨æœ‰è‡ªå·±çš„ç”¨æ³•</strong>ã€‚</p>
<blockquote>
<p>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨åªæ˜¯å—é™è¿›ç¨‹ã€‚</p>
</blockquote>
<p>å®¹å™¨å†…æ ¹æœ¬ä¸éœ€è¦åå°æœåŠ¡ï¼Œä¹Ÿä¸éœ€è¦æœåŠ¡è°ƒåº¦å’Œç»´æŠ¤ï¼Œè‡ªç„¶ä¹Ÿä¸éœ€è¦ <code>systemd</code>ã€‚å®¹å™¨åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨è¿›ç¨‹ã€‚å®¹å™¨çš„ç”Ÿå­˜å‘¨æœŸå°±æ˜¯å›´ç»•ç€è¿™ä¸ªä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œæ‰€ä»¥æ‰€è¯•å›¾å¯åŠ¨çš„åå°æœåŠ¡ï¼Œåº”è¯¥æ”¹ä¸ºç›´æ¥åœ¨å‰å°è¿è¡Œï¼Œæ ¹æœ¬ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥ä½¿ç”¨ <code>systemctl</code> å‘½ä»¤å»åœ¨åå°åŠ è½½ã€‚æ—¥å¿—ä¹‹ç±»çš„ä¹Ÿæ˜¯ç›´æ¥ä» <code>stdout</code>/<code>stderr</code> è¾“å‡ºï¼Œè€Œä¸æ˜¯èµ° <code>journald</code>ã€‚</p>
<h3 id="å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ"><a href="#å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ" class="headerlink" title="å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ"></a>å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ</h3><p>é—®è¿™ä¸ªé—®é¢˜çš„äººå¾€å¾€æ··æ·†äº†<strong>æ—¶é—´</strong>å’Œ<strong>æ—¶åŒº</strong>çš„æ¦‚å¿µã€‚</p>
<p><strong>æ—¶é—´</strong>æ˜¯ä» <code>epoch</code> åˆ°å½“å‰çš„ç§’æ•°æˆ–è€…æ¯«ç§’æ•°ï¼Œå…¨çƒéƒ½ä¸€æ ·ï¼Œè¿™æ˜¯ç»å¯¹å€¼ï¼›è€Œ<strong>æ—¶åŒº</strong>åˆ™æ˜¯ç”±äºåœ°ç†ä½ç½®å·®å¼‚ã€è¡Œæ”¿åŒºåˆ’å¯¼è‡´å„åœ°æ˜¾ç¤ºæ—¶é—´çš„å·®å¼‚ã€‚</p>
<p>å¯¹äº Docker å®¹å™¨è€Œè¨€ï¼Œæ ¹æœ¬ä¸å­˜åœ¨å®¿ä¸»å’Œå®¹å™¨çš„æ—¶é—´å·®å¼‚é—®é¢˜ï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå†…æ ¸ã€åŒä¸€ä¸ªæ—¶é’Ÿï¼ŒäºŒè€…å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸å­˜åœ¨åŒæ­¥é—®é¢˜ã€‚è¿˜æ˜¯é‚£å¥è¯ <strong>Docker ä¸æ˜¯è™šæ‹Ÿæœº</strong>ã€‚</p>
<p>æ‰€çœ‹åˆ°çš„å·®å¼‚ï¼Œå¦‚æœç»†å¿ƒä¸€ç‚¹ï¼Œå¾ˆå¯èƒ½ä¼šå‘ç°å…¶å®æ ¹æœ¬ä¸æ˜¯<strong>æ—¶é—´</strong>åŒæ­¥é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it ubuntu bash</span><br><span class="line">root@08c6ad41f343:/<span class="comment"># date</span></span><br><span class="line">Tue Dec 13 01:36:37 UTC 2016</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ° <code>UTC</code> äº†ä¹ˆï¼Œè¿™æ˜¯è¯´ä½¿ç”¨çš„æ˜¯å›½é™…æ ‡å‡† <code>0 æ—¶åŒº</code> çš„æ—¶é—´æ˜¾ç¤ºï¼Œå› æ­¤è¿™åªæ˜¯æ˜¾ç¤ºæ‰€ç”¨çš„æ—¶åŒºè®¾ç½®å·®å¼‚é—®é¢˜ã€‚è€Œä¸”ä¹‹å‰å¦‚æœç¨å¾®æ³¨æ„ä¸€ä¸‹ï¼Œå°±ä¼šå‘ç°æ‰€è°“æ—¶é—´ä¸ä¸€è‡´ï¼Œå®é™…ä¸Šæ˜¯æ•´æ•´å·®äº† <code>8</code> ä¸ªå°æ—¶ï¼Œè¿˜è®°å¾—ä¸­å­¦åœ°ç†è¯¾ä¸Šè®²çš„ä¸­å›½æ—¶åŒºæ˜¯å¤šå°‘ä¹ˆï¼Ÿæ˜¯ <code>+8 æ—¶åŒº</code>ï¼Œæ‰€ä»¥è‡ªç„¶å’Œ <code>0 æ—¶åŒº</code> å·®äº† <code>8</code> ä¸ªå°æ—¶ã€‚åº”è¯¥å¾ˆå¿«å°±æ„è¯†åˆ°æ˜¯è‡ªå·±çš„æ—¶åŒºè®¾é”™äº†ï¼ˆæˆ–è€…å·æ‡’æ²¡è®¾ï¼‰å¯¼è‡´ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œè®¾ç½®æ—¶åŒºå³å¯ã€‚ä¸€èˆ¬æƒ…å†µç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡ <code>TZ</code> å°±å¤Ÿäº†ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it -e TZ=Asia/Shanghai debian bash</span><br><span class="line">root@8e6d6c588328:/<span class="comment"># date</span></span><br><span class="line">Tue Dec 13 09:41:21 CST 2016</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†ä¹ˆï¼Ÿæ—¶åŒºè°ƒæ•´åˆ°äº† <code>CST</code>ï¼Œä¹Ÿå°±æ˜¯<code>China Standard Time - ä¸­å›½æ ‡å‡†æ—¶é—´</code>ï¼Œå› æ­¤æ˜¾ç¤ºå°±æ­£å¸¸äº†ã€‚</p>
<p>ä¸è¿‡å¹¶éæ‰€æœ‰ç³»ç»Ÿéƒ½å¯ä»¥å¦‚æ­¤æ–¹ä¾¿çš„è®¾ç½®æ—¶åŒºã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>TZ=Asia/Shanghai</code> ç¯å¢ƒå˜é‡ä¿®æ”¹æ—¶åŒºçš„ç³»ç»Ÿæœ‰ï¼š</p>
<ul>
<li><code>centos</code> (<code>5</code>, <code>6</code>, <code>7</code>)</li>
<li><code>debian</code> (<code>7</code>, <code>8</code>, <code>9</code>)</li>
<li><code>fedora</code> (<code>24</code>, <code>25</code>, <code>26</code>)</li>
<li><code>ubuntu</code> (<code>14.04</code>)</li>
</ul>
<p>è€Œä¸‹é¢çš„è¿™äº›ç³»ç»Ÿå¯èƒ½å‡ºäºé•œåƒä½“ç§¯çš„è€ƒè™‘ï¼Œå»æ‰äº†æ—¶åŒºçš„è½¯ä»¶åŒ… <code>tzdata</code>ï¼Œå› æ­¤éœ€è¦åœ¨ <code>Dockerfile</code> ä¸­å…ˆè¡Œå®‰è£…æ—¶åŒºåŒ…ã€‚</p>
<ul>
<li><code>ubuntu</code>: (<code>16.04</code>, <code>17.04</code>, <code>17.10</code>) (~15MB)<ul>
<li><code>Dockerfile</code>:</li>
</ul>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">  &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="bash">  &amp;&amp; apt-get install tzdata locales \</span></span><br><span class="line"><span class="bash">  &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>alpine</code> (~1.3MB)<ul>
<li><code>Dockerfile</code>: <code>RUN apk --no-cache add tzdata</code></li>
</ul>
</li>
<li><code>opensuse</code> (~12MB)<ul>
<li><code>Dockerfile</code>:</li>
</ul>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive refresh \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive -qn install --no-recommends timezone \</span></span><br><span class="line"><span class="bash">    &amp;&amp; zypper --non-interactive clean -a</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>clearlinux</code> (~280MB â€¦ğŸ˜‚)<ul>
<li><code>Dockerfile</code>:</li>
</ul>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">set</span> -xe \</span></span><br><span class="line"><span class="bash">    &amp;&amp; swupd bundle-add sysadmin-basic \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/swupd/*</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢åˆ—è¡¨é™¤äº†åˆ—å‡ºç³»ç»Ÿå¤–ï¼Œè¿˜ç»™å‡ºäº†æ¯ä¸ªç³»ç»Ÿéœ€è¦æ·»åŠ åˆ° <code>Dockerfile</code> çš„å®‰è£…åŒ…çš„å‘½ä»¤ï¼Œä»¥åŠå®‰è£…åé•œåƒä½“ç§¯å¢åŠ çš„å¤§å°ã€‚å…¶ä¸­ <code>clearlinux</code> ä¸èƒ½å•ä¸ªå®‰è£…è½¯ä»¶åŒ…ï¼Œæ‰€ä»¥ä½“ç§¯å¢åŠ çš„æœ‰äº›å¤¸å¼ ï¼Œå› æ­¤æ›´å¥½åœ°åŠæ³•æ˜¯ç›´æ¥ <code>COPY</code> æ—¶åŒºä¿¡æ¯è¿›é•œåƒã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<code>ubuntu:16.04</code> ä»¥åçš„ç‰ˆæœ¬ï¼Œåœ¨ 2017å¹´4æœˆ10 æ—¥ä»¥åï¼Œå·²ç»å»é™¤ <code>tzdata</code>ï¼Œå› æ­¤è¦æ”¹å˜å…¶æ—¶åŒºéœ€è¦è¿›è¡Œæ—¶åŒºå®‰è£…æ“ä½œï¼Œè€Œ<strong>ä¸æ˜¯</strong>åƒä»¥å‰é‚£æ ·åªéœ€é…ç½® <code>TZ</code> ç¯å¢ƒå˜é‡å³å¯ã€‚<br>ä¸è¿‡å¤§éƒ¨åˆ†<strong>å®˜æ–¹é•œåƒ</strong>æ˜¯åŸºäº <code>debian</code> çš„ï¼Œå› æ­¤å®ƒä»¬<strong>ä¸å—å½±å“</strong>ã€‚</p>
<p>å‚è€ƒ issue:</p>
<ul>
<li><a href="https://bugs.launchpad.net/cloud-images/+bug/1682622" target="_blank" rel="noopener">https://bugs.launchpad.net/cloud-images/+bug/1682622</a></li>
<li><a href="https://bugs.launchpad.net/cloud-images/+bug/1682305" target="_blank" rel="noopener">https://bugs.launchpad.net/cloud-images/+bug/1682305</a></li>
<li><a href="https://github.com/docker-library/official-images/issues/2863" target="_blank" rel="noopener">https://github.com/docker-library/official-images/issues/2863</a></li>
<li><a href="https://github.com/docker-library/official-images/issues/2856" target="_blank" rel="noopener">https://github.com/docker-library/official-images/issues/2856</a></li>
</ul>
</blockquote>
<p>è¿™ä»…ä»…æ˜¯è°ƒæ•´å®¹å™¨å†…ç³»ç»Ÿç¯å¢ƒçš„æ—¶åŒºï¼Œå¤§éƒ¨åˆ†ç¨‹åºéƒ½ä¼šéµå¾ªè¿™ä¸ªæ ‡å‡†ã€‚ä½†æ˜¯æœ‰äº›åº”ç”¨å¹¶ä¸éµå®ˆè¿™ç±»çº¦å®šï¼Œä¼šä½¿ç”¨è‡ªå·±çš„æ—¶åŒºè®¾ç½®ã€‚</p>
<p>ä¸€èˆ¬åº”ç”¨ã€æœåŠ¡çš„é…ç½®æ–‡ä»¶é‡Œä¸€èˆ¬éƒ½æœ‰æ—¶åŒºé€‰é¡¹ï¼Œåº”è¯¥æ ¹æ®è‡ªå·±éœ€æ±‚æŠŠä¸­å›½æ—¶åŒºé…ä¸Šã€‚</p>
<p>æ¯”å¦‚ï¼ŒPHP é…ç½®æ–‡ä»¶ä¸­çš„ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Date]</span></span><br><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure>
<p>å†æ¯”å¦‚ <code>mysqld</code> ä¸­çš„å‚æ•° <code>--timezone=Asia/Shanghai</code>ï¼›<code>Java</code> çš„ <code>-Duser.timezone=Asia/Shanghai</code> <code>JVM</code> å‚æ•°ï¼Œéƒ½å¯ä»¥æŒ‡å®šä¸Šå±‚åº”ç”¨æ—¶åŒºï¼Œè€Œä¸ä¾èµ–äºç³»ç»Ÿé»˜è®¤æ—¶åŒºï¼Œè¿™ä¹Ÿæ˜¯æ¨èçš„åšæ³•ã€‚é¿å…ç³»ç»Ÿéƒ¨ç½²æ—¶å—ç³»ç»Ÿæ—¶åŒºå½±å“ï¼Œè¿™åœ¨å…¨çƒäº‘æœåŠ¡å™¨ç¯å¢ƒä¸­å…¶å®å¾ˆå¸¸è§ï¼Œå› æ­¤å°½é‡åœ¨åº”ç”¨å±‚è®¾ç½®å¥½ã€‚å¾ˆå¤šåº”ç”¨éƒ½æœ‰è‡ªå·±çš„æ—¶åŒºè®¾ç½®ï¼Œåº”è¯¥å»äº†è§£ä¸€ä¸‹å¹¶ä¸”è¿›è¡Œè®¾ç½®ï¼Œä¸è¦æ€»ç”¨é»˜è®¤å€¼ã€‚</p>
<p>ä¸€äº›äººåœ¨é…ç½®æœåŠ¡çš„æ—¶å€™å¾ˆæ‡’æƒ°ï¼Œåªè¦é»˜è®¤èƒ½ç”¨å³å¯ï¼Œè€Œä¸ä¼šä¸€ä¸€æ£€æŸ¥æ¯ä¸€ä¸ªé…ç½®çš„é»˜è®¤å€¼æ˜¯å¦å’Œè‡ªå·±æœŸæœ›ä¸€è‡´ï¼Œè¿™æ˜¯å¾ˆä¸ä¸“ä¸šçš„åšæ³•ï¼Œæ­£æ˜¯è¿™ç§ä¸ä¸“ä¸šæ‰å¯¼è‡´äº†å‡ºç°äº†è¿™ç§é—®é¢˜ã€‚æ‰€ä»¥åšäº‹æƒ…ï¼Œä¸€å®šè¦è®©è‡ªå·±ä»¥ä¸“ä¸šçš„è§†è§’å’Œæ€åº¦çœ‹é—®é¢˜ã€‚</p>
<h3 id="æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè·-SIGTERM-ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ"><a href="#æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè·-SIGTERM-ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ" class="headerlink" title="æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè· SIGTERM ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ"></a>æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè· <code>SIGTERM</code> ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ</h3><p><code>docker stop</code>, <code>docker service rm</code> åœ¨åœæ­¢å®¹å™¨æ—¶ï¼Œéƒ½ä¼šå…ˆå‘ <code>SIGTERM</code> ä¿¡å·ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰åï¼Œå¦‚æœç¨‹åºæ²¡å“åº”ï¼Œåˆ™å¼ºè¡Œ <code>SIGKILL</code> æ€æ‰è¿›ç¨‹ã€‚</p>
<p>è¿™æ ·åº”ç”¨è¿›ç¨‹å°±æœ‰æœºä¼šå¹³æ»‘é€€å‡ºï¼Œåœ¨æ¥æ”¶åˆ° <code>SIGTERM</code> åï¼Œå¯ä»¥å» Flush ç¼“å­˜ã€å®Œæˆæ–‡ä»¶è¯»å†™ã€å…³é—­æ•°æ®åº“è¿æ¥ã€é‡Šæ”¾æ–‡ä»¶èµ„æºã€é‡Šæ”¾é”ç­‰ç­‰ï¼Œç„¶åå†é€€å‡ºã€‚æ‰€ä»¥è¯•å›¾æˆªè· <code>SIGTERM</code> ä¿¡å·çš„åšæ³•æ˜¯å¯¹çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¯èƒ½åœ¨æˆªè· <code>SIGTERM</code> æ—¶å´å‘ç°ï¼Œå´å‘ç°åº”ç”¨å¹¶æ²¡æœ‰æ”¶åˆ° <code>SIGTERM</code>ï¼Œäºæ˜¯ç›²ç›®çš„è®¤ä¸º Docker ä¸æ”¯æŒå¹³æ»‘é€€å‡ºï¼Œå…¶å®å¹¶éå¦‚æ­¤ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬æåˆ°è¿‡ï¼Œ<strong>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨åªæ˜¯å—é™è¿›ç¨‹ï¼Œè€Œä¸€ä¸ªå®¹å™¨åªåº”è¯¥è·‘ä¸€ä¸ªä¸»è¿›ç¨‹</strong>çš„è¯´æ³•ä¹ˆï¼Ÿå¦‚æœä½ å‘ç°ä½ çš„ç¨‹åºæ²¡æœ‰æˆªè·åˆ° <code>SIGTERM</code>ï¼Œé‚£å°±å¾ˆå¯èƒ½ä½ æ²¡æœ‰éµå¾ªè¿™ä¸ªæœ€ä½³å®è·µçš„åšæ³•ã€‚å› ä¸º <code>SIGTERM</code> åªä¼šå‘ç»™ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨å†… <code>PID</code> ä¸º <code>1</code> çš„è¿›ç¨‹ã€‚</p>
<p>è‡³äºè¯´ä¸»è¿›ç¨‹å¯åŠ¨çš„é‚£äº›å­è¿›ç¨‹ï¼Œå®Œå…¨çœ‹ä¸»è¿›ç¨‹æ˜¯å¦æ„¿æ„è½¬å‘ <code>SIGTERM</code> ç»™å­è¿›ç¨‹äº†ã€‚æ‰€ä»¥é‚£äº›æŠŠ Docker å½“åšè™šæ‹Ÿæœºç”¨çš„ï¼Œä¸»è¿›ç¨‹è·‘äº†ä¸ª <code>bash</code>ï¼Œç„¶å exec è¿›å»å¯åŠ¨ç¨‹åºçš„ï¼Œæˆ–è€…æ¥ä¸ª <code>&amp;</code> è®©ç¨‹åºè·‘åå°çš„æƒ…å†µï¼Œåº”ç”¨è¿›ç¨‹å¿…ç„¶æ— æ³•æ”¶åˆ° <code>SIGTERM</code>ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯åœ¨ <code>Dockerfile</code> ä¸­çš„ <code>CMD</code> é‚£è¡Œç”¨çš„æ˜¯ <code>shell</code> æ ¼å¼å†™çš„å‘½ä»¤ï¼Œè€Œä¸æ˜¯ <code>exec</code> æ ¼å¼ã€‚è¿˜è®°å¾—å‰é¢æåˆ°è¿‡çš„ <code>shell</code> æ ¼å¼çš„å‘½ä»¤ï¼Œä¼šåŠ ä¸€ä¸ª <code>sh -c</code> æ¥å»æ‰§è¡Œä¹ˆï¼Ÿå› æ­¤ä½¿ç”¨ <code>shell</code> æ ¼å¼å†™ <code>CMD</code> çš„æ—¶å€™ï¼Œ<code>PID</code> ä¸º <code>1</code> çš„è¿›ç¨‹æ˜¯ <code>sh</code>ï¼Œè€Œå®ƒä¸è½¬å‘ä¿¡å·ï¼Œæ‰€ä»¥ä¸»ç¨‹åºæ”¶ä¸åˆ°ã€‚</p>
<p>æ˜ç™½äº†é“ç†ï¼Œè§£å†³æ–¹æ³•å°±å¾ˆç®€å•ï¼Œæ¢æˆ <code>exec</code> æ ¼å¼ï¼Œå¹¶ä¸”å°†ä¸»è¿›ç¨‹æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨ç¬¬ä¸€ä½å³å¯ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¹‹å‰æ¨è <code>exec</code> æ ¼å¼çš„åŸå› ä¹‹ä¸€ã€‚</p>
<h1 id="Docker-Compose-ç›¸å…³é—®é¢˜-2"><a href="#Docker-Compose-ç›¸å…³é—®é¢˜-2" class="headerlink" title="Docker Compose ç›¸å…³é—®é¢˜ (2)"></a>Docker Compose ç›¸å…³é—®é¢˜ <code>(2)</code></h1><h2 id="ä½ é‚£ä¸ª-LNMP-ä¾‹å­ä¸­çš„-docker-compose-yml-ä¸­æœ‰å¥½å¤š-networksï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ"><a href="#ä½ é‚£ä¸ª-LNMP-ä¾‹å­ä¸­çš„-docker-compose-yml-ä¸­æœ‰å¥½å¤š-networksï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ" class="headerlink" title="ä½ é‚£ä¸ª LNMP ä¾‹å­ä¸­çš„ docker-compose.yml ä¸­æœ‰å¥½å¤š networksï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ"></a>ä½ é‚£ä¸ª <code>LNMP</code> ä¾‹å­ä¸­çš„ <code>docker-compose.yml</code> ä¸­æœ‰å¥½å¤š <code>networks</code>ï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ</h2><p>æˆ‘å†™çš„ <code>LNMP</code> å¤šå®¹å™¨äº’é€šçš„ä¾‹å­ï¼š<a href="https://coding.net/u/twang2218/p/docker-lnmp/git" target="_blank" rel="noopener">https://coding.net/u/twang2218/p/docker-lnmp/git</a></p>
<p>å‰é¢ <code>services</code> ä¸‹çš„æ¯ä¸ªæœåŠ¡ä¸‹é¢çš„ <code>networks</code>ï¼Œæ˜¯è¯´è¿™ä¸ªæœåŠ¡è¦æ¥åˆ°å“ªä¸ªç½‘ç»œä¸Šã€‚<br>è€Œæœ€åçš„é‚£ä¸ªæ€»çš„<code>networks</code>ä¸‹é¢çš„ï¼Œæ˜¯è¿™å‡ ä¸ªç½‘ç»œçš„å®šä¹‰ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>nginx</code> æ¥åˆ°äº†åä¸º <code>frontend</code> çš„å‰ç«¯ç½‘ç»œï¼›<code>mysql</code> æ¥åˆ°äº†åä¸º <code>backend</code> çš„åç«¯ç½‘ç»œï¼›è€Œä½œä¸ºä¸­é—´çš„ <code>php</code> æ—¢éœ€è¦å’Œ <code>nginx</code> é€šè®¯ï¼Œåˆéœ€è¦å’Œ <code>mysql</code> é€šè®¯ï¼Œæ‰€ä»¥åŒæ—¶è¿æ¥äº† <code>frontend</code> å’Œ <code>backend</code> ç½‘ç»œã€‚ç”±äº <code>nginx</code> å’Œ <code>mysql</code> ä¸å¤„äºåŒä¸€ç½‘ç»œï¼Œæ‰€ä»¥äºŒè€…æ— æ³•é€šè®¯ï¼Œèµ·åˆ°äº†éš”ç¦»çš„ä½œç”¨ã€‚</p>
<p>å…³äº Docker è‡ªå®šä¹‰ç½‘ç»œï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼š<br><a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/dockernetworks/#/user-defined-networks</a></p>
<p>å…³äºåœ¨ Docker Compose ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œçš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å®˜æ–¹è¿™éƒ¨åˆ†æ–‡æ¡£ï¼š<br><a href="https://docs.docker.com/compose/networking/" target="_blank" rel="noopener">https://docs.docker.com/compose/networking/</a></p>
<h2 id="ä½¿ç”¨-Compose-çš„æ—¶å€™ç¢°åˆ°-â€œAn-HTTP-request-took-too-long-to-completeâ€¦-â€-é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#ä½¿ç”¨-Compose-çš„æ—¶å€™ç¢°åˆ°-â€œAn-HTTP-request-took-too-long-to-completeâ€¦-â€-é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ä½¿ç”¨ Compose çš„æ—¶å€™ç¢°åˆ° â€œAn HTTP request took too long to completeâ€¦.â€ é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a>ä½¿ç”¨ Compose çš„æ—¶å€™ç¢°åˆ° â€œAn HTTP request took too long to completeâ€¦.â€ é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ</h2><p>Compose çš„è¯·æ±‚è¶…æ—¶æ—¶é™æ˜¯å¯ä»¥é…ç½®çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> COMPOSE_HTTP_TIMEOUT=120</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œè¿™ä¸æ˜¯é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œå› ä¸ºä¸€èˆ¬æƒ…å†µä¸‹ä¸åº”è¯¥è¶…æ—¶ï¼Œè¶…æ—¶çš„åŸå› æ˜¯å› ä¸ºæ‰€è®¿é—®çš„ Docker Engine è¿‡äºç¹å¿™ï¼Œè€Œæ— æ³•å“åº” Compose çš„è¯·æ±‚ã€‚åº”è¯¥æ£€æŸ¥å…·ä½“ Docker Engine å‡ºäº†ä»€ä¹ˆé—®é¢˜ï¼Œæ˜¯ä¸æ˜¯è¿˜åœ¨ç”¨ç€ <code>CentOS</code> é»˜è®¤çš„ <code>device mapper</code> çš„ <code>loop</code> è®¾å¤‡ï¼Œç­‰ç­‰ã€‚</p>
<h1 id="Docker-Swarm-ç›¸å…³é—®é¢˜-8"><a href="#Docker-Swarm-ç›¸å…³é—®é¢˜-8" class="headerlink" title="Docker Swarm ç›¸å…³é—®é¢˜ (8)"></a>Docker Swarm ç›¸å…³é—®é¢˜ <code>(8)</code></h1><h2 id="æˆ‘çš„-Docker-ç‰ˆæœ¬æ˜¯-1-12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£-Swarm-è¿˜æ˜¯äºŒä»£-Swarm-å•Šï¼Ÿ"><a href="#æˆ‘çš„-Docker-ç‰ˆæœ¬æ˜¯-1-12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£-Swarm-è¿˜æ˜¯äºŒä»£-Swarm-å•Šï¼Ÿ" class="headerlink" title="æˆ‘çš„ Docker ç‰ˆæœ¬æ˜¯ 1.12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£ Swarm è¿˜æ˜¯äºŒä»£ Swarm å•Šï¼Ÿ"></a>æˆ‘çš„ Docker ç‰ˆæœ¬æ˜¯ 1.12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£ Swarm è¿˜æ˜¯äºŒä»£ Swarm å•Šï¼Ÿ</h2><p>â€¦â€¦è‡ªå·±è¿è¡Œçš„ Swarm æ€ä¹ˆä¼šè¿è‡ªå·±éƒ½ä¸çŸ¥é“è·‘çš„æ˜¯å•¥ï¼ŸğŸ˜…</p>
<p>é¦–å…ˆï¼Œè‡³äºæ˜¯è¿è¡Œçš„ä¸€ä»£ Swarm è¿˜æ˜¯äºŒä»£ Swarmï¼Œå•çœ‹ç‰ˆæœ¬æ˜¯æ²¡æ„ä¹‰çš„ã€‚<strong>Docker 1.12+ çš„ç‰ˆæœ¬åŒæ—¶æ”¯æŒä¸€ä»£ Swarm å’ŒäºŒä»£ Swarm</strong>ã€‚</p>
<p>å¦‚æœæ˜¯ä½¿ç”¨å®¹å™¨å½¢å¼è¿è¡Œçš„ Swarmï¼Œä¹Ÿå°±æ˜¯ <code>docker run swarm</code> å½¢å¼æ„å»ºçš„ Swarmï¼Œè¿™æ˜¯<strong>ä¸€ä»£ Swarm</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º <strong>Docker Swarm</strong>ã€‚</p>
<p>å¦‚æœæ˜¯ä½¿ç”¨å†…ç½®å‘½ä»¤å½¢å¼æ„å»ºçš„ Swarmï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨å‘½ä»¤ <code>docker swarm init</code> å½¢å¼æ„å»ºçš„ Swarmï¼Œè¿™æ˜¯å†…ç½®çš„ Swarmï¼Œæ˜¯<strong>äºŒä»£ Swarm</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º <strong>Docker Swarm Mode</strong>ã€‚</p>
<h2 id="Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ"><a href="#Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ" class="headerlink" title="Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ"></a>Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ</h2><p>æ¯ä¸ª Docker Host å»ºç«‹æ—¶éƒ½å¯ä»¥é€šè¿‡ <code>--label</code> æŒ‡å®šå…¶ Docker å¼•æ“çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dockerd \</span><br><span class="line">    --label com.example.environment=<span class="string">"production"</span> \</span><br><span class="line">    --label com.example.storage=<span class="string">"ssd"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„é…ç½®å‚æ•°åº”è¯¥é…ç½®åœ¨ <code>Docker</code> å¼•æ“çš„é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ï¼Œå¦‚ <code>docker.service</code>ï¼Œè€Œä¸æ˜¯ç®€å•çš„å‘½ä»¤è¡Œæ‰§è¡Œâ€¦â€¦</p>
</blockquote>
<p>ç„¶åè¿è¡Œå®¹å™¨æ—¶ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡çº¦æŸè°ƒåº¦å³å¯ã€‚å¯ä»¥ä½¿ç”¨ Compose æ–‡ä»¶çš„ <code>environment</code> é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>docker run</code> çš„ <code>-e</code> ç¯å¢ƒå˜é‡å‚æ•°ã€‚ä¸‹é¢ä»¥ Compose é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"2"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  mongodb:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="attr">mongo:latest</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"constraint:com.example.storage==ssd"</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è¿™ä¸ª <code>mongodb</code> çš„æœåŠ¡å°±ä¼šè¿è¡Œåœ¨æ ‡è®°ä¸º <code>com.example.storage=&quot;ssd&quot;</code> çš„å®¿ä¸»ä¸Šè¿è¡Œã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆ-Swarm-é›†ç¾¤çš„-overlay-network-è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Swarm-é›†ç¾¤çš„-overlay-network-è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Swarm é›†ç¾¤çš„ overlay network è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Swarm é›†ç¾¤çš„ overlay network è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ</h2><p>é¦–å…ˆï¼Œæ£€æŸ¥å»ºç«‹ Swarm çš„æ—¶å€™ï¼Œå¯¹å…¶å®ƒèŠ‚ç‚¹æ‰€å®£å‘Šçš„æœ¬èŠ‚ç‚¹çš„åœ°å€æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>å¯¹äºå•ç½‘å¡ã€å•IPçš„å®¿ä¸»ï¼ŒSwarm ä¼šè‡ªåŠ¨é€‰æ‹©ç½‘å¡åœ°å€ï¼Œä½†æ˜¯å¤šç½‘å¡ã€å¤šIPçš„å®¿ä¸»ï¼Œå°±å¿…é¡»æ‰‹åŠ¨å®£å‘Šåœ°å€ã€‚</p>
<ul>
<li>å¯¹äºä¸€ä»£ Swarm è€Œè¨€ï¼Œæ£€æŸ¥ä¸€ä¸‹ <code>dockerd</code> çš„é…ç½®ä¸­ï¼Œ<code>--cluster-advertise</code> åœ°å€æ˜¯å¦é…ç½®æ­£ç¡®ã€‚</li>
<li>å¯¹äºäºŒä»£ Swarmï¼Œåˆ™æ£€æŸ¥ä¸€ä¸‹åˆ›å»ºã€åŠ å…¥ Swarm çš„æ—¶å€™ï¼Œ<code>--advertise-addr</code> æ˜¯å¦å¡«å†™æ­£ç¡®ã€‚</li>
</ul>
<p>å®£å‘Šåœ°å€å¿…é¡»æ˜¯å…¨é›†ç¾¤å¯ä»¥äº’è®¿çš„ï¼Œç”±äºè¯¥åœ°å€ç«¯å£æ˜¯ <code>Docker Remote API</code> ç«¯å£ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ <code>curl</code> æ¥è¿æ¥å…¶å®ƒèŠ‚ç‚¹ï¼Œä»¥åˆ¤æ–­äº’é€šæ€§ã€‚</p>
<p>ç„¶åï¼Œæ£€æŸ¥å®¿ä¸»é—´çš„ç½‘ç»œäº’é€šé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å®¿ä¸»çš„é˜²ç«å¢™å¼€å¯çš„æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ä¸‹åˆ—æœåŠ¡ç«¯å£æœ‰æ²¡æœ‰æ”¾å¼€ï¼š</p>
<ul>
<li><code>7946/{udp,tcp}</code></li>
<li><code>4789/{udp,tcp}</code></li>
<li>{<code>2375</code>,<code>2376</code>,<code>2377</code>,<code>3375</code>,<code>3376</code>}/<code>tcp</code> ï¼ˆå…·ä½“ç«¯å£å–å†³äºå®é™… <code>Swarm</code> æˆ– <code>Engine</code> å®ˆæŠ¤ç«¯å£)</li>
</ul>
<p>å¯ä»¥é€šè¿‡ <code>telnet</code>, <code>curl</code> ä¹‹ç±»çš„å·¥å…·ç¡®ä¿ä¸Šè¿°ç«¯å£å¯ä»¥äº’è®¿ã€‚</p>
<p>å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯ä»¥è¿›ä¸€æ­¥å¯ç”¨å„ä¸ªèŠ‚ç‚¹çš„ Docker å¼•æ“çš„è°ƒè¯•æ¨¡å¼ã€‚å’Œé…ç½® <code>--insecure-registry</code> çš„æ–¹æ³•ä¸€æ ·ï¼Œç¼–è¾‘ Docker é…ç½®æ–‡ä»¶ï¼Œåœ¨ <code>dockerd</code> åæ·»åŠ  <code>-D</code> å‚æ•°ã€‚ç„¶åé‡æ–°å¯åŠ¨ Docker å¼•æ“ï¼Œå»ºç«‹é›†ç¾¤ã€ç½‘ç»œã€æœåŠ¡ã€‚å¦‚æœé—®é¢˜é‡ç°ï¼Œå¯ä»¥åˆ†æ <code>Docker</code> å¼•æ“çš„æ—¥å¿—ï¼Œå…·ä½“æŸ¥çœ‹æ—¥å¿—çš„æ–¹æ³•è§å‰é¢çš„é—®ç­”ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ <code>1.13</code> ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œè·¨å®¿ä¸»çš„æƒ…å†µä¸‹ï¼Œæ— æ³•åœ¨å®¹å™¨å†… <code>ping</code> åˆ°å¦ä¸€ä¸ªæœåŠ¡çš„ <code>VIP</code>ï¼Œè¿™ç§æƒ…å†µï¼Œå¯ä»¥ <code>ping tasks.&lt;æœåŠ¡å&gt;</code>ï¼Œæ¥è·³è¿‡ <code>VIP</code> è¿›è¡Œ <code>ping</code>ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://docs.docker.com/swarm/plan-for-production/" target="_blank" rel="noopener">https://docs.docker.com/swarm/plan-for-production/</a></p>
<p><a href="https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/swarm-tutorial/#/open-ports-between-the-hosts</a></p>
<p><a href="https://docs.docker.com/engine/swarm/networking/" target="_blank" rel="noopener">https://docs.docker.com/engine/swarm/networking/</a></p>
<h2 id="Docker-äºŒä»£Swarm-æ—¢-Swarm-Mode-ï¼Œdocker-service-create-ä¸å¯ä»¥ä½¿ç”¨-v-é‚£æ€ä¹ˆä½¿ç”¨å·-Volume-ï¼Ÿ"><a href="#Docker-äºŒä»£Swarm-æ—¢-Swarm-Mode-ï¼Œdocker-service-create-ä¸å¯ä»¥ä½¿ç”¨-v-é‚£æ€ä¹ˆä½¿ç”¨å·-Volume-ï¼Ÿ" class="headerlink" title="Docker äºŒä»£Swarm (æ—¢ Swarm Mode)ï¼Œdocker service create ä¸å¯ä»¥ä½¿ç”¨ -v é‚£æ€ä¹ˆä½¿ç”¨å·(Volume)ï¼Ÿ"></a>Docker äºŒä»£Swarm (æ—¢ Swarm Mode)ï¼Œ<code>docker service create</code> ä¸å¯ä»¥ä½¿ç”¨ <code>-v</code> é‚£æ€ä¹ˆä½¿ç”¨å·(Volume)ï¼Ÿ</h2><p>ä»äºŒä»£ Swarm å¼€å§‹ï¼Œå°†ä½¿ç”¨ <code>--mount</code> å‚æ•°æ¥è¿›è¡Œå·æŒ‚è½½ï¼Œå¹¶ä¸”å¯¹è¯­ä¹‰è¿›è¡Œæ›´æ˜ç¡®çš„åˆ’åˆ†ã€‚</p>
<p>æŒ‚è½½åˆ†ä¸¤ç§ï¼š</p>
<ul>
<li>ç»‘å®šæŒ‚è½½ <code>bind-mount</code>ï¼šè¿™ç±»æŒ‚è½½å°†å®¿ä¸»ç›®å½•/æ–‡ä»¶ç»‘å®šåˆ°å®¹å™¨çš„æŸä¸ªä½ç½®ã€‚è¿™ç±»æŒ‚è½½éœ€è¦æ³¨æ„å®¿ä¸»å’Œå®¹å™¨çš„ä¸åŒuidå¯¼è‡´çš„æƒé™ã€è®¿é—®æ§åˆ¶å·®å¼‚é—®é¢˜ã€‚</li>
<li>æ•°æ®å· <code>data volumes</code>ï¼šè¿™ç±»æŒ‚è½½æ˜¯ä¹‹å‰æ¨èä½¿ç”¨çš„å·ã€‚å·å¯ä»¥åˆ†ä¸ºå‘½åå·<code>named volume</code>ä»¥åŠåŒ¿åå·<code>anonymous volume</code></li>
</ul>
<p>æŒ‚è½½å‚æ•°çš„æ ¼å¼åŸºæœ¬ä¸Šä¸º <code>--mount &lt;key1&gt;=&lt;value1&gt;[,&lt;key2&gt;=&lt;value2&gt;,...]</code>ã€‚</p>
<p>ä¸»è¦å‚æ•°æœ‰ï¼š</p>
<ul>
<li><code>type</code>: å¦‚ä¹‹å‰æ‰€è¯´ï¼Œä¸¤ç§ç±»å‹ï¼š <code>volume</code> å’Œ <code>bind</code>ã€‚å¦‚æœä¸æŒ‡å®š <code>type</code>ï¼Œé»˜è®¤ä¸º <code>volume</code>ï¼›</li>
<li><code>src</code> æˆ– <code>source</code>ï¼šæºï¼š<ul>
<li>å¦‚æœ <code>type=volume</code>ï¼Œ<code>src</code> åˆ™æ˜¯å·çš„åå­—ï¼Œæ˜¯å¯é€‰é¡¹ã€‚å¦‚æœå­˜åœ¨å°±æ˜¯å‘½åå·ï¼Œå¦‚æœæ²¡æŒ‡å®š <code>src</code> åˆ™æ˜¯åŒ¿åå·ï¼›</li>
<li>å¦‚æœ <code>type=bind</code>ï¼Œ<code>src</code> æ˜¯å®¿ä¸»æœ¬åœ°çš„è·¯å¾„ï¼›</li>
</ul>
</li>
<li><code>dst</code> æˆ– <code>destination</code> æˆ– <code>target</code>ï¼šå°†åœ¨å®¹å™¨å†…æŒ‚è½½çš„è·¯å¾„ã€‚å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œä¼šåœ¨æŒ‚è½½å‰è‡ªåŠ¨å»ºç«‹è·¯å¾„ã€‚</li>
<li><code>readonly</code> æˆ– <code>ro</code>ï¼šæ˜¯å¦è®©è¯¥æŒ‚è½½ä¸ºåªè¯»ï¼Œé»˜è®¤æ˜¯è¯»å†™ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›å¸¸è§çš„å‚æ•°å¯ä»¥è®¾ç½®ï¼š</p>
<ul>
<li><code>volume-driver</code>ï¼šæŒ‡å®šå·é©±åŠ¨ï¼Œé»˜è®¤æ˜¯ <code>local</code>ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æŒ‡å®šå…¶å®ƒï¼ˆå¦‚ <code>flocker</code>, <code>glusterfs</code>, <code>ceph</code>ï¼‰ä¹‹ç±»çš„é©±åŠ¨ï¼›</li>
<li><code>volume-label</code>ï¼šæŒ‡å®šå·çš„å…ƒæ•°æ®(metadata)ï¼Œä»è€Œæ–¹ä¾¿è¿‡æ»¤æ“ä½œï¼›</li>
<li><code>volume-opt</code>ï¼šä¸åŒçš„å·é©±åŠ¨å¯èƒ½éœ€è¦é¢å¤–çš„å‚æ•°ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥æŒ‡å®šè¿™äº›å‚æ•°ã€‚</li>
</ul>
<p><code>--mount</code> å’Œ <code>--volume</code> æœ‰ä¸€äº›å·®å¼‚éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><code>--mount</code> å¯ä»¥ç›´æ¥ä½¿ç”¨å·ï¼Œè€Œæ— éœ€äº‹å…ˆä½¿ç”¨ <code>docker volume create</code> æ¥åˆ›å»ºå·ï¼Œå¹¶ä¸”å¯ä»¥å¤šç»„ä¸åŒé©±åŠ¨çš„å·ï¼›</li>
<li><code>--mount</code> å¦‚æœ <code>type=bind</code> çš„è¯ï¼Œå®¿ä¸»å¿…é¡»å­˜åœ¨æŒ‡å®šç›®å½•ï¼Œå¦åˆ™æŠ¥é”™ã€‚è€Œ <code>--volume</code> åˆ™åœ¨å®¿ä¸»ä¸å­˜åœ¨è¯¥è·¯å¾„æ—¶ï¼Œåœ¨å®¿ä¸»åˆ›å»ºä¸€ä¸ªç©ºç›®å½•æ¥è¿›è¡Œç»‘å®šã€‚</li>
</ul>
<p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p>
<p>æŒ‚è½½å‘½åå·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name my-service \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=my-volume,destination=/path/<span class="keyword">in</span>/container,volume-label=<span class="string">"color=red"</span>,volume-label=<span class="string">"shape=round"</span> \</span><br><span class="line">  nginx:alpine</span><br></pre></td></tr></table></figure>
<p>æŒ‚è½½åŒ¿åå·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line">  --name my-service \</span><br><span class="line">  --replicas 3 \</span><br><span class="line">  --mount <span class="built_in">type</span>=volume,destination=/path/<span class="keyword">in</span>/container \</span><br><span class="line">  nginx:alpine</span><br></pre></td></tr></table></figure>
<p>ç»‘å®šå®¿ä¸»ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker service create \</span><br><span class="line"> --name my-service \</span><br><span class="line"> --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=/path/on/host,destination=/path/<span class="keyword">in</span>/container \</span><br><span class="line"> nginx:alpine</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/service_create/#/add-bind-mounts-or-volumes</a></p>
<h2 id="å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ-replicas-2-å’Œ-mode-global-æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ"><a href="#å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ-replicas-2-å’Œ-mode-global-æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ" class="headerlink" title="å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ--replicas=2 å’Œ --mode=global æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ"></a>å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ<code>--replicas=2</code> å’Œ <code>--mode=global</code> æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ</h2><p>é¦–å…ˆï¼ŒäºŒè€…è¯­ä¹‰å°±ä¸åŒã€‚</p>
<ul>
<li><code>--replicas=2</code>ï¼Œæ˜¯è¦æ±‚è¯¥æœåŠ¡æœ‰2ä¸ªå‰¯æœ¬ï¼Œæ— è®ºé›†ç¾¤å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿä¸åœ¨ä¹è¿™ä¸¤ä¸ªå‰¯æœ¬æ˜¯ä¸æ˜¯éƒ½è·‘åœ¨ä¸€ä¸ªå®¿ä¸»ä¸Šï¼Œæ‰€ä»¥æ— æ³•ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªå‰¯æœ¬ï¼›</li>
<li><code>--mode=global</code>ï¼Œæ˜¯è¦æ±‚æœåŠ¡åœ¨é›†ç¾¤æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ªå‰¯æœ¬ã€‚</li>
</ul>
<p>ç°è±¡ä¸Šä¹Ÿä¸ä¸€æ ·ï¼Œ<code>--replicas=2</code> æ˜¯è¦ç¡®ä¿å‰¯æœ¬ä¸º2ä¸ªã€‚é‚£ä¹ˆå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œä¼šåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåœ¨èµ·ä¸€ä¸ªå‰¯æœ¬ï¼Œä»è€Œç¡®ä¿å‰¯æœ¬æ•°ä¸º2ã€‚è€Œå¯¹äº <code>--mode=global</code> æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œä¸ä¼šå†å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šèµ·ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
<h2 id="ä¸€ä»£-Swarm-çš„æ—¶å€™å¯ä»¥ç”¨-docker-run-å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª-docker-service-create-å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ"><a href="#ä¸€ä»£-Swarm-çš„æ—¶å€™å¯ä»¥ç”¨-docker-run-å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª-docker-service-create-å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ" class="headerlink" title="ä¸€ä»£ Swarm çš„æ—¶å€™å¯ä»¥ç”¨ docker run å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª docker service create å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ"></a>ä¸€ä»£ Swarm çš„æ—¶å€™å¯ä»¥ç”¨ <code>docker run</code> å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª <code>docker service create</code> å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</h2><p>å› ä¸º <code>docker run</code> å’Œ <code>docker service create</code> æ˜¯ä¸¤ä¸ªä¸åŒç†å¿µçš„ä¸œè¥¿ã€‚</p>
<p>ä¸€ä»£ Swarm ä¸­ï¼Œå°† Swarm é›†ç¾¤è§†ä¸ºä¸€ä¸ªå·¨å¤§çš„ Docker ä¸»æœºï¼Œæœ¬è´¨ä¸Šå’Œå•æœºæ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ç›´æ¥è°ƒåº¦è¿è¡Œå®¹å™¨ã€‚å› æ­¤ä¾æ—§ä½¿ç”¨å•æœºçš„ <code>docker run</code> çš„æ–¹å¼æ¥å¯åŠ¨ç‰¹å®šå®¹å™¨ã€‚</p>
<p>äºŒä»£ Swarm åˆ™æ”¹å˜äº†è¿™ä¸ªç†å¿µï¼Œå¢åŠ äº†æœåŠ¡æ ˆ(<code>Stack</code>)ã€æœåŠ¡(<code>Service</code>)ã€ä»»åŠ¡(<code>Task</code>) çš„æ¦‚å¿µã€‚åœ¨äºŒä»£ Swarm ä¸­ï¼Œä¸€ç»„æœåŠ¡å¯ä»¥ç»„æˆä¸€ä¸ªæ•´ä½“è¿›è¡Œéƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯éƒ¨ç½²æœåŠ¡æ ˆï¼Œè¿™ç›¸å½“äºæ˜¯ä¹‹å‰çš„ Docker Compose æ‰€å®Œæˆçš„ç›®çš„ã€‚ä½†æ˜¯è¿™æ¬¡ï¼Œæ˜¯çœŸæ­£çš„é’ˆå¯¹<strong>æœåŠ¡</strong>çš„ã€‚</p>
<p>ä¸€ä¸ª<strong>æœåŠ¡</strong>å¹¶éä¸€ä¸ª<strong>å®¹å™¨</strong>ï¼Œä¸€ä¸ªæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬<strong>ä»»åŠ¡</strong>ï¼Œæ¯ä¸ªä»»åŠ¡å¯¹åº”ä¸€ä¸ªå®¹å™¨ã€‚è¿™ä¸ªæ¦‚å¿µåœ¨ä¸€ä»£ Swarm å’Œå•æœºç¯å¢ƒä¸­æ˜¯æ²¡æœ‰çš„ï¼Œå› æ­¤ Docker Compose ä¸ºäº†å®ç°æœåŠ¡çš„æ¦‚å¿µï¼Œç”¨äº†å„ç§åŠæ³•å»æ¨¡æ‹Ÿï¼ŒåŒ…æ‹¬ä½¿ç”¨ <code>labels</code>ï¼Œä½¿ç”¨ç½‘ç»œåˆ«åç­‰ç­‰ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šï¼Œä¾æ—§æ˜¯ä»¥å®¹å™¨ä¸ºå•ä½è¿›è¡Œè¿è¡Œï¼Œä¹Ÿå°±æ˜¯æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ç»„ <code>docker run</code>ã€‚</p>
<p>æ­£æ˜¯ç”±äºäºŒä»£ Swarm ä¸­ç”¨æˆ·æ“ä½œçš„å•å…ƒæ˜¯æœåŠ¡ï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„ä»¥å®¹å™¨ä¸ºä¸­å¿ƒçš„ <code>docker run</code> å°±ä¸å†é€‚ç”¨ï¼Œå› æ­¤æœ‰æ–°çš„ä¸€ç»„é’ˆå¯¹æœåŠ¡çš„å‘½ä»¤ï¼Œ<code>docker service</code>ã€‚</p>
<h2 id="docker-service-ps-é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ"><a href="#docker-service-ps-é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ" class="headerlink" title="docker service ps é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ"></a><code>docker service ps</code> é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ</h2><p>ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´äºŒä»£ Swarm åï¼Œç‰¹åˆ«æ˜¯ç»´æŠ¤äº†å‡ æ¬¡æœåŠ¡åï¼Œä¼šå‘ç° <code>docker service ps</code> ä¸­æ˜¾ç¤ºäº†å¾ˆå¤šä¹‹å‰å¤±è´¥çš„å®¹å™¨è®°å½•ï¼Œå¾ˆæ˜¯çƒ¦äººã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps web                                                                                                       [e641012]</span><br><span class="line">NAME                    IMAGE                NODE  DESIRED STATE  CURRENT STATE                ERROR                             PORTS</span><br><span class="line">web.1.uultetkovwch      nginx:1.11.3-alpine  moby  Running        Running 43 seconds ago</span><br><span class="line">\_ web.1.etb0jpr21mhe  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.1.uhyl9158ldf9  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.1.mwallx77rc3m  nginx:1.11.1-alpine  moby  Shutdown       Shutdown about a minute ago</span><br><span class="line">\_ web.1.zmyvszvv21ak  nginx:1.10-alpine    moby  Shutdown       Shutdown 3 minutes ago</span><br><span class="line">web.2.dp0imr8kbmad      nginx:1.11.3-alpine  moby  Running        Running 43 seconds ago</span><br><span class="line">\_ web.2.0xzwj9o8kfzn  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.2.mk3g1l5js4ph  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.2.v9x98vxma1q3  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.2.vo5mvyux3vok  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">web.3.cc3mrji1dlz2      nginx:1.11.3-alpine  moby  Running        Running 42 seconds ago</span><br><span class="line">\_ web.3.uvubn2pdceaa  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.3.mt7xwl4a0bii  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.3.cdseizjlnzoj  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.3.kwlz5mxbu2t6  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">web.4.zoadbqu3wtzf      nginx:1.11.3-alpine  moby  Running        Running 42 seconds ago</span><br><span class="line">\_ web.4.u6p58nzxlib9  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such container: web.4.u6p5â€¦"</span></span><br><span class="line">\_ web.4.kf420b73lwcc  nginx:1.11.2-alpine  moby  Shutdown       Rejected about a minute ago  <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.4.tzzmc1zuffn7  nginx:1.11.2-alpine  moby  Shutdown       Rejected 2 minutes ago       <span class="string">"No such image: nginx:1.11.2-aâ€¦"</span></span><br><span class="line">\_ web.4.mccsks74u370  nginx:1.11.1-alpine  moby  Shutdown       Shutdown 2 minutes ago</span><br><span class="line">web.5.u0i5cnh0m5jb      nginx:1.11.3-alpine  moby  Running        Running 39 seconds ago</span><br><span class="line">\_ web.5.xzv6o5hoxjay  nginx:1.11.1-alpine  moby  Shutdown       Shutdown 41 seconds ago</span><br><span class="line">\_ web.5.f0ssiwebempk  nginx:1.10-alpine    moby  Shutdown       Shutdown 3 minutes ago</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°é‚£äº›å†å²ä¸Šè¿è¡Œè¿‡çš„å®¹å™¨ï¼Œå®ƒä»¬å½“ç„¶å·²ç»åœæ­¢è¿è¡Œï¼Œä¿ç•™åœ¨è¿™é‡Œæ˜¯ä¸ºäº†å¸®åŠ©è¿›è¡ŒæœåŠ¡æ’éšœï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šä¿ç•™æœ€å 5 ä¸ªå®¹å™¨å†å²ï¼Œå…¶ä½™çš„ä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨é›†ç¾¤å»ºç«‹æ—¶(<code>docker swarm init</code>)æˆ–è€…æ›´æ–°æ—¶(<code>docker swarm update</code>)ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>--task-history-limit</code> æ¥è°ƒæ•´ã€‚</p>
<p>ä½†æ˜¯ä¸è¦å› ä¸ºåªæ˜¯çœ‹ç€ä¹±ï¼Œå°±å°†å†å²è®°å½•è®¾çš„å¾ˆå°‘ï¼Œå› ä¸ºå†å²è®°å½•çš„å­˜åœ¨æ˜¯æœ‰åŸå› çš„ï¼Œå¯ä»¥é€šè¿‡å†å²è®°å½•æ¥è¿›è¡Œæ’éšœã€‚å¦‚æœæ²¡æœ‰è¿™äº›ä¿¡æ¯ï¼Œåœ¨å°†æ¥ç»´æŠ¤å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œæ•…éšœæ ¹æœ¬æ— ä»æŸ¥èµ·ã€‚</p>
<p>å¦‚æœåªæ˜¯è§‰å¾—çœ‹ç€ä¹±è€Œä¸æƒ³æ˜¾ç¤ºï¼Œç›´æ¥ç”¨ <code>--filter</code> åŠ è¿‡æ»¤å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps -f <span class="string">'desired-state=running'</span> web                                                                            [e641012]</span><br><span class="line">NAME                IMAGE                NODE  DESIRED STATE  CURRENT STATE           ERROR  PORTS</span><br><span class="line">web.1.uultetkovwch  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.2.dp0imr8kbmad  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.3.cc3mrji1dlz2  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.4.zoadbqu3wtzf  nginx:1.11.3-alpine  moby  Running        Running 11 minutes ago</span><br><span class="line">web.5.u0i5cnh0m5jb  nginx:1.11.3-alpine  moby  Running        Running 10 minutes ago</span><br></pre></td></tr></table></figure>
<h2 id="æ€ä¹ˆæ‰èƒ½è®©-docker-service-create-åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ"><a href="#æ€ä¹ˆæ‰èƒ½è®©-docker-service-create-åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ" class="headerlink" title="æ€ä¹ˆæ‰èƒ½è®© docker service create åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ"></a>æ€ä¹ˆæ‰èƒ½è®© <code>docker service create</code> åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ</h2><p>æœ‰äº›æ—¶å€™ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚æœåŠ¡æ˜¯ç”±åº”ç”¨å±‚çš„è¿œç¨‹æ§åˆ¶æŒ‡ä»¤å…³é—­çš„ï¼Œè¿™ç§è¿›ç¨‹é€€å‡ºæ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå¹¶éé”™è¯¯ã€‚ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦å®¹å™¨é€€å‡ºï¼Œå¼•æ“å°±è§†ä¸ºå¼‚å¸¸ï¼Œå°±ä¼šå°è¯•é‡æ–°è°ƒåº¦å¯åŠ¨è¿™ä¸ªå®¹å™¨ã€‚è¿™ä¼šå¯¼è‡´æ˜æ˜å…³äº†çš„æœåŠ¡ï¼Œåˆè¢«å¯åŠ¨äº†ã€‚</p>
<p>è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ <code>--restart-condition=on-failure</code> å‚æ•°ï¼Œè¿™æ ·åªæœ‰åœ¨ä¸»è¿›ç¨‹é€€å‡ºç ä¸º <strong>é 0</strong> çš„æ—¶å€™ï¼Œæ‰ä¼šé‡å¯ï¼Œè€Œæ­£å¸¸é€€å‡ºï¼ˆ<code>exited code = 0</code>) æ— éœ€é‡å¯ã€‚</p>
<h1 id="Docker-Machine-ç›¸å…³é—®é¢˜-5"><a href="#Docker-Machine-ç›¸å…³é—®é¢˜-5" class="headerlink" title="Docker Machine ç›¸å…³é—®é¢˜ (5)"></a>Docker Machine ç›¸å…³é—®é¢˜ <code>(5)</code></h1><h2 id="æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥-boot2docker-isoï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥-boot2docker-isoï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥ boot2docker.isoï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a>æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥ <code>boot2docker.iso</code>ï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ</h2><p>è£…äº† Docker Toolbox çš„ Windows ç”¨æˆ·ï¼Œæˆ–è€…ç¬¬ä¸€æ¬¡ä½¿ç”¨ <code>docker-machine</code> åˆ›å»ºæœ¬åœ° VirtualBox è™šæ‹Ÿæœºçš„ç”¨æˆ·ï¼Œç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„æŠ¥é”™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(default) Latest release <span class="keyword">for</span> github.com/boot2docker/boot2docker is v17.06.2-ce</span><br><span class="line">(default) Downloading /Users/jessie/.docker/machine/cache/boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v17.06.2-ce/boot2docker.iso...</span><br></pre></td></tr></table></figure>
<p>ç„¶åç»è¿‡æ¼«é•¿çš„ç­‰å¾…åï¼Œè¯´è¶…æ—¶ã€æˆ–è€…ä¸‹è½½å¤±è´¥ï¼Œæœ€ååˆ›å»ºè™šæ‹Ÿæœºå¤±è´¥ã€‚</p>
<p>è¿™é¦–å…ˆè¿˜æ˜¯å…ˆå»<em>æ„Ÿè°¢</em>ä¼Ÿå¤§çš„å¢™åŠå…¶äº²å±ï¼Œæ²¡æœ‰ä»–ä»¬çš„ä½œç¥Ÿï¼Œè¿™ä¸ªé”™è¯¯åŸºæœ¬å‡ºç°ä¸äº†ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Docker æ˜¯åŸºäº Linux å†…æ ¸çš„ã€‚å› æ­¤åœ¨ Windows ç¯å¢ƒä¸­ï¼ŒDocker Toolbox ä¼šä½¿ç”¨ Docker Machine å»ºç«‹ä¸€ä¸ªåä¸º <code>default</code> çš„ VirtualBox Linux è™šæ‹Ÿæœºï¼Œæ¥è¿›è¡Œ Docker æ“ä½œã€‚ç”±äºåªéœ€è¦è¿è¡Œ Dockerï¼Œå› æ­¤è¿™ä¸ª Linux å¯ä»¥éå¸¸ç²¾ç®€ï¼Œä¸éœ€è¦ä»»ä½•å¤æ‚çš„ç³»ç»ŸåŠŸèƒ½ã€‚ç”±äºå†å²åŸå› ï¼Œè¿™ä¸ªå¾®ç¼©ç‰ˆçš„ Linux ç³»ç»Ÿæ˜¯è¢«ç§°ä¸º <code>boot2docker</code> çš„ç³»ç»Ÿã€‚</p>
<p>è€Œ Docker Machine åœ¨å»ºç«‹è™šæ‹Ÿæœºçš„æ—¶å€™ï¼Œä¼šä»<a href="https://github.com/boot2docker/boot2docker/releases" target="_blank" rel="noopener">ç½‘ä¸Š</a>æ£€æŸ¥ Docker æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Œå¦‚æœå‘ç°æœ¬åœ°ç¼“å­˜ä¸­çš„ ISO ä¸å­˜åœ¨ï¼Œæˆ–è€…ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œé‚£å°±ä¼šå»ä»å®˜ç½‘ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ ISO æ–‡ä»¶ã€‚è€Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯æç¤ºä¸­æ‰€è¯´çš„ <code>boot2docker.iso</code> æ–‡ä»¶ã€‚ç”±äºä¼Ÿå¤§çš„å¢™ç»å¸¸åšå‡ºåˆ·å‡ºé•œç‡çš„è¡Œä¸ºï¼Œä» GitHub ä¸Šä¸‹è½½ä¸œè¥¿ç»å¸¸ä¼šè¢«å¹²æ‰°å’Œé˜»æ–­ã€‚è¿™å°±æ˜¯ä¸ºå•¥ç»å¸¸å‡ºç°è¶…æ—¶ã€æˆ–è€…æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œç›´æ¥ä¸‹ä¸è¡Œï¼Œé‚£å°±æ‰‹å·¥ç¿»å¢™ä¸‹â€¦â€¦ğŸ˜¹</p>
<p>å½“ç„¶ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªåŠæ³•ï¼Œå¯ä»¥ç”¨è¿…é›·ä¸‹è½½ã€‚è¿…é›·æ‹¥æœ‰<em>ç»†æ€ææ</em>çš„ä¸‹è½½ç¼“å­˜ï¼ŒåŸºæœ¬ç”¨è¿…é›·ä¸‹è½½è¿‡çš„ä¸œè¥¿ï¼Œè¿…é›·çš„æœåŠ¡å™¨ä¸Šéƒ½ä¼šç¼“å­˜ä¸€ä»½ğŸ˜¨â€¦â€¦ã€‚å¦‚æœä½ ç”¨è¿…é›·ä¸‹è½½è¿™ä¸ª <code>boot2docker.iso</code> çš„è¯ï¼Œå¾ˆå¤§çš„å‡ ç‡è¿…é›·çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šå·²ç»æœ‰äº†ä¸€ä»½è¿™ä¸ªæ–‡ä»¶ã€‚å› æ­¤å¦‚æœå­˜åœ¨ï¼Œè¿…é›·ä¼šç›´æ¥ä»å®ƒçš„ç¼“å­˜æœåŠ¡å™¨ä¸Šå¸®ä½ æŠŠè¿™ä¸ªæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œè¿™æ ·å°±é¿å…äº†ç¿»å¢™äº†ã€‚</p>
<p>ä»ä¸Šé¢çš„æŠ¥é”™ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¾—çŸ¥ï¼Œéœ€è¦ä¸‹è½½çš„é“¾æ¥ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/boot2docker/boot2docker/releases/download/v17.06.2-ce/boot2docker.iso</span><br></pre></td></tr></table></figure>
<p>å°†è¿™ä¸ªé“¾æ¥æ·»åŠ åˆ°ä½ çš„è¿…é›·ä¸‹è½½ä»»åŠ¡ä¸­å»ï¼Œ<strong>æ³¨æ„ï¼šæ¢æˆä½ çš„æŠ¥é”™ä¸­çš„é“¾æ¥ï¼ï¼</strong>ã€‚</p>
<p>ä¸‹è½½å®Œæˆåï¼Œç¡®ä¿æ–‡ä»¶åä¸º <code>boot2docker.iso</code>ï¼Œç„¶åç”¨ <code>shasum -a 256 boot2docker.iso</code> æ ¡éªŒä¸€ä¸‹æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œç¡®ä¿å’Œ<a href="https://github.com/boot2docker/boot2docker/releases" target="_blank" rel="noopener">å®˜ç½‘</a><strong>å¯¹åº”çš„ç‰ˆæœ¬</strong>ä¸€æ ·åï¼Œå†æ”¾ç½®åˆ°æŠ¥é”™ä¸­çš„é‚£ä¸ªä½ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/jessie/.docker/machine/cache/boot2docker.iso</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šæ¢æˆä½ çš„æŠ¥é”™ä¸­çš„é‚£ä¸ªæ–‡ä»¶ä½ç½®ï¼ï¼</strong></p>
<p>æ‰‹å·¥ä¸‹è½½å¥½åï¼Œé‡æ–°è¿è¡Œ Docker Quickstart Terminalï¼Œæˆ–è€…é‡æ–°ä½¿ç”¨ <code>docker-machine</code> åˆ›å»º Virtualbox è™šæ‹Ÿæœºï¼Œä¸€åˆ‡å°±åº”è¯¥æ­£å¸¸äº†ã€‚</p>
<h2 id="è£…å®Œ-Docker-Toolbox-åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ"><a href="#è£…å®Œ-Docker-Toolbox-åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ" class="headerlink" title="è£…å®Œ Docker Toolbox åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ"></a>è£…å®Œ Docker Toolbox åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ</h2><p>å®‰è£… Docker Toolbox æ—¶ï¼Œå®‰è£…ç¨‹åºä¼šä½¿ç”¨ <code>docker-machine</code> ä¸ºä½ åˆ›å»ºä¸€ä¸ªåä¸º <code>default</code> çš„è™šæ‹Ÿæœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create -d virtualbox default</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè™šæ‹Ÿæœºæ²¡æœ‰åŠ ä»»ä½•å‚æ•°ï¼Œå› æ­¤å¯¹äºæ‹¥æœ‰ä¼Ÿå¤§çš„å¢™çš„å›½å†…ç½‘ç»œæ¥è¯´ï¼Œæœ‰äº›ä¸æ–¹ä¾¿ä½¿ç”¨ã€‚æ‰€ä»¥æœ€ç®€å•çš„åšæ³•æ˜¯åœ¨å®‰è£…å®Œ Docker Toolbox åï¼Œåˆ æ‰é»˜è®¤çš„è™šæ‹Ÿæœºï¼Œç„¶åé‡æ–°åˆ›å»ºè¯¥è™šæ‹Ÿæœºï¼Œåˆ›å»ºæ—¶åŠ å…¥æœ‰ä¸­å›½ç‰¹è‰²çš„é…ç½®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker-machine rm default</span><br><span class="line"></span><br><span class="line">docker-machine create -d virtualbox \</span><br><span class="line">     --engine-registry-mirror https://registry.docker-cn.com \</span><br><span class="line">     --engine-insecure-registry 192.168.99.0/24 \</span><br><span class="line">     --engine-storage-driver overlay2 \</span><br><span class="line">     default</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ é™¤ <code>default</code> è™šæ‹Ÿæœºçš„æ—¶å€™è¦æ³¨æ„ï¼Œå…¶ä¸­é•œåƒã€å®¹å™¨ç­‰å†…å®¹éƒ½ä¼šè¢«åˆ é™¤ã€‚</p>
</blockquote>
<h2 id="å¦‚ä½•åœ¨-Docker-Toolbox-ä¸­åˆ›å»ºçš„-default-è™šæ‹Ÿæœºä¸­æ·»åŠ DOCKER-OPTSä¹‹ç±»çš„é…ç½®ï¼Ÿ"><a href="#å¦‚ä½•åœ¨-Docker-Toolbox-ä¸­åˆ›å»ºçš„-default-è™šæ‹Ÿæœºä¸­æ·»åŠ DOCKER-OPTSä¹‹ç±»çš„é…ç½®ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ Docker Toolbox ä¸­åˆ›å»ºçš„ default è™šæ‹Ÿæœºä¸­æ·»åŠ DOCKER_OPTSä¹‹ç±»çš„é…ç½®ï¼Ÿ"></a>å¦‚ä½•åœ¨ Docker Toolbox ä¸­åˆ›å»ºçš„ <code>default</code> è™šæ‹Ÿæœºä¸­æ·»åŠ <code>DOCKER_OPTS</code>ä¹‹ç±»çš„é…ç½®ï¼Ÿ</h2><p>å…¶å®åœ¨æœ€åˆåˆ›å»ºè¯¥docker hostæ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨ <code>docker-machine</code> æŒ‡å®šå¼•æ“é…ç½®å‚æ•°ï¼Œå¦‚æœä¸è¦ç´§ï¼Œå¯ä»¥ç›´æ¥rmæ‰è¿™ä¸ªè™šæ‹Ÿæœºï¼Œé‡æ–°å»ºç«‹ã€‚</p>
<p>å¦‚æœä¸æ–¹ä¾¿ rm æ‰è¿™ä¸ªè™šæ‹Ÿæœºï¼Œå¯ä»¥ <code>docker-machine ssh</code> è¿›å…¥è¿™ä¸ªè™šæ‹Ÿæœºï¼Œç„¶åä¿®æ”¹ <code>/var/lib/boot2docker/profile</code> æ–‡ä»¶ï¼Œä¿®æ”¹é‡Œé¢çš„ <code>EXTRA_ARGS</code> å‚æ•°å³å¯ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰docker-machine-å‘½ä»¤"><a href="#ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰docker-machine-å‘½ä»¤" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰docker-machine å‘½ä»¤"></a>ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰<code>docker-machine</code> å‘½ä»¤</h2><p>è£…å¥½çš„dockeré»˜è®¤æ²¡æœ‰<code>docker-machine</code>å‘½ä»¤ï¼Œå®ƒæ˜¯ç”¨äºæ“çºµè™šæ‹Ÿæœºçš„å‘½ä»¤ï¼Œä¸€èˆ¬é…åˆ<code>Virtual Box</code>ä½¿ç”¨ã€‚</p>
<h2 id="docker-machine-åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥-ssh-è¿›å»ï¼Ÿæ”¹äº†-root-å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ"><a href="#docker-machine-åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥-ssh-è¿›å»ï¼Ÿæ”¹äº†-root-å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ" class="headerlink" title="docker-machine åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥ ssh è¿›å»ï¼Ÿæ”¹äº† root å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ"></a><code>docker-machine</code> åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥ <code>ssh</code> è¿›å»ï¼Ÿæ”¹äº† <code>root</code> å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ</h2><p><code>docker-machine</code> åˆ›å»ºçš„ä¸»æœºï¼Œä¼šéµå¾ªå®‰å…¨æœ€ä½³å®è·µï¼Œå› æ­¤ä¸€èˆ¬ä¸ä¼šå…è®¸ <code>root</code> ç™»å½•ï¼Œè€Œä¸”ä¸€èˆ¬ä¸ä¼šå…è®¸å¯†ç ç™»å½•ï¼Œåªå…è®¸<code>å¯†é’¥</code>ç™»å½•ï¼ˆä¹Ÿå°±æ˜¯å¾ˆå¤šå›½å†…æ–‡ç« ç§°ä¸ºçš„å…å¯†ç™»å½•ï¼Œå…¶å®å¹¶éå…å¯†ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œä½¿ç”¨å¯†é’¥ <code>~/.docker/machine/machines/&lt;æœºå™¨å&gt;/id_rsa</code> ç™»å½•å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.docker/machine/machines/default/id_rsa \</span><br><span class="line">    -o UserKnownHostsFile=/dev/null \</span><br><span class="line">    -o StrictHostKeyChecking=no \</span><br><span class="line">    docker@$(docker-machine ip default)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªä¾‹å­ä¸­è¿æ¥çš„æ˜¯ <code>default</code> è¿™ä¸ªæœºå™¨ï¼Œéœ€è¦è¿æ¥å…¶å®ƒçš„æœºå™¨æ¢æˆåˆ«çš„å³å¯ã€‚å¦å¤–çš„ä¸¤ä¸ª <code>-o</code> çš„å‚æ•°æ˜¯è®©å…¶ä¸è¦æ ¡éªŒæœåŠ¡å™¨å¯†é’¥ï¼Œè¿™å½“ç„¶æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸è¿‡è¿™é‡Œåªæ˜¯è¯•éªŒçš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥æ²¡å…³ç³»ã€‚</p>
<h2 id="docker-machine-ä½¿ç”¨-d-generic-æ—¶ï¼ŒæŒ‡å®šç”¨æˆ·-generic-ssh-user-åå‘ç°è¦-sudo-å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"><a href="#docker-machine-ä½¿ç”¨-d-generic-æ—¶ï¼ŒæŒ‡å®šç”¨æˆ·-generic-ssh-user-åå‘ç°è¦-sudo-å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ" class="headerlink" title="docker-machine ä½¿ç”¨ -d generic æ—¶ï¼ŒæŒ‡å®šç”¨æˆ· --generic-ssh-user åå‘ç°è¦ sudo å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"></a><code>docker-machine</code> ä½¿ç”¨ <code>-d generic</code> æ—¶ï¼ŒæŒ‡å®šç”¨æˆ· <code>--generic-ssh-user</code> åå‘ç°è¦ <code>sudo</code> å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</h2><p>ä½ åº”è¯¥å†ä»”ç»†çœ‹çœ‹ <code>generic</code> çš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/machine/drivers/generic/#/sudo-privileges" target="_blank" rel="noopener">https://docs.docker.com/machine/drivers/generic/#/sudo-privileges</a></p>
<p>é‡Œé¢è¯´çš„å¾ˆæ¸…æ¥šï¼Œé»˜è®¤ç”¨æˆ·æ˜¯ <code>root</code>ï¼Œä½†å¦‚æœé€šè¿‡ <code>--generic-ssh-user</code> æŒ‡å®šå…¶å®ƒç”¨æˆ·çš„è¯ï¼Œè¯¥ç”¨æˆ·å¿…é¡»æ‹¥æœ‰æ— å¯†ç <code>sudo</code>çš„èƒ½åŠ›ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯åœ¨ <code>sudoers</code> æ–‡ä»¶ä¸­å¯¹è¯¥ç”¨æˆ·é…ç½® <code>NOPASSWD</code>ã€‚</p>
<h1 id="Docker-Registry-ç›¸å…³é—®é¢˜-10"><a href="#Docker-Registry-ç›¸å…³é—®é¢˜-10" class="headerlink" title="Docker Registry ç›¸å…³é—®é¢˜ (10)"></a>Docker Registry ç›¸å…³é—®é¢˜ <code>(10)</code></h1><h2 id="æˆ‘-docker-push-çš„æ—¶å€™æ€ä¹ˆæŠ¥-authentication-required-é”™è¯¯ï¼Ÿ"><a href="#æˆ‘-docker-push-çš„æ—¶å€™æ€ä¹ˆæŠ¥-authentication-required-é”™è¯¯ï¼Ÿ" class="headerlink" title="æˆ‘ docker push çš„æ—¶å€™æ€ä¹ˆæŠ¥ authentication required é”™è¯¯ï¼Ÿ"></a>æˆ‘ <code>docker push</code> çš„æ—¶å€™æ€ä¹ˆæŠ¥ <code>authentication required</code> é”™è¯¯ï¼Ÿ</h2><p>å› ä¸ºä½ æ²¡æœ‰ç™»å½•ã€‚å¦‚æœæ˜¯å‘ Docker Hub æ¨é€é•œåƒï¼Œéœ€è¦åœ¨æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼š <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p>
<h2 id="ä¸ºä»€ä¹ˆæˆ‘-docker-login-å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæˆ‘-docker-login-å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘ docker login å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæˆ‘ <code>docker login</code> å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, </span></span><br><span class="line"><span class="string">head over to https://hub.docker.com to create one.</span></span><br><span class="line"><span class="string">Username: pinkman@heisenb.org</span></span><br><span class="line"><span class="string">Password:</span></span><br><span class="line"><span class="string">Error response from daemon: Get https://registry-1.docker.io/v2/: unauthorized: incorrect username or password</span></span><br></pre></td></tr></table></figure>
<p>å‘ƒï¼Œè¿™é‡Œåº”è¯¥æ˜¯<strong>ç”¨æˆ·å</strong>çš„ï¼Œæ€ä¹ˆå†™äº†ä¸ª<strong>ç”µå­é‚®ä»¶</strong> <code>pinkman@heisenb.org</code> å‘¢ï¼Ÿè™½ç„¶ <a href="https://hub.docker.com" target="_blank" rel="noopener">Docker Hub ç½‘ç«™</a>å…è®¸ä½ ä½¿ç”¨ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ç™»å½•ï¼Œä½†æ˜¯ <code>docker login</code> åªå¯ä»¥ä½¿ç”¨ç”¨æˆ·åï¼Œæ¢æˆä½ çš„ç”¨æˆ·åç™»å½•å°±å¥½äº†ã€‚</p>
<h2 id="æˆ‘æ³¨å†Œç”¨æˆ·-pinkman-äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³•-docker-push-mrwhite-xxx-å•Šï¼Ÿ"><a href="#æˆ‘æ³¨å†Œç”¨æˆ·-pinkman-äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³•-docker-push-mrwhite-xxx-å•Šï¼Ÿ" class="headerlink" title="æˆ‘æ³¨å†Œç”¨æˆ· pinkman äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³• docker push mrwhite/xxx å•Šï¼Ÿ"></a>æˆ‘æ³¨å†Œç”¨æˆ· <code>pinkman</code> äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³• <code>docker push mrwhite/xxx</code> å•Šï¼Ÿ</h2><p>ğŸ˜’â€¦â€¦å› ä¸ºä½  <code>push</code> åˆ°åˆ«äººï¼ˆ<strong>mrwhite</strong>ï¼‰çš„ <code>repo</code> äº†ï¼Œä½ åªèƒ½ <code>push</code> åˆ° <code>pinkman/xxx</code> ä¸‹ã€‚</p>
<h2 id="ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å›-docker-push-pinkman-xxx-äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ"><a href="#ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å›-docker-push-pinkman-xxx-äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ" class="headerlink" title="ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å› docker push pinkman/xxx äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ"></a>ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å› <code>docker push pinkman/xxx</code> äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ</h2><p>ğŸ˜“â€¦â€¦å› ä¸ºä½ æ²¡æœ‰ <code>tag</code> å¯¹åº”çš„é•œåƒä¸º <code>pinkman/xxx</code>ã€‚</p>
<p>æ‰€æœ‰è¿™äº›é—®é¢˜ï¼Œéƒ½æ˜¯ç”±äºä½ æ²¡æœ‰å»çœ‹æ–‡æ¡£ï¼Œå»ºè®®ä¸è¦è¿™ä¹ˆä¸€æ¬¡æ¬¡çš„çæ’ï¼Œå»çœ‹å®˜ç½‘æ–‡æ¡£ï¼š</p>
<p><a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">https://docs.docker.com/get-started/</a></p>
<h2 id="docker-push-åˆ°ç§æœ‰-registry-æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#docker-push-åˆ°ç§æœ‰-registry-æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="docker push åˆ°ç§æœ‰ registry æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ"></a><code>docker push</code> åˆ°ç§æœ‰ <code>registry</code> æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ</h2><p>å¦‚æœåœ¨æŠ¥é”™ä¸­çœ‹åˆ°äº† <code>https</code>ï¼Œé‚£å¾ˆå¯èƒ½æ˜¯å› ä¸º <code>registry</code> æ²¡æœ‰é…ç½®è¯ä¹¦ã€‚</p>
<p>å¾ˆå¤šäººæœ€å¼€å§‹é…ç½® <code>registry</code> çš„æ—¶å€™ï¼Œä¸ºäº†ç®€å•è€Œæ²¡æœ‰é…ç½® <code>TLS</code> è¯ä¹¦ã€‚</p>
<p>è¿™æ˜¯<strong>ä¸å®‰å…¨</strong>çš„åšæ³•ï¼Œåœ¨ Docker ä¸­<strong>ä¸æ¨è</strong>ä½¿ç”¨ã€‚å› æ­¤ï¼Œåˆ»æ„çš„å¢åŠ äº†ä½¿ç”¨è¿™ç§ä¸å®‰å…¨ <code>registry</code> çš„å¤æ‚åº¦ã€‚ä½¿ç”¨è€…å¿…é¡»åœ¨ <code>dockerd</code> é…ç½®ä¸­ï¼Œæ˜ç¡®å£°æ˜è¦ä½¿ç”¨è¿™äº›ä¸å®‰å…¨çš„ <code>registry</code>ã€‚</p>
<p>æ¯”å¦‚ï¼Œåœ¨ <a href="http://www.ubuntu.com/download/server" target="_blank" rel="noopener">Ubuntu 16.04</a> ä¸­ï¼Œç¼–è¾‘ <code>/etc/systemd/system/multi-user.target.wants/docker.service</code> ä¸­çš„ <code>ExecStart=</code> çš„ç»“å°¾ï¼ŒåŠ å…¥ <code>--insecure-registry=192.168.99.100:5000</code>ï¼Œå°† <code>192.168.99.100:5000</code> æ›¿æ¢æˆä½ çš„ <code>registry</code> åœ°å€ã€‚å¦‚æœæœ‰å¾ˆå¤š <code>registry</code>ï¼Œå¯ä»¥è®¾ç½®å¤šç»„ã€‚æˆ–è€…å¦‚æœè™šæ‹Ÿæœºçš„ <code>IP</code> æ€»æ˜¯å˜åŒ–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>CIDR</code> çš„å½¢å¼ï¼Œæ¯”å¦‚ <code>--insecure-registry=192.168.99.0/24</code>ã€‚</p>
<p>ä¸è¿‡æµ‹è¯•è¿‡åï¼Œä¸€å®šè¦<a href="https://docs.docker.com/registry/deploying/#/get-a-certificate" target="_blank" rel="noopener">é…ä¸Š TLS è¯ä¹¦</a>ã€‚ç°åœ¨ <a href="https://letsencrypt.org/getting-started/" target="_blank" rel="noopener">Letâ€™s Encrpyt</a> å·²ç»æ”¯æŒ <code>DNS</code> è®¤è¯äº†ï¼Œä¸éœ€è¦æš´éœ²å†…éƒ¨çš„æœºå™¨äºå…¬ç½‘ï¼Œç”¨å…¶<a href="https://certbot.eff.org/" target="_blank" rel="noopener">è„šæœ¬</a>è‡ªåŠ¨å–å¾—å…è´¹è¯ä¹¦æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚</p>
<h2 id="æˆ‘-docker-push-äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„-registry-ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ"><a href="#æˆ‘-docker-push-äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„-registry-ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ" class="headerlink" title="æˆ‘ docker push äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„ registry ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ"></a>æˆ‘ <code>docker push</code> äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„ <code>registry</code> ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ</h2><p>ä¸¤ç§åŠæ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ Registry V2 APIã€‚å¯ä»¥åˆ—å‡ºæ‰€æœ‰é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://&lt;ç§æœ‰registryåœ°å€&gt;/v2/_catalog</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç§æœ‰ Registry å°šæ”¯æŒ V1 APIï¼ˆ<strong>å·²ç»åºŸå¼ƒ</strong>ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker search</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search &lt;ç§æœ‰registryåœ°å€&gt;/&lt;å…³é”®å­—&gt;</span><br></pre></td></tr></table></figure>
<h2 id="docker-search-ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰-Registry-ä¸­ç”¨ï¼Ÿ"><a href="#docker-search-ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰-Registry-ä¸­ç”¨ï¼Ÿ" class="headerlink" title="docker search ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰ Registry ä¸­ç”¨ï¼Ÿ"></a><code>docker search</code> ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰ <code>Registry</code> ä¸­ç”¨ï¼Ÿ</h2><p><code>docker search</code> å‘½ä»¤æ‰€ä½¿ç”¨çš„ <code>API</code> æ˜¯ <code>/search</code>ï¼Œè€Œè¿™æ˜¯å·²ç»åºŸå¼ƒçš„ Registry <code>v1</code> çš„ APIï¼Œç›®å‰çš„ Registry éƒ½å·²ç»æ˜¯ <code>v2</code> APIäº†ï¼Œæ—©å°±ä¸æ”¯æŒ <code>v1</code> API äº†ï¼Œæ‰€ä»¥è‡ªç„¶ç”¨ä¸äº†ã€‚è€Œ <code>v2</code> çš„ API ä¸­åªæœ‰åˆ—è¡¨ <code>/_catalogs</code> APIï¼Œæ²¡æœ‰åŒç­‰çš„ <code>search</code> APIã€‚æ‰€ä»¥äº‹å®ä¸Š <code>docker search</code> å‘½ä»¤å·²ç»åºŸå¼ƒäº†ã€‚</p>
<p>å¦å¤–ï¼Œ<code>docker search</code> åŠŸèƒ½å¤ªè¿‡å±€é™ï¼Œå…¶å®å¹¶ä¸å®ç”¨ã€‚è¿œä¸å¦‚ç›´æ¥å» <a href="https://hub.docker.com/explore/" target="_blank" rel="noopener">Docker Hub ç½‘ç«™</a> æœç´¢ã€‚Docker Hub ç½‘ç«™ä¸Šï¼Œå¯ä»¥æœç´¢æŸ¥æ‰¾é•œåƒï¼Œæ‰¾åˆ°åè¿˜å¯ä»¥çœ‹å¯¹åº”çš„<strong>æ ‡ç­¾</strong>ã€é•œåƒ<strong>ä½¿ç”¨æ–‡æ¡£</strong>ã€æ¯ä¸ªé•œåƒçš„ <code>Dockerfile</code>ã€<strong>å®‰å…¨æ‰«æç»“æœ</strong>ç­‰ç­‰ã€‚</p>
<p>å¦‚æœåªä½¿ç”¨å¼€æºçš„ <code>docker registry</code> è‡ªå»ºä»“åº“çš„è¯ï¼Œç›®å‰åªèƒ½ç”¨ <code>API</code> è®¿é—®å…¶å†…å®¹ã€‚é™¤æ­¤ä»¥å¤–ï¼Œå®˜æ–¹è¿˜æœ‰å•†ä¸šç‰ˆçš„ <code>Docker Trusted Registry</code> é¡¹ç›®ï¼Œé‡Œé¢æœ‰ä¸€äº›å¢å€¼çš„å†…å®¹åœ¨é‡Œé¢ï¼Œæä¾›äº†ç±»ä¼¼äº Docker Hub ä¼¼å¾— UI ç­‰ï¼Œå¯ä»¥æœç´¢è¿‡æ»¤ã€‚ç›®å‰ Docker Trusted Registry å±äº <a href="https://www.docker.com/products/docker-datacenter" target="_blank" rel="noopener">Docker Datacenter</a> çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å¦å¤–ï¼Œç¬¬ä¸‰æ–¹ä¹Ÿæœ‰ä¸€äº›æä¾›äº†UIçš„ã€‚æ¯”å¦‚ <a href="https://github.com/vmware/harbor" target="_blank" rel="noopener">VMWare Harbor</a>ã€‚VMWare Harbor æ˜¯ VMWare ä¸­å›½åŸºäºå¼€æº docker registry è¿›ä¸€æ­¥å¼€å‘çš„é¡¹ç›®ï¼Œæœ‰æ›´å¤æ‚çš„ä¸Šå±‚é€»è¾‘ã€‚åŒ…æ‹¬ç”¨æˆ·ç®¡ç†ã€é•œåƒç®¡ç†ã€Registryé›†ç¾¤ä¹‹ç±»çš„åŠŸèƒ½ã€‚Harbor æ˜¯å¼€æºçš„ï¼Œå…è´¹çš„ã€‚</p>
<p>ç¬¬ä¸‰æ–¹çš„ registry è¿˜æœ‰ Java ä¸–ç•Œé‡Œå¸¸è§çš„ Nexusï¼Œå…¶<a href="https://github.com/sonatype/docker-nexus3" target="_blank" rel="noopener">ç¬¬ä¸‰ä»£</a>æ”¯æŒ Docker Registry APIã€‚</p>
<h2 id="å¦‚ä½•åˆ é™¤ç§æœ‰-registry-ä¸­çš„é•œåƒï¼Ÿ"><a href="#å¦‚ä½•åˆ é™¤ç§æœ‰-registry-ä¸­çš„é•œåƒï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ é™¤ç§æœ‰ registry ä¸­çš„é•œåƒï¼Ÿ"></a>å¦‚ä½•åˆ é™¤ç§æœ‰ <code>registry</code> ä¸­çš„é•œåƒï¼Ÿ</h2><p>é¦–å…ˆï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œdocker registry æ˜¯ä¸å…è®¸åˆ é™¤é•œåƒçš„ï¼Œéœ€è¦åœ¨é…ç½®<code>config.yml</code>ä¸­å¯ç”¨ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">delete:</span></span><br><span class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œä½¿ç”¨ API <code>GET /v2/&lt;é•œåƒå&gt;/manifests/&lt;tag&gt;</code> æ¥å–å¾—è¦åˆ é™¤çš„<code>é•œåƒ:Tag</code>æ‰€å¯¹åº”çš„ <code>digest</code>ã€‚</p>
<p>Registry <code>2.3</code> ä»¥åï¼Œå¿…é¡»åŠ å…¥å¤´ <code>Accept: application/vnd.docker.distribution.manifest.v2+json</code>ï¼Œå¦åˆ™å–åˆ°çš„ <code>digest</code> æ˜¯é”™è¯¯çš„ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢è¯¯åˆ é™¤ã€‚</p>
<p>æ¯”å¦‚ï¼Œè¦åˆ é™¤ <code>myimage:latest</code> é•œåƒï¼Œé‚£ä¹ˆå–å¾— <code>digest</code> çš„å‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl --header <span class="string">"Accept: application/vnd.docker.distribution.manifest.v2+json"</span> \</span><br><span class="line">  -I -X HEAD http://192.168.99.100:5000/v2/myimage/manifests/latest \</span><br><span class="line">  | grep Digest</span><br><span class="line">Docker-Content-Digest: sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</span><br></pre></td></tr></table></figure>
<p>ç„¶åè°ƒç”¨ API <code>DELETE /v2/&lt;é•œåƒå&gt;/manifests/&lt;digest&gt;</code> æ¥åˆ é™¤é•œåƒã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl  -X DELETE http://192.168.99.100:5000/v2/myimage/manifests/sha256:3a07b4e06c73b2e3924008270c7f3c3c6e3f70d4dbb814ad8bff2697123ca33c</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œé•œåƒå·²ä» <code>registry</code> ä¸­æ ‡è®°åˆ é™¤ï¼Œå¤–ç•Œè®¿é—® <code>pull</code> ä¸åˆ°äº†ã€‚ä½†æ˜¯ <code>registry</code> çš„æœ¬åœ°ç©ºé—´å¹¶æœªé‡Šæ”¾ï¼Œéœ€è¦ç­‰å¾…åƒåœ¾æ”¶é›†æ‰ä¼šé‡Šæ”¾ã€‚è€Œåƒåœ¾æ”¶é›†ä¸å¯ä»¥åœ¨çº¿è¿›è¡Œï¼Œå¿…é¡»åœæ­¢ <code>registry</code>ï¼Œç„¶åæ‰§è¡Œã€‚æ¯”å¦‚ï¼Œå‡è®¾ <code>registry</code> æ˜¯ç”¨ Compose è¿è¡Œçš„ï¼Œé‚£ä¹ˆä¸‹é¢å‘½ä»¤ç”¨æ¥åƒåœ¾æ”¶é›†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose stop</span><br><span class="line">docker run -it --name gc --rm --volumes-from registry_registry_1 registry:2 garbage-collect /etc/registry/config.yml</span><br><span class="line">docker-compose start</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>registry_registry_1</code> å¯ä»¥æ›¿æ¢ä¸ºå®é™…çš„ <code>registry</code> çš„å®¹å™¨åï¼Œè€Œ <code>/etc/registry/config.yml</code> åˆ™æ›¿æ¢ä¸ºå®é™…çš„ <code>registry</code> é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š</p>
<p><a href="https://docs.docker.com/registry/configuration/#/delete" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/delete</a></p>
<p><a href="https://docs.docker.com/registry/spec/api/#/deleting-an-image" target="_blank" rel="noopener">https://docs.docker.com/registry/spec/api/#/deleting-an-image</a></p>
<h2 id="ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š-docker-ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ"><a href="#ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š-docker-ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ" class="headerlink" title="ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š docker ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ"></a>ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š docker ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ</h2><p>åœ¨å±€åŸŸç½‘å†…ï¼Œæœ¬åœ°æ¶è®¾ä¸ª Docker Registry mirrorï¼Œä½œä¸ºç¼“å­˜å³å¯ã€‚</p>
<p>å»ºç«‹ä¸€ä¸ªç©ºç›®å½•ï¼Œå¹¶ä¸”æ·»åŠ  Registry çš„é…ç½®æ–‡ä»¶ <code>config.yml</code>ï¼Œå…¶å†…å®¹ä¸ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">0.1</span></span><br><span class="line"><span class="attr">log:</span></span><br><span class="line"><span class="attr">    fields:</span></span><br><span class="line"><span class="attr">        service:</span> <span class="string">registry</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line"><span class="attr">    cache:</span></span><br><span class="line"><span class="attr">        blobdescriptor:</span> <span class="string">inmemory</span></span><br><span class="line"><span class="attr">    filesystem:</span></span><br><span class="line"><span class="attr">        rootdirectory:</span> <span class="string">/var/lib/registry</span></span><br><span class="line"><span class="attr">http:</span></span><br><span class="line"><span class="attr">    addr:</span> <span class="string">:5000</span></span><br><span class="line"><span class="attr">    headers:</span></span><br><span class="line"><span class="attr">        X-Content-Type-Options:</span> <span class="string">[nosniff]</span></span><br><span class="line"><span class="attr">health:</span></span><br><span class="line"><span class="attr">    storagedriver:</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">        interval:</span> <span class="number">10</span><span class="string">s</span></span><br><span class="line"><span class="attr">        threshold:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">proxy:</span></span><br><span class="line"><span class="attr">    remoteurl:</span> <span class="attr">https://registry.docker-cn.com</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„è¿™é‡Œçš„ <code>remoteurl</code>ï¼Œå…¶åœ°å€å¯ä»¥å¡«å†™ä»»æ„ä¸€ä¸ªå›½å†…é•œåƒåŠ é€Ÿå™¨çš„åœ°å€ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ Docker å®˜æ–¹åœ¨ä¸­å›½çš„é•œåƒç«™ç‚¹ã€‚å¦‚æœåœ¨å›½å¤–çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ Docker Hub çš„å®˜æ–¹åœ°å€ï¼š<code>https://registry-1.docker.io</code>ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œå»ºç«‹ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶æ–¹ä¾¿å¯åŠ¨è¿™ä¸ªæœåŠ¡ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'2'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    mirror:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">registry:2</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">"5000:5000"</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./config.yml:/etc/docker/registry/config.yml</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨ Docker Compose å¯åŠ¨è¿™ä¸ªé•œåƒæœåŠ¡ï¼š<code>docker-compose up -d</code></p>
<p>ç„¶ååœ¨å±€åŸŸç½‘ä¸­çš„æ‰€æœ‰ Docker ä¸»æœºä¸­çš„ Docker å¼•æ“é…ç½®ä¸­ï¼Œéƒ½æ·»åŠ ä¸€æ¡ <code>--registry-mirror=&lt;è¿™ä¸ªé•œåƒæœåŠ¡å™¨çš„åœ°å€&gt;</code></p>
<p>é¦–å…ˆç”¨ <code>docker pull</code> ä¸‹è½½ä¸€ä¸ªæœ¬åœ°ä¸å­˜åœ¨çš„é•œåƒï¼Œçœ‹ä¸€ä¸‹æ—¶é—´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ time docker pull php:7-fpm-alpine</span><br><span class="line">7-fpm-alpine: Pulling from library/php</span><br><span class="line">e110a4a17941: Pull complete</span><br><span class="line">d9f63633faf6: Pull complete</span><br><span class="line">ac309a5bc5d5: Pull complete</span><br><span class="line">4523ec888a62: Pull complete</span><br><span class="line">6a77f79ab9b5: Pull complete</span><br><span class="line">27243562b67c: Pull complete</span><br><span class="line">33e1803456c2: Pull complete</span><br><span class="line">a1219b0a1418: Pull complete</span><br><span class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</span><br><span class="line">docker pull php:7-fpm-alpine  0.07s user 0.07s system 0% cpu 2:30.43 total</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æˆ‘ä»¬ä¸‹è½½äº† php:7-fpm-alpineï¼Œç”¨æ—¶ 2 åˆ† 30ç§’ï¼Œç„¶åæˆ‘ä»¬åˆ æ‰é•œåƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker rmi php:7-fpm-alpine</span><br><span class="line">Untagged: php:7-fpm-alpine</span><br><span class="line">Deleted: sha256:b80ca1f4f99d13e00ac6ef13aca7c1ef6e2fb83ec2fe6a035e8beeeb05afb4b6</span><br><span class="line">Deleted: sha256:69ee0f31988504dc3e3b068476f11d06b43fc34465a1c58d351406b9d2368e7a</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ç„¶åé‡æ–°ä¸‹è½½é•œåƒï¼Œæµ‹è¯•æ—¶é—´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ time docker pull php:7-fpm-alpine</span><br><span class="line">7-fpm-alpine: Pulling from library/php</span><br><span class="line">e110a4a17941: Pull complete</span><br><span class="line">d9f63633faf6: Pull complete</span><br><span class="line">ac309a5bc5d5: Pull complete</span><br><span class="line">4523ec888a62: Pull complete</span><br><span class="line">6a77f79ab9b5: Pull complete</span><br><span class="line">27243562b67c: Pull complete</span><br><span class="line">33e1803456c2: Pull complete</span><br><span class="line">a1219b0a1418: Pull complete</span><br><span class="line">Digest: sha256:f7d6f6844df64f8f615fa50ca28b3f1ad82be0a2dcde0b55205d31c1bb9f4820</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> php:7-fpm-alpine</span><br><span class="line">docker pull php:7-fpm-alpine  0.05s user 0.04s system 0% cpu 13.778 total</span><br></pre></td></tr></table></figure>
<p>è¿™æ¬¡ç”±äºè¯¥ docker image æœ¬åœ° mirror ç¼“å­˜äº†ï¼Œæ‰€ä»¥ç”¨æ—¶çº¦14ç§’ï¼Œé€Ÿåº¦å¤§å¤§æé«˜äº†ã€‚</p>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š</p>
<p>æœåŠ¡ç«¯ï¼š<a href="https://docs.docker.com/registry/configuration/#/proxy" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/proxy</a></p>
<p>å®¢æˆ·ç«¯ï¼š<a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p>
<h2 id="è‡ªå·±æ¶çš„-registry-æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ"><a href="#è‡ªå·±æ¶çš„-registry-æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ" class="headerlink" title="è‡ªå·±æ¶çš„ registry æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ"></a>è‡ªå·±æ¶çš„ <code>registry</code> æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ</h2><p>é‚£æ˜¯å› ä¸ºæ²¡æœ‰åŠ è®¤è¯ï¼Œä¸åŠ è®¤è¯çš„æ„æ€å°±æ˜¯å…è®¸ä»»ä½•äººè®¿é—®çš„ã€‚</p>
<p>æ·»åŠ è®¤è¯æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>Registry é…ç½®ä¸­åŠ å…¥è®¤è¯ï¼š <a href="https://docs.docker.com/registry/configuration/#/auth" target="_blank" rel="noopener">https://docs.docker.com/registry/configuration/#/auth</a></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auth:</span></span><br><span class="line"><span class="attr">  token:</span></span><br><span class="line"><span class="attr">    realm:</span> <span class="string">token-realm</span></span><br><span class="line"><span class="attr">    service:</span> <span class="string">token-service</span></span><br><span class="line"><span class="attr">    issuer:</span> <span class="string">registry-token-issuer</span></span><br><span class="line"><span class="attr">    rootcertbundle:</span> <span class="string">/root/certs/bundle</span></span><br><span class="line"><span class="attr">  htpasswd:</span></span><br><span class="line"><span class="attr">    realm:</span> <span class="string">basic-realm</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/path/to/htpasswd</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å‰ç«¯æ¶è®¾ nginx è¿›è¡Œè®¤è¯ï¼š<a href="https://docs.docker.com/registry/recipes/nginx/" target="_blank" rel="noopener">https://docs.docker.com/registry/recipes/nginx/</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /v2/ &#123;</span><br><span class="line">    ...</span><br><span class="line">    auth_basic <span class="string">"Registry realm"</span>;</span><br><span class="line">    auth_basic_user_file /etc/nginx/conf.d/nginx.htpasswd;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ç³»ç»Ÿç›¸å…³é—®é¢˜-7"><a href="#ç³»ç»Ÿç›¸å…³é—®é¢˜-7" class="headerlink" title="ç³»ç»Ÿç›¸å…³é—®é¢˜ (7)"></a>ç³»ç»Ÿç›¸å…³é—®é¢˜ <code>(7)</code></h1><h2 id="CentOS-RHEL-çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜"><a href="#CentOS-RHEL-çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜" class="headerlink" title="CentOS/RHEL çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜"></a>CentOS/RHEL çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜</h2><h3 id="åœ¨-CentOS-6-ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰-Docker-1-7-è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ"><a href="#åœ¨-CentOS-6-ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰-Docker-1-7-è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ" class="headerlink" title="åœ¨ CentOS 6 ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰ Docker 1.7 è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ"></a>åœ¨ CentOS 6 ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰ Docker 1.7 è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ</h3><p>Docker å·²ç»ä¸å†æ”¯æŒ CentOS 6 äº†ï¼Œç°åœ¨çœ‹åˆ°çš„æ˜¯å¾ˆä¹…ä»¥å‰çš„è€ç‰ˆæœ¬ï¼Œä¹‹åå†ä¹Ÿæ²¡æœ‰å‘å¸ƒè¿‡ CentOS 6 çš„ç‰ˆæœ¬ã€‚</p>
<p>æ‰€ä»¥ä¸è¦å†åœ¨ CentOS 6ä¸Šç”¨ Docker äº†ã€‚æ¢ CentOS 7 æˆ–è€… Ubuntu å§ã€‚</p>
<h3 id="æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ-Permission-deniedï¼Œæ²¡æƒé™"><a href="#æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ-Permission-deniedï¼Œæ²¡æƒé™" class="headerlink" title="æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ Permission deniedï¼Œæ²¡æƒé™"></a>æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ <code>Permission denied</code>ï¼Œæ²¡æƒé™</h3><p>åŸå› æ˜¯ <code>CentOS</code>/<code>RHEL</code>ä¸­çš„ <code>SELinux</code> é™åˆ¶äº†ç›®å½•æƒé™ã€‚éœ€è¦æ·»åŠ è§„åˆ™ã€‚</p>
<p>ä¸‹é¢æ˜¯ <code>man docker-run</code> çš„è§£é‡Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">When  using  SELinux,  be  aware that the host has no knowledge of container</span><br><span class="line">SELinux policy. Therefore, in the above example, if SELinux policy  is enforced,</span><br><span class="line">the /var/db directory is not  writable to the container. A &quot;Permission Denied&quot;</span><br><span class="line">message will occur and an avc: message in the host&apos;s syslog.</span><br><span class="line"></span><br><span class="line">To  work  around  this, at time of writing this man page, the following command</span><br><span class="line">needs to be run in order for the  proper  SELinux  policy  type label to be</span><br><span class="line">attached to the host directory:</span><br></pre></td></tr></table></figure>
<p>å› æ­¤éœ€è¦å¯¹ç‰¹å®šç›®å½•æ·»åŠ è§„åˆ™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chcon -Rt svirt_sandbox_file_t /var/db</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼š<a href="http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/" target="_blank" rel="noopener">http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/</a></p>
<h3 id="Dockerçš„-var-lib-docker-devicemapper-å ç”¨ç©ºé—´ä¸æ–­å¢é•¿-æ€ä¹ˆç ´ï¼Ÿ"><a href="#Dockerçš„-var-lib-docker-devicemapper-å ç”¨ç©ºé—´ä¸æ–­å¢é•¿-æ€ä¹ˆç ´ï¼Ÿ" class="headerlink" title="Dockerçš„ /var/lib/docker/devicemapper å ç”¨ç©ºé—´ä¸æ–­å¢é•¿, æ€ä¹ˆç ´ï¼Ÿ"></a>Dockerçš„ <code>/var/lib/docker/devicemapper</code> å ç”¨ç©ºé—´ä¸æ–­å¢é•¿, æ€ä¹ˆç ´ï¼Ÿ</h3><p>è¿™ç±»é—®é¢˜ä¸€èˆ¬æ˜¯ CentOS/RHEL çº¢å¸½ç³»çš„é—®é¢˜ï¼ŒCentOS è¿™ç±»çº¢å¸½ç³»ç»Ÿä¸­ï¼Œç”±äºä¸åƒ <code>Ubuntu</code> é‚£æ ·æœ‰æˆç†Ÿçš„ Union FSå®ç°(å¦‚<code>aufs</code>)ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ <code>devicemapper</code>ï¼Œè€Œé»˜è®¤ä½¿ç”¨çš„æ˜¯<code>lvm-loop</code>ï¼Œä¹Ÿå°±æ˜¯ç”¨ä¸€ä¸ªç¨€ç–æ–‡ä»¶æ¥å½“æˆä¸€ä¸ªå—è®¾å¤‡ï¼Œç»™<code>devicemapper</code>ç”¨ï¼Œä½œä¸ºDockeré•œåƒå®¹å™¨æ–‡ä»¶ç³»ç»Ÿã€‚è¿™æ˜¯éå¸¸ä¸æ¨èä½¿ç”¨çš„ï¼Œæ€§èƒ½å¾ˆå·®ä¸è¯´ï¼Œä¸ç¨³å®šï¼Œè¿˜æœ‰å¾ˆå¤š bugï¼Œå¦‚æœæ²¡åŠæ³•æ¢ <code>Ubuntu</code>/<code>Debian</code> ç³»ç»Ÿï¼Œé‚£ä¹ˆæœ€èµ·ç åº”è¯¥å»ºç«‹å—è®¾å¤‡ï¼ˆåˆ†åŒºã€å·ï¼‰ç»™ <code>devicemapper</code> ç”¨ã€‚</p>
<p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#configure-direct-lvm-mode-for-production</a></p>
<p>ä¸¥æ ¼æ¥è¯´ CentOS/RHEL 7 ä¸­å®é™…ä¸Šæœ‰ä¸€ä¸ª Union FS å®ç°ï¼Œè™½ç„¶ CentOS/RHEL 7 çš„å†…æ ¸æ˜¯ 3.10ï¼Œä¸è¿‡çº¢å¸½ä» Linux 3.18 backport å›æ¥äº† <code>overlay</code> fs çš„é©±åŠ¨ã€‚ä½†æ˜¯ï¼Œçº¢å¸½è‡ªå·±éƒ½åœ¨å®˜æ–¹çš„å‘å¸ƒå£°æ˜ä¸­è¯´èƒ½ä¸è¦ç”¨å°±ä¸ç”¨ã€‚</p>
<p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.2_Release_Notes/technology-preview-file_systems.html</a></p>
<h3 id="CentOS-7-çš„å†…æ ¸å¤ªè€äº†-3-10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š-Docker-åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ"><a href="#CentOS-7-çš„å†…æ ¸å¤ªè€äº†-3-10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š-Docker-åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ" class="headerlink" title="CentOS 7 çš„å†…æ ¸å¤ªè€äº† 3.10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š Docker åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ"></a>CentOS 7 çš„å†…æ ¸å¤ªè€äº† 3.10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š Docker åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ</h3><p>æ˜¯çš„ï¼Œæœ‰ä¸€äº›åŠŸèƒ½æ— æ³•æ”¯æŒï¼Œæ¯”å¦‚ <code>overlay2</code> çš„å­˜å‚¨é©±åŠ¨å°±æ— æ³•åœ¨ CentOS ä¸Šä½¿ç”¨ï¼Œä½†å¹¶éæ‰€æœ‰éœ€è¦é«˜ç‰ˆæœ¬å†…æ ¸çš„åŠŸèƒ½éƒ½ä¸æ”¯æŒã€‚</p>
<p>æ¯”å¦‚ Overlay FS éœ€è¦ Linux 3.18ï¼Œè€Œ Overlay network éœ€è¦ Linux 3.16ã€‚è€Œ CentOS 7 å†…æ ¸ä¸º 3.10ï¼Œç¡®å®ä½äºè¿™äº›ç‰ˆæœ¬éœ€æ±‚ã€‚ä½†å®é™…ä¸Šï¼Œçº¢å¸½å›¢é˜Ÿä¼šæŠŠä¸€äº›æ–°å†…æ ¸çš„åŠŸèƒ½ backport å›è€çš„å†…æ ¸ã€‚æ¯”å¦‚ <code>overlay fs</code>ç­‰ã€‚æ‰€ä»¥ä¸€äº›åŠŸèƒ½ä¾æ—§ä¼šæ”¯æŒã€‚å› æ­¤ CentOS 7 çš„ Docker Engine åŒæ ·å¯ä»¥æ”¯æŒ <code>overlay network</code>ï¼Œä»¥åŠ <code>overlay</code> å­˜å‚¨é©±åŠ¨ï¼ˆä¸æ˜¯<code>overlay2</code>ï¼‰ã€‚å› æ­¤åœ¨æ–°çš„ Docker 1.12 ä¸­ï¼ŒCentOS/RHEL 7 æ‰æœ‰å¯èƒ½æ”¯æŒ Swarm Modeã€‚</p>
<p>å³ä½¿çº¢å¸½ä¼šæŠŠä¸€äº›é«˜ç‰ˆæœ¬å†…æ ¸çš„åŠŸèƒ½ backport å› 3.10 å†…æ ¸ä¸­ï¼Œè¿™ç§ä¿®ä¿®è¡¥è¡¥å‡ºæ¥çš„åŠŸèƒ½ï¼Œå¹¶ä¸ä¸€å®šç¨³å®šã€‚å¦‚æœè§‚å¯Ÿ Docker Issue åˆ—è¡¨ï¼Œä¼šå‘ç°å¤§é‡çš„ç”±äº CentOS è€å†…æ ¸å¯¼è‡´çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨äº† 1.12 å†…ç½®çš„ Swarm Mode é›†ç¾¤åŠŸèƒ½åï¼Œå­˜å‚¨ã€ç½‘ç»œå‡ºç°çš„é—®é¢˜å¾ˆå¤šã€‚</p>
<p>æ‰€ä»¥ä¾æ—§å»ºè®®ä½¿ç”¨å…¶å®ƒç»´æŠ¤å†…æ ¸ç‰ˆæœ¬å‡çº§çš„ Linux å‘è¡Œç‰ˆï¼Œå¦‚ Ubuntuã€‚</p>
<h3 id="CentOS-7-RHEL-7-å‡çº§-1-12-åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ"><a href="#CentOS-7-RHEL-7-å‡çº§-1-12-åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ" class="headerlink" title="CentOS 7/RHEL 7 å‡çº§ 1.12 åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ"></a>CentOS 7/RHEL 7 å‡çº§ 1.12 åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ</h3><p>ä¸€äº›äººåœ¨å‡çº§ä¹‹åï¼Œå¯åŠ¨ Docker æ—¶å‘ç°æ— æ³•å¯åŠ¨ï¼Œè€Œåœ¨æŠ¥é”™ä¸­çœ‹åˆ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unit docker.socket failed to load: No such file or directory.</span><br></pre></td></tr></table></figure>
<p>å…¶åŸå› æ˜¯ç”±äºä» <code>1.12</code> å¼€å§‹ï¼Œä¸éœ€è¦åœ¨ <code>systemd</code> ä¸­å†™ä¸ª <code>docker.socket</code> æ–‡ä»¶äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶å°±éšå‡çº§è€Œåˆ é™¤äº†ã€‚è€Œ <code>docker.service</code> ç”±äºè¢«ä¿®æ”¹è¿‡ï¼ˆæˆ–åˆ«çš„ä»€ä¹ˆåŸå› ï¼‰ï¼Œå¯¼è‡´ <code>yum</code> å‡çº§çš„æ—¶å€™æ²¡æœ‰æ›¿æ¢è¿™ä¸ªæ–‡ä»¶ã€‚äºæ˜¯å‡ºç°äº†æ—§çš„ <code>docker.service</code> ä¸­é…ç½®è¦æ±‚æœ‰ <code>docker.socket</code> æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶å·²ç»åœ¨æ–°çš„ç‰ˆæœ¬ä¸­åˆ é™¤äº†ï¼Œæ‰€ä»¥å¯¼è‡´å¯åŠ¨é”™è¯¯ã€‚</p>
<p>è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œç›´æ¥æ‰“å¼€ <code>docker.service</code>ï¼Œå°†å…¶å‚ç…§ <code>1.12</code> çš„é»˜è®¤é…ç½®æ–‡ä»¶ä¿®æ”¹å³å¯ã€‚å¯»æ‰¾åˆ° <code>Required=docker.socket</code> é‚£è¡Œï¼Œåˆ æ‰ã€‚ç„¶åå¯»æ‰¾åˆ° <code>docker daemon</code>(æˆ–è€… <code>dockerd</code>) é‚£è¡Œï¼Œå°†å…¶åçš„ <code>-H fd://</code> åˆ æ‰ã€‚å¹¶ä¸”è¿›ä¸€æ­¥å°† <code>docker daemon</code> æ”¹ä¸º <code>dockerd</code>ï¼Œå› ä¸ºä» <code>1.12</code> å¼€å§‹æ”¹åå«è¿™ä¸ªäº†ã€‚ä¿å­˜é€€å‡ºé‡å¯æœåŠ¡å³å¯ã€‚</p>
<h2 id="Mac-Windows-ç›¸å…³é—®é¢˜"><a href="#Mac-Windows-ç›¸å…³é—®é¢˜" class="headerlink" title="Mac / Windows ç›¸å…³é—®é¢˜"></a>Mac / Windows ç›¸å…³é—®é¢˜</h2><h3 id="ä¸ºä»€ä¹ˆåœ¨Macä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•-usr-local-nginxä¸æˆåŠŸï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåœ¨Macä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•-usr-local-nginxä¸æˆåŠŸï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨Macä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•/usr/local/nginxä¸æˆåŠŸï¼Ÿ"></a>ä¸ºä»€ä¹ˆåœ¨<code>Mac</code>ä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•<code>/usr/local/nginx</code>ä¸æˆåŠŸï¼Ÿ</h3><p>è™½ç„¶ Docker å›¢é˜Ÿå°½é‡è®©ä½¿ç”¨ <a href="https://www.docker.com/products/docker-toolbox" target="_blank" rel="noopener">Docker Toolbox</a>, <a href="https://docs.docker.com/docker-for-mac/" target="_blank" rel="noopener">Docker for Mac</a> and <a href="https://docs.docker.com/docker-for-windows" target="_blank" rel="noopener">Docker for Windows</a> çš„ç”¨æˆ·æ„Ÿè§‰æ“ä½œ Docker å°±åƒåœ¨ Linux ä¸‹ä¸€æ ·ï¼Œä½†å®é™…ä¸Šåœ¨ Mac/Windows ä¸Šå¹¶éæ˜¯ç›´æ¥è¿è¡Œ Docker çš„ã€‚ä¸­é—´ç»è¿‡äº†ä¸€ä¸ª Linux è™šæ‹Ÿæœºï¼Œè€Œ Docker è¿è¡Œåœ¨é‚£ä¸ªè™šæ‹Ÿæœºé‡Œã€‚</p>
<p>å› æ­¤ Mac ä¸»æœºä¸Šçš„ç›®å½•å®é™…ä¸Šå¹¶ä¸æ˜¯ Docker çœ¼ä¸­çš„å®¿ä¸»ç›®å½•ï¼Œä¸ºäº†è®©ç”¨æˆ·å°½é‡æ„Ÿè§‰ä¸åˆ°è¿™ä¸ªå·®å¼‚ï¼Œ<code>Boot2Docker</code> æˆ–è€… <code>Docker for Mac / Windows</code> ä¸­ï¼Œå°†ä¸€éƒ¨åˆ†ç‰©ç†ä¸»æœºçš„ç›®å½•æ˜ å°„åˆ°äº† Linux è™šæ‹Ÿæœºä¸­ï¼Œè¿™æ ·å…¶ä¸Š Docker å°±å¯ä»¥è®¿é—®åˆ°è¿™äº›ç‰©ç†æœºçš„ç›®å½•äº†ã€‚</p>
<p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¹¶ä¸ä¼šæŠŠç‰©ç†æœºçš„æ‰€æœ‰ç›®å½•éƒ½æ˜ å°„åˆ° Linux è™šæ‹Ÿæœºå†…ã€‚ä¸€èˆ¬æ¥è¯´åªæœ‰å½“å‰ç”¨æˆ·ç›®å½•åœ¨å†…çš„ä¸€äº›ç›®å½•ä¼šè¢«æ˜ å°„åˆ° Linux è™šæ‹Ÿæœºå†…ï¼Œæ¯”å¦‚ <code>/Users</code>, <code>/Volumes</code> ç­‰ã€‚</p>
<p>å¯¹äº <code>Docker for Mac</code> çš„ç”¨æˆ·ï¼Œå¯ä»¥ç›´æ¥åœ¨é…ç½®ç•Œé¢ <code>File Sharing</code> ä¸­æ·»åŠ é¢å¤–çš„æ˜ å°„ç›®å½•ï¼Œä½†æ˜¯ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸æ·»åŠ é¢å¤–æ˜ å°„ï¼Œè€Œä½¿ç”¨å½“å‰ç”¨æˆ·ç›®å½•ä¸‹çš„ç›®å½•ï¼Œæ˜¯æ›´å¥½åœ°åšæ³•ã€‚</p>
<h3 id="å¬è¯´-Windows-10ã€Windows-Server-2016-å†…ç½®-Docker-äº†ï¼Ÿå’Œ-Docker-å®˜ç½‘ä¸‹è½½çš„-Docker-for-Windows-æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ"><a href="#å¬è¯´-Windows-10ã€Windows-Server-2016-å†…ç½®-Docker-äº†ï¼Ÿå’Œ-Docker-å®˜ç½‘ä¸‹è½½çš„-Docker-for-Windows-æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ" class="headerlink" title="å¬è¯´ Windows 10ã€Windows Server 2016 å†…ç½® Docker äº†ï¼Ÿå’Œ Docker å®˜ç½‘ä¸‹è½½çš„ Docker for Windows æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ"></a>å¬è¯´ Windows 10ã€Windows Server 2016 å†…ç½® Docker äº†ï¼Ÿå’Œ Docker å®˜ç½‘ä¸‹è½½çš„ Docker for Windows æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ</h3><p>äºŒè€…å®Œå…¨ä¸åŒã€‚</p>
<p>Windows 10 æˆ–è€… Windows Server 2016 è‡ªå¸¦çš„ Dockerï¼Œè¢«ç§°ä¸º <code>Docker on Windows</code>ï¼Œå…¶è¿è¡Œäº Windows NT å†…æ ¸è‡³ä¸Šï¼Œä»¥ Docker ç±»ä¼¼çš„æ–¹å¼æä¾› Windows å®¹å™¨æœåŠ¡ï¼Œå› æ­¤åªå¯ä»¥è¿è¡Œ Windows ç¨‹åºã€‚</p>
<p>è€Œ Docker å®˜ç½‘ä¸‹è½½çš„ï¼Œè¢«ç§°ä¸º <code>Docker for Windows</code>ã€‚è¿™æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ Dockerï¼Œå®ƒæ˜¯è¿è¡Œäº Linux å†…æ ¸ä¸Šçš„ Dockerã€‚åœ¨ Windows ä¸Šè¿è¡Œæ—¶å®é™…ä¸Šæ˜¯åœ¨ Hyper-V ä¸Šçš„ä¸€ä¸ª Alpine Linux è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ Dockerã€‚å®ƒåªå¯ä»¥è¿è¡Œ Linux ç¨‹åºã€‚</p>
<p><code>Docker on Windows</code> æä¸ºè‡ƒè‚¿ï¼Œæœ€å°é•œåƒä¹Ÿè¿‘ GBï¼Œå¯åŠ¨æ—¶é—´å¹¶ä¸å¿«ï¼›è€Œ <code>Docker for Windows</code> åˆ™æ˜¯æ­£å¸¸çš„ Dockerï¼Œæœ€å°é•œåƒä¹Ÿå°±å‡ å KBï¼Œä¸€èˆ¬çš„é•œåƒéƒ½åœ¨å‡ ç™¾å…†ä»¥å†…ï¼Œè€Œä¸”å¯åŠ¨æ—¶é—´åŸºæœ¬æ˜¯æ¯«ç§’çº§ã€‚</p>
<p>å¸Œæœ›å¯¹ <code>Docker on Windows</code> æœ‰æ‰€äº†è§£çš„ç«¥é‹å¯ä»¥çœ‹ä¸€ä¸‹ä¸€ä¸ª DockerCon çš„è§†é¢‘ï¼Œæ˜¯ç”±å¾®è½¯è´Ÿè´£ Docker é¡¹ç›®çš„æ„æ¶å¸ˆè¿›è¡Œçš„ä»‹ç»ï¼Œä»ä¸­å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ‰‹çš„ä¿¡æ¯ï¼ŒWindows åˆ°åº•æœ‰å¤šæƒ¨ã€‚è¿™ä¸ªè§†é¢‘æˆ‘åšäº†ç¬”è®°ï¼Œå¯ä»¥åˆ°è¿™é‡Œçœ‹ä¸€ä¸‹ï¼š&lt;/post/docker-2016-08-12-video-windows-server-and-docker.html&gt;</p>
<h1 id="å…¶å®ƒé—®é¢˜-1"><a href="#å…¶å®ƒé—®é¢˜-1" class="headerlink" title="å…¶å®ƒé—®é¢˜ (1)"></a>å…¶å®ƒé—®é¢˜ <code>(1)</code></h1><h2 id="Kubernetes-è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå«-k8s-ï¼Ÿ"><a href="#Kubernetes-è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå«-k8s-ï¼Ÿ" class="headerlink" title="Kubernetes è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå« k8s ï¼Ÿ"></a><code>Kubernetes</code> è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå« <code>k8s</code> ï¼Ÿ</h2><p>Kubernetes çš„å‘éŸ³ï¼š<code>koo-ber-nay&#39;-tace</code> ï¼Œï¼ˆå¦‚æœéç”¨ä¸­æ–‡æ‹¼å‡‘çš„è¯ï¼Œå¤§æ¦‚æ˜¯<code>â€œé…·-åš-å†…-å¿’ä¸â€</code>ï¼‰ï¼Œè¿™è¯æ¥è‡ªå¸Œè…Š<code>èˆµæ‰‹</code>è¿™ä¸ªè¯ã€‚<br>ä½†æ˜¯ç»å¸¸æœ‰äººå¿µæˆï¼š<code>koo-ber-net-ees</code>ï¼Œï¼ˆå¦‚æœéç”¨ä¸­æ–‡æ‹¼å‡‘çš„è¯ï¼Œå¤§æ¦‚æ˜¯<code>â€œé…·-åš-è€-æ›¿â€</code>ï¼‰ã€‚ä¹Ÿæœ‰äººçŠ¯æ‡’ç»å¸¸æ˜¯å¿µæˆ <code>k8s</code>ï¼Œä¹Ÿå°±æ˜¯ <code>k-eights</code>ã€‚</p>
<p><a href="http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html" target="_blank" rel="noopener">http://www.biblestudytools.com/lexicons/greek/nas/kubernetes.html</a></p>
<p>è‡³äºä¸ºå•¥å« <code>k8s</code>ï¼Œæ˜¯å› ä¸ºå‘éŸ³æ¥è¿‘ä¹ˆï¼Ÿâ€¦â€¦å¥½å§ï¼Œå®è¯è¯´äº†å§ï¼Œæ˜¯å› ä¸ºçŠ¯æ‡’ï¼Œæ•°æ•° <code>k</code> å’Œ <code>s</code> ä¸­é—´å¤šå°‘ä¸ªå­—æ¯ï¼Ÿ8 ä¸ªå§ï¼Œè¿™ä¸ª 8 çš„æ„æ€å°±æ˜¯çœç•¥ 8 ä¸ªå­—æ¯ï¼Œæ‡’å¾—æ•²äº†â€¦â€¦ å…¶å®è¿™ç±»ç”¨æ³•å¾ˆå¤šï¼Œæ¯”å¦‚ <code>i18n</code> (<code>internationalization</code>), <code>l11n</code> (<code>localization</code>) ç­‰ç­‰ï¼Œè€å¤–ä¹Ÿæ‡’å¾—æ‰“å­—å•Šã€‚</p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>åŸæ–‡ä½œè€…ï¼š<a href="http://note.run-linux.com">Linus Lee</a>
            <p>åŸæ–‡é“¾æ¥ï¼š<a href="http://note.run-linux.com/2018/06/15/Docker-faq/">http://note.run-linux.com/2018/06/15/Docker-faq/</a>
            <p>å‘è¡¨æ—¥æœŸï¼š<a href="http://note.run-linux.com/2018/06/15/Docker-faq/">June 15th 2018, 8:43:22 pm</a>
            <p>æ›´æ–°æ—¥æœŸï¼š<a href="http://note.run-linux.com/2018/06/15/Docker-faq/">July 5th 2018, 12:38:22 am</a>
            <p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2018/06/21/Linux-Primer/" title= "Linux-Primer">
                    <div class="nextTitle">Linux-Primer</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2017/12/12/Binary-tree/" title= "Binary tree  of Data Structure">
                    <div class="prevTitle">Binary tree  of Data Structure</div>
                </a>
            
        </li>
    </ul>
    <!-- è¯„è®ºæ’ä»¶ -->
    <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->

    <div id="lv-container" data-id="city" data-uid= MTAyMC8zMjU0Ni85MTA3>
        <script type="text/javascript">
            (function (d, s) {
                var j, e = d.getElementsByTagName(s)[0];
                if (typeof LivereTower === 'function') { return; }
                j = d.createElement(s);
                j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                j.async = true;

                e.parentNode.insertBefore(j, e);
            })(document, 'script');
        </script>
        <noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
    </div>

<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
    
    
    <!-- partial('_partial/comment/changyan') -->
    <!--PCç‰ˆ-->


    
    

    <!-- è¯„è®º -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:708863861@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/mr-linus" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- ä¸è’œå­  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-å¼•æ“ç›¸å…³é—®é¢˜-67"><span class="toc-number">2.</span> <span class="toc-text">Docker å¼•æ“ç›¸å…³é—®é¢˜ (67)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æ¦‚å¿µé—®é¢˜-5"><span class="toc-number">2.1.</span> <span class="toc-text">æ¦‚å¿µé—®é¢˜ (5)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ-Docker-å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ"><span class="toc-number">2.1.1.</span> <span class="toc-text">å®¿ä¸»å¦‚æœå’Œå®¹å™¨ç³»ç»Ÿä¸åŒçš„è¯ï¼Œé‚£ä¸æ˜¯å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸€å±‚å±‚çš„è°ƒç”¨ï¼Œé‚£ä¹ˆ Docker å’Œè™šæ‹Ÿæœºè¿˜æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ"><span class="toc-number">2.1.2.</span> <span class="toc-text">Docker èµ„æ–™å¥½å°‘å•Šï¼Ÿç½‘ä¸Šçš„å‘½ä»¤æ€ä¹ˆä¸èƒ½ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•é€‰æ‹©-Docker-ä¹¦ç±ï¼Ÿ"><span class="toc-number">2.1.3.</span> <span class="toc-text">å¦‚ä½•é€‰æ‹© Docker ä¹¦ç±ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯-Docker-å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.1.4.</span> <span class="toc-text">æ€»è¯´çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå¯æ˜¯ Docker å®˜ç½‘æ–‡æ¡£ç»å¸¸è¢«å¢™ï¼Œçœ‹ä¸äº†æ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-1-8-ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ"><span class="toc-number">2.1.5.</span> <span class="toc-text">Docker 1.8 ä»¥åç‰ˆæœ¬éƒ½æœ‰ä»€ä¹ˆæ”¹è¿›ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®‰è£…ã€é…ç½®é—®é¢˜-8"><span class="toc-number">2.2.</span> <span class="toc-text">å®‰è£…ã€é…ç½®é—®é¢˜ (8)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ"><span class="toc-number">2.2.1.</span> <span class="toc-text">Docker æ€ä¹ˆè¿™ä¹ˆå¤šè½¯ä»¶ï¼Œæˆ‘è¯¥è£…å“ªä¸ªï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ˜¯ç›´æ¥ç”¨-yum-apt-get-å®‰è£…-Docker-å—ï¼Ÿ"><span class="toc-number">2.2.2.</span> <span class="toc-text">æ˜¯ç›´æ¥ç”¨ yum / apt-get å®‰è£… Docker å—ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#17-04-åŠä»¥åçš„ç‰ˆæœ¬"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">17.04 åŠä»¥åçš„ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-03-åŠä»¥å‰çš„ç‰ˆæœ¬"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">17.03 åŠä»¥å‰çš„ç‰ˆæœ¬</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ-Docker-17-07-äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯-17-05-å‘€ï¼Ÿ"><span class="toc-number">2.2.3.</span> <span class="toc-text">ä¸æ˜¯éƒ½å·²ç»å‘å¸ƒ Docker 17.07 äº†ä¹ˆï¼Ÿæˆ‘æ€ä¹ˆå‡çº§åˆ°æœ€æ–°è¿˜æ˜¯ 17.05 å‘€ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-pull-å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.2.4.</span> <span class="toc-text">docker pull å¥½æ…¢å•Šæ€ä¹ˆåŠï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Ubuntu-14-04-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Upstart-çš„ç³»ç»Ÿï¼‰"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">Ubuntu 14.04 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Upstart çš„ç³»ç»Ÿï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ubuntu-16-04-æˆ–-CentOS-7-é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨-Systemd-çš„ç³»ç»Ÿï¼‰"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">Ubuntu 16.04 æˆ– CentOS 7 é…ç½®åŠ é€Ÿå™¨ï¼ˆæˆ–å…¶å®ƒä½¿ç”¨ Systemd çš„ç³»ç»Ÿï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€ä¹ˆä¿®æ”¹äº†-docker-æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ"><span class="toc-number">2.2.5.</span> <span class="toc-text">æ€ä¹ˆä¿®æ”¹äº† docker æœåŠ¡é…ç½®åä¸èµ·ä½œç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚æœ-Docker-å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ"><span class="toc-number">2.2.6.</span> <span class="toc-text">å¦‚æœ Docker å‡çº§æˆ–è€…é‡å¯çš„è¯ï¼Œé‚£å®¹å™¨æ˜¯ä¸æ˜¯éƒ½ä¼šè¢«åœæ‰ç„¶åé‡å¯å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆæ‰§è¡Œ-docker-å‘½ä»¤ä¼šæŠ¥-permission-denied-æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ"><span class="toc-number">2.2.7.</span> <span class="toc-text">ä¸ºä»€ä¹ˆæ‰§è¡Œ docker å‘½ä»¤ä¼šæŠ¥ permission denied æ²¡æƒé™çš„é”™è¯¯å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª-xmrig-çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"><span class="toc-number">2.2.8.</span> <span class="toc-text">æœåŠ¡å™¨ä¸Šçº¿åï¼Œæ€ä¹ˆå‘ç°æ€»æœ‰ä¸ª xmrig çš„å®¹å™¨åœ¨è·‘ï¼Œåˆ äº†è¿˜å‡ºæ¥ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç½‘ç»œé—®é¢˜-13"><span class="toc-number">2.3.</span> <span class="toc-text">ç½‘ç»œé—®é¢˜ (13)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€ä¹ˆå›ºå®šå®¹å™¨-IP-åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ–-IP-åœ°å€æ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.3.1.</span> <span class="toc-text">æ€ä¹ˆå›ºå®šå®¹å™¨ IP åœ°å€ï¼Ÿæ¯æ¬¡é‡å¯å®¹å™¨éƒ½è¦å˜åŒ– IP åœ°å€æ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„-etc-hosts-æ–‡ä»¶ï¼Ÿ"><span class="toc-number">2.3.2.</span> <span class="toc-text">å¦‚ä½•ä¿®æ”¹å®¹å™¨çš„ /etc/hosts æ–‡ä»¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼ŸDockerfile-ä¸­çš„EXPOSEå’Œ-docker-run-p-æœ‰å•¥åŒºåˆ«ï¼Ÿ"><span class="toc-number">2.3.3.</span> <span class="toc-text">æ€ä¹ˆæ˜ å°„å®¿ä¸»ç«¯å£ï¼ŸDockerfile ä¸­çš„EXPOSEå’Œ docker run -p æœ‰å•¥åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª-p-ä¹ˆï¼Ÿ"><span class="toc-number">2.3.4.</span> <span class="toc-text">æˆ‘è¦æ˜ å°„å¥½å‡ ç™¾ä¸ªç«¯å£ï¼Œéš¾é“è¦ä¸€ä¸ªä¸ª -p ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆ-p-åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ"><span class="toc-number">2.3.5.</span> <span class="toc-text">ä¸ºä»€ä¹ˆ -p åè¿˜æ˜¯æ— æ³•é€šè¿‡æ˜ å°„ç«¯å£è®¿é—®å®¹å™¨é‡Œé¢çš„æœåŠ¡ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æœ¬æœºé˜²ç«å¢™"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">æœ¬æœºé˜²ç«å¢™</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#è¾¹ç•Œé˜²ç«å¢™"><span class="toc-number">2.3.5.2.</span> <span class="toc-text">è¾¹ç•Œé˜²ç«å¢™</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vethxxxx-è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ"><span class="toc-number">2.3.6.</span> <span class="toc-text">vethxxxx è¿™ç§è™šæ‹Ÿç½‘å¡å’Œå®¹å™¨çš„å¯¹åº”å…³ç³»ä»å“ªé‡Œçœ‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ"><span class="toc-number">2.3.7.</span> <span class="toc-text">å¦‚ä½•è®©ä¸€ä¸ªå®¹å™¨è¿æ¥ä¸¤ä¸ªç½‘ç»œï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ"><span class="toc-number">2.3.8.</span> <span class="toc-text">Docker å¤šå®¿ä¸»ç½‘ç»œæ€ä¹ˆé…ç½®ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ˜æ˜-docker-network-ls-ä¸­çœ‹åˆ°äº†å»ºç«‹çš„-overlay-ç½‘ç»œï¼Œæ€ä¹ˆ-docker-run-è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ"><span class="toc-number">2.3.9.</span> <span class="toc-text">æ˜æ˜ docker network ls ä¸­çœ‹åˆ°äº†å»ºç«‹çš„ overlay ç½‘ç»œï¼Œæ€ä¹ˆ docker run è¿˜è¯´ç½‘ç»œä¸å­˜åœ¨å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-Swarm-Mode-çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå«-ingress-çš„-overlay-ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><span class="toc-number">2.3.10.</span> <span class="toc-text">ä½¿ç”¨ Swarm Mode çš„æ—¶ï¼Œçœ‹åˆ°æœ‰ä¸ªå« ingress çš„ overlay ç½‘ç»œï¼Œå®ƒå’Œè‡ªå·±åˆ›å»ºçš„ç½‘ç»œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¬è¯´-link-è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.3.11.</span> <span class="toc-text">å¬è¯´ --link è¿‡æ—¶ä¸å†ç”¨äº†ï¼Ÿé‚£å®¹å™¨äº’è”ã€æœåŠ¡å‘ç°æ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½¿ç”¨-HBase-Hadoop-çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.3.12.</span> <span class="toc-text">ä½¿ç”¨ HBase/Hadoop çš„æ—¶å€™ï¼Œåå‘è§£ææ€»æ˜¯ä¸å¯¹ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº-IP-å•Šï¼Ÿ"><span class="toc-number">2.3.13.</span> <span class="toc-text">å®¹å™¨æ€ä¹ˆå–å®¿ä¸»æœº IP å•Šï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å•æœºç¯å¢ƒ"><span class="toc-number">2.3.13.1.</span> <span class="toc-text">å•æœºç¯å¢ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é›†ç¾¤ç¯å¢ƒ"><span class="toc-number">2.3.13.2.</span> <span class="toc-text">é›†ç¾¤ç¯å¢ƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å­˜å‚¨é—®é¢˜-11"><span class="toc-number">2.4.</span> <span class="toc-text">å­˜å‚¨é—®é¢˜ (11)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ"><span class="toc-number">2.4.1.</span> <span class="toc-text">å®¹å™¨ç£ç›˜å¯ä»¥é™åˆ¶é…é¢ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ"><span class="toc-number">2.4.2.</span> <span class="toc-text">å®¹å™¨å†…çš„æ•°æ®è¯¥ä¿å­˜åœ¨é•œåƒé‡Œè¿˜æ˜¯ç‰©ç†æœºé‡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"><span class="toc-number">2.4.3.</span> <span class="toc-text">çœ‹åˆ°æ€»è¯´è¦ä¿æŒå®¹å™¨æ— çŠ¶æ€ï¼Œé‚£ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">æœåŠ¡å±‚é¢çš„æ— çŠ¶æ€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><span class="toc-number">2.4.4.</span> <span class="toc-text">æ•°æ®å®¹å™¨ã€æ•°æ®å·ã€å‘½åå·ã€åŒ¿åå·ã€æŒ‚è½½ç›®å½•è¿™äº›éƒ½æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><span class="toc-number">2.4.5.</span> <span class="toc-text">å·å’ŒæŒ‚è½½ç›®å½•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ"><span class="toc-number">2.4.6.</span> <span class="toc-text">ä¸ºä»€ä¹ˆç»‘å®šäº†å®¿ä¸»çš„æ–‡ä»¶åˆ°å®¹å™¨ï¼Œå®¿ä¸»ä¿®æ”¹äº†æ–‡ä»¶ï¼Œå®¹å™¨å†…çœ‹åˆ°çš„è¿˜æ˜¯æ—§çš„å†…å®¹å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¤šä¸ª-Docker-å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS-ï¼Ÿ"><span class="toc-number">2.4.7.</span> <span class="toc-text">å¤šä¸ª Docker å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®æ€ä¹ˆåŠï¼ŸNFS ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡-cron-æ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.4.8.</span> <span class="toc-text">æ—¢ç„¶ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆæˆ‘æƒ³åœ¨è¯¥å®¹å™¨ä¸­ç”¨è®¡åˆ’ä»»åŠ¡ cron æ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ"><span class="toc-number">2.4.9.</span> <span class="toc-text">å¦‚ä½•åˆå§‹åŒ–å·ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ­£å¸¸æŒ‚è½½è¯¥-mydata-å·ï¼Œç„¶å-docker-cp-è¿›å»"><span class="toc-number">2.4.9.1.</span> <span class="toc-text">æ­£å¸¸æŒ‚è½½è¯¥ mydata å·ï¼Œç„¶å docker cp è¿›å»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ"><span class="toc-number">2.4.9.2.</span> <span class="toc-text">ä¸“é—¨åˆ¶ä½œåˆå§‹åŒ–é•œåƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åœ¨é•œåƒçš„-Dockerfile-åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†"><span class="toc-number">2.4.9.3.</span> <span class="toc-text">åœ¨é•œåƒçš„ Dockerfile åˆ¶ä½œä¸­ï¼ŒåŠ å…¥åˆå§‹åŒ–éƒ¨åˆ†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨-Docker-å®¹å™¨é‡Œè¿è¡Œï¼Ÿ"><span class="toc-number">2.4.10.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¯´æ•°æ®åº“ä¸é€‚åˆæ”¾åœ¨ Docker å®¹å™¨é‡Œè¿è¡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ"><span class="toc-number">2.4.11.</span> <span class="toc-text">å¦‚ä½•åˆ—å‡ºå®¹å™¨å’Œæ‰€ä½¿ç”¨çš„å·çš„å…³ç³»ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é•œåƒé—®é¢˜-17"><span class="toc-number">2.5.</span> <span class="toc-text">é•œåƒé—®é¢˜ (17)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-pull-ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ"><span class="toc-number">2.5.1.</span> <span class="toc-text">docker pull ä¸‹æ¥çš„é•œåƒæ–‡ä»¶éƒ½åœ¨å“ªï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-images-å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ"><span class="toc-number">2.5.2.</span> <span class="toc-text">docker images å‘½ä»¤æ˜¾ç¤ºçš„é•œåƒå äº†å¥½å¤§çš„ç©ºé—´ï¼Œæ€ä¹ˆåŠï¼Ÿæ¯æ¬¡éƒ½æ˜¯ä¸‹è½½è¿™ä¹ˆå¤§çš„é•œåƒï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-images-a-åæ˜¾ç¤ºäº†å¥½å¤š-lt-none-gt-çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ"><span class="toc-number">2.5.3.</span> <span class="toc-text">docker images -a åæ˜¾ç¤ºäº†å¥½å¤š &lt;none&gt; çš„é•œåƒï¼Ÿéƒ½æ˜¯ä»€ä¹ˆå‘€ï¼Ÿèƒ½åˆ ä¹ˆï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¾èµ–é•œåƒ"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">ä¾èµ–é•œåƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸¢äº†æ ‡ç­¾çš„é•œåƒ"><span class="toc-number">2.5.3.2.</span> <span class="toc-text">ä¸¢äº†æ ‡ç­¾çš„é•œåƒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆ-Docker-Hub-çš„é•œåƒå°ºå¯¸å’Œ-docker-images-ä¸ä¸€è‡´ï¼Ÿ"><span class="toc-number">2.5.4.</span> <span class="toc-text">ä¸ºä»€ä¹ˆ Docker Hub çš„é•œåƒå°ºå¯¸å’Œ docker images ä¸ä¸€è‡´ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-commit-æ€ä¹ˆç”¨å•Šï¼Ÿ"><span class="toc-number">2.5.5.</span> <span class="toc-text">docker commit æ€ä¹ˆç”¨å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨-import-export-save-load-commit-æ¥æ„å»ºé•œåƒï¼Ÿ"><span class="toc-number">2.5.6.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¯´ä¸è¦ä½¿ç”¨ import, export, save, load, commit æ¥æ„å»ºé•œåƒï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-æ€ä¹ˆå†™ï¼Ÿ"><span class="toc-number">2.5.7.</span> <span class="toc-text">Dockerfile æ€ä¹ˆå†™ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile-å°±æ˜¯-shell-è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚"><span class="toc-number">2.5.8.</span> <span class="toc-text">Dockerfile å°±æ˜¯ shell è„šæœ¬å§ï¼Ÿé‚£æˆ‘æ‡‚ï¼Œä¸€è¡Œè¡ŒæŠŠéœ€è¦è£…çš„ä¸œè¥¿éƒ½å†™è¿›å»ä¸å°±è¡Œäº†ã€‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª-RUN-å°±å¯¹äº†å§ï¼Ÿ"><span class="toc-number">2.5.9.</span> <span class="toc-text">é‚£æˆ‘æŠŠæ‰€æœ‰å‘½ä»¤éƒ½åˆå¹¶åˆ°ä¸€ä¸ª RUN å°±å¯¹äº†å§ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#context-åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ"><span class="toc-number">2.5.10.</span> <span class="toc-text">context åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ENTRYPOINT-å’Œ-CMD-åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><span class="toc-number">2.5.11.</span> <span class="toc-text">ENTRYPOINT å’Œ CMD åˆ°åº•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„-Dockerfile-ï¼Ÿ"><span class="toc-number">2.5.12.</span> <span class="toc-text">æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¦‚ä½•è·å¾—é•œåƒçš„ Dockerfile ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åœ¨ä½ çš„-LNMP-çš„ä¾‹å­ä¸­ï¼ŒPHP-çš„-Dockerfile-é‡Œé¢çš„-â€œæ„å»ºä¾èµ–â€-å’Œ-â€œè¿è¡Œä¾èµ–â€-éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><span class="toc-number">2.5.13.</span> <span class="toc-text">åœ¨ä½ çš„ LNMP çš„ä¾‹å­ä¸­ï¼ŒPHP çš„ Dockerfile é‡Œé¢çš„ â€œæ„å»ºä¾èµ–â€ å’Œ â€œè¿è¡Œä¾èµ–â€ éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ"><span class="toc-number">2.5.14.</span> <span class="toc-text">åº”ç”¨ä»£ç æ˜¯åº”è¯¥æŒ‚è½½å®¿ä¸»ç›®å½•è¿˜æ˜¯æ”¾å…¥é•œåƒå†…ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆåœ¨-Dockerfile-ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥-sqlã€service-xxx-startï¼‰ä¸ç®¡ç”¨ï¼Ÿ"><span class="toc-number">2.5.15.</span> <span class="toc-text">ä¸ºä»€ä¹ˆåœ¨ Dockerfile ä¸­æ‰§è¡Œï¼ˆå¯¼å…¥ .sqlã€service xxx startï¼‰ä¸ç®¡ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆåŸºäº-Alpine-çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº-Alpine-çš„é•œåƒä¹ˆï¼Ÿ"><span class="toc-number">2.5.16.</span> <span class="toc-text">ä¸ºä»€ä¹ˆåŸºäº Alpine çš„é•œåƒé‚£ä¹ˆå°ï¼Ÿæˆ‘å¯ä»¥éƒ½æ¢æˆåŸºäº Alpine çš„é•œåƒä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ"><span class="toc-number">2.5.17.</span> <span class="toc-text">å¯ä»¥çœ‹åˆ°é•œåƒå„å±‚çš„ä¾èµ–å…³ç³»ä¹ˆï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ—¥å¿—é—®é¢˜-2"><span class="toc-number">2.6.</span> <span class="toc-text">æ—¥å¿—é—®é¢˜ (2)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ"><span class="toc-number">2.6.1.</span> <span class="toc-text">Docker æ—¥å¿—éƒ½åœ¨å“ªé‡Œï¼Ÿæ€ä¹ˆæ”¶é›†ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-å¼•æ“æ—¥å¿—"><span class="toc-number">2.6.1.1.</span> <span class="toc-text">Docker å¼•æ“æ—¥å¿—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å®¹å™¨æ—¥å¿—"><span class="toc-number">2.6.1.2.</span> <span class="toc-text">å®¹å™¨æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ°-fluentd-åå¦‚ä½•åŒºåˆ†ï¼Ÿ"><span class="toc-number">2.6.2.</span> <span class="toc-text">ä¸åŒå®¹å™¨çš„æ—¥å¿—æ±‡èšåˆ° fluentd åå¦‚ä½•åŒºåˆ†ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½¿ç”¨é—®é¢˜-11"><span class="toc-number">2.7.</span> <span class="toc-text">ä½¿ç”¨é—®é¢˜ (11)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ"><span class="toc-number">2.7.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆå®¹å™¨ä¸€è¿è¡Œå°±é€€å‡ºå•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•åœ¨-Docker-å®¹å™¨å†…ä½¿ç”¨-docker-å‘½ä»¤-æ¯”å¦‚åœ¨-Jenkins-å®¹å™¨ä¸­-ï¼Ÿ"><span class="toc-number">2.7.2.</span> <span class="toc-text">å¦‚ä½•åœ¨ Docker  å®¹å™¨å†…ä½¿ç”¨ docker å‘½ä»¤(æ¯”å¦‚åœ¨ Jenkins å®¹å™¨ä¸­)ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ä¸º-Jenkins-æ·»åŠ -Docker-å‘½ä»¤è¡Œ"><span class="toc-number">2.7.2.1.</span> <span class="toc-text">ä¸º Jenkins æ·»åŠ  Docker å‘½ä»¤è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ"><span class="toc-number">2.7.3.</span> <span class="toc-text">Docker å®¹å™¨å¦‚ä½•éšç³»ç»Ÿä¸€åŒå¯åŠ¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-stats-æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ"><span class="toc-number">2.7.4.</span> <span class="toc-text">docker stats æ˜¾ç¤ºçš„åªæœ‰å®¹å™¨IDï¼Œæ€ä¹ˆæ‰èƒ½æ˜¾ç¤ºå®¹å™¨åå­—ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘-Ubuntu-14-04-ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯3-13ï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">2.7.5.</span> <span class="toc-text">æˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘ Ubuntu 14.04 ä¸»æœºï¼Œå†…æ ¸è¿˜æ˜¯3.13ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ"><span class="toc-number">2.7.6.</span> <span class="toc-text">å¦‚ä½•åŠ¨æ€ä¿®æ”¹å†…å­˜é™åˆ¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ç»å¸¸åœ¨å„ç§-Docker-å‘½ä»¤é‡Œçœ‹åˆ°-labelï¼Œlabel-æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ"><span class="toc-number">2.7.7.</span> <span class="toc-text">ç»å¸¸åœ¨å„ç§ Docker å‘½ä»¤é‡Œçœ‹åˆ° --labelï¼Œlabel æ˜¯ä»€ä¹ˆï¼Ÿå¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ·»åŠ labelä»¥åŠè¿‡æ»¤"><span class="toc-number">2.7.7.1.</span> <span class="toc-text">æ·»åŠ labelä»¥åŠè¿‡æ»¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é›†ç¾¤è°ƒåº¦çº¦æŸ"><span class="toc-number">2.7.7.2.</span> <span class="toc-text">é›†ç¾¤è°ƒåº¦çº¦æŸ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#éƒ½è¯´ä¸è¦ç”¨-root-å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„-Dockerfile-éƒ½æ˜¯ç”¨-root-å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ"><span class="toc-number">2.7.8.</span> <span class="toc-text">éƒ½è¯´ä¸è¦ç”¨ root å»è¿è¡ŒæœåŠ¡ï¼Œä½†æˆ‘çœ‹åˆ°çš„ Dockerfile éƒ½æ˜¯ç”¨ root å»è¿è¡Œï¼Œè¿™ä¸å®‰å…¨å§ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ-systemctl-start-xxx-æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ"><span class="toc-number">2.7.9.</span> <span class="toc-text">æˆ‘åœ¨å®¹å™¨é‡Œè¿è¡Œ systemctl start xxx æ€ä¹ˆæŠ¥é”™å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ"><span class="toc-number">2.7.10.</span> <span class="toc-text">å®¹å™¨å†…çš„æ—¶é—´å’Œå®¿ä¸»ä¸ä¸€è‡´ï¼Œæ€ä¹ˆåŒæ­¥å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè·-SIGTERM-ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ"><span class="toc-number">2.7.11.</span> <span class="toc-text">æˆ‘æƒ³è®©æˆ‘çš„ç¨‹åºå¹³æ»‘é€€å‡ºï¼Œä¸ºä»€ä¹ˆæˆªè· SIGTERM ä¿¡å·ä¸ç®¡ç”¨å•Šï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose-ç›¸å…³é—®é¢˜-2"><span class="toc-number">3.</span> <span class="toc-text">Docker Compose ç›¸å…³é—®é¢˜ (2)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½ é‚£ä¸ª-LNMP-ä¾‹å­ä¸­çš„-docker-compose-yml-ä¸­æœ‰å¥½å¤š-networksï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ"><span class="toc-number">3.1.</span> <span class="toc-text">ä½ é‚£ä¸ª LNMP ä¾‹å­ä¸­çš„ docker-compose.yml ä¸­æœ‰å¥½å¤š networksï¼Œéƒ½æ˜¯ä»€ä¹ˆæ„æ€å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½¿ç”¨-Compose-çš„æ—¶å€™ç¢°åˆ°-â€œAn-HTTP-request-took-too-long-to-completeâ€¦-â€-é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">3.2.</span> <span class="toc-text">ä½¿ç”¨ Compose çš„æ—¶å€™ç¢°åˆ° â€œAn HTTP request took too long to completeâ€¦.â€ é”™è¯¯ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Swarm-ç›¸å…³é—®é¢˜-8"><span class="toc-number">4.</span> <span class="toc-text">Docker Swarm ç›¸å…³é—®é¢˜ (8)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æˆ‘çš„-Docker-ç‰ˆæœ¬æ˜¯-1-12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£-Swarm-è¿˜æ˜¯äºŒä»£-Swarm-å•Šï¼Ÿ"><span class="toc-number">4.1.</span> <span class="toc-text">æˆ‘çš„ Docker ç‰ˆæœ¬æ˜¯ 1.12ï¼Œè¯·é—®æˆ‘è·‘çš„æ˜¯ä¸€ä»£ Swarm è¿˜æ˜¯äºŒä»£ Swarm å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ"><span class="toc-number">4.2.</span> <span class="toc-text">Swarmç¯å¢ƒä¸­æ€ä¹ˆæŒ‡å®šæŸä¸ªå®¹å™¨åœ¨æŒ‡å®šçš„å®¿ä¸»ä¸Šè¿è¡Œå‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ºä»€ä¹ˆ-Swarm-é›†ç¾¤çš„-overlay-network-è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ"><span class="toc-number">4.3.</span> <span class="toc-text">ä¸ºä»€ä¹ˆ Swarm é›†ç¾¤çš„ overlay network è·¨å®¿ä¸»æ— æ³•äº’è®¿ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-äºŒä»£Swarm-æ—¢-Swarm-Mode-ï¼Œdocker-service-create-ä¸å¯ä»¥ä½¿ç”¨-v-é‚£æ€ä¹ˆä½¿ç”¨å·-Volume-ï¼Ÿ"><span class="toc-number">4.4.</span> <span class="toc-text">Docker äºŒä»£Swarm (æ—¢ Swarm Mode)ï¼Œdocker service create ä¸å¯ä»¥ä½¿ç”¨ -v é‚£æ€ä¹ˆä½¿ç”¨å·(Volume)ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ-replicas-2-å’Œ-mode-global-æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ"><span class="toc-number">4.5.</span> <span class="toc-text">å¯¹äºä¸¤èŠ‚ç‚¹é›†ç¾¤æ¥è¯´ï¼Œ--replicas=2 å’Œ --mode=global æ˜¯ä¸æ˜¯ä¸€ä¸ªæ„æ€ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸€ä»£-Swarm-çš„æ—¶å€™å¯ä»¥ç”¨-docker-run-å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª-docker-service-create-å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ"><span class="toc-number">4.6.</span> <span class="toc-text">ä¸€ä»£ Swarm çš„æ—¶å€™å¯ä»¥ç”¨ docker run å•Šï¼ŒäºŒä»£æ€ä¹ˆåˆå¼„ä¸ª docker service create å‡ºæ¥ï¼Ÿä¸ºä»€ä¹ˆè¦å¤šæ­¤ä¸€ä¸¾ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-service-ps-é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ"><span class="toc-number">4.7.</span> <span class="toc-text">docker service ps é‡Œé¢æ€»æ˜¯æœ‰ä¸€å †å¤±è´¥æˆ–è€…shutdownçš„å†å²å®¹å™¨ï¼Œæ€ä¹ˆåˆ å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€ä¹ˆæ‰èƒ½è®©-docker-service-create-åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ"><span class="toc-number">4.8.</span> <span class="toc-text">æ€ä¹ˆæ‰èƒ½è®© docker service create åˆ›å»ºçš„æœåŠ¡æ­£å¸¸é€€å‡ºæ—¶ä¸é‡å¯å•Šï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Machine-ç›¸å…³é—®é¢˜-5"><span class="toc-number">5.</span> <span class="toc-text">Docker Machine ç›¸å…³é—®é¢˜ (5)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥-boot2docker-isoï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">5.1.</span> <span class="toc-text">æ‰“å¼€å‘½ä»¤è¡Œåï¼Œçœ‹åˆ°ä¸‹è½½å•¥ boot2docker.isoï¼Œç„¶åæ€»æ˜¯è¶…æ—¶å¤±è´¥ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è£…å®Œ-Docker-Toolbox-åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ"><span class="toc-number">5.2.</span> <span class="toc-text">è£…å®Œ Docker Toolbox åå‘ç°ä¸‹è½½é•œåƒé€Ÿåº¦å¤ªæ…¢ï¼Œæ˜¯ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¦‚ä½•åœ¨-Docker-Toolbox-ä¸­åˆ›å»ºçš„-default-è™šæ‹Ÿæœºä¸­æ·»åŠ DOCKER-OPTSä¹‹ç±»çš„é…ç½®ï¼Ÿ"><span class="toc-number">5.3.</span> <span class="toc-text">å¦‚ä½•åœ¨ Docker Toolbox ä¸­åˆ›å»ºçš„ default è™šæ‹Ÿæœºä¸­æ·»åŠ DOCKER_OPTSä¹‹ç±»çš„é…ç½®ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰docker-machine-å‘½ä»¤"><span class="toc-number">5.4.</span> <span class="toc-text">ä¸ºä»€ä¹ˆæˆ‘å®‰è£…å¥½çš„Dockeræ²¡æœ‰docker-machine å‘½ä»¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-machine-åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥-ssh-è¿›å»ï¼Ÿæ”¹äº†-root-å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ"><span class="toc-number">5.5.</span> <span class="toc-text">docker-machine åˆ›å»ºçš„ä¸»æœºæ€ä¹ˆç›´æ¥ ssh è¿›å»ï¼Ÿæ”¹äº† root å¯†ç å¥½åƒä¹Ÿæ²¡ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-machine-ä½¿ç”¨-d-generic-æ—¶ï¼ŒæŒ‡å®šç”¨æˆ·-generic-ssh-user-åå‘ç°è¦-sudo-å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ"><span class="toc-number">5.6.</span> <span class="toc-text">docker-machine ä½¿ç”¨ -d generic æ—¶ï¼ŒæŒ‡å®šç”¨æˆ· --generic-ssh-user åå‘ç°è¦ sudo å¯†ç ï¼Œç»“æœæŠ¥é”™é€€å‡ºï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Registry-ç›¸å…³é—®é¢˜-10"><span class="toc-number">6.</span> <span class="toc-text">Docker Registry ç›¸å…³é—®é¢˜ (10)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æˆ‘-docker-push-çš„æ—¶å€™æ€ä¹ˆæŠ¥-authentication-required-é”™è¯¯ï¼Ÿ"><span class="toc-number">6.1.</span> <span class="toc-text">æˆ‘ docker push çš„æ—¶å€™æ€ä¹ˆæŠ¥ authentication required é”™è¯¯ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ºä»€ä¹ˆæˆ‘-docker-login-å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ"><span class="toc-number">6.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆæˆ‘ docker login å¤±è´¥äº†ï¼Ÿæˆ‘æ³¨å†Œç”¨æˆ·äº†ï¼Œåœ¨ç½‘ç«™ç™»å½•ä¹Ÿæ²¡é—®é¢˜å‘€ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æˆ‘æ³¨å†Œç”¨æˆ·-pinkman-äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³•-docker-push-mrwhite-xxx-å•Šï¼Ÿ"><span class="toc-number">6.3.</span> <span class="toc-text">æˆ‘æ³¨å†Œç”¨æˆ· pinkman äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯æ— æ³• docker push mrwhite/xxx å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å›-docker-push-pinkman-xxx-äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ"><span class="toc-number">6.4.</span> <span class="toc-text">ä¸ç®¡ç”¨å•Šï¼Œæˆ‘è¿™å› docker push pinkman/xxx äº†ï¼Œæ€ä¹ˆå‘Šè¯‰æˆ‘é•œåƒä¸å­˜åœ¨å•Šï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-push-åˆ°ç§æœ‰-registry-æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="toc-number">6.5.</span> <span class="toc-text">docker push åˆ°ç§æœ‰ registry æ€»æ˜¯ä¸æˆåŠŸï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æˆ‘-docker-push-äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„-registry-ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ"><span class="toc-number">6.6.</span> <span class="toc-text">æˆ‘ docker push äº†å¾ˆå¤šé•œåƒåˆ°ç§æœ‰çš„ registry ä¸Šï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹ä¸Šé¢éƒ½æœ‰å•¥ï¼Ÿæˆ–è€…æœç´¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-search-ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰-Registry-ä¸­ç”¨ï¼Ÿ"><span class="toc-number">6.7.</span> <span class="toc-text">docker search ä¸ºä»€ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ç§æœ‰ Registry ä¸­ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¦‚ä½•åˆ é™¤ç§æœ‰-registry-ä¸­çš„é•œåƒï¼Ÿ"><span class="toc-number">6.8.</span> <span class="toc-text">å¦‚ä½•åˆ é™¤ç§æœ‰ registry ä¸­çš„é•œåƒï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š-docker-ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ"><span class="toc-number">6.9.</span> <span class="toc-text">ä½¿ç”¨å›½å†…é•œåƒè¿˜æ˜¯æ…¢ï¼Œå…¬å¸å†…å¥½å¤š docker ä¸»æœºï¼Œéƒ½éœ€è¦å»é‡å¤ä¸‹è½½é•œåƒï¼Œå’‹åŠï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è‡ªå·±æ¶çš„-registry-æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ"><span class="toc-number">6.10.</span> <span class="toc-text">è‡ªå·±æ¶çš„ registry æ€ä¹ˆä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥å–åˆ°é•œåƒï¼Ÿè¿™ä¸å®‰å…¨å•Šï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ç³»ç»Ÿç›¸å…³é—®é¢˜-7"><span class="toc-number">7.</span> <span class="toc-text">ç³»ç»Ÿç›¸å…³é—®é¢˜ (7)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CentOS-RHEL-çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜"><span class="toc-number">7.1.</span> <span class="toc-text">CentOS/RHEL çº¢å¸½ç³»ç»Ÿç‰¹æœ‰é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åœ¨-CentOS-6-ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰-Docker-1-7-è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ"><span class="toc-number">7.1.1.</span> <span class="toc-text">åœ¨ CentOS 6 ä¸Šå®‰è£…åæ€ä¹ˆæœ€é«˜åªæœ‰ Docker 1.7 è¿™ä¸ªç‰ˆæœ¬ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ-Permission-deniedï¼Œæ²¡æƒé™"><span class="toc-number">7.1.2.</span> <span class="toc-text">æŒ‚è½½å®¿ä¸»ç›®å½•ï¼Œç»“æœ Permission deniedï¼Œæ²¡æƒé™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerçš„-var-lib-docker-devicemapper-å ç”¨ç©ºé—´ä¸æ–­å¢é•¿-æ€ä¹ˆç ´ï¼Ÿ"><span class="toc-number">7.1.3.</span> <span class="toc-text">Dockerçš„ /var/lib/docker/devicemapper å ç”¨ç©ºé—´ä¸æ–­å¢é•¿, æ€ä¹ˆç ´ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-7-çš„å†…æ ¸å¤ªè€äº†-3-10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š-Docker-åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ"><span class="toc-number">7.1.4.</span> <span class="toc-text">CentOS 7 çš„å†…æ ¸å¤ªè€äº† 3.10ï¼Œæ˜¯ä¸æ˜¯å¾ˆå¤š Docker åŠŸèƒ½ä¸æ”¯æŒï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CentOS-7-RHEL-7-å‡çº§-1-12-åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ"><span class="toc-number">7.1.5.</span> <span class="toc-text">CentOS 7/RHEL 7 å‡çº§ 1.12 åï¼Œæ— æ³•å¯åŠ¨ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mac-Windows-ç›¸å…³é—®é¢˜"><span class="toc-number">7.2.</span> <span class="toc-text">Mac / Windows ç›¸å…³é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆåœ¨Macä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•-usr-local-nginxä¸æˆåŠŸï¼Ÿ"><span class="toc-number">7.2.1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆåœ¨Macä¸‹æŒ‚è½½å®¿ä¸»ç›®å½•/usr/local/nginxä¸æˆåŠŸï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å¬è¯´-Windows-10ã€Windows-Server-2016-å†…ç½®-Docker-äº†ï¼Ÿå’Œ-Docker-å®˜ç½‘ä¸‹è½½çš„-Docker-for-Windows-æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ"><span class="toc-number">7.2.2.</span> <span class="toc-text">å¬è¯´ Windows 10ã€Windows Server 2016 å†…ç½® Docker äº†ï¼Ÿå’Œ Docker å®˜ç½‘ä¸‹è½½çš„ Docker for Windows æœ‰ä»€ä¹ˆåŒºåˆ«å•Šï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å…¶å®ƒé—®é¢˜-1"><span class="toc-number">8.</span> <span class="toc-text">å…¶å®ƒé—®é¢˜ (1)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå«-k8s-ï¼Ÿ"><span class="toc-number">8.1.</span> <span class="toc-text">Kubernetes è¿™è¯å’‹å¿µå•Šï¼Ÿä¸ºå•¥æœ‰äººç®¡å®ƒå« k8s ï¼Ÿ</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- åœ¨ejsä¸­å°†archiveæŒ‰ç…§æ—¶é—´æ’åº -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 29
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2020 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/03</span><a class="archive-post-title" href= "/2020/06/03/kubefed-SyncController/" >Kubefed - Sync Controller</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/02</span><a class="archive-post-title" href= "/2020/06/02/kubefed-FTCcontroller/" >Kubefed - FTC Controller</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/01</span><a class="archive-post-title" href= "/2020/06/01/kubefed-clustercontroller/" >Kubefed - ClusterController</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/24</span><a class="archive-post-title" href= "/2019/11/24/k8s-storage/" >Kubernetes Storage</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/17</span><a class="archive-post-title" href= "/2019/04/17/Kubernetes-s-API/" >Kubernetes's API</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span><a class="archive-post-title" href= "/2019/03/27/Istio-s-traffic-management/" >Istio's traffic management</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span><a class="archive-post-title" href= "/2019/03/27/Views-about-the-struct-of-istio/" >Views about the struct of istio</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/25</span><a class="archive-post-title" href= "/2019/03/25/Install-istio-with-helm/" >Install Istio using helm</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/18</span><a class="archive-post-title" href= "/2019/03/18/Install-Helm-with-k8s/" >Install Helm for k8s</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/15</span><a class="archive-post-title" href= "/2019/03/15/Install-K8S-dashboard/" >Install K8S dashboard with ingress</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/10</span><a class="archive-post-title" href= "/2019/03/10/Install-K8S-with-kubeadm/" >Install a single master K8S cluster with kubeadm</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/24</span><a class="archive-post-title" href= "/2019/01/24/Go-Core-Interface/" >Go Core Dev Interface</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/23</span><a class="archive-post-title" href= "/2019/01/23/Go-Core-TypeSystem/" >Go Core Dev Type-System</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/17</span><a class="archive-post-title" href= "/2019/01/17/Go-Core-Function/" >Go Core Dev Function</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/15</span><a class="archive-post-title" href= "/2019/01/15/Go-Core-Base/" >Go Core Dev Base</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2018 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/2018/09/09/Go-Primer/" >Go Primer</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2018/08/24/Kubernetes StatefulSet/" >Kubernetes StatefulSet</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/24</span><a class="archive-post-title" href= "/2018/08/24/contribute-to-opensource/" >How to contribute to open source projects</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/20</span><a class="archive-post-title" href= "/2018/08/20/Linux-namespace/" >Views about Namespace & Cgroups of Linux Kernel</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/17</span><a class="archive-post-title" href= "/2018/07/17/K8S-InfoCollection/" >Kubernetes Information Collection</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">07/01</span><a class="archive-post-title" href= "/2018/07/01/Scraping-Primer/" >Scraping-Primer</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/21</span><a class="archive-post-title" href= "/2018/06/21/Linux-Primer/" >Linux-Primer</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/15</span><a class="archive-post-title" href= "/2018/06/15/Docker-faq/" >Docker-FAQ</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2017 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/12</span><a class="archive-post-title" href= "/2017/12/12/Binary-tree/" >Binary tree  of Data Structure</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/12</span><a class="archive-post-title" href= "/2017/12/12/Graph-traversal/" >Graph traversal  of Data Structure</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/28</span><a class="archive-post-title" href= "/2017/10/28/search/" >Search of Data Structure</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span><a class="archive-post-title" href= "/2017/10/24/struct/" >Concept of Data Structure</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/23</span><a class="archive-post-title" href= "/2017/10/23/sort/" >Sort of Data Structure</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/20</span><a class="archive-post-title" href= "/2017/10/20/Docker-Primer/" >Docker-Primer</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="Data Structure"><span class="iconfont-archer">&#xe606;</span>Data Structure</span>
    
        <span class="sidebar-tag-name" data-tags="docker"><span class="iconfont-archer">&#xe606;</span>docker</span>
    
        <span class="sidebar-tag-name" data-tags="Go"><span class="iconfont-archer">&#xe606;</span>Go</span>
    
        <span class="sidebar-tag-name" data-tags="k8s"><span class="iconfont-archer">&#xe606;</span>k8s</span>
    
        <span class="sidebar-tag-name" data-tags="istio"><span class="iconfont-archer">&#xe606;</span>istio</span>
    
        <span class="sidebar-tag-name" data-tags="Linux"><span class="iconfont-archer">&#xe606;</span>Linux</span>
    
        <span class="sidebar-tag-name" data-tags="scraping"><span class="iconfont-archer">&#xe606;</span>scraping</span>
    
        <span class="sidebar-tag-name" data-tags="open-source"><span class="iconfont-archer">&#xe606;</span>open-source</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    ç¼ºå¤±æ¨¡å—ã€‚<br/>
    1ã€è¯·ç¡®ä¿nodeç‰ˆæœ¬å¤§äº6.2<br/>
    2ã€åœ¨åšå®¢æ ¹ç›®å½•ï¼ˆæ³¨æ„ä¸æ˜¯archeræ ¹ç›®å½•ï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3ã€åœ¨æ ¹ç›®å½•_config.ymlé‡Œæ·»åŠ é…ç½®ï¼š
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Linus Lee"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->    
     
    </body>
</html>


